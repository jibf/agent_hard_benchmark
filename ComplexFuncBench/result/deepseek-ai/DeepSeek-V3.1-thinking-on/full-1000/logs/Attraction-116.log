2025-08-25 13:18:06,883 - evaluation_logger_Attraction-116 - INFO - Test Example Attraction-116
2025-08-25 13:18:06,883 - evaluation_logger_Attraction-116 - INFO - Query: Can you find the two most trending attractions in Seoul and provide a detailed comparison of them? Also, check if there are any tickets available for both attractions in October.
2025-08-25 13:18:17,479 - evaluation_logger_Attraction-116 - INFO - Function Calls: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Seoul"
        }
    }
]

2025-08-25 13:18:17,481 - evaluation_logger_Attraction-116 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Seoul, Korea"
        }
    },
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi03MTY1ODN9",
            "sortBy": "trending"
        }
    }
]

2025-08-25 13:18:18,484 - evaluation_logger_Attraction-116 - INFO - Start compare_single_call: 
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Seoul'}}
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Seoul, Korea'}}
2025-08-25 13:18:27,624 - evaluation_logger_Attraction-116 - DEBUG - LLM-based comparison output: {'is_equal': True, 'reason': "The parameter 'query' in both function calls refers to the same location, 'Seoul'. The addition of ', Korea' in Function call 2 does not change the meaning of the location, as 'Seoul' is commonly understood to be in Korea. Therefore, both function calls are equivalent."}
2025-08-25 13:18:27,624 - evaluation_logger_Attraction-116 - INFO - LLM-based compare success.
2025-08-25 13:18:27,624 - evaluation_logger_Attraction-116 - INFO - Success matched: [{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Seoul, Korea'}}]
2025-08-25 13:18:27,624 - evaluation_logger_Attraction-116 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "products": [
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJjcDdNY3NGNzA5IiwidWZpIjotNzE2NTgzfQ==",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Private tour guide service in Seoul, Korea",
                    "productId": "PRcp7McsF709",
                    "productSlug": "prcp7mcsf709-private-tour-guide-service-in-seoul-korea",
                    "taxonomySlug": "tours",
                    "cityUfi": -716583,
                    "cityName": "Seoul",
                    "countryCode": "kr"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJtaXRCckpEVml6IiwidWZpIjotNzE2NTgzfQ==",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Gangnam Walking Tour on Youth and Society in Seoul Korea",
                    "productId": "PRmitBrJDViz",
                    "productSlug": "prmitbrjdviz-gangnam-walking-tour-on-youth-and-society-in-seoul-korea",
                    "taxonomySlug": "tours",
                    "cityUfi": -716583,
                    "cityName": "Seoul",
                    "countryCode": "kr"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFI1cmRnS3RGZzh1IiwidWZpIjotNzE2NTgzfQ==",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Seoul: War Memorial of Korea Walking Tour",
                    "productId": "PR5rdgKtFg8u",
                    "productSlug": "pr5rdgktfg8u-taste-of-seoul-hannam-dong-hallyu-tour",
                    "taxonomySlug": "tours",
                    "cityUfi": -716583,
                    "cityName": "Seoul",
                    "countryCode": "kr"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJycXk1U0d1TFQ4IiwidWZpIjotNzE2NTgzfQ==",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Korea DMZ from Seoul and War Memorial of Korea Day Tour",
                    "productId": "PRrqy5SGuLT8",
                    "productSlug": "prrqy5sgult8-korea-dmz-from-seoul-and-war-memorial-of-korea-day-tour",
                    "taxonomySlug": "tours",
                    "cityUfi": -716583,
                    "cityName": "Seoul",
                    "countryCode": "kr"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJOVGZ4dE1FZEhhIiwidWZpIjotNzE2NTgzfQ==",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "N Seoul Tower Observatory Ticket South Korea",
                    "productId": "PRNTfxtMEdHa",
                    "productSlug": "prntfxtmedha-n-seoul-tower-observatory-ticket-south-korea",
                    "taxonomySlug": "tours",
                    "cityUfi": -716583,
                    "cityName": "Seoul",
                    "countryCode": "kr"
                }
            ],
            "destinations": [
                {
                    "id": "eyJ1ZmkiOi03MTY1ODN9",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": -716583,
                    "country": "South Korea",
                    "cityName": "Seoul",
                    "productCount": 671,
                    "cc1": "kr"
                }
            ]
        }
    }
]

2025-08-25 13:18:37,079 - evaluation_logger_Attraction-116 - INFO - Function Calls: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi03MTY1ODN9",
            "sortBy": "trending"
        }
    }
]

2025-08-25 13:18:37,079 - evaluation_logger_Attraction-116 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi03MTY1ODN9",
            "sortBy": "trending"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRT8And0S5eI"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRGMWJxJKBXA"
        }
    },
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "prt8and0s5ei-demilitarized-zone-dmz-guided-tour"
        }
    },
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "prgmwjxjkbxa-dmz-group-tour-3rd-invasion-tunnel-suspension-bridge-from-seoul"
        }
    }
]

2025-08-25 13:18:37,080 - evaluation_logger_Attraction-116 - INFO - Start compare_single_call: 
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi03MTY1ODN9', 'sortBy': 'trending'}}
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi03MTY1ODN9', 'sortBy': 'trending'}}
2025-08-25 13:18:37,080 - evaluation_logger_Attraction-116 - INFO - Rule-based compare success.
2025-08-25 13:18:37,080 - evaluation_logger_Attraction-116 - INFO - Success matched: [{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi03MTY1ODN9', 'sortBy': 'trending'}}]
2025-08-25 13:18:37,080 - evaluation_logger_Attraction-116 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProductSearchResponse",
            "products": [
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRT8And0S5eI",
                    "name": "Demilitarized Zone (DMZ) Guided Tour",
                    "slug": "prt8and0s5ei-demilitarized-zone-dmz-guided-tour",
                    "shortDescription": "Educational tour around the buffer zone between North and South Korea",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 51.81,
                        "currency": "USD",
                        "publicAmount": 51.81
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 59,
                        "percentage": "100%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.8,
                            "total": 3102
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Oryong dong",
                        "ufi": -712730
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIO4mm7SBwo8"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIUL88H1Cz68"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIoyjlXaw6nW"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OILGb7ELpupU"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI2TwnmJn6Ej"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI4XHFbKNAsp"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIEvHBKQqZNb"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 1
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRGMWJxJKBXA",
                    "name": "DMZ Tour: 3rd Tunnel, Option(Suspension Bridge, Boat) from Seoul",
                    "slug": "prgmwjxjkbxa-dmz-group-tour-3rd-invasion-tunnel-suspension-bridge-from-seoul",
                    "shortDescription": "1. The most safe DMZ Tour with with reliable company having NO accident at all since of 2018 \n\n2....",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 55,
                        "currency": "USD",
                        "publicAmount": 55
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.8,
                            "total": 501
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Seoul",
                        "ufi": -716583
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIPdYkCLY4CX"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIdd7ZhpCjmX"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI16HsmbOWu8"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIOhJnnt1r88"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI2yEDp7dAAa"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OItQMUZzn5qs"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIMuFUrG6Xck"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OILMeAziLwmp"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIsSRWAuxTKT"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI8CeU91agad"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 2
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRfpWVukOiJK",
                    "name": "South Korea eSIM (3-30 days. Up to 45GB)",
                    "slug": "prfpwvukoijk-south-korea-esim-3-30-days-up-to-45gb",
                    "shortDescription": "Get this eSim to stay connected friends and family, and to find your way around town. The eSim al...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 5,
                        "currency": "USD",
                        "publicAmount": 5
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Seoul",
                        "ufi": -716583
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIvKr3yn6QhD"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIeywCA7q6BC"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIwjXu2izMCQ"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OInglCp3Rzuh"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIsQQpU25c9m"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    }
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRokOVI85yOy",
                    "name": "Best DMZ Tour Korea from Seoul (Red Suspension Bridge Optional)",
                    "slug": "prokovi85yoy-best-dmz-3rd-infiltration-tunnel-tour-from-seoul-no-shopping",
                    "shortDescription": "What is the DMZ – an exciting experience like no other\n\nWhile the Cold War happened a long time a...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 55,
                        "currency": "USD",
                        "publicAmount": 55
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.7,
                            "total": 971
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Seoul",
                        "ufi": -716583
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIMYDo40GaG3"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI2AgbNuQboU"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIq73AgDyqXS"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIYzzMtDEHoY"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIWFZbZQ1zau"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI1BAYo4dOxu"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIdbppSUoWwa"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIKYMeOIaN4x"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIZjUqEBIdiu"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 3
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRsYE50174B1",
                    "name": "Rare Chance : The Korea's White House Walking Tour",
                    "slug": "prsye50174b1-the-blue-house-walking-tour-cheong-wa-dae",
                    "shortDescription": "#1 The Exclusive Blue House Tour\n(Korea's White House Tour)\n\nThe Blue House, Korea's equivalent t...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 35.99,
                        "currency": "USD",
                        "publicAmount": 35.99
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.9,
                            "total": 110
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Seoul",
                        "ufi": -716583
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OILgC46lWu6t"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI5QfRiquOOD"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 7
                        }
                    ]
                }
            ],
            "filterStats": {
                "__typename": "FilterStats",
                "unfilteredProductCount": 652,
                "filteredProductCount": 652
            },
            "sorters": [
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Our top picks",
                    "value": "trending"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Most popular",
                    "value": "attr_book_score"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Lowest price",
                    "value": "lowest_price"
                }
            ],
            "defaultSorter": {
                "__typename": "AttractionsSorterOption",
                "name": "Our top picks",
                "value": "trending"
            },
            "filterOptions": {
                "__typename": "FilterOptions",
                "typeFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Tours",
                        "tagname": "tours",
                        "productCount": 102
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Museums, arts & culture",
                        "tagname": "museums-arts-culture",
                        "productCount": 69
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Nature & outdoor",
                        "tagname": "nature-outdoor",
                        "productCount": 50
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Entertainment & tickets",
                        "tagname": "entertainment-tickets",
                        "productCount": 41
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Food & drinks",
                        "tagname": "food-drinks",
                        "productCount": 16
                    }
                ],
                "labelFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Free cancellation",
                        "tagname": "free_cancellation",
                        "productCount": 614
                    }
                ],
                "ufiFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Seoul",
                        "tagname": "-716583",
                        "productCount": 622
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Incheon",
                        "tagname": "-708814",
                        "productCount": 25
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Suwon",
                        "tagname": "-716880",
                        "productCount": 4
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Oryong dong",
                        "tagname": "-712730",
                        "productCount": 1
                    }
                ],
                "priceFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "US$0 - US$22",
                        "tagname": "b0",
                        "productCount": 48
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$22 - US$44",
                        "tagname": "b1",
                        "productCount": 43
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$44 - US$83",
                        "tagname": "b2",
                        "productCount": 190
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$83 - US$138",
                        "tagname": "b3",
                        "productCount": 127
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$138+",
                        "tagname": "b4",
                        "productCount": 251
                    }
                ]
            }
        }
    }
]

2025-08-25 13:18:50,992 - evaluation_logger_Attraction-116 - INFO - Function Calls: 
[
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "prt8and0s5ei-demilitarized-zone-dmz-guided-tour"
        }
    },
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "prgmwjxjkbxa-dmz-group-tour-3rd-invasion-tunnel-suspension-bridge-from-seoul"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRT8And0S5eI"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRGMWJxJKBXA"
        }
    }
]

2025-08-25 13:18:50,992 - evaluation_logger_Attraction-116 - INFO - Golden Function Call: 
[
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRT8And0S5eI"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRGMWJxJKBXA"
        }
    },
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "prt8and0s5ei-demilitarized-zone-dmz-guided-tour"
        }
    },
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "prgmwjxjkbxa-dmz-group-tour-3rd-invasion-tunnel-suspension-bridge-from-seoul"
        }
    }
]

2025-08-25 13:18:50,993 - evaluation_logger_Attraction-116 - INFO - Start compare_single_call: 
{'name': 'Get_Attraction_Details', 'arguments': {'slug': 'prt8and0s5ei-demilitarized-zone-dmz-guided-tour'}}
{'name': 'Get_Attraction_Details', 'arguments': {'slug': 'prt8and0s5ei-demilitarized-zone-dmz-guided-tour'}}
2025-08-25 13:18:50,993 - evaluation_logger_Attraction-116 - INFO - Rule-based compare success.
2025-08-25 13:18:50,993 - evaluation_logger_Attraction-116 - INFO - Start compare_single_call: 
{'name': 'Get_Attraction_Details', 'arguments': {'slug': 'prgmwjxjkbxa-dmz-group-tour-3rd-invasion-tunnel-suspension-bridge-from-seoul'}}
{'name': 'Get_Attraction_Details', 'arguments': {'slug': 'prgmwjxjkbxa-dmz-group-tour-3rd-invasion-tunnel-suspension-bridge-from-seoul'}}
2025-08-25 13:18:50,993 - evaluation_logger_Attraction-116 - INFO - Rule-based compare success.
2025-08-25 13:18:50,993 - evaluation_logger_Attraction-116 - INFO - Start compare_single_call: 
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRT8And0S5eI'}}
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRT8And0S5eI'}}
2025-08-25 13:18:50,993 - evaluation_logger_Attraction-116 - INFO - Rule-based compare success.
2025-08-25 13:18:50,993 - evaluation_logger_Attraction-116 - INFO - Start compare_single_call: 
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRGMWJxJKBXA'}}
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRGMWJxJKBXA'}}
2025-08-25 13:18:50,993 - evaluation_logger_Attraction-116 - INFO - Rule-based compare success.
2025-08-25 13:18:50,993 - evaluation_logger_Attraction-116 - INFO - Success matched: [{'name': 'Get_Attraction_Details', 'arguments': {'slug': 'prt8and0s5ei-demilitarized-zone-dmz-guided-tour'}}, {'name': 'Get_Attraction_Details', 'arguments': {'slug': 'prgmwjxjkbxa-dmz-group-tour-3rd-invasion-tunnel-suspension-bridge-from-seoul'}}, {'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRT8And0S5eI'}}, {'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRGMWJxJKBXA'}}]
2025-08-25 13:18:50,994 - evaluation_logger_Attraction-116 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProduct",
            "accessibility": [
                "Wheelchair accessible"
            ],
            "additionalInfo": "Please bring your ticket with you to the attraction.\n\nBe aware that operators may cancel for unforeseen reasons.\n\nYou need to be 18 years or older to book or be accompanied by an adult. ",
            "applicableTerms": [
                {
                    "__typename": "TermsConditions",
                    "policyProvider": "Booking.com"
                },
                {
                    "__typename": "TermsConditions",
                    "policyProvider": "Klook"
                }
            ],
            "cancellationPolicy": {
                "__typename": "AttractionsCancellationPolicy",
                "hasFreeCancellation": true
            },
            "description": "This tour will take you to the Korean Demilitarized Zone (DMZ), where you'll gain insights into the Korean War and Cold War. The tour will include stops at Imjingak Park, the Freedom Bridge, 3rd Infiltration Tunnel as well as a DMZ exhibition hall. You'll also make your way up to the summit of an observatory tower to get a bird's-eye view of North Korea.",
            "flags": [
                {
                    "__typename": "AttractionsProductFlags",
                    "flag": "bestseller",
                    "value": true,
                    "rank": 1
                }
            ],
            "id": "PRT8And0S5eI",
            "isBookable": true,
            "labels": [
                {
                    "__typename": "AttractionsLabel",
                    "text": "Free cancellation",
                    "type": "free_cancellation"
                }
            ],
            "name": "Demilitarized Zone (DMZ) Guided Tour",
            "offers": [
                {
                    "__typename": "Offer",
                    "availabilityType": "date_time",
                    "id": "OFEesaOfdxsR"
                },
                {
                    "__typename": "Offer",
                    "availabilityType": "date_time",
                    "id": "OFikzouRNgw0"
                },
                {
                    "__typename": "Offer",
                    "availabilityType": "date_time",
                    "id": "OFUhsa98F0Uv"
                },
                {
                    "__typename": "Offer",
                    "availabilityType": "date_time",
                    "id": "OFSKm8UyCt1T"
                }
            ],
            "onSiteRequirements": {
                "__typename": "OnSiteRequirements"
            },
            "operatedBy": "Klook",
            "representativePrice": {
                "__typename": "AttractionsPrice",
                "chargeAmount": 51.95,
                "currency": "USD",
                "publicAmount": 51.95
            },
            "restrictions": [
                "Passport needed"
            ],
            "reviews": {
                "__typename": "AttractionsGetReviewsResponse",
                "total": 426,
                "reviews": [
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSnrryzUTlkk",
                        "epochMs": 1729507346000,
                        "language": "en-gb",
                        "numericRating": 5,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "peter",
                            "cc1": "au"
                        }
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSjZJwMfEP8O",
                        "epochMs": 1729439118000,
                        "language": "fr",
                        "numericRating": 5,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "Benoit",
                            "cc1": "fr"
                        }
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSl5sMX0c4et",
                        "epochMs": 1729428672000,
                        "language": "de",
                        "numericRating": 3,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "Walter",
                            "cc1": "de"
                        }
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSx3JgGMChjm",
                        "epochMs": 1729333456000,
                        "numericRating": 5
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RS7Yp4NnbXSV",
                        "epochMs": 1729244594000,
                        "numericRating": 4,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "Hai Sun"
                        }
                    }
                ]
            },
            "reviewsStats": {
                "__typename": "AttractionsProductReviewStats",
                "allReviewsCount": 59,
                "percentage": "100%",
                "combinedNumericStats": {
                    "__typename": "AttractionsProductCombinedReviewStats",
                    "average": 4.8,
                    "total": 3102
                }
            },
            "shortDescription": "Educational tour around the buffer zone between North and South Korea",
            "slug": "prt8and0s5ei-demilitarized-zone-dmz-guided-tour",
            "supportedFeatures": {
                "__typename": "AttractionsProductSupportedFeatures",
                "nativeApp": true,
                "nativeAppBookProcess": false,
                "liveAvailabilityCheckSupported": true
            },
            "ufiDetails": {
                "__typename": "AttractionLocationResponse",
                "ufi": -712730,
                "bCityName": "Oryong dong"
            }
        }
    },
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProduct",
            "additionalInfo": "Infants are required to sit on an adult’s lap\n\nNot recommended for travelers with spinal injuries\n\nNot recommended for travelers with poor cardiovascular health\n\nNot recommended for pregnant travelers\n\nTravelers should have at least a moderate level of physical fitness\n\nA current valid passport is required on the day of travel\n\nSchedule and details can be changed due to unexpected situations including military training schedule changes, traffic, weathers\n\nIt is not recommended/restricted to those who have health issue\n\n\n\nNot wheelchair accessible\n\nPlease bring your ticket with you to the attraction.\n\nBe aware that operators may cancel for unforeseen reasons.\n\nYou need to be 18 years or older to book or be accompanied by an adult. ",
            "applicableTerms": [
                {
                    "__typename": "TermsConditions",
                    "policyProvider": "Booking.com"
                },
                {
                    "__typename": "TermsConditions",
                    "policyProvider": "Viator"
                }
            ],
            "cancellationPolicy": {
                "__typename": "AttractionsCancellationPolicy",
                "hasFreeCancellation": true
            },
            "description": "1. The most safe DMZ Tour with with reliable company having NO accident at all since of 2018 \n\n2.Well-organized Group DMZ Budget Tour \nYou can enjoy the well made full-day tour with affordable prices with our professional guide.\n\n3. No Shopping\nWe never take your time away for unnecessary shopping center! We care customers' satisfaction and valuable time!\n\n4. DMZ and optional choice\n\n-Option 1 DMZ Only Essential Tour (Halfday) with no option\n-Option 2 DMZ + Mt.Gamaksan Suspension Bridge \n-Option 3 DMZ + Lake Majang Suspension Bridge\n-Option 4 DMZ + Imjin River Boat riding\n\nEssential tour doesn't include suspension Bridge, Boat Riding at all",
            "flags": [
                {
                    "__typename": "AttractionsProductFlags",
                    "flag": "bestseller",
                    "value": true,
                    "rank": 2
                }
            ],
            "id": "PRGMWJxJKBXA",
            "isBookable": true,
            "labels": [
                {
                    "__typename": "AttractionsLabel",
                    "text": "Free cancellation",
                    "type": "free_cancellation"
                }
            ],
            "name": "DMZ Tour: 3rd Tunnel, Option(Suspension Bridge, Boat) from Seoul",
            "notIncluded": [
                "Lunch",
                "Travel insurance",
                "Anything not mentioned in details"
            ],
            "offers": [
                {
                    "__typename": "Offer",
                    "availabilityType": "date_time",
                    "id": "OFldYyIOhjyz"
                },
                {
                    "__typename": "Offer",
                    "availabilityType": "date_time",
                    "id": "OFH4O2Eg0vdu"
                },
                {
                    "__typename": "Offer",
                    "availabilityType": "date_time",
                    "id": "OFQ6wwS6jrSb"
                },
                {
                    "__typename": "Offer",
                    "availabilityType": "date_time",
                    "id": "OFhGGJoX4ZoX"
                },
                {
                    "__typename": "Offer",
                    "availabilityType": "date_time",
                    "id": "OFOhZIneOPRF"
                }
            ],
            "onSiteRequirements": {
                "__typename": "OnSiteRequirements"
            },
            "operatedBy": "PLK TRAVEL",
            "representativePrice": {
                "__typename": "AttractionsPrice",
                "chargeAmount": 55,
                "currency": "USD",
                "publicAmount": 55
            },
            "reviews": {
                "__typename": "AttractionsGetReviewsResponse",
                "total": 182,
                "reviews": [
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSO0m9v5IZA9",
                        "epochMs": 1729513142000,
                        "language": "fi",
                        "numericRating": 4,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "Ari Pekka",
                            "cc1": "fi"
                        }
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSWUTh7ZthGm",
                        "epochMs": 1729493683000,
                        "numericRating": 5
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSmwhzPScvgl",
                        "epochMs": 1729133544000,
                        "language": "cs",
                        "numericRating": 4,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "Vladimir",
                            "cc1": "cz"
                        }
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSqfN0Pgq9t8",
                        "content": "Very interesting place to visit.",
                        "epochMs": 1728891309000,
                        "language": "en-gb",
                        "numericRating": 4,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "Richard Thant",
                            "cc1": "au"
                        }
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSRSHdeTW9z0",
                        "epochMs": 1728631695000,
                        "numericRating": 5,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "Sandra",
                            "cc1": "au"
                        }
                    }
                ]
            },
            "reviewsStats": {
                "__typename": "AttractionsProductReviewStats",
                "allReviewsCount": 0,
                "percentage": "0",
                "combinedNumericStats": {
                    "__typename": "AttractionsProductCombinedReviewStats",
                    "average": 4.8,
                    "total": 501
                }
            },
            "slug": "prgmwjxjkbxa-dmz-group-tour-3rd-invasion-tunnel-suspension-bridge-from-seoul",
            "supportedFeatures": {
                "__typename": "AttractionsProductSupportedFeatures",
                "nativeApp": true,
                "nativeAppBookProcess": false,
                "liveAvailabilityCheckSupported": true
            },
            "ufiDetails": {
                "__typename": "AttractionLocationResponse",
                "ufi": -716583,
                "bCityName": "Seoul"
            },
            "whatsIncluded": [
                "Admission fees to DMZ",
                "Roundtrip Trasnfer from Seoul",
                "Licensed Professional Tour Guide"
            ]
        }
    },
    {
        "status": true,
        "message": "Success",
        "timestamp": 1729531432844,
        "data": [
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-10-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-10-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-10-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-31"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-11-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-11-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-11-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-11-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-31"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-19"
            }
        ]
    },
    {
        "status": true,
        "message": "Success",
        "timestamp": 1729531456819,
        "data": [
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-10-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-10-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-10-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-31"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-11-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-11-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-11-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-11-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-31"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-19"
            }
        ]
    }
]

2025-08-25 13:22:11,129 - evaluation_logger_Attraction-116 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 概述

本文，我们来分享 [MyBatis 的脚本模块](https://github.com/YunaiV/mybatis-3/tree/master/src/main/java/org/apache/ibatis/scripting)，对应 `scripting` 包。如下图所示：[![`scripting` 包](http://static.iocoder.cn/images/MyBatis/2020_02_04/01.png)](http://static.iocoder.cn/images/MyBatis/2020_02_04/01.png)`scripting` 包

在 [《精尽 MyBatis 源码解析 —— 项目结构一览》](http://svip.iocoder.cn/MyBatis/intro) 中，简单介绍了这个模块如下：

> 拼凑 SQL 语句是一件烦琐且易出错的过程，MyBatis 支持动态 SQL 功能，通过 MyBatis 提供的各种动态 SQL 标签，例如`<where>`、`<if>`等，并配合 OGNL 表达式，我们可以很方便的拼凑出复杂的 SQL 语句。

- 实际上，`scripting` 模块，就是实现了 MyBatis 的**动态 SQL 语句**的功能。
- 当然，`scripting` 模块的代码量不多，但是难度不小。因为，需要具备一些“动态”编程的思维。

本文，我们会先看看 `scripting` 模块的**大体结构**。然后，选择一个动态 SQL 标签的例子，看看 MyBatis 是如何执行的。最后，我们会对 `scripting` 模块的每个包，进行详细解析。

# 2. 整体结构

`scripting` 模块的代码结构，如下图：[![代码结构](http://static.iocoder.cn/images/MyBatis/2020_02_04/02.png)](http://static.iocoder.cn/images/MyBatis/2020_02_04/02.png)代码结构

- `defaults` 包：默认语言实现。目前，MyBatis 仅仅提供了基于 **XML** 的动态语句实现。
- `xmltags` 包：XML 动态语句实现。基于 `defaults` 包，提供各种动态 SQL 标签的解析和处理。
- `language` 包：语言驱动接口。`scripting` 模块，通过语言驱动，创建对应语言的 **SQL 节点( `SqlNode` )** 树。目前，`language` 包下，提供了 `LanguageDriver`、`LanguageDriverRegistry` 接口，和 `XMLLanguageDriver` 默认实现类。
- 根目录：`scripting` 模块，暴露给外部调用的 API 。例如，`SqlSource` 接口。

# 3. 简单示例

在我们看具体每个包的具体代码之前，我们先来看一个 MyBatis 动态 SQL 语句的示例。代码如下：

```xml
<select id="getUserList" parameterType="User" resultType="User">
    SELECT * FROM user
    <where>
        <if test="name != null and name != ''">
            AND name like CONCAT('%', #{name}, '%')
        </if>
        <if test="age != null">
            AND age = #{age}
        </if>
    </where>
</select>
```

- 动态 SQL 语句是 `scripting` 模块，通过解析 `"SELECT * ..."` 字符串，组合而成。

那么，`scripting` 模块，是如何解析该动态 SQL 语句的呢？答案见 [《精尽 MyBatis 源码分析 —— 解析器模块》](http://svip.iocoder.cn/MyBatis/parsing-package) 文章。但是，本文也会详细解析。

# 4. LanguageDriver

`org.apache.ibatis.scripting.LanguageDriver` ，语言驱动接口。代码如下：

```java
// LanguageDriver.java

public interface LanguageDriver {

    /**
     * Creates a {@link ParameterHandler} that passes the actual parameters to the the JDBC statement.
     *
     * 创建 ParameterHandler 对象。
     *
     * @param mappedStatement The mapped statement that is being executed
     * @param parameterObject The input parameter object (can be null)
     * @param boundSql The resulting SQL once the dynamic language has been executed.
     * @return the parameter handler
     * @see DefaultParameterHandler
     */
    ParameterHandler createParameterHandler(MappedStatement mappedStatement, Object parameterObject, BoundSql boundSql);

    /**
     * Creates an {@link SqlSource} that will hold the statement read from a mapper xml file.
     * It is called during startup, when the mapped statement is read from a class or an xml file.
     *
     * 创建 SqlSource 对象，从 Mapper XML 配置的 Statement 标签中，即 <select /> 等。
     *
     * @param configuration The MyBatis configuration
     * @param script XNode parsed from a XML file
     * @param parameterType input parameter type got from a mapper method or specified in the parameterType xml attribute. Can be null.
     * @return the sql source
     */
    SqlSource createSqlSource(Configuration configuration, XNode script, Class<?> parameterType);

    /**
     * Creates an {@link SqlSource} that will hold the statement read from an annotation.
     * It is called during startup, when the mapped statement is read from a class or an xml file.
     *
     * 创建 SqlSource 对象，从方法注解中，即 @Select 等。
     *
     * @param configuration The MyBatis configuration
     * @param script The content of the annotation
     * @param parameterType input parameter type got from a mapper method or specified in the parameterType xml attribute. Can be null.
     * @return the sql source
     */
    SqlSource createSqlSource(Configuration configuration, String script, Class<?> parameterType);

}
```

- 定义了创建 ParameterHandler 和 SqlSource 对象的方法。

## 4.1 XMLLanguageDriver

`org.apache.ibatis.scripting.xmltags.XMLLanguageDriver` ，实现 LanguageDriver 接口，XML 语言驱动实现类。代码如下：

```java
// XMLLanguageDriver.java

public class XMLLanguageDriver implements LanguageDriver {

    @Override
    public ParameterHandler createParameterHandler(MappedStatement mappedStatement, Object parameterObject, BoundSql boundSql) {
        // 创建 DefaultParameterHandler 对象
        return new DefaultParameterHandler(mappedStatement, parameterObject, boundSql);
    }

    @Override
    public SqlSource createSqlSource(Configuration configuration, XNode script, Class<?> parameterType) {
        // 创建 XMLScriptBuilder 对象，执行解析
        XMLScriptBuilder builder = new XMLScriptBuilder(configuration, script, parameterType);
        return builder.parseScriptNode();
    }

    @Override
    public SqlSource createSqlSource(Configuration configuration, String script, Class<?> parameterType) {
        // 如果是 <script> 开头，使用 XML 配置的方式，使用动态 SQL 
        if (script.startsWith("<script>")) {
            // 创建 XPathParser 对象，解析出 <script /> 节点
            XPathParser parser = new XPathParser(script, false, configuration.getVariables(), new XMLMapperEntityResolver());
            // 调用 #createSqlSource(Configuration, XNode, Class<?>) 方法
            return createSqlSource(configuration, parser.evalNode("/script"), parameterType);
        } else {
            // 如果是变量，则替换成对应的值
            // issue #127
            script = PropertyParser.parse(script, configuration.getVariables());
            // 创建 TextSqlNode 对象
            TextSqlNode textSqlNode = new TextSqlNode(script);
            // 如果是动态 SQL ，则创建 DynamicSqlSource 对象
            if (textSqlNode.isDynamic()) {
                return new DynamicSqlSource(configuration, textSqlNode);
            // 如果不是动态 SQL ，则创建 RawSqlSource 对象
            } else {
                return new RawSqlSource(configuration, script, parameterType);
            }
        }
    }

}
```

- 对于 `#createSqlSource(Configuration, XNode script, Class<?>)` 方法，会创建 XMLScriptBuilder 对象，执行解析。详细解析，见 [「5. XMLScriptBuilder」](http://svip.iocoder.cn/MyBatis/scripting-1/#) 。
- 对于 `#createSqlSource(Configuration, String script, Class<?>)` 方法，如果是 `<script>` 开头，则按照 XML 的方式，进行解析。否则，按照变量的方式，进行替换。最终，如果是动态 SQL ，则创建 DynamicSqlSource 对象。如果不是动态 SQL ，则创建 RawSqlSource 对象。

## 4.2 LanguageDriverRegistry

`org.apache.ibatis.scripting.LanguageDriverRegistry` ，语言驱动注册表。代码如下：

```java
// LanguageDriverRegistry.java

public class LanguageDriverRegistry {

    /**
     * LanguageDriver 映射
     */
    private final Map<Class<? extends LanguageDriver>, LanguageDriver> LANGUAGE_DRIVER_MAP = new HashMap<>();
    /**
     * 默认的 LanguageDriver 类
     */
    private Class<? extends LanguageDriver> defaultDriverClass;

    /**
     * 注册 LanguageDriver 对象
     *
     * @param driverClass LanguageDriver 类
     */
    public void register(Class<? extends LanguageDriver> driverClass) {
        if (driverClass == null) {
            throw new IllegalArgumentException("null is not a valid Language Driver");
        }
        // 创建 driverClass 对象
        if (!LANGUAGE_DRIVER_MAP.containsKey(driverClass)) {
            try {
                LANGUAGE_DRIVER_MAP.put(driverClass, driverClass.newInstance());
            } catch (Exception ex) {
                throw new ScriptingException("Failed to load language driver for " + driverClass.getName(), ex);
            }
        }
    }

    /**
     * 注册 LanguageDriver 对象
     *
     * @param instance LanguageDriver 对象
     */
    public void register(LanguageDriver instance) {
        if (instance == null) {
            throw new IllegalArgumentException("null is not a valid Language Driver");
        }
        Class<? extends LanguageDriver> driverClass = instance.getClass();
        if (!LANGUAGE_DRIVER_MAP.containsKey(driverClass)) {
            LANGUAGE_DRIVER_MAP.put(driverClass, instance);
        }
    }

    public LanguageDriver getDriver(Class<? extends LanguageDriver> cls) {
        return LANGUAGE_DRIVER_MAP.get(cls);
    }

    public LanguageDriver getDefaultDriver() {
        return getDriver(getDefaultDriverClass());
    }

    public Class<? extends LanguageDriver> getDefaultDriverClass() {
        return defaultDriverClass;
    }

    /**
     * 设置 {@link #defaultDriverClass}
     *
     * @param defaultDriverClass 默认的 LanguageDriver 类
     */
    public void setDefaultDriverClass(Class<? extends LanguageDriver> defaultDriverClass) {
        // 注册到 LANGUAGE_DRIVER_MAP 中
        register(defaultDriverClass);
        // 设置 defaultDriverClass
        this.defaultDriverClass = defaultDriverClass;
    }

}
```

- 比较简单，胖友自己看看。

在 Configuration 中，有一个 `languageRegistry` 属性，就是 LanguageDriverRegistry 类型。并且在 Configuration 的构造方法中，会进行初始化，设置默认的为 XMLLanguageDriver 类。代码如下：

```java
// Configuration.java

/**
 * 语言驱动注册表
 */
protected final LanguageDriverRegistry languageRegistry = new LanguageDriverRegistry();

public Configuration() {
    // ... 省略其它代码
    // 设置默认的 LanguageDriver 为 XMLLanguageDriver
    languageRegistry.setDefaultDriverClass(XMLLanguageDriver.class);
}
```

# 5. XMLScriptBuilder

`org.apache.ibatis.scripting.xmltags.XMLScriptBuilder` ，继承 BaseBuilder 抽象类，XML 动态语句( SQL )构建器，负责将 SQL 解析成 SqlSource 对象。

## 5.1 构造方法

```java
// XMLScriptBuilder.java

/**
 * 当前 SQL 的 XNode 对象
 */
private final XNode context;
/**
 * 是否为动态 SQL
 */
private boolean isDynamic;
/**
 * SQL 方法类型
 */
private final Class<?> parameterType;
/**
 * NodeNodeHandler 的映射
 */
private final Map<String, NodeHandler> nodeHandlerMap = new HashMap<>();

public XMLScriptBuilder(Configuration configuration, XNode context, Class<?> parameterType) {
    super(configuration);
    this.context = context;
    this.parameterType = parameterType;
    // 初始化 nodeHandlerMap 属性
    initNodeHandlerMap();
}

/**
 * 初始化 nodeHandlerMap 属性
 */
private void initNodeHandlerMap() {
    nodeHandlerMap.put("trim", new TrimHandler());
    nodeHandlerMap.put("where", new WhereHandler());
    nodeHandlerMap.put("set", new SetHandler());
    nodeHandlerMap.put("foreach", new ForEachHandler());
    nodeHandlerMap.put("if", new IfHandler());
    nodeHandlerMap.put("choose", new ChooseHandler());
    nodeHandlerMap.put("when", new IfHandler());
    nodeHandlerMap.put("otherwise", new OtherwiseHandler());
    nodeHandlerMap.put("bind", new BindHandler());
}
```

- `nodeHandlerMap` 属性，NodeNodeHandler 的映射。XMLScriptBuilder 将每个 XML 元素，解析成对应的 Node 节点。而每个 Node 节点，对应一个 NodeHandler 实现类，进行解析。

## 5.2 parseScriptNode

`#parseScriptNode()` 方法，负责解析 SQL 。代码如下：

```java
// XMLScriptBuilder.java

public SqlSource parseScriptNode() {
    // 解析 SQL
    MixedSqlNode rootSqlNode = parseDynamicTags(context);
    SqlSource sqlSource;
    // 创建 SqlSource 对象
    if (isDynamic) {
        sqlSource = new DynamicSqlSource(configuration, rootSqlNode);
    } else {
        sqlSource = new RawSqlSource(configuration, rootSqlNode, parameterType);
    }
    return sqlSource;
}
```

- 调用 `#parseDynamicTags(XNode node)` 方法，解析 SQL 成 MixedSqlNode 对象。代码如下：

  ```java
  // XMLScriptBuilder.java
  
  protected MixedSqlNode parseDynamicTags(XNode node) {
      // 创建 SqlNode 数组
      List<SqlNode> contents = new ArrayList<>();
      // 遍历 SQL 节点的所有子节点
      NodeList children = node.getNode().getChildNodes();
      for (int i = 0; i < children.getLength(); i++) {
          // 当前子节点
          XNode child = node.newXNode(children.item(i));
          // 如果类型是 CDATA 或者 TEXT 节点
          if (child.getNode().getNodeType() == Node.CDATA_SECTION_NODE || child.getNode().getNodeType() == Node.TEXT_NODE) {
              // 获得内容
              String data = child.getStringBody("");
              // 创建 TextSqlNode 对象
              TextSqlNode textSqlNode = new TextSqlNode(data);
              // 如果是动态的 TextSqlNode 对象
              if (textSqlNode.isDynamic()) {
                  // 添加到 contents 中
                  contents.add(textSqlNode);
                  // 标记为动态 SQL
                  isDynamic = true;
              // 如果是非动态的 TextSqlNode 对象
              } else {
                  // 创建 StaticTextSqlNode 添加到 contents 中
                  contents.add(new StaticTextSqlNode(data));
              }
          // 如果类型是 ELEMENT 节点
          } else if (child.getNode().getNodeType() == Node.ELEMENT_NODE) { // issue #628
              // 根据 node 的节点名，获得对应的 NodeHandler 对象
              String nodeName = child.getNode().getNodeName();
              NodeHandler handler = nodeHandlerMap.get(nodeName);
              if (handler == null) { // 获得不到，说明是未知标签，抛出 BuilderException 异常
                  throw new BuilderException("Unknown element <" + nodeName + "> in SQL statement.");
              }
              // 执行 NodeHandler 处理
              handler.handleNode(child, contents);
              // 标记为动态 SQL
              isDynamic = true;
          }
      }
      // 创建 MixedSqlNode 对象
      return new MixedSqlNode(contents);
  }
  ```

  - 看起来比较复杂，但是思路还是很清晰的。
  - 遍历 SQL 节点的所有子节点，处理每个节点，根据节点类型，如果是 CDATA 或者 TEXT 节点，则使用 TextSqlNode 或 StaticTextSqlNode 对象，记录其内容；如果是 ELEMENT 节点，则使用对应的 NodeHandler 对象，处理相应类型的节点。最终，全部节点，会记录到 `contents` 数组中。
  - 并且，如果出现任意一个动态节点，则 `isDynamic` 会标记为 `true` ，表示是动态 SQL 。

- 根据 `isDynamic` 属性，创建 DynamicSqlSource 或 RawSqlSource 对象。

## 5.3 NodeHandler

NodeHandler ，XMLScriptBuilder 的内部接口，节点处理器。代码如下：

```java
// XMLScriptBuilder.java

private interface NodeHandler {

    /**
     * 处理节点
     *
     * @param nodeToHandle 要处理的 XNode 节点
     * @param targetContents 目标的 SqlNode 数组。实际上，被处理的节点，会创建成对应的 SqlNode 对象，添加到 targetContents 中
     */
    void handleNode(XNode nodeToHandle, List<SqlNode> targetContents);

}
```

- 关于 NodeHandler 的实现类，我们放在 [「6.2 NodeHandler」](http://svip.iocoder.cn/MyBatis/scripting-1/#) 中详细解析。

# 6. SqlNode

`org.apache.ibatis.scripting.xmltags.SqlNode` ，SQL 节点接口。每个 XML Node 会解析成对应的 SQL Node 对象。代码如下：

```java
// SqlNode.java

public interface SqlNode {

    /**
     * 应用当前 SQL Node 节点
     *
     * @param context 上下文
     * @return 当前 SQL Node 节点是否应用成功。
     */
    boolean apply(DynamicContext context);

}
```

- 从接口的定义，我们可以看出，SqlNode 的核心目的是，将自身拼接到 DynamicContext 上下文中。
- 注意，返回值类型是 `boolean` ，是否应用成功。什么意思呢？有些情况下，`<if />` 标签，可能不满足条件，那么就会返回 `false` ，表示未应用成功。所以，`SqlNode` 的实现类，需要通过 `#apply(DynamicContext context)` 方法，根据当前情况，判断是否满足条件，然后生成对应的 SQL 片段，拼接到 DynamicContext 上下文中。

## 6.1 实现类

SqlNode 的实现类非常多，如下图所示：[![SqlNode 实现类](http://static.iocoder.cn/images/MyBatis/2020_02_04

2025-08-25 13:22:18,179 - evaluation_logger_Attraction-116 - INFO - Complete Result: {'score': 0, 'reason': "The response does not address any of the requested information in the user's query."}
2025-08-25 13:22:24,040 - evaluation_logger_Attraction-116 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 13:22:24,040 - evaluation_logger_Attraction-116 - INFO - Message: Success.
2025-08-25 13:22:24,040 - evaluation_logger_Attraction-116 - INFO - Success turn num = 3
2025-08-25 13:22:24,040 - evaluation_logger_Attraction-116 - INFO - ----------------------------------------------------------------------------------------------------
