2025-08-25 13:05:49,921 - evaluation_logger_Attraction-39 - INFO - Test Example Attraction-39
2025-08-25 13:05:49,921 - evaluation_logger_Attraction-39 - INFO - Query: Our company is planning a trip to Vienna for the employees. What is the highest-rated attraction there?
2025-08-25 13:05:58,215 - evaluation_logger_Attraction-39 - INFO - Function Calls: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Vienna"
        }
    }
]

2025-08-25 13:05:58,215 - evaluation_logger_Attraction-39 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Vienna"
        }
    },
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0xOTk1NDk5fQ==",
            "sortBy": "attr_book_score"
        }
    }
]

2025-08-25 13:05:58,215 - evaluation_logger_Attraction-39 - INFO - Start compare_single_call: 
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Vienna'}}
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Vienna'}}
2025-08-25 13:05:58,215 - evaluation_logger_Attraction-39 - INFO - Rule-based compare success.
2025-08-25 13:05:58,215 - evaluation_logger_Attraction-39 - INFO - Success matched: [{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Vienna'}}]
2025-08-25 13:05:58,215 - evaluation_logger_Attraction-39 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "products": [
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJTV1NrbldHbTl2IiwidWZpIjotMTk5NTQ5OX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Vienna Airport Transfer: Vienna to Vienna International Airport (VIE)",
                    "productId": "PRSWSknWGm9v",
                    "productSlug": "prswsknwgm9v-vienna-airport-transfer-vienna-to-vienna-international-airport-vie",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -1995499,
                    "cityName": "Vienna",
                    "countryCode": "at"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJHQVduVGYxUXhyIiwidWZpIjotMTk5MTQ0MH0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Vienna Arrival Private Transfers from Vienna Airport VIE to Vienna City",
                    "productId": "PRGAWnTf1Qxr",
                    "productSlug": "prgawntf1qxr-vienna-arrival-private-transfers-from-vienna-airport-vie-to-vienna-",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -1991440,
                    "cityName": "Schwechat",
                    "countryCode": "at"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFI3ajlZM29BaE01IiwidWZpIjotMTk5MTQ0MH0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Vienna Arrival Private Transfers from Vienna Airport VIE to Vienna City",
                    "productId": "PR7j9Y3oAhM5",
                    "productSlug": "pr7j9y3oahm5-vienna-arrival-private-transfers-from-vienna-airport-vie-to-vienna-",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -1991440,
                    "cityName": "Schwechat",
                    "countryCode": "at"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFI5aFFHVWdSSWI4IiwidWZpIjotMTk5NTQ5OX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Vienna Departure Private Transfers from Vienna City to Vienna Airport VIE",
                    "productId": "PR9hQGUgRIb8",
                    "productSlug": "pr9hqgugrib8-vienna-departure-private-transfers-from-vienna-city-to-vienna-airpo",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -1995499,
                    "cityName": "Vienna",
                    "countryCode": "at"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJoYWhFQmpaZ1FpIiwidWZpIjotMTk5NTQ5OX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Vienna Pass",
                    "productId": "PRhahEBjZgQi",
                    "productSlug": "prhahebjzgqi-vienna-pass",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -1995499,
                    "cityName": "Vienna",
                    "countryCode": "at"
                }
            ],
            "destinations": [
                {
                    "id": "eyJ1ZmkiOi0xOTk1NDk5fQ==",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": -1995499,
                    "country": "Austria",
                    "cityName": "Vienna",
                    "productCount": 777,
                    "cc1": "at"
                }
            ]
        }
    }
]

2025-08-25 13:06:08,501 - evaluation_logger_Attraction-39 - INFO - Function Calls: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0xOTk1NDk5fQ==",
            "sortBy": "attr_book_score"
        }
    }
]

2025-08-25 13:06:08,501 - evaluation_logger_Attraction-39 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0xOTk1NDk5fQ==",
            "sortBy": "attr_book_score"
        }
    }
]

2025-08-25 13:06:08,501 - evaluation_logger_Attraction-39 - INFO - Start compare_single_call: 
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0xOTk1NDk5fQ==', 'sortBy': 'attr_book_score'}}
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0xOTk1NDk5fQ==', 'sortBy': 'attr_book_score'}}
2025-08-25 13:06:08,501 - evaluation_logger_Attraction-39 - INFO - Rule-based compare success.
2025-08-25 13:06:08,501 - evaluation_logger_Attraction-39 - INFO - Success matched: [{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0xOTk1NDk5fQ==', 'sortBy': 'attr_book_score'}}]
2025-08-25 13:06:08,502 - evaluation_logger_Attraction-39 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProductSearchResponse",
            "products": [
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRtEAG8urN5F",
                    "name": "Admission to Schönbrunn Zoo",
                    "slug": "prteag8urn5f-admission-to-schonbrunn-zoo",
                    "shortDescription": "A ticket to the UNESCO-listed city zoo with skip-the-line access",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 29.49,
                        "currency": "USD",
                        "publicAmount": 29.49
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.8,
                            "total": 406
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Vienna",
                        "ufi": -1995499
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI7YOrDlLCdd"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIyOBQn2nF83"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 3
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRHGyAAOHyZ4",
                    "name": "Schönbrunn Palace Guided Tour with Admission",
                    "slug": "prhgyaaohyz4-schonbrunn-palace-guided-tour-with-admission",
                    "shortDescription": "A tour to explore the luxurious summer residence of the Habsburg monarchs",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 58.98,
                        "currency": "USD",
                        "publicAmount": 58.98
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 95,
                        "percentage": "88%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.7,
                            "total": 876
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Vienna",
                        "ufi": -1995499
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIIf0RkIgBkl"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI0QNDzZi0Qp"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIxoMm1c4yjD"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIMeghX2My2o"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIBGJruvQuyd"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIwHmv6ZwdlH"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI2qdiFYTqyC"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIsbKjB1KkaC"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OICMF7lj4dDH"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI5x4RqwCjo3"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIrpnt9XENrF"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIpA9XjgeSl7"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    }
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": false
                    },
                    "id": "PR2BfUVF6RVg",
                    "name": "Vienna Kunsthistorisches Museum",
                    "slug": "pr2bfuvf6rvg-vienna-kunsthistorisches-museum",
                    "shortDescription": "Magnificent art collection spanning from ancient Egypt to the 18th century",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 22.94,
                        "currency": "USD",
                        "publicAmount": 22.94
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 108,
                        "percentage": "96%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.7,
                            "total": 299
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Vienna",
                        "ufi": -1995499
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIfYreWL2ZSs"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIh1FIEJrjIe"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI7TXAE7b7sI"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIS6pcn0czxK"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIbkGffjCTZm"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIrlRREnk7XQ"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIkvlikz1S78"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIi4vPGz3jrn"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIHPTnxJyBXW"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIOJKwvAsbjL"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIIJhnFsO5Zt"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 8
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForMuseums",
                            "value": true,
                            "rank": 3
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRee2hR3j4X9",
                    "name": "Vienna Mozart Concert Ticket",
                    "slug": "pree2hr3j4x9-vienna-mozart-concert-ticket",
                    "shortDescription": "An 18th-century musical recreation at the Musikverein",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 64.45,
                        "currency": "USD",
                        "publicAmount": 64.45
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 7,
                        "percentage": "100%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.7,
                            "total": 212
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Vienna",
                        "ufi": -1995499
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIgcglXDmprb"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIt7ox3xpqxo"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIV5sdddHGpA"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIDvf24o5Xqu"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIGTBzGgcFAu"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIeGkD9T519Q"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIzakF3wht7w"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIlkEJhUaWvT"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    }
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": false
                    },
                    "id": "PRuYCCVyFX3d",
                    "name": "Vienna's Airport Train Ride to the City Centre",
                    "slug": "pruyccvyfx3d-ticket-for-viennas-city-airport-train",
                    "shortDescription": "A convenient transfer service between Vienna's main airport and downtown",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 16.28,
                        "currency": "USD",
                        "publicAmount": 16.28
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.7,
                            "total": 67
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Vienna",
                        "ufi": -1995499
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIO8GcZ3MJc9"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OITL0yyhKuEJ"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIb3y8xxlFG2"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIDy3SkC2uY8"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OItPKA1rz84g"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIpvD2WC5ITW"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIjZYViDBuXB"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OISTqhtBYWlH"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    }
                }
            ],
            "filterStats": {
                "__typename": "FilterStats",
                "unfilteredProductCount": 782,
                "filteredProductCount": 782
            },
            "sorters": [
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Our top picks",
                    "value": "trending"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Most popular",
                    "value": "attr_book_score"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Lowest price",
                    "value": "lowest_price"
                }
            ],
            "defaultSorter": {
                "__typename": "AttractionsSorterOption",
                "name": "Our top picks",
                "value": "trending"
            },
            "filterOptions": {
                "__typename": "FilterOptions",
                "typeFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Tours",
                        "tagname": "tours",
                        "productCount": 132
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Museums, arts & culture",
                        "tagname": "museums-arts-culture",
                        "productCount": 123
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Entertainment & tickets",
                        "tagname": "entertainment-tickets",
                        "productCount": 77
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Nature & outdoor",
                        "tagname": "nature-outdoor",
                        "productCount": 58
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Food & drinks",
                        "tagname": "food-drinks",
                        "productCount": 21
                    }
                ],
                "labelFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Free cancellation",
                        "tagname": "free_cancellation",
                        "productCount": 693
                    }
                ],
                "ufiFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Vienna",
                        "tagname": "-1995499",
                        "productCount": 766
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Schwechat",
                        "tagname": "-1991440",
                        "productCount": 15
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Klosterneuburg",
                        "tagname": "-1982773",
                        "productCount": 1
                    }
                ],
                "priceFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "US$0 - US$22",
                        "tagname": "b0",
                        "productCount": 117
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$22 - US$44",
                        "tagname": "b1",
                        "productCount": 93
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$44 - US$83",
                        "tagname": "b2",
                        "productCount": 87
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$83 - US$138",
                        "tagname": "b3",
                        "productCount": 65
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$138+",
                        "tagname": "b4",
                        "productCount": 434
                    }
                ]
            }
        }
    }
]

2025-08-25 13:09:19,193 - evaluation_logger_Attraction-39 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 概述

本文，我们来分享 MyBatis 的日志模块，对应 `logging` 包。如下图所示：[![`logging` 包](http://static.iocoder.cn/images/MyBatis/2020_02_01/01.png)](http://static.iocoder.cn/images/MyBatis/2020_02_01/01.png)`logging` 包

在 [《精尽 MyBatis 源码解析 —— 项目结构一览》](http://svip.iocoder.cn/MyBatis/intro) 中，简单介绍了这个模块如下：

> 无论在开发测试环境中，还是在线上生产环境中，日志在整个系统中的地位都是非常重要的。良好的日志功能可以帮助开发人员和测试人员快速定位 Bug 代码，也可以帮助运维人员快速定位性能瓶颈等问题。目前的 Java 世界中存在很多优秀的日志框架，例如 Log4j、 Log4j2、Slf4j 等。
>
> MyBatis 作为一个设计优良的框架，除了提供详细的日志输出信息，还要能够集成多种日志框架，其日志模块的一个主要功能就是**集成第三方日志框架到 MyBatis 中**。

下面，我们就来看看具体的源码。因为 `logging` 包下的代码比较多，我们拆分成两篇文章：

1. 本文，我们主要看看 `logging` 包下的日志框架实现类。
2. 下一文，我们主要看看 `logging` 包下的其它类。

# 2. Log

`org.apache.ibatis.logging.Log` ，MyBatis 日志接口。代码如下：

```java
// Log.java

public interface Log {

    boolean isDebugEnabled();

    boolean isTraceEnabled();

    void error(String s, Throwable e);

    void error(String s);

    void debug(String s);

    void trace(String s);

    void warn(String s);

}
```

- 定义了日志的接口。

## 2.1 LogFactory

`org.apache.ibatis.logging.LogFactory` ，Log 工厂类。代码如下：

```java
// LogFactory.java

public final class LogFactory {

    /**
     * Marker to be used by logging implementations that support markers.
     */
    public static final String MARKER = "MYBATIS";

    /**
     * 使用的 Log 的构造方法
     */
    private static Constructor<? extends Log> logConstructor;

    static {
        // <1> 尝试依次初始化每个日志框架的日志构造器
        tryImplementation(LogFactory::useSlf4jLogging);
        tryImplementation(LogFactory::useCommonsLogging);
        tryImplementation(LogFactory::useLog4J2Logging);
        tryImplementation(LogFactory::useLog4JLogging);
        tryImplementation(LogFactory::useJdkLogging);
        tryImplementation(LogFactory::useNoLogging);
    }

    private LogFactory() {
        // disable construction
    }

    public static Log getLog(Class<?> aClass) {
        return getLog(aClass.getName());
    }

    public static Log getLog(String logger) {
        try {
            // 获得 Log 对象
            return logConstructor.newInstance(logger);
        } catch (Throwable t) {
            throw new LogException("Error creating logger for logger " + logger + ".  Cause: " + t, t);
        }
    }

    public static synchronized void useCustomLogging(Class<? extends Log> clazz) {
        setImplementation(clazz);
    }

    public static synchronized void useSlf4jLogging() {
        setImplementation(org.apache.ibatis.logging.slf4j.Slf4jImpl.class);
    }

    public static synchronized void useCommonsLogging() {
        setImplementation(org.apache.ibatis.logging.commons.JakartaCommonsLoggingImpl.class);
    }

    public static synchronized void useLog4JLogging() {
        setImplementation(org.apache.ibatis.logging.log4j.Log4jImpl.class);
    }

    public static synchronized void useLog4J2Logging() {
        setImplementation(org.apache.ibatis.logging.log4j2.Log4j2Impl.class);
    }

    public static synchronized void useJdkLogging() {
        setImplementation(org.apache.ibatis.logging.jdk14.Jdk14LoggingImpl.class);
    }

    public static synchronized void useStdOutLogging() {
        setImplementation(org.apache.ibatis.logging.stdout.StdOutImpl.class);
    }

    public static synchronized void useNoLogging() {
        setImplementation(org.apache.ibatis.logging.nologging.NoLoggingImpl.class);
    }

    private static void tryImplementation(Runnable runnable) {
        if (logConstructor == null) {
            try {
                runnable.run();
            } catch (Throwable t) {
                // ignore
            }
        }
    }

    private static void setImplementation(Class<? extends Log> implClass) {
        try {
            // 获得参数为 String 的构造方法
            Constructor<? extends Log> candidate = implClass.getConstructor(String.class);
            // 创建 Log 对象
            Log log = candidate.newInstance(LogFactory.class.getName());
            if (log.isDebugEnabled()) {
                log.debug("Logging initialized using '" + implClass + "' adapter.");
            }
            // 创建成功，意味着可以使用，设置为 logConstructor
            logConstructor = candidate;
        } catch (Throwable t) {
            throw new LogException("Error setting Log implementation.  Cause: " + t, t);
        }
    }

}
```

- `logConstructor` 静态属性，使用的 Log 的构造方法。
- `<1>` 处，在**静态代码块**中，尝试依次初始化每个日志框架的日志构造器。而初始化的方式，调用 `#tryImplementation(Runnable runnable)` 方法，若 `logConstructor` 为空，则执行回调方法。而回调的方法，例如 `LogFactory::useSlf4jLogging` 方法，会调用 `#setImplementation(Class<? extends Log> implClass)` 方法，尝试设置 `logConstructor` 为指定类的带 String 参数的构造方法。
- `#getLog(...)` 方法，创建 Log 对象。而具体创建什么类，由 `logConstructor` 决定。

# 3. 日志框架实现

在 `logging` 包下，MyBatis 内置了一大批日志框架的实现类，如下图所示：[![日志框架实现类](http://static.iocoder.cn/images/MyBatis/2020_02_01/02.png)](http://static.iocoder.cn/images/MyBatis/2020_02_01/02.png)日志框架实现类

- 实际上，MyBatis 仅仅是**适配**了一大批的日志框架。所以，`logging` 包下的代码，是非常简单的。

## 3.1 Slf4jImpl

`org.apache.ibatis.logging.slf4j.Slf4jImpl` ，实现 Log 接口，SLF4J 实现类。代码如下：

```java
// Slf4jImpl.java

public class Slf4jImpl implements Log {

    private Log log;

    public Slf4jImpl(String clazz) {
        // 使用 SLF4J 的 LoggerFactory 获得 org.slf4j.Logger 对象
        Logger logger = LoggerFactory.getLogger(clazz);

        // 如果使用了 SLF4J 的 LocationAwareLogger 实现，则创建 Slf4jLocationAwareLoggerImpl 对象
        if (logger instanceof LocationAwareLogger) {
            try {
                // check for slf4j >= 1.6 method signature
                logger.getClass().getMethod("log", Marker.class, String.class, int.class, String.class, Object[].class, Throwable.class);
                log = new Slf4jLocationAwareLoggerImpl((LocationAwareLogger) logger);
                return;
            } catch (SecurityException | NoSuchMethodException e) {
                // fail-back to Slf4jLoggerImpl
            }
        }

        // Logger is not LocationAwareLogger or slf4j version < 1.6
        // 否则，创建 Slf4jLoggerImpl 对象
        log = new Slf4jLoggerImpl(logger);
    }

    @Override
    public boolean isDebugEnabled() {
        return log.isDebugEnabled();
    }

    @Override
    public boolean isTraceEnabled() {
        return log.isTraceEnabled();
    }

    @Override
    public void error(String s, Throwable e) {
        log.error(s, e);
    }

    @Override
    public void error(String s) {
        log.error(s);
    }

    @Override
    public void debug(String s) {
        log.debug(s);
    }

    @Override
    public void trace(String s) {
        log.trace(s);
    }

    @Override
    public void warn(String s) {
        log.warn(s);
    }

}
```

- 在构造方法中，会根据情况，创建 `Slf4jLocationAwareLoggerImpl` 或 `Slf4jLoggerImpl` 对象。而这两个类，也是实现 Log 接口。

#### 3.1.1 Slf4jLocationAwareLoggerImpl

`org.apache.ibatis.logging.slf4j.Slf4jLocationAwareLoggerImpl` ，实现 Log 接口，代码如下：

```java
// Slf4jLocationAwareLoggerImpl.java

public class Slf4jLocationAwareLoggerImpl implements Log {

    private static final String FQCN = Slf4jImpl.class.getName();

    private final LocationAwareLogger logger;

    public Slf4jLocationAwareLoggerImpl(LocationAwareLogger logger) {
        this.logger = logger;
    }

    @Override
    public boolean isDebugEnabled() {
        return logger.isDebugEnabled();
    }

    @Override
    public boolean isTraceEnabled() {
        return logger.isTraceEnabled();
    }

    @Override
    public void error(String s, Throwable e) {
        logger.log(null, FQCN, LocationAwareLogger.ERROR_INT, s, null, e);
    }

    @Override
    public void error(String s) {
        logger.log(null, FQCN, LocationAwareLogger.ERROR_INT, s, null, null);
    }

    @Override
    public void debug(String s) {
        logger.log(null, FQCN, LocationAwareLogger.DEBUG_INT, s, null, null);
    }

    @Override
    public void trace(String s) {
        logger.log(null, FQCN, LocationAwareLogger.TRACE_INT, s, null, null);
    }

    @Override
    public void warn(String s) {
        logger.log(null, FQCN, LocationAwareLogger.WARN_INT, s, null, null);
    }

}
```

- 通过 `LocationAwareLogger` 实现日志的打印。

#### 3.1.2 Slf4jLoggerImpl

`org.apache.ibatis.logging.slf4j.Slf4jLoggerImpl` ，实现 Log 接口，代码如下：

```java
// Slf4jLoggerImpl.java

public class Slf4jLoggerImpl implements Log {

    private final Logger log;

    public Slf4jLoggerImpl(Logger logger) {
        log = logger;
    }

    @Override
    public boolean isDebugEnabled() {
        return log.isDebugEnabled();
    }

    @Override
    public boolean isTraceEnabled() {
        return log.isTraceEnabled();
    }

    @Override
    public void error(String s, Throwable e) {
        log.error(s, e);
    }

    @Override
    public void error(String s) {
        log.error(s);
    }

    @Override
    public void debug(String s) {
        log.debug(s);
    }

    @Override
    public void trace(String s) {
        log.trace(s);
    }

    @Override
    public void warn(String s) {
        log.warn(s);
    }

}
```

- 通过 `Logger` 实现日志的打印。

## 3.2 JakartaCommonsLoggingImpl

`org.apache.ibatis.logging.commons.JakartaCommonsLoggingImpl` ，实现 Log 接口，Apache Commons Logging 实现类。代码如下：

```java
// JakartaCommonsLoggingImpl.java

public class JakartaCommonsLoggingImpl implements Log {

    private final Log log;

    public JakartaCommonsLoggingImpl(String clazz) {
        // 获得 org.apache.commons.logging.Log 对象
        log = LogFactory.getLog(clazz);
    }

    @Override
    public boolean isDebugEnabled() {
        return log.isDebugEnabled();
    }

    @Override
    public boolean isTraceEnabled() {
        return log.isTraceEnabled();
    }

    @Override
    public void error(String s, Throwable e) {
        log.error(s, e);
    }

    @Override
    public void error(String s) {
        log.error(s);
    }

    @Override
    public void debug(String s) {
        log.debug(s);
    }

    @Override
    public void trace(String s) {
        log.trace(s);
    }

    @Override
    public void warn(String s) {
        log.warn(s);
    }

}
```

## 3.3 Log4jImpl

`org.apache.ibatis.logging.log4j.Log4jImpl` ，实现 Log 接口，Log4J 实现类。代码如下：

```java
// Log4jImpl.java

public class Log4jImpl implements Log {

    private static final String FQCN = Log4jImpl.class.getName();

    private final Logger log;

    public Log4jImpl(String clazz) {
        // 获得 org.apache.log4j.Logger 对象
        log = Logger.getLogger(clazz);
    }

    @Override
    public boolean isDebugEnabled() {
        return log.isDebugEnabled();
    }

    @Override
    public boolean isTraceEnabled() {
        return log.isTraceEnabled();
    }

    @Override
    public void error(String s, Throwable e) {
        log.log(FQCN, Level.ERROR, s, e);
    }

    @Override
    public void error(String s) {
        log.log(FQCN, Level.ERROR, s, null);
    }

    @Override
    public void debug(String s) {
        log.log(FQCN, Level.DEBUG, s, null);
    }

    @Override
    public void trace(String s) {
        log.log(FQCN, Level.TRACE, s, null);
    }

    @Override
    public void warn(String s) {
        log.log(FQCN, Level.WARN, s, null);
    }

}
```

## 3.4 Log4j2Impl

`org.apache.ibatis.logging.log4j2.Log4j2Impl` ，实现 Log 接口，Log4J2 实现类。代码如下：

```java
// Log4j2Impl.java

public class Log4j2Impl implements Log {

    private final Logger log;

    public Log4j2Impl(String clazz) {
        // 获得 org.apache.logging.log4j.Logger 对象
        log = LogManager.getLogger(clazz);
    }

    @Override
    public boolean isDebugEnabled() {
        return log.isDebugEnabled();
    }

    @Override
    public boolean isTraceEnabled() {
        return log.isTraceEnabled();
    }

    @Override
    public void error(String s, Throwable e) {
        log.error(s, e);
    }

    @Override
    public void error(String s) {
        log.error(s);
    }

    @Override
    public void debug(String s) {
        log.debug(s);
    }

    @Override
    public void trace(String s) {
        log.trace(s);
    }

    @Override
    public void warn(String s) {
        log.warn(s);
    }

}
```

## 3.5 Jdk14LoggingImpl

`org.apache.ibatis.logging.jdk14.Jdk14LoggingImpl` ，实现 Log 接口，JDK Logging 实现类。代码如下：

```java
// Jdk14LoggingImpl.java

public class Jdk14LoggingImpl implements Log {

    private final Logger log;

    public Jdk14LoggingImpl(String clazz) {
        // 获得 java.util.logging.Logger 对象
        log = Logger.getLogger(clazz);
    }

    @Override
    public boolean isDebugEnabled() {
        return log.isLoggable(Level.FINE);
    }

    @Override
    public boolean isTraceEnabled() {
        return log.isLoggable(Level.FINER);
    }

    @Override
    public void error(String s, Throwable e) {
        log.log(Level.SEVERE, s, e);
    }

    @Override
    public void error(String s) {
        log.log(Level.SEVERE, s);
    }

    @Override
    public void debug(String s) {
        log.log(Level.FINE, s);
    }

    @Override
    public void trace(String s) {
        log.log(Level.FINER, s);
    }

    @Override
    public void warn(String s) {
        log.log(Level.WARNING, s);
    }

}
```

## 3.6 StdOutImpl

`org.apache.ibatis.logging.stdout.StdOutImpl` ，实现 Log 接口，StdOut 实现类。代码如下：

```java
// StdOutImpl.java

public class StdOutImpl implements Log {

    public StdOutImpl(String clazz) {
        // Do Nothing
    }

    @Override
    public boolean isDebugEnabled() {
        return true;
    }

    @Override
    public boolean isTraceEnabled() {
        return true;
    }

    @Override
    public void error(String s, Throwable e) {
        System.err.println(s);
        e.printStackTrace(System.err);
    }

    @Override
    public void error(String s) {
        System.err.println(s);
    }

    @Override
    public void debug(String s) {
        System.out.println(s);
    }

    @Override
    public void trace(String s) {
        System.out.println(s);
    }

    @Override
    public void warn(String s) {
        System.out.println(s);
    }

}
```

- 通过 `System.out` 和 `System.err` 实现日志的打印。

## 3.7 NoLoggingImpl

`org.apache.ibatis.logging.nologging.NoLoggingImpl` ，实现 Log 接口，No Log 实现类。代码如下：

```java
// NoLoggingImpl.java

public class NoLoggingImpl implements Log {

    public NoLoggingImpl(String clazz) {
        // Do Nothing
    }

    @Override
    public boolean isDebugEnabled() {
        return false;
    }

    @Override
    public boolean isTraceEnabled() {
        return false;
    }

    @Override
    public void error(String s, Throwable e) {
        // Do Nothing
    }

    @Override
    public void error(String s) {
        // Do

2025-08-25 13:09:25,690 - evaluation_logger_Attraction-39 - INFO - Complete Result: {'score': 0, 'reason': "The response does not address any part of the user's query about the highest-rated attraction in Vienna."}
2025-08-25 13:09:31,724 - evaluation_logger_Attraction-39 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 13:09:31,724 - evaluation_logger_Attraction-39 - INFO - Message: Success.
2025-08-25 13:09:31,724 - evaluation_logger_Attraction-39 - INFO - Success turn num = 2
2025-08-25 13:09:31,724 - evaluation_logger_Attraction-39 - INFO - ----------------------------------------------------------------------------------------------------
