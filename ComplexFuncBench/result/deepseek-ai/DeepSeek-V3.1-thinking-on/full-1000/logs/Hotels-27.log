2025-08-25 12:40:39,702 - evaluation_logger_Hotels-27 - INFO - Test Example Hotels-27
2025-08-25 12:40:39,702 - evaluation_logger_Hotels-27 - INFO - Query: I'm planning to stay at the Best Western Blairmore in Saskatoon from December 15, 2024 to December 20, 2024. I want to know the user reviews for the hotel.
2025-08-25 12:40:47,822 - evaluation_logger_Hotels-27 - INFO - Function Calls: 
[
    {
        "name": "Search_Hotel_Destination",
        "arguments": {
            "query": "Best Western Blairmore Saskatoon"
        }
    }
]

2025-08-25 12:40:47,822 - evaluation_logger_Hotels-27 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Hotel_Destination",
        "arguments": {
            "query": "Best Western Blairmore, Saskatoon"
        }
    },
    {
        "name": "Search_Hotels",
        "arguments": {
            "dest_id": 280911,
            "search_type": "hotel",
            "arrival_date": "2024-12-15",
            "departure_date": "2024-12-20"
        }
    }
]

2025-08-25 12:40:48,947 - evaluation_logger_Hotels-27 - INFO - Start compare_single_call: 
{'name': 'Search_Hotel_Destination', 'arguments': {'query': 'Best Western Blairmore Saskatoon'}}
{'name': 'Search_Hotel_Destination', 'arguments': {'query': 'Best Western Blairmore, Saskatoon'}}
2025-08-25 12:40:56,835 - evaluation_logger_Hotels-27 - DEBUG - LLM-based comparison output: {'is_equal': True, 'reason': "The queries 'Best Western Blairmore Saskatoon' and 'Best Western Blairmore, Saskatoon' are equivalent as the presence or absence of a comma does not change the meaning of the location."}
2025-08-25 12:40:56,835 - evaluation_logger_Hotels-27 - INFO - LLM-based compare success.
2025-08-25 12:40:56,835 - evaluation_logger_Hotels-27 - INFO - Success matched: [{'name': 'Search_Hotel_Destination', 'arguments': {'query': 'Best Western Blairmore, Saskatoon'}}]
2025-08-25 12:40:56,835 - evaluation_logger_Hotels-27 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": [
            {
                "dest_id": "280911",
                "search_type": "hotel",
                "nr_hotels": 1,
                "hotels": 1,
                "longitude": -106.75571,
                "city_name": "Saskatoon",
                "name": "Best Western Blairmore",
                "dest_type": "hotel",
                "type": "ho",
                "latitude": 52.12835,
                "roundtrip": "GgEwIAAoATICZW46IUJlc3QgV2VzdGVybiBCbGFpcm1vcmUsIFNhc2thdG9vbkAASgBQAA==",
                "cc1": "ca",
                "city_ufi": -573213,
                "country": "Canada",
                "region": "Saskatchewan",
                "lc": "en",
                "label": "Best Western Blairmore, Saskatoon, Saskatchewan, Canada"
            }
        ]
    }
]

2025-08-25 12:41:07,349 - evaluation_logger_Hotels-27 - INFO - Function Calls: 
[
    {
        "name": "Search_Hotels",
        "arguments": {
            "dest_id": 280911,
            "search_type": "hotel",
            "arrival_date": "2024-12-15",
            "departure_date": "2024-12-20"
        }
    }
]

2025-08-25 12:41:07,349 - evaluation_logger_Hotels-27 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Hotels",
        "arguments": {
            "arrival_date": "2024-12-15",
            "departure_date": "2024-12-20",
            "dest_id": 280911,
            "search_type": "hotel"
        }
    },
    {
        "name": "Get_Hotel_Reviews(Tips)",
        "arguments": {
            "hotel_id": "280911"
        }
    }
]

2025-08-25 12:41:07,349 - evaluation_logger_Hotels-27 - INFO - Start compare_single_call: 
{'name': 'Search_Hotels', 'arguments': {'arrival_date': '2024-12-15', 'departure_date': '2024-12-20', 'dest_id': 280911, 'search_type': 'hotel'}}
{'name': 'Search_Hotels', 'arguments': {'arrival_date': '2024-12-15', 'departure_date': '2024-12-20', 'dest_id': 280911, 'search_type': 'hotel'}}
2025-08-25 12:41:07,349 - evaluation_logger_Hotels-27 - INFO - Rule-based compare success.
2025-08-25 12:41:07,349 - evaluation_logger_Hotels-27 - INFO - Success matched: [{'name': 'Search_Hotels', 'arguments': {'arrival_date': '2024-12-15', 'departure_date': '2024-12-20', 'dest_id': 280911, 'search_type': 'hotel'}}]
2025-08-25 12:41:07,349 - evaluation_logger_Hotels-27 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "hotels": [
                {
                    "hotel_id": 280911,
                    "accessibilityLabel": "Best Western Blairmore.\n3 out of 5 stars.\n8.6 Fabulous 376 reviews.\n‎7 km from centre‬.\n2 beds.\n531 USD.\nIncludes taxes and charges.\nFree cancellation.\nNo prepayment needed.",
                    "property": {
                        "rankingPosition": 0,
                        "checkout": {
                            "fromTime": "00:00",
                            "untilTime": "11:00"
                        },
                        "ufi": -573213,
                        "accuratePropertyClass": 3,
                        "isPreferred": true,
                        "checkoutDate": "2024-12-20",
                        "checkin": {
                            "untilTime": "00:00",
                            "fromTime": "16:00"
                        },
                        "countryCode": "ca",
                        "mainPhotoId": 163832717,
                        "propertyClass": 3,
                        "currency": "CAD",
                        "wishlistName": "Saskatoon",
                        "reviewCount": 376,
                        "reviewScore": 8.6,
                        "checkinDate": "2024-12-15",
                        "longitude": -106.755706071854,
                        "position": 0,
                        "blockIds": [
                            "28091113_346755329_2_1_0"
                        ],
                        "id": 280911,
                        "reviewScoreWord": "Fabulous",
                        "optOutFromGalleryChanges": 0,
                        "latitude": 52.1283509641964,
                        "priceBreakdown": {
                            "grossPrice": {
                                "value": 530.613771340925,
                                "currency": "USD"
                            }
                        },
                        "qualityClass": 0,
                        "name": "Best Western Blairmore",
                        "isHighlightedHotel": true,
                        "isFirstPage": true
                    }
                }
            ],
            "meta": [
                {
                    "title": "61 properties"
                }
            ],
            "appear": [
                {
                    "id": "cma",
                    "component": {
                        "props": {
                            "fill": true,
                            "content": {
                                "props": {
                                    "fitContentWidth": true,
                                    "items": [
                                        {
                                            "props": {
                                                "component": {
                                                    "props": {
                                                        "spacing": "spacing_half",
                                                        "items": [
                                                            {
                                                                "props": {
                                                                    "text": [
                                                                        {
                                                                            "font": "body_2",
                                                                            "text": "Commission paid and other benefits may affect an accommodation's ranking."
                                                                        },
                                                                        {
                                                                            "text": "  ",
                                                                            "color": "foreground",
                                                                            "font": "strong_2"
                                                                        },
                                                                        {
                                                                            "linkActions": [
                                                                                {}
                                                                            ],
                                                                            "text": "Find out more",
                                                                            "color": "action_foreground",
                                                                            "font": "body_2"
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                }
                                            }
                                        },
                                        {},
                                        {
                                            "props": {
                                                "component": {
                                                    "props": {
                                                        "variant": "tertiary_tinted",
                                                        "tertiaryTintedColor": "foreground",
                                                        "accessibilityLabel": "Close",
                                                        "icon": "close"
                                                    }
                                                }
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                },
                {},
                {
                    "id": "signin_now",
                    "component": {
                        "props": {
                            "title": "Sign in and save money",
                            "text": "Get instant access to our Genius loyalty programme and enjoy discounts at properties worldwide."
                        }
                    }
                },
                {
                    "component": {
                        "props": {
                            "text": "Properties with these icons have been awarded Booking.com's quality rating for homes"
                        }
                    },
                    "id": "banner_qualityrating"
                }
            ]
        }
    }
]

2025-08-25 12:41:16,419 - evaluation_logger_Hotels-27 - INFO - Function Calls: 
[
    {
        "name": "Get_Hotel_Reviews(Tips)",
        "arguments": {
            "hotel_id": "280911"
        }
    }
]

2025-08-25 12:41:16,419 - evaluation_logger_Hotels-27 - INFO - Golden Function Call: 
[
    {
        "name": "Get_Hotel_Reviews(Tips)",
        "arguments": {
            "hotel_id": "280911"
        }
    }
]

2025-08-25 12:41:16,419 - evaluation_logger_Hotels-27 - INFO - Start compare_single_call: 
{'name': 'Get_Hotel_Reviews(Tips)', 'arguments': {'hotel_id': '280911'}}
{'name': 'Get_Hotel_Reviews(Tips)', 'arguments': {'hotel_id': '280911'}}
2025-08-25 12:41:16,419 - evaluation_logger_Hotels-27 - INFO - Rule-based compare success.
2025-08-25 12:41:16,419 - evaluation_logger_Hotels-27 - INFO - Success matched: [{'name': 'Get_Hotel_Reviews(Tips)', 'arguments': {'hotel_id': '280911'}}]
2025-08-25 12:41:16,419 - evaluation_logger_Hotels-27 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "count": 25,
            "result": [
                {
                    "languagecode": "en-us",
                    "countrycode": "ca",
                    "hotel_id": 280911,
                    "helpful_vote_count": 0,
                    "is_incentivised": 0,
                    "no_user_title": 0,
                    "review_hash": "25c33d48154b5906",
                    "stayed_room_info": {
                        "checkout": "2024-08-04",
                        "room_name": "Queen Room with Two Queen Beds",
                        "checkin": "2024-08-02",
                        "num_nights": 2,
                        "room_id": 28091112
                    },
                    "average_score": 4,
                    "pros": "Great stay\nGreat staff\nMade me feel welcomed",
                    "is_moderated": 0,
                    "date": "2024-10-12 21:49:16",
                    "title": "I will tell any one to go stay there",
                    "reviewng": 1,
                    "travel_purpose": "leisure",
                    "author": {
                        "name": "Marie",
                        "helpful_vote_count": 0,
                        "countrycode": "ca",
                        "user_id": 285074897,
                        "type": "review_category_group_of_friends",
                        "type_string": "Group of friends",
                        "nr_reviews": 0
                    },
                    "cons": "Very clean",
                    "review_id": 5093136179
                },
                {
                    "no_user_title": 0,
                    "review_hash": "790a8001cbcfac03",
                    "languagecode": "en-us",
                    "countrycode": "ca",
                    "hotel_id": 280911,
                    "is_incentivised": 0,
                    "helpful_vote_count": 0,
                    "pros": "Quiet.  Super clean.  Friendly staff.  Amazing breakfast.  Cookies at the. Check  in desk!",
                    "is_moderated": 0,
                    "average_score": 4,
                    "stayed_room_info": {
                        "checkin": "2024-10-04",
                        "room_name": "Queen Room with Two Queen Beds",
                        "checkout": "2024-10-07",
                        "num_nights": 3,
                        "room_id": 28091112
                    },
                    "travel_purpose": "leisure",
                    "reviewng": 1,
                    "title": "This is an outstanding hotel!  I felt totally pampered.",
                    "date": "2024-10-08 05:04:55",
                    "review_id": 5091657479,
                    "author": {
                        "type": "solo_traveller",
                        "type_string": "Solo traveller",
                        "nr_reviews": 0,
                        "name": "Truth",
                        "helpful_vote_count": 0,
                        "countrycode": "ca",
                        "user_id": 510920294
                    }
                },
                {
                    "languagecode": "en-us",
                    "countrycode": "ca",
                    "hotel_id": 280911,
                    "is_incentivised": 0,
                    "helpful_vote_count": 0,
                    "no_user_title": 0,
                    "review_hash": "9af5ad7bacf055f7",
                    "stayed_room_info": {
                        "num_nights": 2,
                        "room_id": 28091112,
                        "room_name": "Queen Room with Two Queen Beds",
                        "checkout": "2024-09-29",
                        "checkin": "2024-09-27"
                    },
                    "average_score": 4,
                    "pros": "The kids loved the swimming pool.\nThe front personnel were exceptionally awesome and courteous🤗",
                    "is_moderated": 0,
                    "reviewng": 1,
                    "travel_purpose": "leisure",
                    "date": "2024-09-30 05:06:55",
                    "title": "Absolutely friendly environment and awesome customer service.",
                    "review_id": 5088615575,
                    "author": {
                        "helpful_vote_count": 0,
                        "countrycode": "ca",
                        "user_id": 0,
                        "name": "Angie",
                        "nr_reviews": 0,
                        "type": "family_with_children",
                        "type_string": "Family"
                    },
                    "cons": "No benches to go enjoy some fresh air."
                },
                {
                    "title": "Very good",
                    "date": "2024-09-27 09:16:17",
                    "travel_purpose": "business",
                    "reviewng": 1,
                    "cons": "Swimming Pool was a bit cold",
                    "author": {
                        "nr_reviews": 0,
                        "type": "solo_traveller",
                        "type_string": "Solo traveller",
                        "user_id": 162581851,
                        "helpful_vote_count": 0,
                        "countrycode": "rs",
                        "name": "Frederic"
                    },
                    "review_id": 5087559229,
                    "no_user_title": 1,
                    "review_hash": "75f9e7761e2b98f9",
                    "languagecode": "en-gb",
                    "hotel_id": 280911,
                    "countrycode": "rs",
                    "helpful_vote_count": 0,
                    "is_incentivised": 0,
                    "pros": "Room comfortable",
                    "is_moderated": 0,
                    "average_score": 3.20000004768372,
                    "stayed_room_info": {
                        "room_id": 28091112,
                        "num_nights": 4,
                        "checkin": "2024-09-22",
                        "room_name": "Queen Room with Two Queen Beds",
                        "checkout": "2024-09-26"
                    }
                },
                {
                    "title": "Relaxing vacay",
                    "date": "2024-08-31 06:22:19",
                    "travel_purpose": "leisure",
                    "reviewng": 1,
                    "cons": "Nothing",
                    "author": {
                        "nr_reviews": 0,
                        "type": "review_category_group_of_friends",
                        "type_string": "Group of friends",
                        "user_id": 13104615,
                        "helpful_vote_count": 0,
                        "countrycode": "ca",
                        "name": "Lynette"
                    },
                    "review_id": 5076304717,
                    "review_hash": "d47ba827854e6060",
                    "no_user_title": 0,
                    "hotel_id": 280911,
                    "countrycode": "ca",
                    "helpful_vote_count": 0,
                    "is_incentivised": 0,
                    "languagecode": "en-us",
                    "pros": "Everything.  It was only for one night but we were very happy with the quality an roominess of the rooms.",
                    "is_moderated": 0,
                    "stayed_room_info": {
                        "num_nights": 1,
                        "room_id": 28091112,
                        "room_name": "Queen Room with Two Queen Beds",
                        "checkout": "2024-08-30",
                        "checkin": "2024-08-29"
                    },
                    "average_score": 4
                }
            ],
            "sort_options": [
                {
                    "sort_option_id": "sort_most_relevant",
                    "title": "Most relevant",
                    "sort_option_default": 1
                },
                {
                    "sort_option_id": "sort_recent_desc",
                    "sort_option_default": 0,
                    "title": "Date (newer to older)"
                },
                {
                    "sort_option_id": "proximity_to_hotel_average",
                    "title": "Close to property score",
                    "sort_option_default": 0
                },
                {
                    "sort_option_id": "sort_score_desc",
                    "sort_option_default": 0,
                    "title": "Review score (high to low)"
                },
                {
                    "sort_option_id": "user_country",
                    "sort_option_default": 0,
                    "title": "From your country"
                }
            ]
        }
    }
]

2025-08-25 12:41:39,761 - evaluation_logger_Hotels-27 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 概述

本文分享 **Spring Cloud Alibaba 之 Sentinel 与 Gateway 的整合**。在 Spring Cloud Gateway 中，Sentinel 网关流控默认提供了两种资源维度：

- route 维度：即在 Spring 配置文件中配置的路由条目，资源名为对应的 routeId
- 自定义 API 维度：用户可以利用 Sentinel 提供的 API 来自定义一些 API 分组

Sentinel 1.6.3 引入了网关流控控制台的支持，用户可以直接在 Sentinel 控制台上查看 API Gateway 实时的 route 和自定义 API 分组监控，管理网关规则和 API 分组配置。

# 2. 快速入门

示例代码对应仓库：

- 网关：`labx-08-sc-alibaba-sentinel-gateway-demo`
- 服务提供者：`labx-08-sc-http-demo-provider`

我们直接从 **2.1 网关项目**和 **2.2 服务提供者**开始。

## 2.1 网关项目

创建 `labx-08-sc-alibaba-sentinel-gateway-demo` 项目，作为网关，负责请求的转发。考虑到不污染上述示例，我们新建一个网关项目。

### 2.1.1 引入依赖

创建 [`pom.xml`](https://github.com/YunaiV/SpringBoot-Labs/blob/master/labx-08-spring-cloud-alibaba-sentinel/labx-08-sc-alibaba-sentinel-gateway-demo/pom.xml) 文件，主要引入 Spring Cloud Gateway 和 Sentinel Gateway 相关依赖。代码如下：

2025-08-25 12:41:45,651 - evaluation_logger_Hotels-27 - INFO - Complete Result: {'score': 0, 'reason': "The response does not address any part of the user's query about user reviews for the hotel."}
2025-08-25 12:41:51,642 - evaluation_logger_Hotels-27 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 12:41:51,642 - evaluation_logger_Hotels-27 - INFO - Message: Success.
2025-08-25 12:41:51,642 - evaluation_logger_Hotels-27 - INFO - Success turn num = 3
2025-08-25 12:41:51,642 - evaluation_logger_Hotels-27 - INFO - ----------------------------------------------------------------------------------------------------
