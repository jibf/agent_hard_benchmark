2025-08-25 12:59:24,208 - evaluation_logger_Attraction-0 - INFO - Test Example Attraction-0
2025-08-25 12:59:24,208 - evaluation_logger_Attraction-0 - INFO - Query: Check out the most trending tourist spots in Manchester for my family trip.
2025-08-25 12:59:32,294 - evaluation_logger_Attraction-0 - INFO - Function Calls: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Manchester"
        }
    }
]

2025-08-25 12:59:32,294 - evaluation_logger_Attraction-0 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Manchester"
        }
    },
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0yNjAyNTEyfQ==",
            "sortBy": "trending"
        }
    }
]

2025-08-25 12:59:32,294 - evaluation_logger_Attraction-0 - INFO - Start compare_single_call: 
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Manchester'}}
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Manchester'}}
2025-08-25 12:59:32,294 - evaluation_logger_Attraction-0 - INFO - Rule-based compare success.
2025-08-25 12:59:32,294 - evaluation_logger_Attraction-0 - INFO - Success matched: [{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Manchester'}}]
2025-08-25 12:59:32,294 - evaluation_logger_Attraction-0 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "products": [
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFI4QkJRTzhHUWZWIiwidWZpIjotMjYwMjUxMn0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Manchester Private Transfer from central Manchester to Manchester Airport",
                    "productId": "PR8BBQO8GQfV",
                    "productSlug": "pr8bbqo8gqfv-manchester-private-transfer-from-central-manchester-to-manchester-a",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -2602512,
                    "cityName": "Manchester",
                    "countryCode": "gb"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJsWlRsTkl2amVRIiwidWZpIjotMjYwMjUxMn0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Self-Guided Manchester Scavenger Hunt: Mighty Manchester",
                    "productId": "PRlZTlNIvjeQ",
                    "productSlug": "prlztlnivjeq-manchester-scavenger-hunt",
                    "taxonomySlug": "tours",
                    "cityUfi": -2602512,
                    "cityName": "Manchester",
                    "countryCode": "gb"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFI4eXRiZnhmdG1JIiwidWZpIjotMjYwMjUxMn0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Manchester to Manchester Airport (MAN) - Departure Private Transfer",
                    "productId": "PR8ytbfxftmI",
                    "productSlug": "pr8ytbfxftmi-manchester-to-manchester-airport-man-departure-private-transfer",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -2602512,
                    "cityName": "Manchester",
                    "countryCode": "gb"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJqRG1KZm05T2FDIiwidWZpIjotMjYwMjUxMn0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Manchester Airport (MAN) to Manchester - Arrival Private Transfer",
                    "productId": "PRjDmJfm9OaC",
                    "productSlug": "prjdmjfm9oac-manchester-airport-man-to-manchester-arrival-private-transfer",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -2602512,
                    "cityName": "Manchester",
                    "countryCode": "gb"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJ3VEw4THhWalRaIiwidWZpIjotMjYwMjUxMn0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Manchester River Tour",
                    "productId": "PRwTL8LxVjTZ",
                    "productSlug": "prwtl8lxvjtz-manchester-river-tour",
                    "taxonomySlug": "tours",
                    "cityUfi": -2602512,
                    "cityName": "Manchester",
                    "countryCode": "gb"
                }
            ],
            "destinations": [
                {
                    "id": "eyJ1ZmkiOi0yNjAyNTEyfQ==",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": -2602512,
                    "country": "United Kingdom",
                    "cityName": "Manchester",
                    "productCount": 278,
                    "cc1": "gb"
                }
            ]
        }
    }
]

2025-08-25 12:59:42,444 - evaluation_logger_Attraction-0 - INFO - Function Calls: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0yNjAyNTEyfQ==",
            "sortBy": "trending"
        }
    }
]

2025-08-25 12:59:42,444 - evaluation_logger_Attraction-0 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0yNjAyNTEyfQ==",
            "sortBy": "trending"
        }
    }
]

2025-08-25 12:59:42,445 - evaluation_logger_Attraction-0 - INFO - Start compare_single_call: 
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0yNjAyNTEyfQ==', 'sortBy': 'trending'}}
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0yNjAyNTEyfQ==', 'sortBy': 'trending'}}
2025-08-25 12:59:42,445 - evaluation_logger_Attraction-0 - INFO - Rule-based compare success.
2025-08-25 12:59:42,445 - evaluation_logger_Attraction-0 - INFO - Success matched: [{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0yNjAyNTEyfQ==', 'sortBy': 'trending'}}]
2025-08-25 12:59:42,445 - evaluation_logger_Attraction-0 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProductSearchResponse",
            "products": [
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRwTL8LxVjTZ",
                    "name": "Manchester River Tour",
                    "slug": "prwtl8lxvjtz-manchester-river-tour",
                    "shortDescription": "A one-hour river cruise to take in the city sights",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 15.61,
                        "currency": "USD",
                        "publicAmount": 15.61
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 59,
                        "percentage": "83%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.2,
                            "total": 210
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Manchester",
                        "ufi": -2602512
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIkhUIVh26pR"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIMoqtjzJgws"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI2wSwl9Y2zi"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIBfJrJ9tMZ2"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerOnWeekends",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForTours",
                            "value": true,
                            "rank": 1
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRMDJDPj6kGD",
                    "name": "Manchester City Stadium Guided Tour",
                    "slug": "prmdjdpj6kgd-manchester-city-stadium-guided-tour",
                    "shortDescription": "A visit to see behind the scenes at Manchester City's stadium",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 33.82,
                        "currency": "USD",
                        "publicAmount": 33.82
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 108,
                        "percentage": "94%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.8,
                            "total": 192
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Manchester",
                        "ufi": -2602512
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIaXAMrln4J9"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIghNJq4PSbu"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIaLdU2hyzsC"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIH7nwdL8Zsd"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIQDqCZSGaCU"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI7XqWLZC0G7"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OISR6No6I8bG"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI0jWoJqoFpi"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIyuzR5aswJm"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIhS1BdPtfTR"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIQS6vVJilpv"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIorUEzECsOP"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIxoMqlTuTeE"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OInCID41cfgu"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIXzXe1G8WLE"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIFxZeOYGPFB"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIpazKdwRNGn"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIaD99vIjFaY"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OICZW8HDp0j0"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI9Jeoezrp7r"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIDQY9B76UC4"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIxCui7tOT68"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI2xTUQJXPKT"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIQLRyMOnhnc"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OISd0wvN3wZ9"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 3
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInMonth",
                            "value": true,
                            "rank": 3
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerOnWeekends",
                            "value": true,
                            "rank": 3
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForLandmarks",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "highlyRated",
                            "value": true,
                            "rank": 3
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRkdj3nMvKaC",
                    "name": "Manchester City Stadium Tour",
                    "slug": "prkdj3nmvkac-manchester-city-stadium-tour",
                    "shortDescription": "An immersive audio-visual tour, with visit to the pitch and players’ dressing rooms",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 33.82,
                        "currency": "USD",
                        "publicAmount": 33.82
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 28,
                        "percentage": "96%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.7,
                            "total": 186
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Manchester",
                        "ufi": -2602512
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OILdph6HpjLt"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIUauFjZgovf"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIu4KMah3HWv"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIXD9Ndou24j"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 4
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInMonth",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInWeek",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForLandmarks",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "popularFor2Travelers",
                            "value": true,
                            "rank": 1
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRmPmcKnaJ5X",
                    "name": "Manchester City River Tour",
                    "slug": "prmpmcknaj5x-city-river-cruise",
                    "shortDescription": "A 60-minute boat cruise along Manchester's historic Ship Canal and the River Irwell",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 16.32,
                        "currency": "USD",
                        "publicAmount": 16.32
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 108,
                        "percentage": "77%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4,
                            "total": 159
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Manchester",
                        "ufi": -2602512
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI1UKPhpHcK3"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIIl9gy0fmkm"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIyC9SrJAzMq"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIvNqu0IpgGh"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIf5fVzbZnNp"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIG2XVNwLGkn"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIMyjyqpEXnz"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIUN4U1PCdc3"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIUfayT2pdtR"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIRg9OxmujP2"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OImZFYkVEZlA"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIYPkx2S4TJC"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI8Dc15vt5Fq"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIefcEotyVNG"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInMonth",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInWeek",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerOnWeekends",
                            "value": true,
                            "rank": 2
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRoKgxgA6Rkh",
                    "name": "Manchester Afternoon Walking Tour",
                    "slug": "prokgxga6rkh-manchester-afternoon-walking-tour",
                    "shortDescription": "If you only have a few days in the city, or you want to discover its secrets and explore the main...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 22.11,
                        "currency": "USD",
                        "publicAmount": 22.11
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.7,
                            "total": 97
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Manchester",
                        "ufi": -2602512
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIpaWJudmI5c"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIdmZNnyB1mV"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIk927pMjwnx"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 7
                        }
                    ]
                }
            ],
            "filterStats": {
                "__typename": "FilterStats",
                "unfilteredProductCount": 278,
                "filteredProductCount": 278
            },
            "sorters": [
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Our top picks",
                    "value": "trending"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Most popular",
                    "value": "attr_book_score"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Lowest price",
                    "value": "lowest_price"
                }
            ],
            "defaultSorter": {
                "__typename": "AttractionsSorterOption",
                "name": "Our top picks",
                "value": "trending"
            },
            "filterOptions": {
                "__typename": "FilterOptions",
                "typeFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Tours",
                        "tagname": "tours",
                        "productCount": 30
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Nature & outdoor",
                        "tagname": "nature-outdoor",
                        "productCount": 16
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Entertainment & tickets",
                        "tagname": "entertainment-tickets",
                        "productCount": 14
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Food & drinks",
                        "tagname": "food-drinks",
                        "productCount": 5
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Museums, arts & culture",
                        "tagname": "museums-arts-culture",
                        "productCount": 4
                    }
                ],
                "labelFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Free cancellation",
                        "tagname": "free_cancellation",
                        "productCount": 264
                    }
                ],
                "ufiFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Manchester",
                        "tagname": "-2602512",
                        "productCount": 277
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Castleton",
                        "tagname": "-2592059",
                        "productCount": 1
                    }
                ],
                "priceFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "US$0 - US$22",
                        "tagname": "b0",
                        "productCount": 36
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$22 - US$44",
                        "tagname": "b1",
                        "productCount": 13
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$44 - US$83",
                        "tagname": "b2",
                        "productCount": 78
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$83 - US$138",
                        "tagname": "b3",
                        "productCount": 63
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$138+",
                        "tagname": "b4",
                        "productCount": 90
                    }
                ]
            }
        }
    }
]

2025-08-25 13:02:59,733 - evaluation_logger_Attraction-0 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 引言

## 1.1 编写目的

本文档旨在为“基于深度学习的智能图像识别系统”的设计与实现提供详细的技术说明和指导。文档的主要读者包括项目开发人员、测试人员、项目经理以及未来可能参与系统维护和升级的技术人员。通过本文档，读者可以全面了解系统的架构设计、功能模块、技术实现细节以及部署和维护的相关信息。

## 1.2 项目背景

随着人工智能技术的快速发展，深度学习在图像识别领域的应用日益广泛。传统的图像识别方法往往依赖于手工特征提取，而深度学习通过卷积神经网络（CNN）等模型能够自动学习图像的特征表示，大大提高了识别的准确性和效率。本项目旨在开发一个基于深度学习的智能图像识别系统，能够对输入的图像进行自动分类和识别，可应用于安防监控、医疗影像分析、自动驾驶等多个领域。

## 1.3 系统概述

本系统是一个基于深度学习的智能图像识别系统，主要功能包括图像上传、预处理、特征提取、分类识别以及结果展示。系统采用B/S架构，用户可以通过Web界面轻松上传图像并获取识别结果。后端采用高性能的深度学习框架（如TensorFlow或PyTorch）进行模型训练和推理，确保识别的准确性和实时性。

系统核心功能包括：
- 用户管理：用户注册、登录、权限管理。
- 图像上传：支持多种格式的图像上传。
- 图像预处理：对上传图像进行标准化、归一化等处理。
- 模型推理：使用预训练的深度学习模型进行图像识别。
- 结果展示：将识别结果以可视化的方式展示给用户。

## 1.4 文档结构

本文档共分为以下几个部分：
- 第一章：引言 - 介绍文档编写目的、项目背景和系统概述。
- 第二章：系统架构 - 描述系统的整体架构、技术栈和模块划分。
- 第三章：功能模块详细设计 - 详细说明各功能模块的设计与实现。
- 第四章：数据库设计 - 描述系统数据库的结构和表设计。
- 第五章：接口设计 - 定义系统各模块之间的接口规范。
- 第六章：部署与维护 - 说明系统的部署步骤和维护策略。
- 第七章：测试计划 - 制定系统的测试策略和测试用例。
- 第八章：总结与展望 - 总结项目成果并展望未来改进方向。

# 2. 系统架构

## 2.1 整体架构设计

本系统采用分层架构设计，主要包括前端展示层、后端服务层和数据处理层。整体架构如下图所示：

```
+-------------------+     +-------------------+     +-------------------+
|   前端展示层       |     |   后端服务层       |     |   数据处理层       |
|  (Web界面)        |<--->|  (API服务)        |<--->|  (深度学习模型)   |
+-------------------+     +-------------------+     +-------------------+
```

- **前端展示层**：负责用户交互，提供图像上传、结果展示等功能。
- **后端服务层**：处理业务逻辑，调用深度学习模型进行图像识别，并返回结果。
- **数据处理层**：包含预训练的深度学习模型，负责图像的特征提取和分类。

## 2.2 技术栈

### 前端技术栈
- **HTML/CSS/JavaScript**：用于构建用户界面。
- **React/Vue.js**：前端框架，提供组件化开发支持。
- **Axios**：用于前后端数据交互。

### 后端技术栈
- **Python**：主要编程语言。
- **Flask/Django**：Web框架，提供RESTful API支持。
- **TensorFlow/PyTorch**：深度学习框架，用于模型训练和推理。
- **OpenCV**：图像处理库，用于图像预处理。

### 数据库
- **MySQL/PostgreSQL**：关系型数据库，用于存储用户信息和识别记录。
- **Redis**：缓存数据库，用于提高系统性能。

### 部署与运维
- **Docker**：容器化部署，确保环境一致性。
- **Nginx**：Web服务器，用于负载均衡和静态资源服务。
- **Kubernetes**：容器编排工具，用于管理容器化应用。

## 2.3 模块划分

系统主要分为以下模块：

1. **用户管理模块**：负责用户注册、登录、权限管理等功能。
2. **图像上传模块**：提供图像上传接口，支持多种图像格式。
3. **图像预处理模块**：对上传图像进行标准化、归一化等处理。
4. **模型推理模块**：调用深度学习模型进行图像识别。
5. **结果展示模块**：将识别结果以可视化的方式展示给用户。
6. **数据库管理模块**：负责用户数据、识别记录等的存储和管理。

## 2.4 系统流程

1. 用户通过前端界面上传图像。
2. 前端将图像发送至后端API服务。
3. 后端对图像进行预处理，并调用深度学习模型进行推理。
4. 模型返回识别结果，后端将结果存储至数据库。
5. 后端将识别结果返回至前端，前端展示结果给用户。

# 3. 功能模块详细设计

## 3.1 用户管理模块

### 3.1.1 功能描述
用户管理模块负责系统的用户认证和权限管理。包括用户注册、登录、注销、信息修改等功能。

### 3.1.2 类设计
```python
class User:
    def __init__(self, user_id, username, password, email, role):
        self.user_id = user_id
        self.username = username
        self.password = password  # 存储加密后的密码
        self.email = email
        self.role = role  # 用户角色：admin、user

class UserManager:
    def register_user(self, username, password, email):
        # 注册新用户
        pass

    def login_user(self, username, password):
        # 用户登录
        pass

    def logout_user(self, user_id):
        # 用户注销
        pass

    def update_user_info(self, user_id, **kwargs):
        # 更新用户信息
        pass
```

### 3.1.3 接口设计
- `POST /api/register`：用户注册
- `POST /api/login`：用户登录
- `POST /api/logout`：用户注销
- `PUT /api/user/{user_id}`：更新用户信息

## 3.2 图像上传模块

### 3.2.1 功能描述
图像上传模块允许用户通过Web界面上传图像文件，支持常见格式如JPEG、PNG等。

### 3.2.2 类设计
```python
class ImageUploader:
    def __init__(self, allowed_extensions=None):
        self.allowed_extensions = allowed_extensions or ['jpg', 'jpeg', 'png']

    def upload_image(self, file):
        # 检查文件格式
        if not self._is_allowed_file(file.filename):
            raise ValueError("Unsupported file format")
        
        # 保存文件
        filename = self._generate_filename(file.filename)
        file.save(filename)
        return filename

    def _is_allowed_file(self, filename):
        return '.' in filename and \
               filename.rsplit('.', 1)[1].lower() in self.allowed_extensions

    def _generate_filename(self, original_filename):
        # 生成唯一文件名
        ext = original_filename.rsplit('.', 1)[1].lower()
        return f"{uuid.uuid4().hex}.{ext}"
```

### 3.2.3 接口设计
- `POST /api/upload`：上传图像文件

## 3.3 图像预处理模块

### 3.3.1 功能描述
图像预处理模块负责对上传的图像进行标准化处理，以便输入深度学习模型。包括调整大小、归一化等操作。

### 3.3.2 类设计
```python
class ImagePreprocessor:
    def __init__(self, target_size=(224, 224)):
        self.target_size = target_size

    def preprocess(self, image_path):
        # 读取图像
        image = cv2.imread(image_path)
        if image is None:
            raise ValueError("Unable to read image")
        
        # 调整大小
        image = cv2.resize(image, self.target_size)
        
        # 归一化
        image = image / 255.0
        
        # 转换为模型输入格式
        image = np.expand_dims(image, axis=0)
        
        return image
```

## 3.4 模型推理模块

### 3.4.1 功能描述
模型推理模块加载预训练的深度学习模型，并对预处理后的图像进行推理，返回识别结果。

### 3.4.2 类设计
```python
class ModelInference:
    def __init__(self, model_path):
        self.model = self._load_model(model_path)
        self.labels = self._load_labels()  # 加载类别标签

    def _load_model(self, model_path):
        # 加载模型
        return tf.keras.models.load_model(model_path)

    def _load_labels(self):
        # 加载类别标签
        with open('labels.txt', 'r') as f:
            labels = f.read().splitlines()
        return labels

    def predict(self, preprocessed_image):
        # 进行预测
        predictions = self.model.predict(preprocessed_image)
        predicted_class = np.argmax(predictions, axis=1)
        confidence = np.max(predictions)
        
        return {
            'class': self.labels[predicted_class[0]],
            'confidence': float(confidence)
        }
```

### 3.4.3 接口设计
- `POST /api/predict`：接收预处理后的图像，返回识别结果

## 3.5 结果展示模块

### 3.5.1 功能描述
结果展示模块将模型推理的结果以友好的方式展示给用户，包括识别类别、置信度等信息。

### 3.5.2 类设计
```python
class ResultDisplayer:
    def __init__(self):
        pass

    def display_result(self, result):
        # 格式化结果
        formatted_result = {
            'recognized_class': result['class'],
            'confidence': f"{result['confidence'] * 100:.2f}%",
            'timestamp': datetime.now().isoformat()
        }
        return formatted_result
```

### 3.5.3 接口设计
- `GET /api/result/{image_id}`：获取识别结果

# 4. 数据库设计

## 4.1 数据库选型

本系统选择MySQL作为关系型数据库，用于存储用户信息、图像上传记录和识别结果。MySQL具有成熟稳定、社区支持强大、性能良好等优点，适合本项目的需求。

## 4.2 数据表设计

### 4.2.1 用户表 (users)
存储系统用户的基本信息。

| 字段名       | 类型         | 约束         | 描述           |
|-------------|-------------|-------------|---------------|
| user_id     | INT         | PRIMARY KEY | 用户ID         |
| username    | VARCHAR(50) | UNIQUE, NOT NULL | 用户名       |
| password    | VARCHAR(255)| NOT NULL    | 加密后的密码    |
| email       | VARCHAR(100)| UNIQUE, NOT NULL | 邮箱地址     |
| role        | ENUM('admin','user') | NOT NULL | 用户角色       |
| created_at  | TIMESTAMP   | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at  | TIMESTAMP   | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### 4.2.2 图像表 (images)
存储用户上传的图像信息。

| 字段名       | 类型         | 约束         | 描述           |
|-------------|-------------|-------------|---------------|
| image_id    | INT         | PRIMARY KEY | 图像ID         |
| user_id     | INT         | FOREIGN KEY REFERENCES users(user_id) | 上传用户ID |
| filename    | VARCHAR(255)| NOT NULL    | 存储的文件名    |
| original_name | VARCHAR(255)| NOT NULL    | 原始文件名     |
| upload_time | TIMESTAMP   | DEFAULT CURRENT_TIMESTAMP | 上传时间     |
| file_size   | INT         | NOT NULL    | 文件大小（字节）|

### 4.2.3 识别结果表 (recognition_results)
存储图像识别的结果。

| 字段名       | 类型         | 约束         | 描述           |
|-------------|-------------|-------------|---------------|
| result_id   | INT         | PRIMARY KEY | 结果ID         |
| image_id    | INT         | FOREIGN KEY REFERENCES images(image_id) | 图像ID |
| recognized_class | VARCHAR(100)| NOT NULL    | 识别出的类别    |
| confidence  | FLOAT       | NOT NULL    | 置信度         |
| process_time | TIMESTAMP   | DEFAULT CURRENT_TIMESTAMP | 处理时间     |

## 4.3 数据库关系图

```
users
|
|-- user_id (PK)
|
images
|
|-- image_id (PK)
|-- user_id (FK) -> users.user_id
|
recognition_results
|
|-- result_id (PK)
|-- image_id (FK) -> images.image_id
```

## 4.4 索引设计

为了提高查询效率，为以下字段创建索引：
- `users.username`: 唯一索引，用于快速登录验证
- `users.email`: 唯一索引，用于邮箱验证
- `images.user_id`: 索引，用于查询用户上传记录
- `recognition_results.image_id`: 索引，用于关联查询识别结果

## 4.5 数据库访问层设计

```python
class DatabaseManager:
    def __init__(self, connection_string):
        self.engine = create_engine(connection_string)
        self.Session = sessionmaker(bind=self.engine)

    def add_user(self, user_data):
        session = self.Session()
        try:
            user = User(**user_data)
            session.add(user)
            session.commit()
            return user.user_id
        except Exception as e:
            session.rollback()
            raise e
        finally:
            session.close()

    def get_user_by_username(self, username):
        session = self.Session()
        try:
            return session.query(User).filter(User.username == username).first()
        finally:
            session.close()

    # 其他数据库操作方法...
```

# 5. 接口设计

## 5.1 RESTful API 设计原则

本系统采用RESTful架构风格设计API接口，遵循以下原则：
- 使用HTTP方法表达操作类型（GET、POST、PUT、DELETE）
- 使用URL标识资源
- 使用HTTP状态码表示操作结果
- 返回JSON格式的数据

## 5.2 API 端点列表

### 5.2.1 用户管理接口

#### 用户注册
- **端点**: `POST /api/register`
- **描述**: 注册新用户
- **请求体**:
```json
{
  "username": "string",
  "password": "string",
  "email": "string"
}
```
- **响应**:
  - 成功: `201 Created`
  - 失败: `400 Bad Request` (用户名或邮箱已存在)

#### 用户登录
- **端点**: `POST /api/login`
- **描述**: 用户登录
- **请求体**:
```json
{
  "username": "string",
  "password": "string"
}
```
- **响应**:
  - 成功: `200 OK` + JWT token
  - 失败: `401 Unauthorized`

### 5.2.2 图像上传接口

#### 上传图像
- **端点**: `POST /api/upload`
- **描述**: 上传图像文件
- **请求**: `multipart/form-data`
- **参数**: `file` (图像文件)
- **响应**:
  - 成功: `200 OK` + 图像ID
  - 失败: `400 Bad Request` (文件格式不支持)

### 5.2.3 图像识别接口

#### 进行图像识别
- **端点**: `POST /api/predict`
- **描述**: 对上传的图像进行识别
- **请求体**:
```json
{
  "image_id": "integer"
}
```
- **响应**:
  - 成功: `200 OK` + 识别结果
  - 失败: `404 Not Found` (图像不存在)

### 5.2.4 结果查询接口

#### 获取识别结果
- **端点**: `GET /api/result/{image_id}`
- **描述**: 获取指定图像的识别结果
- **响应**:
  - 成功: `200 OK` + 结果数据
  - 失败: `404 Not Found`

## 5.3 数据格式规范

### 5.3.1 请求头
所有API请求需要包含以下头信息：
```http
Content-Type: application/json
Authorization: Bearer <JWT_TOKEN>  # 需要认证的接口
```

### 5.3.2 响应格式
成功响应格式：
```json
{
  "status": "success",
  "data": {...},
  "message": "操作成功"
}
```

错误响应格式：
```json
{
  "status": "error",
  "error_code": "ERROR_CODE",
  "message": "错误描述"
}
```

## 5.4 错误码定义

| 错误码 | HTTP状态码 | 描述 |
|--------|-----------|------|
| AUTH_FAILED | 401 | 认证失败 |
| INVALID_INPUT | 400 | 输入参数无效 |
| NOT_FOUND | 404 | 资源不存在 |
| INTERNAL_ERROR | 500 | 服务器内部错误 |

## 5.5 接口安全

1. **身份认证**: 使用JWT (JSON Web Token) 进行用户认证
2. **输入验证**: 对所有输入参数进行验证和清理
3. **速率限制**: 对API调用进行速率限制，防止滥用
4. **HTTPS**: 所有通信使用HTTPS加密

# 6. 部署与维护

## 6.1 系统部署

### 6.1.1 环境要求
- **操作系统**: Ubuntu 18.04 LTS 或更高版本
- **Python**: 3.8+
- **数据库**: MySQL 5.7+ 或 PostgreSQL 12+
- **深度学习框架**: TensorFlow 2.x 或 PyTorch 1.8+
- **内存**: 至少 8GB RAM (推荐 16GB)
- **GPU**: 可选，但推荐用于加速模型推理

### 6.1.2 部署步骤

1. **环境准备**
```bash
# 更新系统
sudo apt update && sudo apt

2025-08-25 13:03:06,326 - evaluation_logger_Attraction-0 - INFO - Complete Result: {'score': 0, 'reason': 'The response does not address any information about trending tourist spots in Manchester.'}
2025-08-25 13:03:13,232 - evaluation_logger_Attraction-0 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 13:03:13,232 - evaluation_logger_Attraction-0 - INFO - Message: Success.
2025-08-25 13:03:13,232 - evaluation_logger_Attraction-0 - INFO - Success turn num = 2
2025-08-25 13:03:13,232 - evaluation_logger_Attraction-0 - INFO - ----------------------------------------------------------------------------------------------------
