2025-08-25 12:56:49,807 - evaluation_logger_Hotels-133 - INFO - Test Example Hotels-133
2025-08-25 12:56:49,807 - evaluation_logger_Hotels-133 - INFO - Query: Our family is planning a trip to Rome from January 10th to January 15th, 2025. There will be two adults and a one-year-old child. We hope to find the two cheapest hotels that provide airport shuttle services and to learn about their child policies.
2025-08-25 12:56:59,067 - evaluation_logger_Hotels-133 - INFO - Function Calls: 
[
    {
        "name": "Search_Hotel_Destination",
        "arguments": {
            "query": "Rome"
        }
    }
]

2025-08-25 12:56:59,067 - evaluation_logger_Hotels-133 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Hotel_Destination",
        "arguments": {
            "query": "Rome"
        }
    },
    {
        "name": "Get_Filter",
        "arguments": {
            "search_type": "city",
            "dest_id": "-126693",
            "arrival_date": "2025-01-10",
            "departure_date": "2025-01-15",
            "adults": 2,
            "children_age": "1"
        }
    }
]

2025-08-25 12:56:59,067 - evaluation_logger_Hotels-133 - INFO - Start compare_single_call: 
{'name': 'Search_Hotel_Destination', 'arguments': {'query': 'Rome'}}
{'name': 'Search_Hotel_Destination', 'arguments': {'query': 'Rome'}}
2025-08-25 12:56:59,067 - evaluation_logger_Hotels-133 - INFO - Rule-based compare success.
2025-08-25 12:56:59,067 - evaluation_logger_Hotels-133 - INFO - Success matched: [{'name': 'Search_Hotel_Destination', 'arguments': {'query': 'Rome'}}]
2025-08-25 12:56:59,067 - evaluation_logger_Hotels-133 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": [
            {
                "dest_id": "-126693",
                "search_type": "city",
                "name": "Rome",
                "latitude": 41.89587,
                "city_name": "Rome",
                "nr_hotels": 14096,
                "lc": "en",
                "country": "Italy",
                "hotels": 14096,
                "dest_type": "city",
                "longitude": 12.482617,
                "cc1": "it",
                "type": "ci",
                "region": "Lazio",
                "label": "Rome, Lazio, Italy",
                "roundtrip": "GgEwIAAoATICZW46BFJvbWVAAEoAUAA="
            }
        ]
    }
]

2025-08-25 12:57:10,058 - evaluation_logger_Hotels-133 - INFO - Function Calls: 
[
    {
        "name": "Get_Filter",
        "arguments": {
            "search_type": "city",
            "dest_id": "-126693",
            "arrival_date": "2025-01-10",
            "departure_date": "2025-01-15",
            "adults": 2,
            "children_age": "1"
        }
    }
]

2025-08-25 12:57:10,058 - evaluation_logger_Hotels-133 - INFO - Golden Function Call: 
[
    {
        "name": "Get_Filter",
        "arguments": {
            "adults": 2,
            "arrival_date": "2025-01-10",
            "children_age": "1",
            "departure_date": "2025-01-15",
            "dest_id": "-126693",
            "search_type": "city"
        }
    },
    {
        "name": "Search_Hotels",
        "arguments": {
            "search_type": "city",
            "dest_id": -126693,
            "arrival_date": "2025-01-10",
            "departure_date": "2025-01-15",
            "adults": 2,
            "children_age": "1",
            "sort_by": "price",
            "categories_filter": "facility::17"
        }
    }
]

2025-08-25 12:57:10,058 - evaluation_logger_Hotels-133 - INFO - Start compare_single_call: 
{'name': 'Get_Filter', 'arguments': {'adults': 2, 'arrival_date': '2025-01-10', 'children_age': '1', 'departure_date': '2025-01-15', 'dest_id': '-126693', 'search_type': 'city'}}
{'name': 'Get_Filter', 'arguments': {'adults': 2, 'arrival_date': '2025-01-10', 'children_age': '1', 'departure_date': '2025-01-15', 'dest_id': '-126693', 'search_type': 'city'}}
2025-08-25 12:57:10,058 - evaluation_logger_Hotels-133 - INFO - Rule-based compare success.
2025-08-25 12:57:10,058 - evaluation_logger_Hotels-133 - INFO - Success matched: [{'name': 'Get_Filter', 'arguments': {'adults': 2, 'arrival_date': '2025-01-10', 'children_age': '1', 'departure_date': '2025-01-15', 'dest_id': '-126693', 'search_type': 'city'}}]
2025-08-25 12:57:10,059 - evaluation_logger_Hotels-133 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "timestamp": 1723632617648,
        "data": {
            "pagination": {
                "nbResultsTotal": 9344
            },
            "availabilityInfo": {
                "totalAvailableNotAutoextended": 9344
            },
            "filters": [
                {
                    "title": "Your previous filters",
                    "field": "previous",
                    "filterStyle": "CHECKBOX",
                    "options": [
                        {
                            "title": "Hotels",
                            "genericId": "property_type::204",
                            "countNotAutoextended": 752
                        },
                        {
                            "title": "Swimming Pool",
                            "genericId": "facility::433",
                            "countNotAutoextended": 120
                        },
                        {
                            "title": "Pets allowed",
                            "genericId": "facility::4",
                            "countNotAutoextended": 2490
                        },
                        {
                            "title": "Free WiFi",
                            "genericId": "facility::107",
                            "countNotAutoextended": 9076
                        },
                        {
                            "title": "2 stars",
                            "genericId": "class::2",
                            "countNotAutoextended": 80
                        }
                    ]
                },
                {
                    "title": "Your budget (for 5 nights)",
                    "field": "price",
                    "filterStyle": "SLIDER",
                    "min": "200",
                    "max": "3000",
                    "minPriceStep": "100",
                    "minSelected": "0",
                    "histogram": [
                        0,
                        0,
                        0,
                        0,
                        0,
                        0,
                        3,
                        5,
                        15,
                        34,
                        56,
                        68,
                        88,
                        88,
                        93,
                        83,
                        100,
                        90,
                        82,
                        81,
                        67,
                        64,
                        62,
                        52,
                        51,
                        47,
                        42,
                        42,
                        35,
                        32,
                        28,
                        30,
                        23,
                        26,
                        21,
                        18,
                        18,
                        15,
                        15,
                        15,
                        12,
                        12,
                        7,
                        10,
                        9,
                        11,
                        7,
                        9,
                        8,
                        7
                    ],
                    "currency": "EUR"
                },
                {
                    "title": "Popular filters",
                    "field": "popular",
                    "filterStyle": "CHECKBOX",
                    "options": [
                        {
                            "title": "Breakfast included",
                            "genericId": "mealplan::breakfast_included",
                            "countNotAutoextended": 1365
                        },
                        {
                            "title": "Rome City Centre",
                            "genericId": "district::2282",
                            "countNotAutoextended": 4849
                        },
                        {
                            "title": "Hotels",
                            "genericId": "property_type::204",
                            "countNotAutoextended": 752
                        },
                        {
                            "title": "Apartments",
                            "genericId": "property_type::201",
                            "countNotAutoextended": 6250
                        },
                        {
                            "title": "Very good: 8+",
                            "genericId": "reviewscorebuckets::80",
                            "countNotAutoextended": 7232
                        },
                        {
                            "title": "Central Station",
                            "genericId": "district::2103",
                            "countNotAutoextended": 878
                        },
                        {
                            "title": "Superb: 9+",
                            "genericId": "reviewscorebuckets::90",
                            "countNotAutoextended": 3885
                        },
                        {
                            "title": "Double bed",
                            "genericId": "twin_double_bed::3",
                            "countNotAutoextended": 9189
                        }
                    ]
                },
                {
                    "title": "Review score",
                    "field": "review_score",
                    "filterStyle": "CHECKBOX",
                    "options": [
                        {
                            "title": "Passable: 5+",
                            "genericId": "reviewscorebuckets::50",
                            "countNotAutoextended": 8735
                        },
                        {
                            "title": "Pleasant: 6+",
                            "genericId": "reviewscorebuckets::60",
                            "countNotAutoextended": 8647
                        },
                        {
                            "title": "Good: 7+",
                            "genericId": "reviewscorebuckets::70",
                            "countNotAutoextended": 8399
                        },
                        {
                            "title": "Very good: 8+",
                            "genericId": "reviewscorebuckets::80",
                            "countNotAutoextended": 7232
                        },
                        {
                            "title": "Superb: 9+",
                            "genericId": "reviewscorebuckets::90",
                            "countNotAutoextended": 3885
                        }
                    ]
                },
                {
                    "title": "Property type",
                    "field": "ht_id",
                    "filterStyle": "CHECKBOX",
                    "options": [
                        {
                            "title": "Entire homes & apartments",
                            "genericId": "privacy_type::3",
                            "countNotAutoextended": 6767
                        },
                        {
                            "title": "Apartments",
                            "genericId": "property_type::201",
                            "countNotAutoextended": 6250
                        },
                        {
                            "title": "Guest houses",
                            "genericId": "property_type::216",
                            "countNotAutoextended": 1338
                        },
                        {
                            "title": "Hotels",
                            "genericId": "property_type::204",
                            "countNotAutoextended": 752
                        },
                        {
                            "title": "Bed and breakfasts",
                            "genericId": "property_type::208",
                            "countNotAutoextended": 587
                        },
                        {
                            "title": "Holiday homes",
                            "genericId": "property_type::220",
                            "countNotAutoextended": 358
                        },
                        {
                            "title": "Homestays",
                            "genericId": "property_type::222",
                            "countNotAutoextended": 53
                        },
                        {
                            "title": "Hostels",
                            "genericId": "property_type::203",
                            "countNotAutoextended": 29
                        },
                        {
                            "title": "Villas",
                            "genericId": "property_type::213",
                            "countNotAutoextended": 23
                        },
                        {
                            "title": "Resorts",
                            "genericId": "property_type::206",
                            "countNotAutoextended": 2
                        }
                    ]
                },
                {
                    "title": "Chain",
                    "field": "chaincode",
                    "filterStyle": "CHECKBOX",
                    "options": [
                        {
                            "title": "4L Collection",
                            "genericId": "chaincode::13039",
                            "countNotAutoextended": 5
                        },
                        {
                            "title": "AG Hotels",
                            "genericId": "chaincode::12749",
                            "countNotAutoextended": 7
                        },
                        {
                            "title": "Autograph Collection",
                            "genericId": "chaincode::2542",
                            "countNotAutoextended": 3
                        },
                        {
                            "title": "B&B Hotels",
                            "genericId": "chaincode::1175",
                            "countNotAutoextended": 4
                        },
                        {
                            "title": "B.Zar Hotel&Co.",
                            "genericId": "chaincode::13741",
                            "countNotAutoextended": 7
                        },
                        {
                            "title": "Best Western",
                            "genericId": "chaincode::1029",
                            "countNotAutoextended": 11
                        },
                        {
                            "title": "Camplus",
                            "genericId": "chaincode::11230",
                            "countNotAutoextended": 3
                        },
                        {
                            "title": "Gruppo UNA",
                            "genericId": "chaincode::13926",
                            "countNotAutoextended": 4
                        },
                        {
                            "title": "Holidu",
                            "genericId": "chaincode::10845",
                            "countNotAutoextended": 14
                        },
                        {
                            "title": "ibis Styles",
                            "genericId": "chaincode::3086",
                            "countNotAutoextended": 3
                        }
                    ]
                },
                {
                    "title": "Facilities",
                    "field": "hotelfacility",
                    "filterStyle": "CHECKBOX",
                    "options": [
                        {
                            "title": "Free WiFi",
                            "genericId": "facility::107",
                            "countNotAutoextended": 9076
                        },
                        {
                            "title": "Non-smoking rooms",
                            "genericId": "facility::16",
                            "countNotAutoextended": 7005
                        },
                        {
                            "title": "Family rooms",
                            "genericId": "facility::28",
                            "countNotAutoextended": 4455
                        },
                        {
                            "title": "Airport shuttle",
                            "genericId": "facility::17",
                            "countNotAutoextended": 3505
                        },
                        {
                            "title": "Parking",
                            "genericId": "facility::2",
                            "countNotAutoextended": 2921
                        },
                        {
                            "title": "Pets allowed",
                            "genericId": "facility::4",
                            "countNotAutoextended": 2490
                        },
                        {
                            "title": "Free parking",
                            "genericId": "facility::46",
                            "countNotAutoextended": 1029
                        },
                        {
                            "title": "24-hour front desk",
                            "genericId": "facility::8",
                            "countNotAutoextended": 961
                        },
                        {
                            "title": "Room service",
                            "genericId": "facility::5",
                            "countNotAutoextended": 712
                        },
                        {
                            "title": "Electric vehicle charging station",
                            "genericId": "facility::182",
                            "countNotAutoextended": 403
                        }
                    ]
                },
                {
                    "title": "Distance from city centre",
                    "field": "distance",
                    "filterStyle": "CHECKBOX",
                    "options": [
                        {
                            "title": "Less than 1 km",
                            "genericId": "distance::1000",
                            "countNotAutoextended": 1469
                        },
                        {
                            "title": "Less than 3 km",
                            "genericId": "distance::3000",
                            "countNotAutoextended": 6249
                        },
                        {
                            "title": "Less than 5 km",
                            "genericId": "distance::5000",
                            "countNotAutoextended": 8189
                        }
                    ]
                },
                {
                    "title": "Landmarks",
                    "field": "popular_nearby_landmarks",
                    "filterStyle": "CHECKBOX",
                    "options": [
                        {
                            "title": "Coliseum",
                            "genericId": "popular_nearby_landmarks::1506",
                            "countNotAutoextended": 760
                        },
                        {
                            "title": "Pantheon",
                            "genericId": "popular_nearby_landmarks::1093",
                            "countNotAutoextended": 1672
                        },
                        {
                            "title": "Roman Forum",
                            "genericId": "popular_nearby_landmarks::2125",
                            "countNotAutoextended": 929
                        },
                        {
                            "title": "The Vatican",
                            "genericId": "popular_nearby_landmarks::57962",
                            "countNotAutoextended": 1217
                        },
                        {
                            "title": "Trevi Fountain",
                            "genericId": "popular_nearby_landmarks::1510",
                            "countNotAutoextended": 1614
                        }
                    ]
                },
                {
                    "title": "District",
                    "field": "di",
                    "filterStyle": "CHECKBOX",
                    "options": [
                        {
                            "title": "Guests' favourite area ",
                            "genericId": "district::10347",
                            "countNotAutoextended": 6615
                        },
                        {
                            "title": "Rome City Centre",
                            "genericId": "district::2282",
                            "countNotAutoextended": 4849
                        },
                        {
                            "title": "Central Station",
                            "genericId": "district::2103",
                            "countNotAutoextended": 878
                        },
                        {
                            "title": "Appio Latino",
                            "genericId": "district::2102",
                            "countNotAutoextended": 645
                        },
                        {
                            "title": "Ardeatino",
                            "genericId": "district::17462",
                            "countNotAutoextended": 32
                        },
                        {
                            "title": "Aurelio",
                            "genericId": "district::607",
                            "countNotAutoextended": 691
                        },
                        {
                            "title": "Aventino",
                            "genericId": "district::203",
                            "countNotAutoextended": 144
                        },
                        {
                            "title": "Best areas outside centre",
                            "genericId": "district::9999997",
                            "countNotAutoextended": 1917
                        },
                        {
                            "title": "Cassia",
                            "genericId": "district::7299",
                            "countNotAutoextended": 25
                        },
                        {
                            "title": "Colosseum",
                            "genericId": "district::2101",
                            "countNotAutoextended": 552
                        }
                    ]
                }
            ]
        }
    }
]

2025-08-25 12:57:23,047 - evaluation_logger_Hotels-133 - INFO - Function Calls: 
[
    {
        "name": "Search_Hotels",
        "arguments": {
            "search_type": "city",
            "dest_id": -126693,
            "arrival_date": "2025-01-10",
            "departure_date": "2025-01-15",
            "adults": 2,
            "children_age": "1",
            "categories_filter": "facility::17",
            "sort_by": "price"
        }
    }
]

2025-08-25 12:57:23,048 - evaluation_logger_Hotels-133 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Hotels",
        "arguments": {
            "adults": 2,
            "arrival_date": "2025-01-10",
            "categories_filter": "facility::17",
            "children_age": "1",
            "departure_date": "2025-01-15",
            "dest_id": -126693,
            "search_type": "city",
            "sort_by": "price"
        }
    },
    {
        "name": "Property_Children_Policies",
        "arguments": {
            "hotel_id": "248647"
        }
    },
    {
        "name": "Property_Children_Policies",
        "arguments": {
            "hotel_id": "12246896"
        }
    }
]

2025-08-25 12:57:23,048 - evaluation_logger_Hotels-133 - INFO - Start compare_single_call: 
{'name': 'Search_Hotels', 'arguments': {'adults': 2, 'arrival_date': '2025-01-10', 'categories_filter': 'facility::17', 'children_age': '1', 'departure_date': '2025-01-15', 'dest_id': -126693, 'search_type': 'city', 'sort_by': 'price'}}
{'name': 'Search_Hotels', 'arguments': {'adults': 2, 'arrival_date': '2025-01-10', 'categories_filter': 'facility::17', 'children_age': '1', 'departure_date': '2025-01-15', 'dest_id': -126693, 'search_type': 'city', 'sort_by': 'price'}}
2025-08-25 12:57:23,048 - evaluation_logger_Hotels-133 - INFO - Rule-based compare success.
2025-08-25 12:57:23,048 - evaluation_logger_Hotels-133 - INFO - Success matched: [{'name': 'Search_Hotels', 'arguments': {'adults': 2, 'arrival_date': '2025-01-10', 'categories_filter': 'facility::17', 'children_age': '1', 'departure_date': '2025-01-15', 'dest_id': -126693, 'search_type': 'city', 'sort_by': 'price'}}]
2025-08-25 12:57:23,048 - evaluation_logger_Hotels-133 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "hotels": [
                {
                    "hotel_id": 248647,
                    "accessibilityLabel": "hu Roma Camping In Town.\n7.9 Good 26851 reviews.\n‎7 km from centre‬.\n Entire bungalow – 16 m² : 3 beds • 1 bedroom • 1 bathroom.\n235 USD.\nIncludes taxes and charges.\nFree cancellation.\nNo prepayment needed.",
                    "property": {
                        "isFirstPage": true,
                        "optOutFromGalleryChanges": 0,
                        "rankingPosition": 0,
                        "blockIds": [
                            "24864713_295432772_0_2_0"
                        ],
                        "qualityClass": 0,
                        "currency": "EUR",
                        "name": "hu Roma Camping In Town",
                        "checkinDate": "2025-01-10",
                        "accuratePropertyClass": 0,
                        "isPreferred": true,
                        "latitude": 41.8869302569554,
                        "wishlistName": "Rome",
                        "checkout": {
                            "fromTime": "00:00",
                            "untilTime": "10:00"
                        },
                        "ufi": -126693,
                        "countryCode": "it",
                        "position": 0,
                        "checkin": {
                            "fromTime": "14:00",
                            "untilTime": "00:00"
                        },
                        "checkoutDate": "2025-01-15",
                        "mainPhotoId": 423079754,
                        "reviewCount": 26851,
                        "reviewScore": 7.9,
                        "id": 248647,
                        "priceBreakdown": {
                            "grossPrice": {
                                "currency": "USD",
                                "value": 235.260180646025
                            }
                        },
                        "propertyClass": 0,
                        "reviewScoreWord": "Good",
                        "longitude": 12.4045193198617
                    }
                },
                {
                    "hotel_id": 12246896,
                    "accessibilityLabel": "Veio Terrace.\n3 out of 5 for property rating.\n9.7 Exceptional 10 reviews.\n‎12 km from centre‬.\n Entire apartment – 40 m² : 2 beds • 1 bedroom • 1 living room • 1 bathroom.\n390 USD.\nIncludes taxes and charges.\nFree cancellation.",
                    "property": {
                        "position": 1,
                        "countryCode": "it",
                        "ufi": -126693,
                        "reviewCount": 10,
                        "mainPhotoId": 568307029,
                        "checkoutDate": "2025-01-15",
                        "checkin": {
                            "fromTime": "14:00",
                            "untilTime": "00:00"
                        },
                        "currency": "EUR",
                        "name": "Veio Terrace",
                        "checkinDate": "2025-01-10",
                        "accuratePropertyClass": 0,
                        "qualityClass": 3,
                        "blockIds": [
                            "1224689601_394575525_3_0_0"
                        ],
                        "optOutFromGalleryChanges": 0,
                        "rankingPosition": 1,
                        "isFirstPage": true,
                        "checkout": {
                            "fromTime": "00:00",
                            "untilTime": "10:30"
                        },
                        "wishlistName": "Rome",
                        "latitude": 42.0065322,
                        "propertyClass": 0,
                        "longitude": 12.4794731,
                        "reviewScoreWord": "Exceptional",
                        "priceBreakdown": {
                            "grossPrice": {
                                "currency": "USD",
                                "value": 389.934001070759
                            }
                        },
                        "id": 12246896,
                        "reviewScore": 9.7
                    }
                },
                {
                    "hotel_id": 11105254,
                    "accessibilityLabel": "Dazio Exclusive Rooms.\n3 out of 5 stars.\n6.0 Pleasant 104 reviews.\n‎Tiburtino‬ • ‎11 km from centre‬.\n Hotel room : 2 beds.\nOriginal price 433 USD. Current price 396 USD..\nIncludes taxes and charges.",
                    "property": {
                        "longitude": 12.5843883,
                        "reviewScoreWord": "Pleasant",
                        "propertyClass": 3,
                        "id": 11105254,
                        "priceBreakdown": {
                            "benefitBadges": [
                                {
                                    "identifier": "Mobile Rate",
                                    "text": "Mobile-only price",
                                    "variant": "constructive",
                                    "explanation": "Mobile-only price"
                                }
                            ],
                            "strikethroughPrice": {
                                "currency": "USD",
                                "value": 433.260001189732
                            },
                            "grossPrice": {
                                "currency": "USD",
                                "value": 396.432901088605
                            }
                        },
                        "reviewScore": 6,
                        "mainPhotoId": 507628298,
                        "reviewCount": 104,
                        "checkin": {
                            "fromTime": "15:00",
                            "untilTime": "23:30"
                        },
                        "checkoutDate": "2025-01-15",
                        "position": 2,
                        "ufi": -126693,
                        "countryCode": "it",
                        "latitude": 41.958527,
                        "checkout": {
                            "fromTime": "07:00",
                            "untilTime": "11:00"
                        },
                        "wishlistName": "Rome",
                        "blockIds": [
                            "1110525401_384031987_0_41_0"
                        ],
                        "name": "Dazio Exclusive Rooms",
                        "accuratePropertyClass": 3,
                        "currency": "EUR",
                        "checkinDate": "2025-01-10",
                        "qualityClass": 0,
                        "rankingPosition": 2,
                        "optOutFromGalleryChanges": 0,
                        "isFirstPage": true
                    }
                }
            ],
            "meta": [
                {
                    "title": "3721 properties"
                }
            ],
            "appear": [
                {
                    "component": {
                        "props": {
                            "fill": true,
                            "content": {
                                "props": {
                                    "fitContentWidth": true,
                                    "items": [
                                        {
                                            "props": {
                                                "component": {
                                                    "props": {
                                                        "spacing": "spacing_half",
                                                        "items": [
                                                            {
                                                                "props": {
                                                                    "text": [
                                                                        {
                                                                            "text": "Commission paid and other benefits may affect an accommodation's ranking.",
                                                                            "font": "body_2"
                                                                        },
                                                                        {
                                                                            "font": "strong_2",
                                                                            "text": "  ",
                                                                            "color": "foreground"
                                                                        },
                                                                        {
                                                                            "font": "body_2",
                                                                            "text": "Find out more",
                                                                            "linkActions": [
                                                                                {}
                                                                            ],
                                                                            "color": "action_foreground"
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                }
                                            }
                                        },
                                        {},
                                        {
                                            "props": {
                                                "component": {
                                                    "props": {
                                                        "tertiaryTintedColor": "foreground",
                                                        "variant": "tertiary_tinted",
                                                        "accessibilityLabel": "Close",
                                                        "icon": "close"
                                                    }
                                                }
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    },
                    "id": "cma"
                },
                {},
                {
                    "id": "banner_qualityrating",
                    "component": {
                        "props": {
                            "text": "Properties with these icons have been awarded Booking.com's quality rating for homes"
                        }
                    }
                },
                {
                    "id": "signin_now",
                    "component": {
                        "props": {
                            "title": "Sign in and save money",
                            "text": "Get instant access to our Genius loyalty programme and enjoy discounts at properties worldwide."
                        }
                    }
                }
            ]
        }
    }
]

2025-08-25 12:57:33,898 - evaluation_logger_Hotels-133 - INFO - Function Calls: 
[
    {
        "name": "Property_Children_Policies",
        "arguments": {
            "hotel_id": "248647"
        }
    },
    {
        "name": "Property_Children_Policies",
        "arguments": {
            "hotel_id": "12246896"
        }
    }
]

2025-08-25 12:57:33,898 - evaluation_logger_Hotels-133 - INFO - Golden Function Call: 
[
    {
        "name": "Property_Children_Policies",
        "arguments": {
            "hotel_id": "248647"
        }
    },
    {
        "name": "Property_Children_Policies",
        "arguments": {
            "hotel_id": "12246896"
        }
    }
]

2025-08-25 12:57:33,898 - evaluation_logger_Hotels-133 - INFO - Start compare_single_call: 
{'name': 'Property_Children_Policies', 'arguments': {'hotel_id': '248647'}}
{'name': 'Property_Children_Policies', 'arguments': {'hotel_id': '248647'}}
2025-08-25 12:57:33,898 - evaluation_logger_Hotels-133 - INFO - Rule-based compare success.
2025-08-25 12:57:33,898 - evaluation_logger_Hotels-133 - INFO - Start compare_single_call: 
{'name': 'Property_Children_Policies', 'arguments': {'hotel_id': '12246896'}}
{'name': 'Property_Children_Policies', 'arguments': {'hotel_id': '12246896'}}
2025-08-25 12:57:33,898 - evaluation_logger_Hotels-133 - INFO - Rule-based compare success.
2025-08-25 12:57:33,898 - evaluation_logger_Hotels-133 - INFO - Success matched: [{'name': 'Property_Children_Policies', 'arguments': {'hotel_id': '248647'}}, {'name': 'Property_Children_Policies', 'arguments': {'hotel_id': '12246896'}}]
2025-08-25 12:57:33,898 - evaluation_logger_Hotels-133 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "mfeId": "b-saba-child-policies-mfe/saba",
            "clientVersion": 68,
            "serverVersion": 112,
            "root": {
                "props": {
                    "items": [
                        {
                            "props": {
                                "margin": {
                                    "bottom": "spacing_1x"
                                },
                                "component": {
                                    "props": {
                                        "font": "strong_2",
                                        "text": "Child policies"
                                    },
                                    "type": "bui.Label"
                                }
                            },
                            "type": "core.Margin"
                        },
                        {
                            "props": {
                                "items": [
                                    {
                                        "props": {
                                            "component": {
                                                "props": {
                                                    "text": "Children of any age are welcome."
                                                },
                                                "type": "bui.Label"
                                            },
                                            "margin": {
                                                "top": "spacing_1x"
                                            }
                                        },
                                        "type": "core.Margin"
                                    },
                                    {
                                        "props": {
                                            "margin": {
                                                "top": "spacing_1x"
                                            },
                                            "component": {
                                                "type": "bui.Label",
                                                "props": {
                                                    "text": "Children 3 years and above will be charged as adults at this property."
                                                }
                                            }
                                        },
                                        "type": "core.Margin"
                                    },
                                    {
                                        "props": {
                                            "margin": {
                                                "top": "spacing_1x"
                                            },
                                            "component": {
                                                "type": "bui.Label",
                                                "props": {
                                                    "text": "To see correct prices and occupancy information, please add the number of children in your group and their ages to your search.",
                                                    "font": "emphasized_2"
                                                }
                                            }
                                        },
                                        "type": "core.Margin"
                                    }
                                ]
                            },
                            "type": "core.layout.Column"
                        },
                        {
                            "type": "core.Margin",
                            "props": {
                                "margin": {
                                    "bottom": "spacing_2x",
                                    "top": "spacing_4x"
                                },
                                "component": {
                                    "props": {
                                        "font": "strong_2",
                                        "text": "Cot and extra bed policies"
                                    },
                                    "type": "bui.Label"
                                }
                            }
                        },
                        {
                            "props": {
                                "margin": {
                                    "bottom": "spacing_2x"
                                },
                                "component": {
                                    "props": {
                                        "component": {
                                            "props": {
                                                "items": [
                                                    {
                                                        "props": {
                                                            "component": {
                                                                "type": "core.layout.Row",
                                                                "props": {
                                                                    "items": [
                                                                        {
                                                                            "props": {
                                                                                "component": {
                                                                                    "props": {
                                                                                        "font": "emphasized_2",
                                                                                        "text": "0 - 2 years"
                                                                                    },
                                                                                    "type": "bui.Label"
                                                                                },
                                                                                "margin": {
                                                                                    "top": "spacing_2x",
                                                                                    "end": "spacing_2x",
                                                                                    "bottom": "spacing_2x",
                                                                                    "start": "spacing_2x"
                                                                                }
                                                                            },
                                                                            "type": "core.Margin"
                                                                        }
                                                                    ]
                                                                }
                                                            },
                                                            "background": "border_alt",
                                                            "border": "border_alt"
                                                        },
                                                        "type": "bui.Decoration"
                                                    },
                                                    {
                                                        "props": {
                                                            "firstItemWidth": 57,
                                                            "alignment": "center",
                                                            "items": [
                                                                {
                                                                    "props": {
                                                                        "items": [
                                                                            {
                                                                                "props": {
                                                                                    "items": [
                                                                                        {
                                                                                            "type": "core.Margin",
                                                                                            "props": {
                                                                                                "margin": {
                                                                                                    "top": "spacing_2x",
                                                                                                    "start": "spacing_2x",
                                                                                                    "end": "spacing_2x",
                                                                                                    "bottom": "spacing_2x"
                                                                                                },
                                                                                                "component": {
                                                                                                    "type": "bui.Icon",
                                                                                                    "props": {
                                                                                                        "name": "baby_cot",
                                                                                                        "size": "smaller"
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        },
                                                                                        {
                                                                                            "type": "core.Margin",
                                                                                            "props": {
                                                                                                "margin": {
                                                                                                    "top": "spacing_2x",
                                                                                                    "bottom": "spacing_2x",
                                                                                                    "end": "spacing_2x"
                                                                                                },
                                                                                                "component": {
                                                                                                    "props": {
                                                                                                        "text": "Cot upon request"
                                                                                                    },
                                                                                                    "type": "bui.Label"
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    ],
                                                                                    "alignment": "center"
                                                                                },
                                                                                "type": "core.layout.Row"
                                                                            }
                                                                        ]
                                                                    },
                                                                    "type": "core.layout.Column"
                                                                },
                                                                {
                                                                    "type": "core.Margin",
                                                                    "props": {
                                                                        "component": {
                                                                            "props": {
                                                                                "text": "Free",
                                                                                "color": "constructive_foreground",
                                                                                "font": "emphasized_2"
                                                                            },
                                                                            "type": "bui.Label"
                                                                        },
                                                                        "margin": {
                                                                            "end": "spacing_2x",
                                                                            "bottom": "spacing_2x",
                                                                            "start": "spacing_2x",
                                                                            "top": "spacing_2x"
                                                                        }
                                                                    }
                                                                }
                                                            ]
                                                        },
                                                        "type": "core.layout.SplitRow"
                                                    }
                                                ]
                                            },
                                            "type": "core.layout.Column"
                                        },
                                        "border": "border_alt"
                                    },
                                    "type": "bui.Decoration"
                                }
                            },
                            "type": "core.Margin"
                        },
                        {
                            "props": {
                                "items": [
                                    {
                                        "type": "core.Margin",
                                        "props": {
                                            "component": {
                                                "props": {
                                                    "text": "Supplements are not calculated automatically in the total costs and will have to be paid for separately during your stay."
                                                },
                                                "type": "bui.Label"
                                            },
                                            "margin": {
                                                "top": "spacing_1x"
                                            }
                                        }
                                    },
                                    {
                                        "type": "core.Margin",
                                        "props": {
                                            "component": {
                                                "type": "bui.Label",
                                                "props": {
                                                    "text": "The maximum number of cots, extra beds and children allowed in existing beds may vary depending on the option you book."
                                                }
                                            },
                                            "margin": {
                                                "top": "spacing_1x"
                                            }
                                        }
                                    },
                                    {
                                        "props": {
                                            "margin": {
                                                "top": "spacing_1x"
                                            },
                                            "component": {
                                                "type": "bui.Label",
                                                "props": {
                                                    "text": "All cots and extra beds are subject to availability."
                                                }
                                            }
                                        },
                                        "type": "core.Margin"
                                    },
                                    {
                                        "props": {
                                            "component": {
                                                "props": {
                                                    "text": "There is no capacity for extra beds."
                                                },
                                                "type": "bui.Label"
                                            },
                                            "margin": {
                                                "top": "spacing_1x"
                                            }
                                        },
                                        "type": "core.Margin"
                                    }
                                ]
                            },
                            "type": "core.layout.Column"
                        }
                    ]
                },
                "type": "core.layout.Column"
            }
        }
    },
    {
        "status": true,
        "message": "Success",
        "data": {
            "root": {
                "props": {
                    "items": [
                        {
                            "props": {
                                "margin": {
                                    "bottom": "spacing_1x"
                                },
                                "component": {
                                    "type": "bui.Label",
                                    "props": {
                                        "font": "strong_2",
                                        "text": "Child policies"
                                    }
                                }
                            },
                            "type": "core.Margin"
                        },
                        {
                            "props": {
                                "items": [
                                    {
                                        "type": "core.Margin",
                                        "props": {
                                            "component": {
                                                "props": {
                                                    "text": "Children of any age are welcome."
                                                },
                                                "type": "bui.Label"
                                            },
                                            "margin": {
                                                "top": "spacing_1x"
                                            }
                                        }
                                    },
                                    {
                                        "type": "core.Margin",
                                        "props": {
                                            "component": {
                                                "props": {
                                                    "text": "To see correct prices and occupancy information, please add the number of children in your group and their ages to your search.",
                                                    "font": "emphasized_2"
                                                },
                                                "type": "bui.Label"
                                            },
                                            "margin": {
                                                "top": "spacing_1x"
                                            }
                                        }
                                    }
                                ]
                            },
                            "type": "core.layout.Column"
                        },
                        {
                            "props": {
                                "margin": {
                                    "top": "spacing_4x",
                                    "bottom": "spacing_2x"
                                },
                                "component": {
                                    "type": "bui.Label",
                                    "props": {
                                        "font": "strong_2",
                                        "text": "Cot and extra bed policies"
                                    }
                                }
                            },
                            "type": "core.Margin"
                        },
                        {
                            "props": {
                                "margin": {
                                    "bottom": "spacing_2x"
                                },
                                "component": {
                                    "props": {
                                        "component": {
                                            "type": "core.layout.Column",
                                            "props": {
                                                "items": [
                                                    {
                                                        "props": {
                                                            "component": {
                                                                "props": {
                                                                    "items": [
                                                                        {
                                                                            "type": "core.Margin",
                                                                            "props": {
                                                                                "margin": {
                                                                                    "end": "spacing_2x",
                                                                                    "top": "spacing_2x",
                                                                                    "bottom": "spacing_2x",
                                                                                    "start": "spacing_2x"
                                                                                },
                                                                                "component": {
                                                                                    "props": {
                                                                                        "font": "emphasized_2",
                                                                                        "text": "0 - 3 years"
                                                                                    },
                                                                                    "type": "bui.Label"
                                                                                }
                                                                            }
                                                                        }
                                                                    ]
                                                                },
                                                                "type": "core.layout.Row"
                                                            },
                                                            "background": "border_alt",
                                                            "border": "border_alt"
                                                        },
                                                        "type": "bui.Decoration"
                                                    },
                                                    {
                                                        "props": {
                                                            "items": [
                                                                {
                                                                    "type": "core.layout.Column",
                                                                    "props": {
                                                                        "items": [
                                                                            {
                                                                                "type": "core.layout.Row",
                                                                                "props": {
                                                                                    "alignment": "center",
                                                                                    "items": [
                                                                                        {
                                                                                            "type": "core.Margin",
                                                                                            "props": {
                                                                                                "margin": {
                                                                                                    "bottom": "spacing_2x",
                                                                                                    "start": "spacing_2x",
                                                                                                    "top": "spacing_2x",
                                                                                                    "end": "spacing_2x"
                                                                                                },
                                                                                                "component": {
                                                                                                    "type": "bui.Icon",
                                                                                                    "props": {
                                                                                                        "size": "smaller",
                                                                                                        "name": "baby_cot"
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        },
                                                                                        {
                                                                                            "props": {
                                                                                                "component": {
                                                                                                    "props": {
                                                                                                        "text": "Cot upon request"
                                                                                                    },
                                                                                                    "type": "bui.Label"
                                                                                                },
                                                                                                "margin": {
                                                                                                    "bottom": "spacing_2x",
                                                                                                    "end": "spacing_2x",
                                                                                                    "top": "spacing_2x"
                                                                                                }
                                                                                            },
                                                                                            "type": "core.Margin"
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                },
                                                                {
                                                                    "props": {
                                                                        "component": {
                                                                            "props": {
                                                                                "font": "emphasized_2",
                                                                                "text": "Free",
                                                                                "color": "constructive_foreground"
                                                                            },
                                                                            "type": "bui.Label"
                                                                        },
                                                                        "margin": {
                                                                            "start": "spacing_2x",
                                                                            "bottom": "spacing_2x",
                                                                            "top": "spacing_2x",
                                                                            "end": "spacing_2x"
                                                                        }
                                                                    },
                                                                    "type": "core.Margin"
                                                                }
                                                            ],
                                                            "alignment": "center",
                                                            "firstItemWidth": 57
                                                        },
                                                        "type": "core.layout.SplitRow"
                                                    }
                                                ]
                                            }
                                        },
                                        "border": "border_alt"
                                    },
                                    "type": "bui.Decoration"
                                }
                            },
                            "type": "core.Margin"
                        },
                        {
                            "props": {
                                "items": [
                                    {
                                        "props": {
                                            "margin": {
                                                "top": "spacing_1x"
                                            },
                                            "component": {
                                                "props": {
                                                    "text": "Supplements are not calculated automatically in the total costs and will have to be paid for separately during your stay."
                                                },
                                                "type": "bui.Label"
                                            }
                                        },
                                        "type": "core.Margin"
                                    },
                                    {
                                        "props": {
                                            "margin": {
                                                "top": "spacing_1x"
                                            },
                                            "component": {
                                                "type": "bui.Label",
                                                "props": {
                                                    "text": "The maximum number of cots, extra beds and children allowed in existing beds may vary depending on the option you book."
                                                }
                                            }
                                        },
                                        "type": "core.Margin"
                                    },
                                    {
                                        "type": "core.Margin",
                                        "props": {
                                            "margin": {
                                                "top": "spacing_1x"
                                            },
                                            "component": {
                                                "type": "bui.Label",
                                                "props": {
                                                    "text": "All cots and extra beds are subject to availability."
                                                }
                                            }
                                        }
                                    },
                                    {
                                        "type": "core.Margin",
                                        "props": {
                                            "margin": {
                                                "top": "spacing_1x"
                                            },
                                            "component": {
                                                "props": {
                                                    "text": "There is no capacity for extra beds."
                                                },
                                                "type": "bui.Label"
                                            }
                                        }
                                    }
                                ]
                            },
                            "type": "core.layout.Column"
                        }
                    ]
                },
                "type": "core.layout.Column"
            },
            "mfeId": "b-saba-child-policies-mfe/saba",
            "clientVersion": 68,
            "serverVersion": 112
        }
    }
]

2025-08-25 12:59:29,725 - evaluation_logger_Hotels-133 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 前言

在之前的文章中，我们介绍了`axios`的拦截器，并实现了请求拦截器和响应拦截器的执行流程。我们知道，在给`axios`实例添加多个请求拦截器和响应拦截器的时候，它们会按照添加的顺序被链式调用。那么，拦截器内部究竟是如何实现这种链式调用的呢？接下来，我们就从源码的角度来揭开它的神秘面纱。

# 2. 拦截器管理类

在`axios`中，无论是请求拦截器还是响应拦截器，它们都通过一个叫`InterceptorManager`的拦截器管理类来管理。该类是`axios`中的一个内部类，我们在`Axios.js`文件中可以找到它的定义，如下：

```javascript
function InterceptorManager() {
  this.handlers = [];
}

InterceptorManager.prototype.use = function use(fulfilled, rejected) {
  this.handlers.push({
    fulfilled: fulfilled,
    rejected: rejected
  });
  return this.handlers.length - 1;
};

InterceptorManager.prototype.eject = function eject(id) {
  if (this.handlers[id]) {
    this.handlers[id] = null;
  }
};

InterceptorManager.prototype.forEach = function forEach(fn) {
  utils.forEach(this.handlers, function forEachHandler(h) {
    if (h !== null) {
      fn(h);
    }
  });
};
```

从上面的代码中我们可以看到：

- `InterceptorManager`类有一个属性`handlers`，它是一个数组，用来存储拦截器；
- `InterceptorManager`类有一个实例方法`use`，用来添加拦截器，它接收两个参数：`fulfilled`和`rejected`，分别对应`Promise`的`resolve`和`reject`。该方法将传入的两个参数作为一个对象`{fulfilled: fulfilled,rejected: rejected}`添加到`handlers`中，并返回当前拦截器在`handlers`中的索引，以便之后可以通过`eject`来移除拦截器；
- `InterceptorManager`类有一个实例方法`eject`，用来移除拦截器，它接收一个参数`id`，该参数是拦截器在`handlers`中的索引，该方法将`handlers`中对应索引的拦截器置为`null`，注意这里没有使用删除数组元素的方法，是因为当我们删除数组元素后，数组的长度会发生变化，从而导致之前记录的索引错乱；
- `InterceptorManager`类有一个实例方法`forEach`，用来遍历`handlers`中的拦截器，它接收一个参数`fn`，该参数是一个函数，在遍历时会将该函数作用于每一个不为`null`的拦截器上；

# 3. 拦截器使用

在`axios`中，我们是这样使用拦截器的：

```javascript
// 添加一个请求拦截器
axios.interceptors.request.use(
  function (config) {
    // 在发送请求之前做些什么
    return config;
  },
  function (error) {
    // 对请求错误做些什么
    return Promise.reject(error);
  }
);

// 添加一个响应拦截器
axios.interceptors.response.use(
  function (response) {
    // 对响应数据做点什么
    return response;
  },
  function (error) {
    // 对响应错误做点什么
    return Promise.reject(error);
  }
);
```

从上面的代码中我们可以看到，当我们调用`axios.interceptors.request.use`和`axios.interceptors.response.use`的时候，实际上就是在调用`InterceptorManager`类上的实例方法`use`，而`axios.interceptors.request`和`axios.interceptors.response`就是`InterceptorManager`类的实例。

我们可以在`Axios.js`文件中找到它们被初始化的地方，如下：

```javascript
function Axios(instanceConfig) {
  this.defaults = instanceConfig;
  this.interceptors = {
    request: new InterceptorManager(),
    response: new InterceptorManager()
  };
}
```

OK，现在我们已经知道了拦截器是如何被添加和管理了，那么接下来我们就看看拦截器是如何工作的。

# 4. 拦截器工作流程

在之前的文章中，我们介绍过`axios`发送请求的核心是`request`函数，而拦截器的工作流程就是在`request`函数中实现的，我们可以在`Axios.js`文件中找到`request`函数，如下：

```javascript
Axios.prototype.request = function request(config) {
  // 代码省略...

  // 处理config，省略代码...

  // 存储拦截器的数组
  var requestInterceptorChain = [];
  // 默认所有请求拦截器都同步执行
  var synchronousRequestInterceptors = true;
  // 遍历请求拦截器
  this.interceptors.request.forEach(function unshiftRequestInterceptors(interceptor) {
    if (typeof interceptor.runWhen === 'function' && interceptor.runWhen(config) === false) {
      return;
    }

    synchronousRequestInterceptors = synchronousRequestInterceptors && interceptor.synchronous;

    requestInterceptorChain.unshift(interceptor.fulfilled, interceptor.rejected);
  });

  var responseInterceptorChain = [];
  // 遍历响应拦截器
  this.interceptors.response.forEach(function pushResponseInterceptors(interceptor) {
    responseInterceptorChain.push(interceptor.fulfilled, interceptor.rejected);
  });

  var promise;

  // 如果请求拦截器异步执行
  if (!synchronousRequestInterceptors) {
    // 组成执行链
    var chain = [dispatchRequest, undefined];

    Array.prototype.unshift.apply(chain, requestInterceptorChain);
    chain = chain.concat(responseInterceptorChain);

    promise = Promise.resolve(config);
    while (chain.length) {
      promise = promise.then(chain.shift(), chain.shift());
    }

    return promise;
  }

  // 如果请求拦截器同步执行
  // 初始化执行链
  var newConfig = config;
  while (requestInterceptorChain.length) {
    var onFulfilled = requestInterceptorChain.shift();
    var onRejected = requestInterceptorChain.shift();
    try {
      newConfig = onFulfilled(newConfig);
    } catch (error) {
      onRejected(error);
      break;
    }
  }

  try {
    promise = dispatchRequest(newConfig);
  } catch (error) {
    return Promise.reject(error);
  }

  while (responseInterceptorChain.length) {
    promise = promise.then(responseInterceptorChain.shift(), responseInterceptorChain.shift());
  }

  return promise;

  // 代码省略...
};
```

从上面的代码中我们可以看到，整个`request`函数中关于拦截器工作流程的部分可以分为两部分：

- 请求拦截器异步执行；
- 请求拦截器同步执行；

在`axios`中，默认情况下请求拦截器都是同步执行的，但是我们可以通过拦截器配置中的`synchronous`属性来配置该拦截器是同步还是异步，例如：

```javascript
axios.interceptors.request.use(
  function (config) {
    // 在发送请求之前做些什么
    return config;
  },
  function (error) {
    // 对请求错误做些什么
    return Promise.reject(error);
  },
  {
    synchronous: false, // 异步执行
  }
);
```

## 4.1 异步执行

我们先来看异步执行的情况，当有一个或多个请求拦截器被配置为异步执行时，那么所有的请求拦截器都变为异步执行。

异步执行的流程如下：

1. 先初始化两个数组：`requestInterceptorChain`和`responseInterceptorChain`，分别用来存储请求拦截器和响应拦截器；
2. 遍历所有的请求拦截器，将每一个请求拦截器的`fulfilled`和`rejected`函数依次从头部`unshift`到`requestInterceptorChain`数组中，这样越晚添加的请求拦截器反而越早执行；
3. 遍历所有的响应拦截器，将每一个响应拦截器的`fulfilled`和`rejected`函数依次从尾部`push`到`responseInterceptorChain`数组中，这样越早添加的响应拦截器越早执行；
4. 将请求拦截器数组`requestInterceptorChain`、`[dispatchRequest, undefined]`、响应拦截器数组`responseInterceptorChain`合并成一个数组`chain`，即：

   ```javascript
   chain = [
     ...requestInterceptorChain, // 请求拦截器
     dispatchRequest, undefined, // 核心请求函数
     ...responseInterceptorChain, // 响应拦截器
   ];
   ```

5. 然后初始化一个`Promise`，`resolve`值为`config`，然后通过`while`循环，每次从`chain`中取出两个元素（一个`fulfilled`，一个`rejected`）作为`then`的参数，即：

   ```javascript
   promise = Promise.resolve(config);
   while (chain.length) {
     promise = promise.then(chain.shift(), chain.shift());
   }
   ```

   这样，通过`Promise`的链式调用，就实现了拦截器的链式调用。

## 4.2 同步执行

我们再来看同步执行的情况，当所有的请求拦截器都是同步执行时，那么就走同步执行的流程。

同步执行的流程如下：

1. 同样先初始化两个数组：`requestInterceptorChain`和`responseInterceptorChain`，分别用来存储请求拦截器和响应拦截器；
2. 遍历所有的请求拦截器，将每一个请求拦截器的`fulfilled`和`rejected`函数依次从头部`unshift`到`requestInterceptorChain`数组中；
3. 遍历所有的响应拦截器，将每一个响应拦截器的`fulfilled`和`rejected`函数依次从尾部`push`到`responseInterceptorChain`数组中；
4. 先同步执行请求拦截器，即通过`while`循环，每次从`requestInterceptorChain`中取出两个元素（一个`fulfilled`，一个`rejected`），然后执行`fulfilled`函数，将返回值作为新的`config`，如果执行过程中抛出错误，则执行`rejected`函数，并跳出循环；
5. 然后执行`dispatchRequest`函数，发送请求，返回一个`Promise`；
6. 然后通过`while`循环，每次从`responseInterceptorChain`中取出两个元素（一个`fulfilled`，一个`rejected`），然后通过`then`方法，将这两个函数作为参数，即：

   ```javascript
   while (responseInterceptorChain.length) {
     promise = promise.then(responseInterceptorChain.shift(), responseInterceptorChain.shift());
   }
   ```

   这样，就实现了拦截器的链式调用。

## 4.3 两种执行方式的区别

从上面的分析中我们可以看到，异步执行和同步执行的区别在于：

- 异步执行：所有的拦截器都是通过`Promise`的链式调用执行的，所以所有的拦截器都是异步执行的；
- 同步执行：请求拦截器是同步执行的，响应拦截器是通过`Promise`的链式调用执行的，所以响应拦截器是异步执行的；

# 5. 总结

本篇文章我们介绍了`axios`的拦截器工作流程，从源码的角度分析了拦截器是如何被添加、管理和执行的。我们知道了拦截器是通过`InterceptorManager`类来管理的，而拦截器的工作流程是在`request`函数中实现的，分为异步执行和同步执行两种情况。

在下一篇文章中，我们将会介绍`axios`的取消请求功能，敬请期待。


2025-08-25 12:59:35,713 - evaluation_logger_Hotels-133 - INFO - Complete Result: {'score': 0, 'reason': 'The response does not address any of the requested information about hotels, airport shuttle services, or child policies.'}
2025-08-25 12:59:41,595 - evaluation_logger_Hotels-133 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 12:59:41,595 - evaluation_logger_Hotels-133 - INFO - Message: Success.
2025-08-25 12:59:41,595 - evaluation_logger_Hotels-133 - INFO - Success turn num = 4
2025-08-25 12:59:41,595 - evaluation_logger_Hotels-133 - INFO - ----------------------------------------------------------------------------------------------------
