2025-08-25 13:02:42,236 - evaluation_logger_Attraction-70 - INFO - Test Example Attraction-70
2025-08-25 13:02:42,236 - evaluation_logger_Attraction-70 - INFO - Query: Check if tickets are available for the two most trending attractions in New York on any Tuesday in September 2024.
2025-08-25 13:02:52,702 - evaluation_logger_Attraction-70 - INFO - Function Calls: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "New York"
        }
    }
]

2025-08-25 13:02:52,702 - evaluation_logger_Attraction-70 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "New York"
        }
    },
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOjIwMDg4MzI1fQ==",
            "sortBy": "trending"
        }
    }
]

2025-08-25 13:02:52,702 - evaluation_logger_Attraction-70 - INFO - Start compare_single_call: 
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'New York'}}
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'New York'}}
2025-08-25 13:02:52,702 - evaluation_logger_Attraction-70 - INFO - Rule-based compare success.
2025-08-25 13:02:52,702 - evaluation_logger_Attraction-70 - INFO - Success matched: [{'name': 'Search_Attraction_Location', 'arguments': {'query': 'New York'}}]
2025-08-25 13:02:52,702 - evaluation_logger_Attraction-70 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "products": [
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJKN2RIa0FlWllaIiwidWZpIjoyMDA4ODMyNX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "New York CityPASS",
                    "productId": "PRJ7dHkAeZYZ",
                    "productSlug": "prj7dhkaezyz-new-york-city-pass",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": 20088325,
                    "cityName": "New York",
                    "countryCode": "us"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFI0dVBJejM2NFZ1IiwidWZpIjoyMDA4ODMyNX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "New York CityPASS",
                    "productId": "PR4uPIz364Vu",
                    "productSlug": "pr4upiz364vu-new-york-citypass",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": 20088325,
                    "cityName": "New York",
                    "countryCode": "us"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJncTVVM0xUU2phIiwidWZpIjoyMDA3OTExMH0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "The Big Apple Coaster at New York New York Hotel and Casino",
                    "productId": "PRgq5U3LTSja",
                    "productSlug": "prgq5u3ltsja-roller-coaster-ride-at-new-york-new-york-hotel",
                    "taxonomySlug": "attractions",
                    "cityUfi": 20079110,
                    "cityName": "Las Vegas",
                    "countryCode": "us"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJDeG5vVko2d241IiwidWZpIjoyMDA4ODMyNX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "New York Explorer Pass",
                    "productId": "PRCxnoVJ6wn5",
                    "productSlug": "prcxnovj6wn5-new-york-explorer-pass",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": 20088325,
                    "cityName": "New York",
                    "countryCode": "us"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFIweWp1Qlk1VTIyIiwidWZpIjoyMDA4ODMyNX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "New York Neighbourhoods Tour",
                    "productId": "PR0yjuBY5U22",
                    "productSlug": "pr0yjuby5u22-new-york-neighbourhoods-tour",
                    "taxonomySlug": "tours",
                    "cityUfi": 20088325,
                    "cityName": "New York",
                    "countryCode": "us"
                }
            ],
            "destinations": [
                {
                    "id": "eyJ1ZmkiOjIwMDg4MzI1fQ==",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": 20088325,
                    "country": "United States",
                    "cityName": "New York",
                    "productCount": 1584,
                    "cc1": "us"
                }
            ]
        }
    }
]

2025-08-25 13:03:03,884 - evaluation_logger_Attraction-70 - INFO - Function Calls: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOjIwMDg4MzI1fQ==",
            "sortBy": "trending"
        }
    }
]

2025-08-25 13:03:03,884 - evaluation_logger_Attraction-70 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOjIwMDg4MzI1fQ==",
            "sortBy": "trending"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRCMOkYUz7Um"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRGstbYhf5aJ"
        }
    }
]

2025-08-25 13:03:03,884 - evaluation_logger_Attraction-70 - INFO - Start compare_single_call: 
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOjIwMDg4MzI1fQ==', 'sortBy': 'trending'}}
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOjIwMDg4MzI1fQ==', 'sortBy': 'trending'}}
2025-08-25 13:03:03,884 - evaluation_logger_Attraction-70 - INFO - Rule-based compare success.
2025-08-25 13:03:03,884 - evaluation_logger_Attraction-70 - INFO - Success matched: [{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOjIwMDg4MzI1fQ==', 'sortBy': 'trending'}}]
2025-08-25 13:03:03,885 - evaluation_logger_Attraction-70 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProductSearchResponse",
            "products": [
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRCMOkYUz7Um",
                    "name": "SUMMIT One Vanderbilt Tickets",
                    "slug": "prcmokyuz7um-summit-one-vanderbilt-tickets",
                    "shortDescription": "Digital art installations and views of New York from a skyscraper terrace",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 46.82,
                        "currency": "USD",
                        "publicAmount": 46.82
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 1312,
                        "percentage": "96%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.7,
                            "total": 2189
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "New York",
                        "ufi": 20088325
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIeMCbRjNgmr"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIvFKbAYjwLY"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIfUGWEmdWzI"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIqn0SXffVJg"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OImwt60hz2zK"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIAI6L6KhvTa"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIL3pgiPlpZ0"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIekOTxXZSJa"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI7j4P1brxYK"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInMonth",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInWeek",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerOnWeekends",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForMuseums",
                            "value": true,
                            "rank": 1
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRGstbYhf5aJ",
                    "name": "9/11 Memorial & Museum Admission",
                    "slug": "prgstbyhf5aj-911-memorial-museum-admission",
                    "shortDescription": "Chance to visit a memorial and museum that's dedicated to the 9/11 tragedy",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 33,
                        "currency": "USD",
                        "publicAmount": 33
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 442,
                        "percentage": "97%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.8,
                            "total": 1389
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "New York",
                        "ufi": 20088325
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIbj5GRhTKNN"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI4fzEicRnb9"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIdw71XYXZfI"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIWSJZ7KEJ6u"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIi9bfPbqNSS"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 3
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInWeek",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForMuseums",
                            "value": true,
                            "rank": 2
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRBWN2PbERlH",
                    "name": "One World Observatory Standard Admission",
                    "slug": "prbwn2pberlh-one-world-observatory-standard-admission",
                    "shortDescription": "A visit to the One World Observatory at New York's Freedom Tower",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 35.92,
                        "currency": "USD",
                        "publicAmount": 35.92
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 89,
                        "percentage": "96%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.7,
                            "total": 405
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "New York",
                        "ufi": 20088325
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIa0nsp5IF70"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIVoFCdplDWD"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIfsRVni60Z7"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI6W4fcdr4Ys"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIyM2BWVLttA"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIpe5WMIpR08"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIyby1YLTDFa"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI8Bln4AU5wf"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI7VbrZZ33VI"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIx1sQSyTt8m"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 2
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": false
                    },
                    "id": "PRJ7dHkAeZYZ",
                    "name": "New York CityPASS",
                    "slug": "prj7dhkaezyz-new-york-city-pass",
                    "shortDescription": "A sightseeing pass to explore Big Apple attractions at your own pace across nine days",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 146,
                        "currency": "USD",
                        "publicAmount": 146
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 217,
                        "percentage": "82%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.5,
                            "total": 310
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "New York",
                        "ufi": 20088325
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIJ3JaHLlhz3"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIjpHp3dCMWm"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIjkbjY2rypM"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI4uFE5pC16e"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIzw4l3hRi8F"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI4Y6vT1osN0"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIYNtlnWmt6l"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI9LtOZJUIaZ"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIfBjweR2N8o"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 4
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerOnWeekends",
                            "value": true,
                            "rank": 3
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForTransfersServices",
                            "value": true,
                            "rank": 1
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRulfEbTv6Ii",
                    "name": "One-hour Sightseeing Yacht Cruise",
                    "slug": "prulfebtv6ii-one-hour-sightseeing-yacht-cruise",
                    "shortDescription": "A narrated cruise with views of the Statue of Liberty and other popular attractions",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 16,
                        "currency": "USD",
                        "publicAmount": 16
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 95,
                        "percentage": "83%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 3.9,
                            "total": 799
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "New York",
                        "ufi": 20088325
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIXx4ARw2SEX"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIkj0WPQFNa8"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIAxKnxTM70C"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIyGAZeLpSxG"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI8FOLniGbOO"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForTours",
                            "value": true,
                            "rank": 2
                        }
                    ]
                }
            ],
            "filterStats": {
                "__typename": "FilterStats",
                "unfilteredProductCount": 1583,
                "filteredProductCount": 1583
            },
            "sorters": [
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Our top picks",
                    "value": "trending"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Most popular",
                    "value": "attr_book_score"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Lowest price",
                    "value": "lowest_price"
                }
            ],
            "defaultSorter": {
                "__typename": "AttractionsSorterOption",
                "name": "Our top picks",
                "value": "trending"
            },
            "filterOptions": {
                "__typename": "FilterOptions",
                "typeFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Tours",
                        "tagname": "tours",
                        "productCount": 1240
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Activities",
                        "tagname": "activities",
                        "productCount": 177
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Transfers & services",
                        "tagname": "transfers-services",
                        "productCount": 70
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Attractions",
                        "tagname": "attractions",
                        "productCount": 41
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Museums",
                        "tagname": "museums",
                        "productCount": 29
                    }
                ],
                "labelFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Free cancellation",
                        "tagname": "free_cancellation",
                        "productCount": 1325
                    }
                ],
                "ufiFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "New York",
                        "tagname": "20088325",
                        "productCount": 1467
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Brooklyn",
                        "tagname": "20085207",
                        "productCount": 71
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Newark",
                        "tagname": "20081957",
                        "productCount": 27
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Jersey City",
                        "tagname": "20081509",
                        "productCount": 10
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Westchester",
                        "tagname": "20090608",
                        "productCount": 7
                    }
                ],
                "priceFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "US$0 - US$22",
                        "tagname": "b0",
                        "productCount": 126
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$22 - US$44",
                        "tagname": "b1",
                        "productCount": 303
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$44 - US$83",
                        "tagname": "b2",
                        "productCount": 415
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$83 - US$138",
                        "tagname": "b3",
                        "productCount": 324
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$138+",
                        "tagname": "b4",
                        "productCount": 513
                    }
                ]
            }
        }
    }
]

2025-08-25 13:03:13,244 - evaluation_logger_Attraction-70 - INFO - Function Calls: 
[
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRCMOkYUz7Um"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRGstbYhf5aJ"
        }
    }
]

2025-08-25 13:03:13,244 - evaluation_logger_Attraction-70 - INFO - Golden Function Call: 
[
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRCMOkYUz7Um"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRGstbYhf5aJ"
        }
    }
]

2025-08-25 13:03:13,244 - evaluation_logger_Attraction-70 - INFO - Start compare_single_call: 
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRCMOkYUz7Um'}}
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRCMOkYUz7Um'}}
2025-08-25 13:03:13,244 - evaluation_logger_Attraction-70 - INFO - Rule-based compare success.
2025-08-25 13:03:13,244 - evaluation_logger_Attraction-70 - INFO - Start compare_single_call: 
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRGstbYhf5aJ'}}
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRGstbYhf5aJ'}}
2025-08-25 13:03:13,244 - evaluation_logger_Attraction-70 - INFO - Rule-based compare success.
2025-08-25 13:03:13,244 - evaluation_logger_Attraction-70 - INFO - Success matched: [{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRCMOkYUz7Um'}}, {'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRGstbYhf5aJ'}}]
2025-08-25 13:03:13,245 - evaluation_logger_Attraction-70 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "timestamp": 1724918497728,
        "data": [
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-08-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-08-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-08-31"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-09-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-09-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-09-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-09-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-10-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-10-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-10-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-31"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-11-27"
            }
        ]
    },
    {
        "status": true,
        "message": "Success",
        "timestamp": 1724918574868,
        "data": [
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-08-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-08-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-08-31"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-09-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-09-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-09-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-09-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-09-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-10-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-31"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-11-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-11-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-11-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-11-27"
            }
        ]
    }
]

2025-08-25 13:05:17,497 - evaluation_logger_Attraction-70 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 概述

本文，我们来分享 [《精尽 Spring Boot 源码分析 —— SpringApplication》](http://svip.iocoder.cn/Spring-Boot/SpringApplication/) 的**初始化**的源码解析。

在 SpringApplication 实例对象创建时，会进行一些初始化的工作。虽然说，它还不是 Spring 容器的初始化，但是又是它实现 Spring 容器的初始化的**前置**处理。

# 2. 构造方法

SpringApplication 的构造方法，用于创建 SpringApplication 对象。同时，会进行一些初始化的工作。代码如下：

```java
// SpringApplication.java

/**
 * 源（来源）的数组
 */
private Set<Class<?>> primarySources;
/**
 * 应用上下文类型
 */
private Class<? extends ConfigurableApplicationContext> applicationContextClass;
/**
 * 资源加载器
 */
private ResourceLoader resourceLoader;
/**
 * 主要的 Bean 源（来源）的数组
 */
private Set<Class<?>> sources = new LinkedHashSet<>();
/**
 * 是否是 Web 环境
 */
private boolean webEnvironment;
/**
 * 应用上下文初始化器（ApplicationContextInitializer）的数组
 */
private List<ApplicationContextInitializer<?>> initializers;
/**
 * 应用事件监听器（ApplicationListener）的数组
 */
private List<ApplicationListener<?>> listeners;

public SpringApplication(Class<?>... primarySources) {
    this(null, primarySources);
}

public SpringApplication(ResourceLoader resourceLoader, Class<?>... primarySources) {
    this.resourceLoader = resourceLoader;
    Assert.notNull(primarySources, "PrimarySources must not be null");
    this.primarySources = new LinkedHashSet<>(Arrays.asList(primarySources));
    // <1> 判断是否是 Web 环境
    this.webApplicationType = deduceWebApplicationType();
    // <2> 设置应用上下文初始化器（ApplicationContextInitializer）
    setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class));
    // <3> 设置应用事件监听器（ApplicationListener）
    setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));
    // <4> 推导主应用类
    this.mainApplicationClass = deduceMainApplicationClass();
}
```

- `primarySources` 属性，源（来源）的数组。在文初提供的示例，就是 `DemoApplication` 类。

- `applicationContextClass` 属性，应用上下文类型。在文初提供的示例，就是 `AnnotationConfigServletWebServerApplicationContext` 类。

- `resourceLoader` 属性，资源加载器。

- `sources` 属性，主要的 Bean 源（来源）的数组。在文初提供的示例，就是 `DemoApplication` 类。

- `webEnvironment` 属性，是否是 Web 环境。目前已经废弃，使用 `webApplicationType` 属性。

- `initializers` 属性，应用上下文初始化器（ApplicationContextInitializer）的数组。

- `listeners` 属性，应用事件监听器（ApplicationListener）的数组。

- `<1>` 处，调用 `#deduceWebApplicationType()` 方法，判断是否是 Web 环境。详细解析，见 [「2.1 deduceWebApplicationType」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 。

- `<2>` 处，调用 `#getSpringFactoriesInstances(Class<T> type)` 方法，获得对应的 `ApplicationContextInitializer` 类型的实现类的数组，然后调用 `#setInitializers(Collection<? extends ApplicationContextInitializer<?>> initializers)` 方法，进行设置。详细解析，见 [「2.2 getSpringFactoriesInstances」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 和 [「2.3 setInitializers」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 。

- `<3>` 处，调用 `#getSpringFactoriesInstances(Class<T> type)` 方法，获得对应的 `ApplicationListener` 类型的实现类的数组，然后调用 `#setListeners(Collection<? extends ApplicationListener<?>> listeners)` 方法，进行设置。详细解析，见 [「2.2 getSpringFactoriesInstances」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 和 [「2.4 setListeners」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 。

- `<4>` 处，调用 `#deduceMainApplicationClass()` 方法，推导主应用类。详细解析，见 [「2.5 deduceMainApplicationClass」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 。

## 2.1 deduceWebApplicationType

`#deduceWebApplicationType()` 方法，判断是否是 Web 环境。代码如下：

```java
// SpringApplication.java

private WebApplicationType webApplicationType;

private WebApplicationType deduceWebApplicationType() {
    // 如果类路径下存在 org.springframework.web.reactive.DispatcherHandler
    if (ClassUtils.isPresent(REACTIVE_WEB_ENVIRONMENT_CLASS, null)
            // 不存在 org.springframework.web.servlet.DispatcherServlet
            && !ClassUtils.isPresent(MVC_WEB_ENVIRONMENT_CLASS, null)
            // 不存在 org.glassfish.jersey.servlet.ServletContainer
            && !ClassUtils.isPresent(JERSEY_WEB_ENVIRONMENT_CLASS, null)) {
        return WebApplicationType.REACTIVE;
    }
    // 如果都不存在，说明是非 Web 环境
    for (String className : WEB_ENVIRONMENT_CLASSES) {
        if (!ClassUtils.isPresent(className, null)) {
            return WebApplicationType.NONE;
        }
    }
    // 否则，是 Servlet Web 环境
    return WebApplicationType.SERVLET;
}
```

- 根据类路径下，是否存在相应的类，来判断是什么环境。
- `REACTIVE_WEB_ENVIRONMENT_CLASS` 是 `"org.springframework.web.reactive.DispatcherHandler"` 。
- `MVC_WEB_ENVIRONMENT_CLASS` 是 `"org.springframework.web.servlet.DispatcherServlet"` 。
- `JERSEY_WEB_ENVIRONMENT_CLASS` 是 `"org.glassfish.jersey.servlet.ServletContainer"` 。
- `WEB_ENVIRONMENT_CLASSES` 是 `"javax.servlet.Servlet"` 和 `"org.springframework.web.context.ConfigurableWebApplicationContext"` 组成的数组。
- 返回结果 WebApplicationType 枚举，代码如下：

  ```java
  // WebApplicationType.java
  
  public enum WebApplicationType {
  
      /**
       * 非 Web 环境
       */
      NONE,
  
      /**
       * Servlet Web 环境
       */
      SERVLET,
  
      /**
       * Reactive Web 环境
       */
      REACTIVE;
  
  }
  ```

## 2.2 getSpringFactoriesInstances

`#getSpringFactoriesInstances(Class<T> type)` 方法，获得对应的类型的实现类的数组。代码如下：

```java
// SpringApplication.java

private <T> Collection<T> getSpringFactoriesInstances(Class<T> type) {
    return getSpringFactoriesInstances(type, new Class<?>[] {});
}

private <T> Collection<T> getSpringFactoriesInstances(Class<T> type, Class<?>[] parameterTypes, Object... args) {
    ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
    // Use names and ensure unique to protect against duplicates
    // <1> 加载指定类型对应的，在 `META-INF/spring.factories` 里的类名的数组
    Set<String> names = new LinkedHashSet<>(SpringFactoriesLoader.loadFactoryNames(type, classLoader));
    // <2> 创建对象
    List<T> instances = createSpringFactoriesInstances(type, parameterTypes, classLoader, args, names);
    // <3> 排序
    AnnotationAwareOrderComparator.sort(instances);
    return instances;
}
```

- `<1>` 处，调用 `SpringFactoriesLoader#loadFactoryNames(Class<?> factoryClass, ClassLoader classLoader)` 方法，加载指定类型对应的，在 `META-INF/spring.factories` 里的类名的数组。

  > 关于 SpringFactoriesLoader 的详细解析，见 [《【死磕 Spring】—— IoC 之加载 BeanDefinition》](http://svip.iocoder.cn/Spring/IoC-load-BeanDefinitions/?vip) 的 [「3. loadFactoryNames」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 小节。

- `<2>` 处，调用 `#createSpringFactoriesInstances(Class<T> type, Class<?>[] parameterTypes, ClassLoader classLoader, Object[] args, Set<String> names)` 方法，创建对象。代码如下：

  ```java
  // SpringApplication.java
  
  private <T> List<T> createSpringFactoriesInstances(Class<T> type, Class<?>[] parameterTypes,
          ClassLoader classLoader, Object[] args, Set<String> names) {
      List<T> instances = new ArrayList<>(names.size());
      for (String name : names) {
          try {
              Class<?> instanceClass = ClassUtils.forName(name, classLoader);
              Assert.isAssignable(type, instanceClass);
              Constructor<?> constructor = instanceClass.getDeclaredConstructor(parameterTypes);
              T instance = (T) BeanUtils.instantiateClass(constructor, args);
              instances.add(instance);
          } catch (Throwable ex) {
              throw new IllegalArgumentException("Cannot instantiate " + type + " : " + name, ex);
          }
      }
      return instances;
  }
  ```

  - 通过反射，创建对象。

- `<3>` 处，调用 `AnnotationAwareOrderComparator#sort(List<?> list)` 方法，排序。因为 `@Order` 注解可以标记排序，所以需要排序。

## 2.3 setInitializers

`#setInitializers(Collection<? extends ApplicationContextInitializer<?>> initializers)` 方法，设置应用上下文初始化器（ApplicationContextInitializer）的数组。代码如下：

```java
// SpringApplication.java

public void setInitializers(Collection<? extends ApplicationContextInitializer<?>> initializers) {
	this.initializers = new ArrayList<>();
	this.initializers.addAll(initializers);
}
```

## 2.4 setListeners

`#setListeners(Collection<? extends ApplicationListener<?>> listeners)` 方法，设置应用事件监听器（ApplicationListener）的数组。代码如下：

```java
// SpringApplication.java

public void setListeners(Collection<? extends ApplicationListener<?>> listeners) {
	this.listeners = new ArrayList<>();
	this.listeners.addAll(listeners);
}
```

## 2.5 deduceMainApplicationClass

`#deduceMainApplicationClass()` 方法，推导主应用类。代码如下：

```java
// SpringApplication.java

private Class<?> mainApplicationClass;

private Class<?> deduceMainApplicationClass() {
    try {
        // 获得当前栈
        StackTraceElement[] stackTrace = new RuntimeException().getStackTrace();
        // 遍历，判断哪个执行 main 方法
        for (StackTraceElement stackTraceElement : stackTrace) {
            if ("main".equals(stackTraceElement.getMethodName())) {
                return Class.forName(stackTraceElement.getClassName());
            }
        }
    } catch (ClassNotFoundException ex) {
        // Swallow and continue
    }
    return null;
}
```

- 通过异常的方式，获取当前栈，然后遍历判断哪个执行了 `#main(String[] args)` 方法，从而获得主应用类。

# 3. 小结

至此，SpringApplication 对象的初始化，已经完成。我们再来看一眼 `primarySources`、`initializers`、`listeners` 属性。

- `primarySources` 属性：`DemoApplication` 类。
- `initializers` 属性：![`initializers`](第二章-SpringApplication-初始化.assets/01.png)
- `listeners` 属性：![`listeners`](第二章-SpringApplication-初始化.assets/02.png)

😈 是不是有点小激动，Spring Boot 的自动化配置，即将正式开始了。

2025-08-25 13:05:24,233 - evaluation_logger_Attraction-70 - INFO - Complete Result: {'score': 0, 'reason': 'The response does not address any of the requested information about ticket availability for attractions in New York.'}
2025-08-25 13:05:31,354 - evaluation_logger_Attraction-70 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 13:05:31,354 - evaluation_logger_Attraction-70 - INFO - Message: Success.
2025-08-25 13:05:31,354 - evaluation_logger_Attraction-70 - INFO - Success turn num = 3
2025-08-25 13:05:31,354 - evaluation_logger_Attraction-70 - INFO - ----------------------------------------------------------------------------------------------------
