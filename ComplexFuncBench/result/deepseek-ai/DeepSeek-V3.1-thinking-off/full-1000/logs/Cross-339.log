2025-08-25 12:20:57,472 - evaluation_logger_Cross-339 - INFO - Test Example Cross-339
2025-08-25 12:20:57,472 - evaluation_logger_Cross-339 - INFO - Query: I'm going to arrive at Waterfront Skytrain Station at 2:23pm on December 1st, 2024. Could you look up detailed info about the most trending attractions in Vancouver for me? I'm going to take a taxi to the hottest attractions 10 minutes after my train gets there.
2025-08-25 12:21:05,637 - evaluation_logger_Cross-339 - INFO - Function Calls: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Vancouver"
        }
    }
]

2025-08-25 12:21:05,637 - evaluation_logger_Cross-339 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Vancouver"
        }
    },
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi01NzUyNjh9",
            "sortBy": "trending"
        }
    }
]

2025-08-25 12:21:05,637 - evaluation_logger_Cross-339 - INFO - Start compare_single_call: 
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Vancouver'}}
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Vancouver'}}
2025-08-25 12:21:05,637 - evaluation_logger_Cross-339 - INFO - Rule-based compare success.
2025-08-25 12:21:05,637 - evaluation_logger_Cross-339 - INFO - Success matched: [{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Vancouver'}}]
2025-08-25 12:21:05,638 - evaluation_logger_Cross-339 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "destinations": [
                {
                    "id": "eyJ1ZmkiOi01NzUyNjh9",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": -575268,
                    "country": "Canada",
                    "cityName": "Vancouver",
                    "productCount": 393,
                    "cc1": "ca"
                }
            ]
        }
    }
]

2025-08-25 12:21:15,535 - evaluation_logger_Cross-339 - INFO - Function Calls: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi01NzUyNjh9",
            "sortBy": "trending"
        }
    }
]

2025-08-25 12:21:15,535 - evaluation_logger_Cross-339 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi01NzUyNjh9",
            "sortBy": "trending"
        }
    },
    {
        "name": "Taxi_Search_Location",
        "arguments": {
            "query": "Waterfront Skytrain Station"
        }
    },
    {
        "name": "Taxi_Search_Location",
        "arguments": {
            "query": "Capilano Suspension Bridge Park"
        }
    },
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "prz7e22ltutd-capilano-suspension-bridge-park-admission"
        }
    }
]

2025-08-25 12:21:15,535 - evaluation_logger_Cross-339 - INFO - Start compare_single_call: 
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi01NzUyNjh9', 'sortBy': 'trending'}}
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi01NzUyNjh9', 'sortBy': 'trending'}}
2025-08-25 12:21:15,535 - evaluation_logger_Cross-339 - INFO - Rule-based compare success.
2025-08-25 12:21:15,535 - evaluation_logger_Cross-339 - INFO - Success matched: [{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi01NzUyNjh9', 'sortBy': 'trending'}}]
2025-08-25 12:21:15,536 - evaluation_logger_Cross-339 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProductSearchResponse",
            "products": [
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRZ7E22LTUtd",
                    "name": "Capilano Suspension Bridge Park Admission",
                    "slug": "prz7e22ltutd-capilano-suspension-bridge-park-admission",
                    "shortDescription": "A walk along a cliffside platform and suspension bridges high above ground level",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 55.16,
                        "currency": "USD",
                        "publicAmount": 55.16
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 50,
                        "percentage": "96%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.7,
                            "total": 209
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Vancouver",
                        "ufi": -575268
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIVTsneOpteI"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI5W3WA7rpag"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIBCCkiZ1ab7"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIOjoUhBcXZY"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI67iBoVgAoo"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIco5Rab4zYJ"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI084CVFvIaf"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI6rIwVcPukP"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInMonth",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInWeek",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForLandmarks",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "highlyRated",
                            "value": true,
                            "rank": 2
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRoUOz9VaSWS",
                    "name": "Vancouver Tips-Based Walking Tour | 3-Hour",
                    "slug": "prouoz9vasws-vancouver-tips-based-walking-tour-3-hour",
                    "shortDescription": "This is a tips-based tour, which means that you get to determine the price for yourself. The tour...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 5,
                        "currency": "USD",
                        "publicAmount": 5
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.6,
                            "total": 43
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Vancouver",
                        "ufi": -575268
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIldsFXBZCmr"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIkbbcfUPCre"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 2
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRVU7yphZuvt",
                    "name": "VanDusen Botanical Garden Admission Ticket",
                    "slug": "prvu7yphzuvt-vandusen-botanical-garden-admission-ticket",
                    "shortDescription": "VanDusen Botanical Garden is a 55-acre oasis in the heart of Vancouver with over 7,500 plant spec...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 7.56,
                        "currency": "USD",
                        "publicAmount": 7.56
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 5,
                            "total": 2
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Vancouver",
                        "ufi": -575268
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OITRNptVY8Cd"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIj7lb1CX9Zd"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIC44bY2uZVu"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIxdVTa1E1fF"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIbwTGauungS"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    }
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRKZ8Zw0FYxD",
                    "name": "Vancouver Lookout Admission",
                    "slug": "prkz8zw0fyxd-vancouver-lookout-admission",
                    "shortDescription": "Admission ticket to the Vancouver Lookout, an observation deck offering panoramic city views",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 14.54,
                        "currency": "USD",
                        "publicAmount": 14.54
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 9,
                        "percentage": "89%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.4,
                            "total": 33
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Vancouver",
                        "ufi": -575268
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIO8DBjszpQX"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIiBy3UAF0Gs"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIg32ezlSaix"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIUGnfppj0wP"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIYuT8YL7Qqi"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIniSMQ9ocbF"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIPMq8rGr8Cv"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIlb4yvtfgTb"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIkVqKXMjqkR"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIytSdXtLkom"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIXs60FrxRTj"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIPlS7nh8Uci"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIUbqIyrutq4"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 4
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRreDCM2jyiY",
                    "name": "Sea to Sky Gondola Ride in Squamish",
                    "slug": "prredcm2jyiy-sea-to-sky-gondola-ride-in-squamish",
                    "shortDescription": "A scenic ride into the mountains with activities at the summit",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 51.29,
                        "currency": "USD",
                        "publicAmount": 51.29
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 8,
                        "percentage": "100%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.9,
                            "total": 40
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Vancouver",
                        "ufi": -575268
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIu1eYHehd6c"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIHGIYCOjFbz"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIZa804iIbat"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIiTr350qoZL"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIW5T1X91jf6"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OINfEHxe5rbq"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIGmdhNPFNq5"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OINnQnC162pd"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI4gfYAbGOYM"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIS7CPYVQY0q"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 3
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "popularFor3Travelers",
                            "value": true,
                            "rank": 1
                        }
                    ]
                }
            ],
            "filterStats": {
                "__typename": "FilterStats",
                "unfilteredProductCount": 389,
                "filteredProductCount": 389
            },
            "sorters": [
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Our top picks",
                    "value": "trending"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Most popular",
                    "value": "attr_book_score"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Lowest price",
                    "value": "lowest_price"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Best reviewed",
                    "value": "highest_weighted_rating"
                }
            ],
            "defaultSorter": {
                "__typename": "AttractionsSorterOption",
                "name": "Our top picks",
                "value": "trending"
            },
            "filterOptions": {
                "__typename": "FilterOptions",
                "typeFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Tours",
                        "tagname": "tours",
                        "productCount": 17
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Nature & outdoor",
                        "tagname": "nature-outdoor",
                        "productCount": 14
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Entertainment & tickets",
                        "tagname": "entertainment-tickets",
                        "productCount": 7
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Museums, arts & culture",
                        "tagname": "museums-arts-culture",
                        "productCount": 6
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Food & drinks",
                        "tagname": "food-drinks",
                        "productCount": 1
                    }
                ],
                "labelFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Free cancellation",
                        "tagname": "free_cancellation",
                        "productCount": 354
                    }
                ],
                "ufiFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Vancouver",
                        "tagname": "-575268",
                        "productCount": 389
                    }
                ],
                "priceFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "US$0 - US$22",
                        "tagname": "b0",
                        "productCount": 40
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$22 - US$44",
                        "tagname": "b1",
                        "productCount": 25
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$44 - US$83",
                        "tagname": "b2",
                        "productCount": 36
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$83 - US$138",
                        "tagname": "b3",
                        "productCount": 39
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$138+",
                        "tagname": "b4",
                        "productCount": 253
                    }
                ]
            }
        }
    }
]

2025-08-25 12:21:27,078 - evaluation_logger_Cross-339 - INFO - Function Calls: 
[
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "prz7e22ltutd-capilano-suspension-bridge-park-admission"
        }
    },
    {
        "name": "Taxi_Search_Location",
        "arguments": {
            "query": "Waterfront Skytrain Station"
        }
    },
    {
        "name": "Taxi_Search_Location",
        "arguments": {
            "query": "Capilano Suspension Bridge Park"
        }
    }
]

2025-08-25 12:21:27,078 - evaluation_logger_Cross-339 - INFO - Golden Function Call: 
[
    {
        "name": "Taxi_Search_Location",
        "arguments": {
            "query": "Waterfront Skytrain Station"
        }
    },
    {
        "name": "Taxi_Search_Location",
        "arguments": {
            "query": "Capilano Suspension Bridge Park"
        }
    },
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "prz7e22ltutd-capilano-suspension-bridge-park-admission"
        }
    },
    {
        "name": "Search_Taxi",
        "arguments": {
            "pick_up_place_id": "ChIJD_-SC3hxhlQRLJAnr1qTaqg",
            "drop_off_place_id": "ChIJSd7cANJvhlQRXg8TheyzUPM",
            "pick_up_date": "2024-12-01",
            "pick_up_time": "14:33"
        }
    }
]

2025-08-25 12:21:27,078 - evaluation_logger_Cross-339 - INFO - Start compare_single_call: 
{'name': 'Get_Attraction_Details', 'arguments': {'slug': 'prz7e22ltutd-capilano-suspension-bridge-park-admission'}}
{'name': 'Get_Attraction_Details', 'arguments': {'slug': 'prz7e22ltutd-capilano-suspension-bridge-park-admission'}}
2025-08-25 12:21:27,078 - evaluation_logger_Cross-339 - INFO - Rule-based compare success.
2025-08-25 12:21:27,078 - evaluation_logger_Cross-339 - INFO - Start compare_single_call: 
{'name': 'Taxi_Search_Location', 'arguments': {'query': 'Waterfront Skytrain Station'}}
{'name': 'Taxi_Search_Location', 'arguments': {'query': 'Waterfront Skytrain Station'}}
2025-08-25 12:21:27,078 - evaluation_logger_Cross-339 - INFO - Rule-based compare success.
2025-08-25 12:21:27,078 - evaluation_logger_Cross-339 - INFO - Start compare_single_call: 
{'name': 'Taxi_Search_Location', 'arguments': {'query': 'Capilano Suspension Bridge Park'}}
{'name': 'Taxi_Search_Location', 'arguments': {'query': 'Capilano Suspension Bridge Park'}}
2025-08-25 12:21:27,078 - evaluation_logger_Cross-339 - INFO - Rule-based compare success.
2025-08-25 12:21:27,078 - evaluation_logger_Cross-339 - INFO - Success matched: [{'name': 'Get_Attraction_Details', 'arguments': {'slug': 'prz7e22ltutd-capilano-suspension-bridge-park-admission'}}, {'name': 'Taxi_Search_Location', 'arguments': {'query': 'Waterfront Skytrain Station'}}, {'name': 'Taxi_Search_Location', 'arguments': {'query': 'Capilano Suspension Bridge Park'}}]
2025-08-25 12:21:27,079 - evaluation_logger_Cross-339 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProduct",
            "additionalBookingInfo": {
                "__typename": "AttractionsAdditionalBookingInfo",
                "freeForChildren": {
                    "__typename": "AttractionsFreeForChildren",
                    "age": {
                        "__typename": "MinMax",
                        "label": "Children aged 0 to 5 years can participate for free. "
                    }
                }
            },
            "additionalInfo": "Please note that Treetops Adventure remains closed from 5 February 2024. All other regular park attractions remain open.\r\n\r\nPlease refer to the park's website for updated health and safety guidelines.\r\n\r\nParticipants aged 0–16 years must be accompanied by an adult aged 17 years or above.\r\n\r\nPlease note that dogs are allowed in the park if they are on a leash.\r\n\r\nThe attractions cannot accommodate pushchairs.\r\n\r\nInfants should be carried below railing level or in a child-carrier device.\r\n\r\nPlease note that there is a free shuttle service available on a first-come, first-served basis in the park.\r\n\r\nPlease note that Capilano Suspension Bridge Park tickets are not valid for an annual pass.\n\nPlease bring your ticket with you to the attraction.\n\nBe aware that operators may cancel for unforeseen reasons.\n\nYou need to be 18 years or older to book or be accompanied by an adult. ",
            "applicableTerms": [
                {
                    "__typename": "TermsConditions",
                    "policyProvider": "Booking.com"
                },
                {
                    "__typename": "TermsConditions",
                    "policyProvider": "Musement"
                }
            ],
            "cancellationPolicy": {
                "__typename": "AttractionsCancellationPolicy",
                "hasFreeCancellation": true
            },
            "description": "This ticket will give you access to Capilano Suspension Bridge Park. While there, you'll be able to walk across the Capilano Suspension Bridge, which is 137 metres in length and is suspended 230 feet above the Capilano River. \r\n\r\nAfter seeing the bridge, you will have the chance to walk on The Cliffwalk – a glass walkway thats curves around a cliff face high above the Capilano River. You'll also get the opportunity experience the Treetops Adventure, which is home to seven suspension bridges and an evergreen forest.\r\n\r\nAftwerwards, you'll have the chance to enjoy the park's musical entertainment and shows, which feature elements of First Nations culture. After the performances, you'll be free to explore the Totem Park and learn about the area's history at the Story Centre. You can also pick up some souvenirs and homemade fudge at the gift shop.",
            "flags": [
                {
                    "__typename": "AttractionsProductFlags",
                    "flag": "bestseller",
                    "value": true,
                    "rank": 1
                },
                {
                    "__typename": "AttractionsProductFlags",
                    "flag": "bestsellerInMonth",
                    "value": true,
                    "rank": 2
                },
                {
                    "__typename": "AttractionsProductFlags",
                    "flag": "bestsellerInWeek",
                    "value": true,
                    "rank": 2
                },
                {
                    "__typename": "AttractionsProductFlags",
                    "flag": "bestsellerForLandmarks",
                    "value": true,
                    "rank": 1
                },
                {
                    "__typename": "AttractionsProductFlags",
                    "flag": "highlyRated",
                    "value": true,
                    "rank": 2
                }
            ],
            "id": "PRZ7E22LTUtd",
            "isBookable": true,
            "labels": [
                {
                    "__typename": "AttractionsLabel",
                    "text": "Free cancellation",
                    "type": "free_cancellation"
                },
                {
                    "__typename": "AttractionsLabel",
                    "text": "Ticket collection",
                    "type": "ticket_collection"
                }
            ],
            "name": "Capilano Suspension Bridge Park Admission",
            "offers": [
                {
                    "__typename": "Offer",
                    "availabilityType": "date_time",
                    "id": "OF0zrwlLXu4e"
                },
                {
                    "__typename": "Offer",
                    "availabilityType": "date_time",
                    "id": "OFQKA4twJc9S"
                }
            ],
            "onSiteRequirements": {
                "__typename": "OnSiteRequirements"
            },
            "operatedBy": "Capilano Suspension Bridge Park Ltd.",
            "representativePrice": {
                "__typename": "AttractionsPrice",
                "chargeAmount": 55.16,
                "currency": "USD",
                "publicAmount": 55.16
            },
            "reviews": {
                "__typename": "AttractionsGetReviewsResponse",
                "total": 182,
                "reviews": [
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSpKbjOUSfJE",
                        "epochMs": 1730545940000,
                        "language": "ko",
                        "numericRating": 1,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "SEUNGWON",
                            "cc1": "sg"
                        }
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSGZXwe05Zsq",
                        "epochMs": 1730244273000,
                        "language": "en-us",
                        "numericRating": 5,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "Bernardo",
                            "cc1": "us"
                        }
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSNiF7V2LKSi",
                        "epochMs": 1729694947000,
                        "language": "en-gb",
                        "numericRating": 5,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "Jodie",
                            "cc1": "au"
                        }
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSeN8gwWBkCk",
                        "epochMs": 1729564064000,
                        "language": "en-gb",
                        "numericRating": 5,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "yaglinsky"
                        }
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RS4XIFREfWRx",
                        "content": "Es impresionante caminar en las alturas",
                        "epochMs": 1729000364000,
                        "language": "es-mx",
                        "numericRating": 5,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "Gustavo"
                        }
                    }
                ]
            },
            "reviewsStats": {
                "__typename": "AttractionsProductReviewStats",
                "allReviewsCount": 50,
                "percentage": "96%",
                "combinedNumericStats": {
                    "__typename": "AttractionsProductCombinedReviewStats",
                    "average": 4.7,
                    "total": 209
                }
            },
            "shortDescription": "A walk along a cliffside platform and suspension bridges high above ground level",
            "slug": "prz7e22ltutd-capilano-suspension-bridge-park-admission",
            "supportedFeatures": {
                "__typename": "AttractionsProductSupportedFeatures",
                "nativeApp": true,
                "nativeAppBookProcess": true,
                "liveAvailabilityCheckSupported": true
            },
            "uniqueSellingPoints": [
                "Panoramic views of nature surrounding the Capilano River",
                "Ample photo opportunities from a cliffside glass walkway"
            ],
            "ufiDetails": {
                "__typename": "AttractionLocationResponse",
                "ufi": -575268,
                "bCityName": "Vancouver"
            },
            "whatsIncluded": [
                "Admission to Capilano Suspension Bridge and Cliffwalk",
                "Round-trip transportation within the park"
            ]
        }
    },
    {
        "status": true,
        "message": "Success",
        "data": [
            {
                "city": "Vancouver",
                "country": "Canada",
                "countryCode": "ca",
                "latitude": 49.285164,
                "googlePlaceId": "ChIJD_-SC3hxhlQRLJAnr1qTaqg",
                "longitude": -123.11408,
                "name": "Waterfront Skytrain Station",
                "types": "underground_railway_station"
            }
        ]
    },
    {
        "status": true,
        "message": "Success",
        "data": [
            {
                "longitude": -123.11234,
                "types": "attraction_park",
                "city": "North Vancouver",
                "googlePlaceId": "ChIJSd7cANJvhlQRXg8TheyzUPM",
                "name": "Capilano Suspension Bridge and Park",
                "latitude": 49.34374,
                "country": "Canada",
                "countryCode": "ca"
            }
        ]
    }
]

2025-08-25 12:21:39,825 - evaluation_logger_Cross-339 - INFO - Function Calls: 
[
    {
        "name": "Search_Taxi",
        "arguments": {
            "pick_up_place_id": "ChIJD_-SC3hxhlQRLJAnr1qTaqg",
            "drop_off_place_id": "ChIJSd7cANJvhlQRXg8TheyzUPM",
            "pick_up_date": "2024-12-01",
            "pick_up_time": "14:33"
        }
    }
]

2025-08-25 12:21:39,825 - evaluation_logger_Cross-339 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Taxi",
        "arguments": {
            "drop_off_place_id": "ChIJSd7cANJvhlQRXg8TheyzUPM",
            "pick_up_date": "2024-12-01",
            "pick_up_place_id": "ChIJD_-SC3hxhlQRLJAnr1qTaqg",
            "pick_up_time": "14:33"
        }
    }
]

2025-08-25 12:21:39,825 - evaluation_logger_Cross-339 - INFO - Start compare_single_call: 
{'name': 'Search_Taxi', 'arguments': {'drop_off_place_id': 'ChIJSd7cANJvhlQRXg8TheyzUPM', 'pick_up_date': '2024-12-01', 'pick_up_place_id': 'ChIJD_-SC3hxhlQRLJAnr1qTaqg', 'pick_up_time': '14:33'}}
{'name': 'Search_Taxi', 'arguments': {'drop_off_place_id': 'ChIJSd7cANJvhlQRXg8TheyzUPM', 'pick_up_date': '2024-12-01', 'pick_up_place_id': 'ChIJD_-SC3hxhlQRLJAnr1qTaqg', 'pick_up_time': '14:33'}}
2025-08-25 12:21:39,825 - evaluation_logger_Cross-339 - INFO - Rule-based compare success.
2025-08-25 12:21:39,825 - evaluation_logger_Cross-339 - INFO - Success matched: [{'name': 'Search_Taxi', 'arguments': {'drop_off_place_id': 'ChIJSd7cANJvhlQRXg8TheyzUPM', 'pick_up_date': '2024-12-01', 'pick_up_place_id': 'ChIJD_-SC3hxhlQRLJAnr1qTaqg', 'pick_up_time': '14:33'}}]
2025-08-25 12:21:39,825 - evaluation_logger_Cross-339 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "results": [
                {
                    "description": "Standard",
                    "drivingDistance": 9.14,
                    "janusResultReference": "1",
                    "bags": 3,
                    "nonRefundable": false,
                    "categoryLocalised": "Standard",
                    "resultId": "befcbea4-7896-4277-a7fb-0c9390c52361",
                    "category": "Standard",
                    "supplierId": 668,
                    "meetGreet": false,
                    "discountType": "NONE",
                    "supplierName": "E-Life Limo",
                    "duration": 18,
                    "price": {
                        "currencyCode": "USD",
                        "amount": "69.18"
                    },
                    "vehicleType": "STANDARD",
                    "passengerCapacity": 3,
                    "cancellationLeadTimeMinutes": 1440,
                    "descriptionLocalised": "Perfect for solo travellers, couples and small families.",
                    "geniusDiscount": false,
                    "priceRuleId": 19043,
                    "legPriceBreakdown": [
                        {
                            "supplierName": "E-Life Limo",
                            "supplierLocationId": 5090,
                            "supplierId": 668,
                            "journeyDirection": "OUTBOUND",
                            "price": {
                                "currencyCode": "USD",
                                "amount": "69.18"
                            }
                        }
                    ]
                },
                {
                    "drivingDistance": 9.14,
                    "janusResultReference": "5",
                    "bags": 4,
                    "description": "People Carrier",
                    "categoryLocalised": "People carrier",
                    "nonRefundable": false,
                    "duration": 18,
                    "supplierName": "E-Life Limo",
                    "price": {
                        "currencyCode": "USD",
                        "amount": "78.90"
                    },
                    "category": "People Carrier",
                    "resultId": "8aefe624-a728-483e-a970-e749acdec495",
                    "supplierId": 668,
                    "meetGreet": false,
                    "discountType": "NONE",
                    "descriptionLocalised": "Great choice for families.",
                    "priceRuleId": 19047,
                    "geniusDiscount": false,
                    "legPriceBreakdown": [
                        {
                            "supplierLocationId": 5090,
                            "supplierName": "E-Life Limo",
                            "price": {
                                "amount": "78.90",
                                "currencyCode": "USD"
                            },
                            "journeyDirection": "OUTBOUND",
                            "supplierId": 668
                        }
                    ],
                    "vehicleType": "LARGE",
                    "passengerCapacity": 4,
                    "cancellationLeadTimeMinutes": 1440
                },
                {
                    "janusResultReference": "6",
                    "drivingDistance": 9.14,
                    "bags": 5,
                    "description": "Large People Carrier",
                    "categoryLocalised": "Large people carrier",
                    "nonRefundable": false,
                    "price": {
                        "currencyCode": "USD",
                        "amount": "78.90"
                    },
                    "duration": 18,
                    "supplierName": "E-Life Limo",
                    "supplierId": 668,
                    "category": "Large People Carrier",
                    "resultId": "93bf8dae-f69f-43da-ab48-05626ccede47",
                    "discountType": "NONE",
                    "meetGreet": false,
                    "descriptionLocalised": "Ideal for small groups.",
                    "legPriceBreakdown": [
                        {
                            "supplierName": "E-Life Limo",
                            "supplierLocationId": 5090,
                            "price": {
                                "amount": "78.90",
                                "currencyCode": "USD"
                            },
                            "journeyDirection": "OUTBOUND",
                            "supplierId": 668
                        }
                    ],
                    "priceRuleId": 19048,
                    "geniusDiscount": false,
                    "vehicleType": "LARGE",
                    "cancellationLeadTimeMinutes": 1440,
                    "passengerCapacity": 5
                },
                {
                    "vehicleType": "EXECUTIVE",
                    "passengerCapacity": 2,
                    "cancellationLeadTimeMinutes": 1440,
                    "descriptionLocalised": "Plenty of space to travel in comfort.",
                    "priceRuleId": 19044,
                    "geniusDiscount": false,
                    "legPriceBreakdown": [
                        {
                            "supplierId": 634,
                            "journeyDirection": "OUTBOUND",
                            "price": {
                                "currencyCode": "USD",
                                "amount": "121.38"
                            },
                            "supplierLocationId": 2198,
                            "supplierName": "GTA Airport Taxi"
                        }
                    ],
                    "category": "Executive",
                    "resultId": "b990c258-4ca6-4a4a-9b3b-32eca8e59665",
                    "supplierId": 634,
                    "meetGreet": false,
                    "discountType": "NONE",
                    "duration": 18,
                    "supplierName": "GTA Airport Taxi",
                    "price": {
                        "currencyCode": "USD",
                        "amount": "121.38"
                    },
                    "nonRefundable": false,
                    "categoryLocalised": "Executive",
                    "description": "Executive",
                    "drivingDistance": 9.14,
                    "janusResultReference": "2",
                    "bags": 2
                },
                {
                    "meetGreet": false,
                    "discountType": "NONE",
                    "category": "Electric Standard",
                    "resultId": "b39a40ba-ae29-4e51-b5b6-d66013a79bd7",
                    "supplierId": 668,
                    "duration": 18,
                    "supplierName": "E-Life Limo",
                    "price": {
                        "amount": "135.30",
                        "currencyCode": "USD"
                    },
                    "passengerCapacity": 3,
                    "cancellationLeadTimeMinutes": 1440,
                    "vehicleType": "STANDARD",
                    "geniusDiscount": false,
                    "priceRuleId": 119577,
                    "legPriceBreakdown": [
                        {
                            "price": {
                                "currencyCode": "USD",
                                "amount": "135.30"
                            },
                            "journeyDirection": "OUTBOUND",
                            "supplierId": 668,
                            "supplierName": "E-Life Limo",
                            "supplierLocationId": 5090
                        }
                    ],
                    "descriptionLocalised": "100% Electric",
                    "description": "Electric Standard",
                    "bags": 3,
                    "drivingDistance": 9.14,
                    "janusResultReference": "14",
                    "nonRefundable": false,
                    "categoryLocalised": "Electric Standard"
                }
            ],
            "journeys": [
                {
                    "requestedPickupDateTime": "2024-12-01T14:33:00",
                    "journeyDirection": "OUTBOUND",
                    "janusSearchReference": "40d0a87e-0998-466f-9802-65b365b48aa7",
                    "dropOffLocation": {
                        "name": "Capilano Suspension Bridge Park, 3735 Capilano Rd, North Vancouver, BC V7R 4J1, Canada",
                        "country": "CA",
                        "locationType": "GEO",
                        "city": "North Vancouver",
                        "locationId": "ChIJSd7cANJvhlQRXg8TheyzUPM",
                        "description": "3735 Capilano Rd, North Vancouver, BC V7R 4J1, Canada",
                        "postcode": "V7R 4J1",
                        "establishment": "Capilano Suspension Bridge Park"
                    },
                    "pickupLocation": {
                        "country": "CA",
                        "name": "Waterfront Station, 601 W Cordova St, Vancouver, BC V6B 1G1, Canada",
                        "establishment": "Waterfront Station",
                        "postcode": "V6B 1G1",
                        "description": "601 W Cordova St, Vancouver, BC V6B 1G1, Canada",
                        "locationId": "ChIJD_-SC3hxhlQRLJAnr1qTaqg",
                        "city": "Vancouver",
                        "timezone": "America/Vancouver",
                        "locationType": "STATION"
                    }
                }
            ]
        }
    }
]

2025-08-25 12:23:45,038 - evaluation_logger_Cross-339 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 概述

本文，我们来分享 [《精尽 Spring Boot 源码分析 —— SpringApplication》](http://svip.iocoder.cn/Spring-Boot/SpringApplication/) 的**初始化**的源码解析。

在 SpringApplication 实例对象创建时，会进行一些初始化的工作。虽然说，它还没有开始真正去启动一个 Spring 容器，但是至关重要。所以，我们先来瞅瞅。

# 2. 构造方法

调用 `#SpringApplication(Class<?>... primarySources)` 方法，创建 SpringApplication 对象。代码如下：

```java
// SpringApplication.java

/**
 * 资源数组
 */
private Set<Class<?>> primarySources;
/**
 * Web 应用类型
 */
private WebApplicationType webApplicationType;
/**
 * 初始化器集合
 */
private List<ApplicationContextInitializer<?>> initializers;
/**
 * 监听器集合
 */
private List<ApplicationListener<?>> listeners;

public SpringApplication(Class<?>... primarySources) {
	this(null, primarySources);
}

public SpringApplication(ResourceLoader resourceLoader, Class<?>... primarySources) {
    // <1> 设置 resourceLoader 资源加载器
	this.resourceLoader = resourceLoader;
	Assert.notNull(primarySources, "PrimarySources must not be null");
    // <2> 设置 primarySources
	this.primarySources = new LinkedHashSet<>(Arrays.asList(primarySources));
    // <3> 判断 Web 应用类型
	this.webApplicationType = WebApplicationType.deduceFromClasspath();
    // <4> 设置初始化器
	setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class));
    // <5> 设置监听器
	setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));
    // <6> 设置主应用类
	this.mainApplicationClass = deduceMainApplicationClass();
}
```

- `<1>` 处，设置 `resourceLoader` 属性。如果 `resourceLoader` 参数为空，则不会设置。此时，`resourceLoader` 为 null 。

- `<2>` 处，设置 `primarySources` 属性。一般情况下，就是启动类。

- `<3>` 处，调用 `WebApplicationType#deduceFromClasspath()` 方法，判断 Web 应用类型。详细解析，见 [「3. WebApplicationType」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 。

- `<4>` 处，设置 `initializers` 属性。详细解析，见 [「4. 设置初始化器」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 。

- `<5>` 处，设置 `listeners` 属性。详细解析，见 [「5. 设置监听器」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 。

- `<6>` 处，调用 `#deduceMainApplicationClass()` 方法，获得主应用类。详细解析，见 [「6. 获得主应用类」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 。

# 3. WebApplicationType

`org.springframework.boot.WebApplicationType` ，Web 应用类型枚举。代码如下：

```java
// WebApplicationType.java

public enum WebApplicationType {

    /**
     * 非 Web 项目
     */
	NONE,
    /**
     * Servlet Web 项目
     */
	SERVLET,
    /**
     * Reactive Web 项目
     */
	REACTIVE;

}
```

- 一共有三种类型。

## 3.1 deduceFromClasspath

`#deduceFromClasspath()` 方法，通过 classpath ，判断 Web 应用类型。代码如下：

```java
// WebApplicationType.java

private static final String[] SERVLET_INDICATOR_CLASSES = { "javax.servlet.Servlet",
		"org.springframework.web.context.ConfigurableWebApplicationContext" };

private static final String WEBMVC_INDICATOR_CLASS = "org.springframework.web.servlet.DispatcherServlet";
private static final String WEBFLUX_INDICATOR_CLASS = "org.springframework.web.reactive.DispatcherHandler";
private static final String JERSEY_INDICATOR_CLASS = "org.glassfish.jersey.servlet.ServletContainer";

static WebApplicationType deduceFromClasspath() {
    // REACTIVE 应用
	if (ClassUtils.isPresent(WEBFLUX_INDICATOR_CLASS, null) && !ClassUtils.isPresent(WEBMVC_INDICATOR_CLASS, null)
			&& !ClassUtils.isPresent(JERSEY_INDICATOR_CLASS, null)) {
		return WebApplicationType.REACTIVE;
	}
    // SERVLET 应用
	for (String className : SERVLET_INDICATOR_CLASSES) {
		if (!ClassUtils.isPresent(className, null)) {
			return WebApplicationType.NONE;
		}
	}
    // 默认 SERVLET 应用
	return WebApplicationType.SERVLET;
}
```

- 通过判断是否存在指定的类，从而判断是什么类型。

# 4. 设置初始化器

在 `#setInitializers(Collection<? extends ApplicationContextInitializer<?>> initializers)` 方法中，设置初始化器。代码如下：

```java
// SpringApplication.java

public void setInitializers(Collection<? extends ApplicationContextInitializer<?>> initializers) {
	this.initializers = new ArrayList<>();
	this.initializers.addAll(initializers);
}
```

- 那么，`initializers` 参数，从哪里来呢？答案在 `#getSpringFactoriesInstances(Class<T> type)` 方法中。代码如下：

  ```java
  // SpringApplication.java
  
  private <T> Collection<T> getSpringFactoriesInstances(Class<T> type) {
  	return getSpringFactoriesInstances(type, new Class<?>[] {});
  }
  
  private <T> Collection<T> getSpringFactoriesInstances(Class<T> type, Class<?>[] parameterTypes, Object... args) {
  	ClassLoader classLoader = getClassLoader();
  	// Use names and ensure unique to protect against duplicates
      // 加载指定类型对应的，在 `META-INF/spring.factories` 里的类名的数组
  	Set<String> names = new LinkedHashSet<>(SpringFactoriesLoader.loadFactoryNames(type, classLoader));
      // 创建对象
  	List<T> instances = createSpringFactoriesInstances(type, parameterTypes, classLoader, args, names);
  	// 排序
  	AnnotationAwareOrderComparator.sort(instances);
  	return instances;
  }
  ```

  - 关于 `SpringFactoriesLoader#loadFactoryNames(Class<?> factoryClass, ClassLoader classLoader)` 方法，在 [《精尽 Spring 源码分析 —— 应用上下文之 ApplicationContext 相关》](http://svip.iocoder.cn/Spring/ApplicationContext-related) 的 [「7. SpringFactoriesLoader」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 中，有详细解析。
  - 简单来说，就是从 `META-INF/spring.factories` 中，获得 `org.springframework.context.ApplicationContextInitializer` 对应的实现类的数组。例如下图：[![`META-INF/spring.factories`](http://static.iocoder.cn/images/Spring-Boot/2021-01-07/01.jpg)](http://static.iocoder.cn/images/Spring-Boot/2021-01-07/01.jpg)`META-INF/spring.factories`
  - 然后，调用 `#createSpringFactoriesInstances(Class<T> type, Class<?>[] parameterTypes, ClassLoader classLoader, Object[] args, Set<String> names)` 方法，创建对象。代码如下：

    ```java
    // SpringApplication.java
    
    private <T> List<T> createSpringFactoriesInstances(Class<T> type, Class<?>[] parameterTypes,
    		ClassLoader classLoader, Object[] args, Set<String> names) {
    	List<T> instances = new ArrayList<>(names.size());
    	for (String name : names) {
    		try {
    			Class<?> instanceClass = ClassUtils.forName(name, classLoader);
    			Assert.isAssignable(type, instanceClass);
    			Constructor<?> constructor = instanceClass.getDeclaredConstructor(parameterTypes);
    			T instance = (T) BeanUtils.instantiateClass(constructor, args);
    			instances.add(instance);
    		} catch (Throwable ex) {
    			throw new IllegalArgumentException("Cannot instantiate " + type + " : " + name, ex);
    		}
    	}
    	return instances;
    }
    ```

    - 通过反射，创建对象。

  - 最后，调用 `AnnotationAwareOrderComparator#sort(List<?> list)` 方法，进行排序。关于 OrderComparator 排序相关，可见 [《【死磕 Spring】—— IoC 之深入分析 BeanFactoryPostProcessor》](http://svip.iocoder.cn/Spring/IoC-BeanFactoryPostProcessor) 的 [「4.2 OrderComparator」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 小节。

- 这样，`initializers` 就设置完成了。

# 5. 设置监听器

在 `#setListeners(Collection<? extends ApplicationListener<?>> listeners)` 方法中，设置监听器。代码如下：

```java
// SpringApplication.java

public void setListeners(Collection<? extends ApplicationListener<?>> listeners) {
	this.listeners = new ArrayList<>();
	this.listeners.addAll(listeners);
}
```

- 和 [「4. 设置初始化器」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 一样，也是通过 `#getSpringFactoriesInstances(Class<T> type)` 方法，获得监听器数组。

# 6. 获得主应用类

`#deduceMainApplicationClass()` 方法，获得主应用类。代码如下：

```java
// SpringApplication.java

private Class<?> deduceMainApplicationClass() {
	try {
        // 获得当前 StackTraceElement 数组
		StackTraceElement[] stackTrace = new RuntimeException().getStackTrace();
        // 遍历，判断哪个执行 main 方法
		for (StackTraceElement stackTraceElement : stackTrace) {
			if ("main".equals(stackTraceElement.getMethodName())) {
				return Class.forName(stackTraceElement.getClassName());
			}
		}
	} catch (ClassNotFoundException ex) {
		// Swallow and continue
	}
	return null;
}
```

- 通过构造一个 RuntimeException 异常，然后遍历其 StackTraceElement 数组，判断哪个执行了 `#main(String[] args)` 方法，从而获得主应用类。

# 7. 小结

至此，SpringApplication 对象的初始化，就已经完成。我们来简单总结下：

- 设置 `primarySources` 属性。
- 调用 `WebApplicationType#deduceFromClasspath()` 方法，判断 Web 应用类型。
- 设置 `initializers`、`listeners` 属性。
- 设置 `mainApplicationClass` 属性。

另外，本文涉及到的 Spring Boot 的拓展机制，后续文章，我们也会详细解析。

2025-08-25 12:23:51,474 - evaluation_logger_Cross-339 - INFO - Complete Result: {'score': 0, 'reason': 'The response does not address any of the requested information about trending attractions in Vancouver.'}
2025-08-25 12:23:57,769 - evaluation_logger_Cross-339 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 12:23:57,769 - evaluation_logger_Cross-339 - INFO - Message: Success.
2025-08-25 12:23:57,769 - evaluation_logger_Cross-339 - INFO - Success turn num = 4
2025-08-25 12:23:57,769 - evaluation_logger_Cross-339 - INFO - ----------------------------------------------------------------------------------------------------
