2025-08-25 11:47:16,328 - evaluation_logger_Cross-113 - INFO - Test Example Cross-113
2025-08-25 11:47:16,328 - evaluation_logger_Cross-113 - INFO - Query: I'd like to book a hotel within 10 kilometers of the Boston Logan International Airport for one night on November 5, 2024. I also need to reserve a car to be picked up from the hotel at 11 AM the next day and returned at 5 PM on the third day at the hotel.
2025-08-25 11:47:24,516 - evaluation_logger_Cross-113 - INFO - Function Calls: 
[
    {
        "name": "Location_to_Lat_Long",
        "arguments": {
            "query": "Boston Logan International Airport"
        }
    }
]

2025-08-25 11:47:24,517 - evaluation_logger_Cross-113 - INFO - Golden Function Call: 
[
    {
        "name": "Location_to_Lat_Long",
        "arguments": {
            "query": "Boston Logan International Airport"
        }
    },
    {
        "name": "Search_Hotels_By_Coordinates",
        "arguments": {
            "latitude": "42.365602",
            "longitude": "-71.0096136",
            "arrival_date": "2024-11-05",
            "departure_date": "2024-11-06",
            "radius": 10
        }
    }
]

2025-08-25 11:47:24,517 - evaluation_logger_Cross-113 - INFO - Start compare_single_call: 
{'name': 'Location_to_Lat_Long', 'arguments': {'query': 'Boston Logan International Airport'}}
{'name': 'Location_to_Lat_Long', 'arguments': {'query': 'Boston Logan International Airport'}}
2025-08-25 11:47:24,517 - evaluation_logger_Cross-113 - INFO - Rule-based compare success.
2025-08-25 11:47:24,517 - evaluation_logger_Cross-113 - INFO - Success matched: [{'name': 'Location_to_Lat_Long', 'arguments': {'query': 'Boston Logan International Airport'}}]
2025-08-25 11:47:24,517 - evaluation_logger_Cross-113 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": [
            {
                "business_status": "OPERATIONAL",
                "formatted_address": "East Boston, MA 02128, United States",
                "geometry": {
                    "location": {
                        "lat": 42.365602,
                        "lng": -71.0096136
                    },
                    "viewport": {
                        "northeast": {
                            "lat": 42.37598274999998,
                            "lng": -71.00042324999998
                        },
                        "southwest": {
                            "lat": 42.35845255,
                            "lng": -71.03718465000001
                        }
                    }
                },
                "name": "Boston Logan International Airport",
                "place_id": "ChIJN0na1RRw44kRRFEtH8OUkww",
                "plus_code": {
                    "compound_code": "9X8R+65 East Boston, Boston, MA",
                    "global_code": "87JC9X8R+65"
                },
                "rating": 4.1,
                "reference": "ChIJN0na1RRw44kRRFEtH8OUkww",
                "types": [
                    "airport",
                    "point_of_interest",
                    "establishment"
                ],
                "user_ratings_total": 20831
            }
        ]
    }
]

2025-08-25 11:47:35,381 - evaluation_logger_Cross-113 - INFO - Function Calls: 
[
    {
        "name": "Search_Hotels_By_Coordinates",
        "arguments": {
            "latitude": "42.365602",
            "longitude": "-71.0096136",
            "arrival_date": "2024-11-05",
            "departure_date": "2024-11-06",
            "radius": 10
        }
    }
]

2025-08-25 11:47:35,381 - evaluation_logger_Cross-113 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Hotels_By_Coordinates",
        "arguments": {
            "arrival_date": "2024-11-05",
            "departure_date": "2024-11-06",
            "latitude": "42.365602",
            "longitude": "-71.0096136",
            "radius": 10
        }
    },
    {
        "name": "Search_Car_Rentals",
        "arguments": {
            "pick_up_latitude": 42.3510417,
            "pick_up_longitude": -71.0697049,
            "drop_off_latitude": 42.3510417,
            "drop_off_longitude": -71.0697049,
            "pick_up_date": "2024-11-06",
            "drop_off_date": "2024-11-07",
            "pick_up_time": "11:00",
            "drop_off_time": "17:00"
        }
    }
]

2025-08-25 11:47:35,381 - evaluation_logger_Cross-113 - INFO - Start compare_single_call: 
{'name': 'Search_Hotels_By_Coordinates', 'arguments': {'arrival_date': '2024-11-05', 'departure_date': '2024-11-06', 'latitude': '42.365602', 'longitude': '-71.0096136', 'radius': 10}}
{'name': 'Search_Hotels_By_Coordinates', 'arguments': {'arrival_date': '2024-11-05', 'departure_date': '2024-11-06', 'latitude': '42.365602', 'longitude': '-71.0096136', 'radius': 10}}
2025-08-25 11:47:35,381 - evaluation_logger_Cross-113 - INFO - Rule-based compare success.
2025-08-25 11:47:35,381 - evaluation_logger_Cross-113 - INFO - Success matched: [{'name': 'Search_Hotels_By_Coordinates', 'arguments': {'arrival_date': '2024-11-05', 'departure_date': '2024-11-06', 'latitude': '42.365602', 'longitude': '-71.0096136', 'radius': 10}}]
2025-08-25 11:47:35,382 - evaluation_logger_Cross-113 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "extended_count": 0,
            "page_loading_threshold": 10,
            "filters": [
                {
                    "title": "Your previous filters",
                    "field": "previous"
                },
                {
                    "title": "Your budget (for 1 night)",
                    "field": "price"
                },
                {
                    "field": "tdb",
                    "title": "Bed preference"
                },
                {
                    "field": "roomfacility",
                    "title": "Room facilities"
                },
                {
                    "title": "Free cancellation ",
                    "field": "fc"
                }
            ],
            "unfiltered_primary_count": 1051,
            "result": [
                {
                    "hotel_id": 2119437,
                    "currencycode": "USD",
                    "preferred": 1,
                    "accommodation_type": 204,
                    "hotel_name": "Hilton Boston Park Plaza",
                    "min_total_price": 229,
                    "class_is_estimated": 0,
                    "is_genius_deal": 0,
                    "is_tpi_exclusive_property": 0,
                    "class": 4,
                    "genius_discount_percentage": 0,
                    "latitude": 42.3510417,
                    "id": "property_card_2119437",
                    "composite_price_breakdown": {
                        "net_amount": {
                            "amount_rounded": "US$229",
                            "amount_unrounded": "US$229",
                            "value": 229,
                            "currency": "USD"
                        },
                        "excluded_amount": {
                            "currency": "USD",
                            "amount_rounded": "US$78",
                            "amount_unrounded": "US$78.43",
                            "value": 78.4305
                        },
                        "has_long_stays_monthly_rate_price": 0,
                        "client_translations": {
                            "tooltip_total_text": "Total"
                        },
                        "included_taxes_and_charges_amount": {
                            "currency": "USD",
                            "amount_unrounded": "US$0",
                            "amount_rounded": "US$0",
                            "value": 0
                        },
                        "gross_amount_per_night": {
                            "value": 229,
                            "amount_unrounded": "US$229",
                            "amount_rounded": "US$229",
                            "currency": "USD"
                        },
                        "all_inclusive_amount_hotel_currency": {
                            "currency": "USD",
                            "value": 307.4305,
                            "amount_rounded": "US$307",
                            "amount_unrounded": "US$307.43"
                        },
                        "gross_amount": {
                            "currency": "USD",
                            "amount_unrounded": "US$229",
                            "amount_rounded": "US$229",
                            "value": 229
                        },
                        "charges_details": {
                            "mode": "extra_charges",
                            "amount": {
                                "value": 78,
                                "currency": "USD"
                            }
                        },
                        "price_display_config": [
                            {
                                "value": 0,
                                "key": "use_nightly_prices"
                            }
                        ],
                        "items": [
                            {
                                "kind": "charge",
                                "details": "5.70 % Tax",
                                "name": "Tax",
                                "base": {
                                    "percentage": 5.7,
                                    "kind": "percentage"
                                },
                                "item_amount": {
                                    "value": 13.053,
                                    "amount_rounded": "US$13",
                                    "amount_unrounded": "US$13.05",
                                    "currency": "USD"
                                },
                                "inclusion_type": "excluded"
                            },
                            {
                                "base": {
                                    "percentage": 8,
                                    "kind": "percentage"
                                },
                                "name": "City tax",
                                "inclusion_type": "excluded",
                                "item_amount": {
                                    "currency": "USD",
                                    "value": 18.32,
                                    "amount_unrounded": "US$18.32",
                                    "amount_rounded": "US$18"
                                },
                                "details": "8 % City tax",
                                "kind": "charge"
                            },
                            {
                                "inclusion_type": "excluded",
                                "item_amount": {
                                    "value": 6.2975,
                                    "amount_unrounded": "US$6.30",
                                    "amount_rounded": "US$6",
                                    "currency": "USD"
                                },
                                "name": "Municipality fee",
                                "base": {
                                    "kind": "percentage",
                                    "percentage": 2.75
                                },
                                "kind": "charge",
                                "details": "2.75 % Municipality fee"
                            },
                            {
                                "base": {
                                    "kind": "per_night",
                                    "base_amount": 40.76
                                },
                                "name": "Resort fee",
                                "inclusion_type": "excluded",
                                "item_amount": {
                                    "currency": "USD",
                                    "value": 40.76,
                                    "amount_rounded": "US$41",
                                    "amount_unrounded": "US$40.76"
                                },
                                "kind": "charge"
                            }
                        ],
                        "has_long_stays_weekly_rate_price": 0,
                        "all_inclusive_amount": {
                            "amount_rounded": "US$307",
                            "amount_unrounded": "US$307.43",
                            "value": 307.4305,
                            "currency": "USD"
                        },
                        "gross_amount_hotel_currency": {
                            "currency": "USD",
                            "value": 229,
                            "amount_rounded": "US$229",
                            "amount_unrounded": "US$229"
                        }
                    },
                    "city_in_trans": "in Boston",
                    "is_free_cancellable": 0,
                    "ufi": 20061717,
                    "block_ids": [
                        "211943737_382578344_2_42_0"
                    ],
                    "longitude": -71.0697049,
                    "default_wishlist_name": "Boston",
                    "unit_configuration_label": "1 bed",
                    "default_language": "xu",
                    "type": "property_card",
                    "soldout": 0,
                    "bwallet": {
                        "hotel_eligibility": 0
                    },
                    "countrycode": "us",
                    "hotel_name_trans": "Hilton Boston Park Plaza",
                    "checkout": {
                        "until": "11:00"
                    },
                    "review_score_word": "Good",
                    "checkin": {
                        "from": "15:00"
                    },
                    "review_score": 7.9,
                    "main_photo_id": 502749715,
                    "timezone": "America/New_York",
                    "is_no_prepayment_block": 1,
                    "hotel_has_vb_boost": 0,
                    "extended": 0,
                    "review_nr": 6201,
                    "preferred_plus": 0,
                    "is_smart_deal": 0,
                    "last_reservation_data": {
                        "last_reservation_ellapsed_months": 1
                    },
                    "hotel_include_breakfast": 0,
                    "city": "Boston (Massachusetts)"
                }
            ],
            "primary_count": 302,
            "b_max_los_data": {
                "is_fullon": 0,
                "default_los": 45,
                "has_extended_los": 1,
                "extended_los": 90,
                "experiment": "long_stays_ios_extend_los_2",
                "max_allowed_los": 90
            },
            "count": 302,
            "room_distribution": [
                {
                    "adults": "1"
                }
            ],
            "unfiltered_count": 1051
        }
    }
]

2025-08-25 11:47:53,085 - evaluation_logger_Cross-113 - INFO - Function Calls: 
[
    {
        "name": "Search_Car_Rentals",
        "arguments": {
            "pick_up_latitude": 42.3510417,
            "pick_up_longitude": -71.0697049,
            "drop_off_latitude": 42.3510417,
            "drop_off_longitude": -71.0697049,
            "pick_up_date": "2024-11-06",
            "drop_off_date": "2024-11-07",
            "pick_up_time": "11:00",
            "drop_off_time": "17:00"
        }
    }
]

2025-08-25 11:47:53,086 - evaluation_logger_Cross-113 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Car_Rentals",
        "arguments": {
            "drop_off_date": "2024-11-07",
            "drop_off_latitude": 42.3510417,
            "drop_off_longitude": -71.0697049,
            "drop_off_time": "17:00",
            "pick_up_date": "2024-11-06",
            "pick_up_latitude": 42.3510417,
            "pick_up_longitude": -71.0697049,
            "pick_up_time": "11:00"
        }
    }
]

2025-08-25 11:47:53,086 - evaluation_logger_Cross-113 - INFO - Start compare_single_call: 
{'name': 'Search_Car_Rentals', 'arguments': {'drop_off_date': '2024-11-07', 'drop_off_latitude': 42.3510417, 'drop_off_longitude': -71.0697049, 'drop_off_time': '17:00', 'pick_up_date': '2024-11-06', 'pick_up_latitude': 42.3510417, 'pick_up_longitude': -71.0697049, 'pick_up_time': '11:00'}}
{'name': 'Search_Car_Rentals', 'arguments': {'drop_off_date': '2024-11-07', 'drop_off_latitude': 42.3510417, 'drop_off_longitude': -71.0697049, 'drop_off_time': '17:00', 'pick_up_date': '2024-11-06', 'pick_up_latitude': 42.3510417, 'pick_up_longitude': -71.0697049, 'pick_up_time': '11:00'}}
2025-08-25 11:47:53,086 - evaluation_logger_Cross-113 - INFO - Rule-based compare success.
2025-08-25 11:47:53,086 - evaluation_logger_Cross-113 - INFO - Success matched: [{'name': 'Search_Car_Rentals', 'arguments': {'drop_off_date': '2024-11-07', 'drop_off_latitude': 42.3510417, 'drop_off_longitude': -71.0697049, 'drop_off_time': '17:00', 'pick_up_date': '2024-11-06', 'pick_up_latitude': 42.3510417, 'pick_up_longitude': -71.0697049, 'pick_up_time': '11:00'}}]
2025-08-25 11:47:53,087 - evaluation_logger_Cross-113 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "title": "Car rentals",
            "count": 279,
            "is_genius_location": false,
            "meta": {
                "response_code": 200
            },
            "search_context": {
                "searchKey": "eyJkcml2ZXJzQWdlIjozMCwiZHJvcE9mZkRhdGVUaW1lIjoiMjAyNC0xMS0wN1QxNzowMDowMCIsImRyb3BPZmZMb2NhdGlvbiI6IjQyLjM1MTA0MTcsLTcxLjA2OTcwNDkiLCJkcm9wT2ZmTG9jYXRpb25UeXBlIjoiTEFUTE9ORyIsInBpY2tVcERhdGVUaW1lIjoiMjAyNC0xMS0wNlQxMTowMDowMCIsInBpY2tVcExvY2F0aW9uIjoiNDIuMzUxMDQxNywtNzEuMDY5NzA0OSIsInBpY2tVcExvY2F0aW9uVHlwZSI6IkxBVExPTkciLCJyZW50YWxEdXJhdGlvbkluRGF5cyI6Miwic2VydmljZUZlYXR1cmVzIjpbIk5PX09QQVFVRVMiLCJTVVBSRVNTX0ZJWEVEX1BSSUNFX1ZFSElDTEVTIiwiSU5DTFVERV9QUk9EVUNUX1JFTEFUSU9OU0hJUFMiLCJJTkNMVURFX0VYVFJBU19DT05UQUlOSU5HX0ZFRVMiXX0=",
                "searchId": "3b772818-d6f3-4888-825c-1bb019dce2a4",
                "recommendationsSearchUniqueId": "57a1268b-8765-4c31-a9e0-0dad3648fcb2"
            },
            "search_results": [
                {
                    "vehicle_id": "774124506",
                    "rating_info": {
                        "cleanliness": 7.9,
                        "efficiency": 7.2,
                        "location": 8.5,
                        "average_text": "Very good",
                        "pickup_time": 5.2,
                        "average": 7.4,
                        "no_of_ratings": 400,
                        "value_for_money": 6.7,
                        "condition": 7.5,
                        "dropoff_time": 9.8
                    },
                    "accessibility": {
                        "pick_up_location": "Pick-up information: Car Rental Centre",
                        "transmission": "Automatic gearbox",
                        "fuel_policy": "Fuel policy is: Like for like",
                        "supplier_rating": "At this location, our customers have rated Avis as 7.4 out of 10, Good."
                    },
                    "route_info": {
                        "pickup": {
                            "name": "Logan International Airport",
                            "longitude": "-71.03025807",
                            "country_code": "US",
                            "latitude": "42.36807937",
                            "location_id": "4748716",
                            "location_hash": "TG9nYW4gSW50ZXJuYXRpb25hbCBBaXJwb3J0",
                            "address": "Boston Logan Intl Airport, 15 Transportation Way, Boston (BOS), USA - Other, 02128",
                            "location_type": "CAR_RENTAL_CENTRE"
                        },
                        "dropoff": {
                            "location_type": "CAR_RENTAL_CENTRE",
                            "address": "Boston Logan Intl Airport, 15 Transportation Way, Boston (BOS), USA - Other, 02128",
                            "location_hash": "TG9nYW4gSW50ZXJuYXRpb25hbCBBaXJwb3J0",
                            "country_code": "US",
                            "latitude": "42.36807937",
                            "location_id": "4748716",
                            "longitude": "-71.03025807",
                            "name": "Logan International Airport"
                        }
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "pricing_info": {
                        "fee_breakdown": {
                            "fuel_policy": {
                                "type": "RETURN_SAME",
                                "amount": 0
                            },
                            "known_fees": [
                                {
                                    "is_tax_included": 1,
                                    "is_always_payable": 0,
                                    "max_amount": 0,
                                    "amount": 0,
                                    "min_amount": 0,
                                    "currency": "USD",
                                    "type": "THEFT_EXCESS"
                                },
                                {
                                    "min_amount": 250,
                                    "currency": "USD",
                                    "type": "DEPOSIT",
                                    "is_tax_included": 1,
                                    "max_amount": 250,
                                    "is_always_payable": 0,
                                    "amount": 250
                                },
                                {
                                    "amount": 0,
                                    "is_always_payable": 0,
                                    "max_amount": 0,
                                    "is_tax_included": 1,
                                    "type": "DAMAGE_EXCESS",
                                    "min_amount": 0,
                                    "currency": "USD"
                                },
                                {
                                    "type": "MILEAGE",
                                    "distance_allowed": {
                                        "is_km": 0,
                                        "is_unlimited": 1
                                    },
                                    "is_always_payable": 0
                                }
                            ]
                        },
                        "discount": 0,
                        "base_price": 13379.55,
                        "price": 1.89,
                        "currency": "USD",
                        "quote_allowed": 1,
                        "drive_away_price": 1.89,
                        "drive_away_price_is_approx": true,
                        "base_currency": "INR",
                        "pay_when": "PAY_NOW",
                        "deposit": 159.08,
                        "base_deposit": 13379.55
                    },
                    "content": {
                        "badges": [
                            {
                                "variation": "DEFAULT",
                                "text": "Free cancellation",
                                "type": "CONSTRUCTIVE"
                            }
                        ],
                        "supplier": {
                            "name": "Avis",
                            "rating": {
                                "average": "7.4",
                                "subtitle": "400 reviews",
                                "title": "Good",
                                "localisedRating": {
                                    "displayValue": "7.4",
                                    "rawValue": 7.4
                                }
                            }
                        }
                    },
                    "fee_info": {
                        "tax": 0,
                        "fee": 0
                    },
                    "supplier_info": {
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/47_logo_200.png",
                        "name": "Avis",
                        "latitude": "42.36807937",
                        "longitude": "-71.03025807",
                        "address": "Boston Logan Intl Airport, 15 Transportation Way, Boston (BOS), USA - Other, 02128",
                        "may_require_credit_card_guarantee": false,
                        "location_type": "Car Rental Centre"
                    },
                    "vehicle_info": {
                        "mileage": "Unlimited mileage",
                        "cma_compliant": -1,
                        "v_name": "Chevrolet Cruze  ",
                        "fuel_type": "N/A",
                        "free_cancellation": 1,
                        "airbags": 1,
                        "doors": "2/4",
                        "fuel_policy": "Like for like",
                        "group": "Intermediate",
                        "transmission": "Automatic",
                        "label": "Intermediate car with:",
                        "suitcases": {
                            "small": "0",
                            "big": "0"
                        },
                        "unlimited_mileage": 1,
                        "v_id": "774124506",
                        "aircon": 1,
                        "seats": "5"
                    }
                },
                {
                    "vehicle_id": "372982701",
                    "vehicle_info": {
                        "fuel_policy": "Like for like",
                        "group": "Economy",
                        "transmission": "Automatic",
                        "doors": "4",
                        "free_cancellation": 1,
                        "airbags": 1,
                        "fuel_type": "N/A",
                        "v_name": "Ford Fiesta  ",
                        "mileage": "Unlimited mileage",
                        "cma_compliant": -1,
                        "seats": "4",
                        "v_id": "372982701",
                        "aircon": 1,
                        "unlimited_mileage": 1,
                        "suitcases": {
                            "big": "0",
                            "small": "0"
                        },
                        "label": "Economy car with:"
                    },
                    "supplier_info": {
                        "address": "15 Transportation Way, Boston, MA, USA, 02128",
                        "pickup_instructions": "Please take the blue and white shuttle bus from outside the terminal to the 'Rental Car Center'.",
                        "may_require_credit_card_guarantee": false,
                        "location_type": "Shuttle Bus",
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/47_logo_200.png",
                        "name": "Avis",
                        "latitude": "42.36807359",
                        "longitude": "-71.03026259"
                    },
                    "pricing_info": {
                        "drive_away_price_is_approx": true,
                        "base_currency": "INR",
                        "pay_when": "PAY_NOW",
                        "deposit": 146.72,
                        "base_deposit": 12339.69,
                        "fee_breakdown": {
                            "fuel_policy": {
                                "type": "RETURN_SAME",
                                "amount": 0
                            },
                            "known_fees": [
                                {
                                    "amount": 0,
                                    "is_always_payable": 0,
                                    "max_amount": 0,
                                    "is_tax_included": 1,
                                    "type": "THEFT_EXCESS",
                                    "currency": "USD",
                                    "min_amount": 0
                                },
                                {
                                    "min_amount": 250,
                                    "currency": "USD",
                                    "type": "DEPOSIT",
                                    "is_tax_included": 1,
                                    "max_amount": 250,
                                    "is_always_payable": 0,
                                    "amount": 250
                                },
                                {
                                    "currency": "USD",
                                    "min_amount": 0,
                                    "type": "DAMAGE_EXCESS",
                                    "amount": 0,
                                    "is_tax_included": 1,
                                    "max_amount": 0,
                                    "is_always_payable": 0
                                },
                                {
                                    "distance_allowed": {
                                        "is_km": 0,
                                        "is_unlimited": 1
                                    },
                                    "is_always_payable": 0,
                                    "type": "MILEAGE"
                                }
                            ]
                        },
                        "discount": 0,
                        "base_price": 12339.69,
                        "price": 1.74,
                        "currency": "USD",
                        "quote_allowed": 1,
                        "drive_away_price": 1.74
                    },
                    "fee_info": {
                        "fee": 0,
                        "tax": 0
                    },
                    "content": {
                        "supplier": {
                            "rating": {
                                "average": "7.4",
                                "title": "Good",
                                "subtitle": "400 reviews",
                                "localisedRating": {
                                    "rawValue": 7.4,
                                    "displayValue": "7.4"
                                }
                            },
                            "name": "Avis"
                        },
                        "badges": [
                            {
                                "text": "Free cancellation",
                                "variation": "DEFAULT",
                                "type": "CONSTRUCTIVE"
                            }
                        ]
                    },
                    "route_info": {
                        "pickup": {
                            "location_type": "SHUTTLE_BUS",
                            "address": "15 Transportation Way, Boston, MA, USA, 02128",
                            "location_hash": "TG9nYW4gSW50ZXJuYXRpb25hbCBBaXJwb3J0",
                            "country_code": "US",
                            "latitude": "42.36807359",
                            "location_id": "1687026",
                            "longitude": "-71.03026259",
                            "name": "Logan International Airport"
                        },
                        "dropoff": {
                            "location_type": "CAR_RENTAL_CENTRE",
                            "address": "Boston Logan Intl Airport, 15 Transportation Way, Boston (BOS), USA - Other, 02128",
                            "location_hash": "TG9nYW4gSW50ZXJuYXRpb25hbCBBaXJwb3J0",
                            "country_code": "US",
                            "location_id": "4748716",
                            "latitude": "42.36807937",
                            "longitude": "-71.03025807",
                            "name": "Logan International Airport"
                        }
                    },
                    "accessibility": {
                        "fuel_policy": "Fuel policy is: Like for like",
                        "transmission": "Automatic gearbox",
                        "pick_up_location": "Pick-up information: Shuttle Bus",
                        "supplier_rating": "At this location, our customers have rated Avis as 7.4 out of 10, Good."
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "rating_info": {
                        "efficiency": 7.2,
                        "location": 8.5,
                        "cleanliness": 7.9,
                        "value_for_money": 6.7,
                        "condition": 7.5,
                        "dropoff_time": 9.8,
                        "no_of_ratings": 400,
                        "pickup_time": 5.2,
                        "average": 7.4,
                        "average_text": "Very good"
                    }
                },
                {
                    "vehicle_id": "372982706",
                    "supplier_info": {
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/47_logo_200.png",
                        "name": "Avis",
                        "latitude": "42.36807359",
                        "longitude": "-71.03026259",
                        "address": "15 Transportation Way, Boston, MA, USA, 02128",
                        "may_require_credit_card_guarantee": false,
                        "pickup_instructions": "Please take the blue and white shuttle bus from outside the terminal to the 'Rental Car Center'.",
                        "location_type": "Shuttle Bus"
                    },
                    "vehicle_info": {
                        "mileage": "Unlimited mileage",
                        "cma_compliant": -1,
                        "fuel_type": "N/A",
                        "v_name": "Ford Escape  ",
                        "doors": "4",
                        "free_cancellation": 1,
                        "airbags": 1,
                        "fuel_policy": "Like for like",
                        "group": "Intermediate",
                        "transmission": "Automatic",
                        "label": "Intermediate car with:",
                        "suitcases": {
                            "small": "0",
                            "big": "0"
                        },
                        "v_id": "372982706",
                        "aircon": 1,
                        "unlimited_mileage": 1,
                        "seats": "5"
                    },
                    "content": {
                        "supplier": {
                            "rating": {
                                "localisedRating": {
                                    "displayValue": "7.4",
                                    "rawValue": 7.4
                                },
                                "average": "7.4",
                                "title": "Good",
                                "subtitle": "400 reviews"
                            },
                            "name": "Avis"
                        },
                        "badges": [
                            {
                                "variation": "DEFAULT",
                                "text": "Free cancellation",
                                "type": "CONSTRUCTIVE"
                            }
                        ]
                    },
                    "fee_info": {
                        "tax": 0,
                        "fee": 0
                    },
                    "pricing_info": {
                        "drive_away_price_is_approx": true,
                        "pay_when": "PAY_NOW",
                        "base_currency": "INR",
                        "deposit": 206.07,
                        "base_deposit": 17331.02,
                        "discount": 0,
                        "base_price": 17331.02,
                        "fee_breakdown": {
                            "known_fees": [
                                {
                                    "amount": 0,
                                    "is_tax_included": 1,
                                    "max_amount": 0,
                                    "is_always_payable": 0,
                                    "currency": "USD",
                                    "min_amount": 0,
                                    "type": "THEFT_EXCESS"
                                },
                                {
                                    "currency": "USD",
                                    "min_amount": 250,
                                    "type": "DEPOSIT",
                                    "amount": 250,
                                    "is_tax_included": 1,
                                    "max_amount": 250,
                                    "is_always_payable": 0
                                },
                                {
                                    "type": "DAMAGE_EXCESS",
                                    "min_amount": 0,
                                    "currency": "USD",
                                    "amount": 0,
                                    "is_always_payable": 0,
                                    "max_amount": 0,
                                    "is_tax_included": 1
                                },
                                {
                                    "type": "MILEAGE",
                                    "is_always_payable": 0,
                                    "distance_allowed": {
                                        "is_unlimited": 1,
                                        "is_km": 0
                                    }
                                }
                            ],
                            "fuel_policy": {
                                "type": "RETURN_SAME",
                                "amount": 0
                            }
                        },
                        "price": 2.45,
                        "currency": "USD",
                        "quote_allowed": 1,
                        "drive_away_price": 2.45
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "accessibility": {
                        "fuel_policy": "Fuel policy is: Like for like",
                        "transmission": "Automatic gearbox",
                        "pick_up_location": "Pick-up information: Shuttle Bus",
                        "supplier_rating": "At this location, our customers have rated Avis as 7.4 out of 10, Good."
                    },
                    "route_info": {
                        "dropoff": {
                            "location_type": "CAR_RENTAL_CENTRE",
                            "address": "Boston Logan Intl Airport, 15 Transportation Way, Boston (BOS), USA - Other, 02128",
                            "location_hash": "TG9nYW4gSW50ZXJuYXRpb25hbCBBaXJwb3J0",
                            "country_code": "US",
                            "latitude": "42.36807937",
                            "location_id": "4748716",
                            "longitude": "-71.03025807",
                            "name": "Logan International Airport"
                        },
                        "pickup": {
                            "address": "15 Transportation Way, Boston, MA, USA, 02128",
                            "location_hash": "TG9nYW4gSW50ZXJuYXRpb25hbCBBaXJwb3J0",
                            "location_type": "SHUTTLE_BUS",
                            "name": "Logan International Airport",
                            "latitude": "42.36807359",
                            "location_id": "1687026",
                            "country_code": "US",
                            "longitude": "-71.03026259"
                        }
                    },
                    "rating_info": {
                        "cleanliness": 7.9,
                        "location": 8.5,
                        "efficiency": 7.2,
                        "average_text": "Very good",
                        "pickup_time": 5.2,
                        "average": 7.4,
                        "no_of_ratings": 400,
                        "condition": 7.5,
                        "dropoff_time": 9.8,
                        "value_for_money": 6.7
                    }
                },
                {
                    "vehicle_id": "372982696",
                    "rating_info": {
                        "cleanliness": 7.9,
                        "location": 8.5,
                        "efficiency": 7.2,
                        "pickup_time": 5.2,
                        "average": 7.4,
                        "average_text": "Very good",
                        "no_of_ratings": 400,
                        "dropoff_time": 9.8,
                        "condition": 7.5,
                        "value_for_money": 6.7
                    },
                    "route_info": {
                        "dropoff": {
                            "latitude": "42.36807937",
                            "location_id": "4748716",
                            "country_code": "US",
                            "longitude": "-71.03025807",
                            "name": "Logan International Airport",
                            "location_type": "CAR_RENTAL_CENTRE",
                            "address": "Boston Logan Intl Airport, 15 Transportation Way, Boston (BOS), USA - Other, 02128",
                            "location_hash": "TG9nYW4gSW50ZXJuYXRpb25hbCBBaXJwb3J0"
                        },
                        "pickup": {
                            "location_hash": "TG9nYW4gSW50ZXJuYXRpb25hbCBBaXJwb3J0",
                            "address": "15 Transportation Way, Boston, MA, USA, 02128",
                            "location_type": "SHUTTLE_BUS",
                            "name": "Logan International Airport",
                            "longitude": "-71.03026259",
                            "country_code": "US",
                            "location_id": "1687026",
                            "latitude": "42.36807359"
                        }
                    },
                    "accessibility": {
                        "fuel_policy": "Fuel policy is: Like for like",
                        "transmission": "Automatic gearbox",
                        "pick_up_location": "Pick-up information: Shuttle Bus",
                        "supplier_rating": "At this location, our customers have rated Avis as 7.4 out of 10, Good."
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "pricing_info": {
                        "drive_away_price_is_approx": true,
                        "base_currency": "INR",
                        "pay_when": "PAY_NOW",
                        "deposit": 150.84,
                        "base_deposit": 12686.31,
                        "fee_breakdown": {
                            "known_fees": [
                                {
                                    "currency": "USD",
                                    "min_amount": 0,
                                    "type": "THEFT_EXCESS",
                                    "amount": 0,
                                    "is_tax_included": 1,
                                    "max_amount": 0,
                                    "is_always_payable": 0
                                },
                                {
                                    "amount": 250,
                                    "is_always_payable": 0,
                                    "max_amount": 250,
                                    "is_tax_included": 1,
                                    "type": "DEPOSIT",
                                    "currency": "USD",
                                    "min_amount": 250
                                },
                                {
                                    "is_tax_included": 1,
                                    "is_always_payable": 0,
                                    "max_amount": 0,
                                    "amount": 0,
                                    "min_amount": 0,
                                    "currency": "USD",
                                    "type": "DAMAGE_EXCESS"
                                },
                                {
                                    "distance_allowed": {
                                        "is_unlimited": 1,
                                        "is_km": 0
                                    },
                                    "is_always_payable": 0,
                                    "type": "MILEAGE"
                                }
                            ],
                            "fuel_policy": {
                                "type": "RETURN_SAME",
                                "amount": 0
                            }
                        },
                        "discount": 0,
                        "base_price": 12686.31,
                        "price": 1.79,
                        "currency": "USD",
                        "quote_allowed": 1,
                        "drive_away_price": 1.79
                    },
                    "fee_info": {
                        "fee": 0,
                        "tax": 0
                    },
                    "content": {
                        "badges": [
                            {
                                "type": "CONSTRUCTIVE",
                                "variation": "DEFAULT",
                                "text": "Free cancellation"
                            }
                        ],
                        "supplier": {
                            "rating": {
                                "localisedRating": {
                                    "rawValue": 7.4,
                                    "displayValue": "7.4"
                                },
                                "average": "7.4",
                                "subtitle": "400 reviews",
                                "title": "Good"
                            },
                            "name": "Avis"
                        }
                    },
                    "vehicle_info": {
                        "aircon": 1,
                        "v_id": "372982696",
                        "unlimited_mileage": 1,
                        "seats": "5",
                        "label": "Compact car with:",
                        "suitcases": {
                            "big": "0",
                            "small": "0"
                        },
                        "doors": "4",
                        "airbags": 1,
                        "free_cancellation": 1,
                        "transmission": "Automatic",
                        "fuel_policy": "Like for like",
                        "group": "Compact",
                        "cma_compliant": -1,
                        "mileage": "Unlimited mileage",
                        "fuel_type": "N/A",
                        "v_name": "Ford Focus  "
                    },
                    "supplier_info": {
                        "location_type": "Shuttle Bus",
                        "pickup_instructions": "Please take the blue and white shuttle bus from outside the terminal to the 'Rental Car Center'.",
                        "may_require_credit_card_guarantee": false,
                        "address": "15 Transportation Way, Boston, MA, USA, 02128",
                        "longitude": "-71.03026259",
                        "latitude": "42.36807359",
                        "name": "Avis",
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/47_logo_200.png"
                    }
                },
                {
                    "vehicle_id": "774124481",
                    "rating_info": {
                        "location": 8.5,
                        "efficiency": 7.2,
                        "cleanliness": 7.9,
                        "no_of_ratings": 400,
                        "condition": 7.5,
                        "dropoff_time": 9.8,
                        "value_for_money": 6.7,
                        "pickup_time": 5.2,
                        "average_text": "Very good",
                        "average": 7.4
                    },
                    "route_info": {
                        "dropoff": {
                            "name": "Logan International Airport",
                            "longitude": "-71.03025807",
                            "latitude": "42.36807937",
                            "location_id": "4748716",
                            "country_code": "US",
                            "location_hash": "TG9nYW4gSW50ZXJuYXRpb25hbCBBaXJwb3J0",
                            "address": "Boston Logan Intl Airport, 15 Transportation Way, Boston (BOS), USA - Other, 02128",
                            "location_type": "CAR_RENTAL_CENTRE"
                        },
                        "pickup": {
                            "address": "Boston Logan Intl Airport, 15 Transportation Way, Boston (BOS), USA - Other, 02128",
                            "location_hash": "TG9nYW4gSW50ZXJuYXRpb25hbCBBaXJwb3J0",
                            "location_type": "CAR_RENTAL_CENTRE",
                            "name": "Logan International Airport",
                            "location_id": "4748716",
                            "latitude": "42.36807937",
                            "country_code": "US",
                            "longitude": "-71.03025807"
                        }
                    },
                    "accessibility": {
                        "supplier_rating": "At this location, our customers have rated Avis as 7.4 out of 10, Good.",
                        "fuel_policy": "Fuel policy is: Like for like",
                        "transmission": "Automatic gearbox",
                        "pick_up_location": "Pick-up information: Car Rental Centre"
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "pricing_info": {
                        "base_currency": "INR",
                        "pay_when": "PAY_NOW",
                        "drive_away_price_is_approx": true,
                        "base_deposit": 14072.79,
                        "deposit": 167.33,
                        "price": 1.99,
                        "currency": "USD",
                        "fee_breakdown": {
                            "known_fees": [
                                {
                                    "amount": 0,
                                    "is_tax_included": 1,
                                    "max_amount": 0,
                                    "is_always_payable": 0,
                                    "min_amount": 0,
                                    "currency": "USD",
                                    "type": "THEFT_EXCESS"
                                },
                                {
                                    "min_amount": 250,
                                    "currency": "USD",
                                    "type": "DEPOSIT",
                                    "is_tax_included": 1,
                                    "is_always_payable": 0,
                                    "max_amount": 250,
                                    "amount": 250
                                },
                                {
                                    "currency": "USD",
                                    "min_amount": 0,
                                    "type": "DAMAGE_EXCESS",
                                    "is_tax_included": 1,
                                    "max_amount": 0,
                                    "is_always_payable": 0,
                                    "amount": 0
                                },
                                {
                                    "type": "MILEAGE",
                                    "is_always_payable": 0,
                                    "distance_allowed": {
                                        "is_unlimited": 1,
                                        "is_km": 0
                                    }
                                }
                            ],
                            "fuel_policy": {
                                "amount": 0,
                                "type": "RETURN_SAME"
                            }
                        },
                        "discount": 0,
                        "base_price": 14072.79,
                        "quote_allowed": 1,
                        "drive_away_price": 1.99
                    },
                    "content": {
                        "badges": [
                            {
                                "text": "Free cancellation",
                                "variation": "DEFAULT",
                                "type": "CONSTRUCTIVE"
                            }
                        ],
                        "supplier": {
                            "name": "Avis",
                            "rating": {
                                "average": "7.4",
                                "subtitle": "400 reviews",
                                "title": "Good",
                                "localisedRating": {
                                    "displayValue": "7.4",
                                    "rawValue": 7.4
                                }
                            }
                        }
                    },
                    "fee_info": {
                        "fee": 0,
                        "tax": 0
                    },
                    "supplier_info": {
                        "may_require_credit_card_guarantee": false,
                        "address": "Boston Logan Intl Airport, 15 Transportation Way, Boston (BOS), USA - Other, 02128",
                        "location_type": "Car Rental Centre",
                        "name": "Avis",
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/47_logo_200.png",
                        "longitude": "-71.03025807",
                        "latitude": "42.36807937"
                    },
                    "vehicle_info": {
                        "mileage": "Unlimited mileage",
                        "cma_compliant": -1,
                        "fuel_type": "N/A",
                        "v_name": "Buick Verano  ",
                        "doors": "4",
                        "airbags": 1,
                        "free_cancellation": 1,
                        "fuel_policy": "Like for like",
                        "group": "Standard",
                        "transmission": "Automatic",
                        "label": "Standard car with:",
                        "suitcases": {
                            "small": "0",
                            "big": "0"
                        },
                        "v_id": "774124481",
                        "aircon": 1,
                        "unlimited_mileage": 1,
                        "seats": "5"
                    }
                }
            ],
            "provider": "rentalcars",
            "type": "cars",
            "content": {
                "filters": {
                    "countLabel": "297 results"
                },
                "items": [
                    {
                        "type": "SHELL_REGION_VIEW",
                        "content": {
                            "contentType": "carsSearchResultsSecondaryPromotional"
                        },
                        "positionInList": 3
                    }
                ]
            },
            "search_key": "eyJkcml2ZXJzQWdlIjozMCwiZHJvcE9mZkRhdGVUaW1lIjoiMjAyNC0xMS0wN1QxNzowMDowMCIsImRyb3BPZmZMb2NhdGlvbiI6IjQyLjM1MTA0MTcsLTcxLjA2OTcwNDkiLCJkcm9wT2ZmTG9jYXRpb25UeXBlIjoiTEFUTE9ORyIsInBpY2tVcERhdGVUaW1lIjoiMjAyNC0xMS0wNlQxMTowMDowMCIsInBpY2tVcExvY2F0aW9uIjoiNDIuMzUxMDQxNywtNzEuMDY5NzA0OSIsInBpY2tVcExvY2F0aW9uVHlwZSI6IkxBVExPTkciLCJyZW50YWxEdXJhdGlvbkluRGF5cyI6Miwic2VydmljZUZlYXR1cmVzIjpbIk5PX09QQVFVRVMiLCJTVVBSRVNTX0ZJWEVEX1BSSUNFX1ZFSElDTEVTIiwiSU5DTFVERV9QUk9EVUNUX1JFTEFUSU9OU0hJUFMiLCJJTkNMVURFX0VYVFJBU19DT05UQUlOSU5HX0ZFRVMiXX0=",
            "sort": [
                {
                    "name": "Recommended – best first",
                    "title_tag": "tr.searchresults.sortBy.recommended",
                    "identifier": "recommended"
                },
                {
                    "title_tag": "tr.searchresults.sortBy.price.lowHigh",
                    "name": "Price - lowest first",
                    "identifier": "price_low_to_high"
                },
                {
                    "name": "Review score - highest first",
                    "title_tag": "tr.searchresults.sortBy.reviews.highLow",
                    "identifier": "review_score"
                }
            ],
            "filter": [
                {
                    "title": "Location",
                    "id": "depotLocationType",
                    "layout": {
                        "collapsed_count": 3,
                        "is_collapsed": "false",
                        "is_collapsable": "false",
                        "layout_type": "list"
                    },
                    "categories": [
                        {
                            "count": 203,
                            "nameWithCount": "All other locations (203)",
                            "id": "depotLocationType::DOWNTOWN",
                            "name": "All other locations"
                        },
                        {
                            "count": 10,
                            "name": "Airport (shuttle)",
                            "id": "depotLocationType::SHUTTLE_BUS",
                            "nameWithCount": "Airport (shuttle) (10)"
                        },
                        {
                            "count": 84,
                            "name": "Airport (car rental centre)",
                            "nameWithCount": "Airport (car rental centre) (84)",
                            "id": "depotLocationType::CAR_RENTAL_CENTRE"
                        }
                    ],
                    "type": "multiple_union"
                },
                {
                    "categories": [
                        {
                            "count": 28,
                            "name": "Small",
                            "id": "carCategory::small",
                            "nameWithCount": "Small (28)"
                        },
                        {
                            "count": 86,
                            "nameWithCount": "Medium (86)",
                            "id": "carCategory::medium",
                            "name": "Medium"
                        },
                        {
                            "nameWithCount": "Large (205)",
                            "id": "carCategory::large",
                            "name": "Large",
                            "count": 205
                        },
                        {
                            "name": "Premium",
                            "nameWithCount": "Premium (40)",
                            "id": "carCategory::premium",
                            "count": 40
                        },
                        {
                            "count": 29,
                            "nameWithCount": "People carriers (29)",
                            "id": "carCategory::carriers",
                            "name": "People carriers"
                        }
                    ],
                    "type": "multiple_union",
                    "layout": {
                        "is_collapsable": "true",
                        "is_collapsed": "true",
                        "collapsed_count": 5,
                        "layout_type": "list"
                    },
                    "title": "Car Type",
                    "id": "carCategory"
                },
                {
                    "layout": {
                        "layout_type": "list",
                        "is_collapsed": "false",
                        "collapsed_count": 5,
                        "is_collapsable": "false"
                    },
                    "id": "pricePerDayBuckets",
                    "title": "Price per day",
                    "type": "multiple_union",
                    "categories": [
                        {
                            "name": "US$0 - US$50",
                            "id": "pricePerDayBuckets::BUCKET_1",
                            "nameWithCount": "US$0 - US$50 (24)",
                            "count": 24
                        },
                        {
                            "count": 81,
                            "name": "US$50 - US$100",
                            "id": "pricePerDayBuckets::BUCKET_2",
                            "nameWithCount": "US$50 - US$100 (81)"
                        },
                        {
                            "nameWithCount": "US$100 - US$150 (124)",
                            "id": "pricePerDayBuckets::BUCKET_3",
                            "name": "US$100 - US$150",
                            "count": 124
                        },
                        {
                            "count": 50,
                            "nameWithCount": "US$150 - US$200 (50)",
                            "id": "pricePerDayBuckets::BUCKET_4",
                            "name": "US$150 - US$200"
                        },
                        {
                            "name": "US$200+",
                            "id": "pricePerDayBuckets::BUCKET_5",
                            "nameWithCount": "US$200+ (18)",
                            "count": 18
                        }
                    ]
                },
                {
                    "id": "supplier",
                    "title": "Supplier",
                    "layout": {
                        "collapsed_count": 5,
                        "is_collapsed": "true",
                        "is_collapsable": "true",
                        "layout_type": "list"
                    },
                    "type": "multiple_union",
                    "categories": [
                        {
                            "id": "supplier::Avis",
                            "nameWithCount": "Avis (83)",
                            "name": "Avis",
                            "count": 83
                        },
                        {
                            "count": 90,
                            "name": "Budget",
                            "nameWithCount": "Budget (90)",
                            "id": "supplier::Budget"
                        },
                        {
                            "name": "Dollar",
                            "id": "supplier::Dollar",
                            "nameWithCount": "Dollar (31)",
                            "count": 31
                        },
                        {
                            "count": 65,
                            "name": "Hertz",
                            "nameWithCount": "Hertz (65)",
                            "id": "supplier::Hertz"
                        },
                        {
                            "count": 28,
                            "nameWithCount": "Sixt (28)",
                            "id": "supplier::Sixt",
                            "name": "Sixt"
                        }
                    ]
                },
                {
                    "type": "multiple_union",
                    "categories": [
                        {
                            "count": 297,
                            "nameWithCount": "Automatic (297)",
                            "id": "transmission::AUTOMATIC",
                            "name": "Automatic"
                        }
                    ],
                    "title": "Transmission",
                    "id": "transmission",
                    "layout": {
                        "is_collapsed": "true",
                        "collapsed_count": 5,
                        "is_collapsable": "true",
                        "layout_type": "list"
                    }
                }
            ]
        }
    }
]

2025-08-25 11:50:56,985 - evaluation_logger_Cross-113 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 概述

本文，我们来分享 [《精尽 Spring MVC 源码分析 —— 容器的初始化（二）之 Root WebApplicationContext 容器》](http://svip.iocoder.cn/Spring-MVC/context-init-Root-WebApplicationContext) 的**第二篇：Root WebApplicationContext 容器**。

在 [《精尽 Spring MVC 源码分析 —— 容器的初始化（一）之 Servlet WebApplicationContext 容器》](http://svip.iocoder.cn/Spring-MVC/context-init-Servlet-WebApplicationContext) 中，我们已经详细分析了 Servlet WebApplicationContext 容器的初始化过程。所以，本文更多的，是提供一些代码的差异点的分析。

# 2. 环境搭建

在开始本文之前，胖友先搭建一个 Spring MVC 的环境。可参考 [《精尽 Spring MVC 源码分析 —— 环境搭建》](http://svip.iocoder.cn/Spring-MVC/install) 文章。

考虑到让环境相对简单，我们就不使用 Spring + Spring MVC 的环境，而是直接使用 Spring MVC 的环境。所以，我们的 `web.xml` 配置如下：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns="http://java.sun.com/xml/ns/javaee"
         xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"
         version="3.0">

    <servlet>
        <servlet-name>spring</servlet-name>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
        <!-- 可以自定义servlet.xml配置文件的位置和名称，默认为WEB-INF目录下，名称为[<servlet-name>]-servlet.xml，如spring-servlet.xml -->
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>/WEB-INF/spring-servlet.xml</param-value>
        </init-param>
        <load-on-startup>1</load-on-startup>
    </servlet>
    <servlet-mapping>
        <servlet-name>spring</servlet-name>
        <url-pattern>*.do</url-pattern>
    </servlet-mapping>

</web-app>
```

- 此时，我们并未配置 ContextLoaderListener ，所以并未有 Root WebApplicationContext 容器。

# 3. ContextLoaderListener

`org.springframework.web.context.ContextLoaderListener` ，实现 ServletContextListener 接口，Web 应用的监听器，主要用于初始化 Root WebApplicationContext 容器。

## 3.1 构造方法

```java
// ContextLoaderListener.java

/**
 * Create a new {@link ContextLoaderListener} that will create a web application
 * context based on the "contextClass" and "contextConfigLocation" servlet
 * context-params. See {@link ContextLoader} superclass documentation for details on
 * default values for each.
 * <p>This constructor is typically used when declaring {@link ContextLoaderListener}
 * as a {@code <listener>} in {@code web.xml}, where a no-arg constructor is required.
 * <p>The created application context will be registered into the ServletContext under
 * the attribute name {@link WebApplicationContext#ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE}
 * and subclasses are free to call the {@link #closeWebApplicationContext} method on
 * container shutdown to close the application context.
 * @see #ContextLoaderListener(WebApplicationContext)
 * @see #closeWebApplicationContext(ServletContext)
 * @see ContextLoader
 * @see #CONTEXT_CLASS_PARAM
 * @see #CONFIG_LOCATION_PARAM
 */
public ContextLoaderListener() {
}

/**
 * Create a new {@link ContextLoaderListener} with the given application context.
 * This constructor is useful in Servlet 3.0+ environments where instance-based
 * registration of listeners is possible.
 * <p>The context may or may not yet be {@linkplain
 * ConfigurableApplicationContext#refresh() refreshed}. If it (a) is an implementation
 * of {@link ConfigurableWebApplicationContext} and (b) has <strong>not</strong>
 * already been refreshed (the recommended approach), then the following will occur:
 * <ul>
 * <li>If the given context has not already been assigned an {@linkplain
 * ConfigurableApplicationContext#setId id}, one will be assigned to it</li>
 * <li>{@code ServletContext} and {@code ServletConfig} objects will be delegated to
 * the application context</li>
 * <li>{@link #customizeContext} will be called</li>
 * <li>Any {@link ApplicationContextInitializer ApplicationContextInitializers} specified
 * through the "contextInitializerClasses" init-param will be applied.</li>
 * <li>{@link ConfigurableApplicationContext#refresh refresh()} will be called</li>
 * </ul>
 * If the context has already been refreshed or does not implement
 * {@link ConfigurableWebApplicationContext}, none of the above will occur under the
 * assumption that the user has performed these actions (or not) per their specific
 * needs.
 * <p>See {@link org.springframework.web.WebApplicationInitializer} for usage examples.
 * <p>In any case, the given application context will be registered into the
 * ServletContext under the attribute name {@link
 * WebApplicationContext#ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE} and subclasses are
 * free to call the {@link #closeWebApplicationContext} method on container shutdown
 * to close the application context.
 * @param context the application context to manage
 */
public ContextLoaderListener(WebApplicationContext context) {
	super(context);
}
```

- 两个构造方法，重点在第二个，可以传入已经创建的 WebApplicationContext 对象。而第一个空构造方法，实际创建 WebApplicationContext 对象的工作，会交给 ContextLoader 来完成。

## 3.2 contextInitialized

`#contextInitialized(ServletContextEvent event)` 方法，当 Servlet 容器启动时，接收到初始化事件，初始化 Root WebApplicationContext 容器。代码如下：

```java
// ContextLoaderListener.java

@Override
public void contextInitialized(ServletContextEvent event) {
	initWebApplicationContext(event.getServletContext());
}
```

- 调用父类 ContextLoader 的 `#initWebApplicationContext(ServletContext servletContext)` 方法，初始化 Root WebApplicationContext 容器。

## 3.3 contextDestroyed

`#contextDestroyed(ServletContextEvent event)` 方法，当 Servlet 容器关闭时，接收到销毁事件，销毁 Root WebApplicationContext 容器。代码如下：

```java
// ContextLoaderListener.java

@Override
public void contextDestroyed(ServletContextEvent event) {
	closeWebApplicationContext(event.getServletContext());
	ContextCleanupListener.cleanupAttributes(event.getServletContext());
}
```

- 调用父类 ContextLoader 的 `#closeWebApplicationContext(ServletContext servletContext)` 方法，销毁 Root WebApplicationContext 容器。
- 调用 `ContextCleanupListener#cleanupAttributes(ServletContext servletContext)` 方法，清理 ServletContext 的属性。

# 4. ContextLoader

`org.springframework.web.context.ContextLoader` ，用于初始化 Root WebApplicationContext 容器。

## 4.1 构造方法

```java
// ContextLoader.java

/**
 * Config param for the root WebApplicationContext implementation class to use: {@value}
 * @see #determineContextClass(ServletContext)
 */
public static final String CONTEXT_CLASS_PARAM = "contextClass";

/**
 * Name of servlet context parameter (i.e., {@value}) that can specify the
 * config location for the root context, falling back to the implementation's
 * default otherwise.
 * @see org.springframework.web.context.support.XmlWebApplicationContext#DEFAULT_CONFIG_LOCATION
 */
public static final String CONFIG_LOCATION_PARAM = "contextConfigLocation";

/**
 * Name of servlet context parameter (i.e., {@value}) that can specify the
 * config location for the root context, falling back to the implementation's
 * default otherwise.
 * @see org.springframework.web.context.support.XmlWebApplicationContext#DEFAULT_CONFIG_LOCATION
 */
public static final String CONTEXT_ID_PARAM = "contextId";

/**
 * Name of servlet context parameter (i.e., {@value}) that can specify the
 * config location for the root context, falling back to the implementation's
 * default otherwise.
 * @see org.springframework.web.context.support.XmlWebApplicationContext#DEFAULT_CONFIG_LOCATION
 */
public static final String CONTEXT_INITIALIZER_CLASSES_PARAM = "contextInitializerClasses";

/**
 * Config param for the root WebApplicationContext id, falling back to the implementation's
 * default otherwise.
 * @see org.springframework.web.context.support.XmlWebApplicationContext#DEFAULT_CONFIG_LOCATION
 */
public static final String CONFIG_LOCATION_DELIMITERS = ",; \t\n";

/**
 * Name of the class path resource (relative to the ContextLoader class)
 * that defines ContextLoader's default strategy names.
 */
private static final String DEFAULT_STRATEGIES_PATH = "ContextLoader.properties";

private static final Properties defaultStrategies;

static {
	// Load default strategy properties from well-known file.
	try {
		ClassPathResource resource = new ClassPathResource(DEFAULT_STRATEGIES_PATH, ContextLoader.class);
		defaultStrategies = PropertiesLoaderUtils.loadProperties(resource);
	} catch (IOException ex) {
		throw new IllegalStateException("Could not load 'ContextLoader.properties': " + ex.getMessage());
	}
}

/**
 * The root WebApplicationContext instance that this loader manages.
 */
private WebApplicationContext context;

/**
 * The actual ApplicationContextInitializer instances to apply to the context.
 */
private final List<ApplicationContextInitializer<ConfigurableApplicationContext>> contextInitializers = new ArrayList<>();

/**
 * Holds Bean Factory Reference when there is an active custom ClassLoader.
 */
private volatile BeanFactoryReference factoryReference;
```

- 从 `DEFAULT_STRATEGIES_PATH` 的默认配置，我们可以看到，它和 ContextLoader 在同一个包下：

  ![DEFAULT_STRATEGIES_PATH](第二章 容器的初始化（二）之 Root WebApplicationContext 容器.assets/01.png)

- 打开 `ContextLoader.properties` 文件，内容如下：

  ```properties
  org.springframework.web.context.WebApplicationContext=org.springframework.web.context.support.XmlWebApplicationContext
  ```

  - 所以，默认情况下，Root WebApplicationContext 容器，使用 XmlWebApplicationContext 类。

## 4.2 initWebApplicationContext

`#initWebApplicationContext(ServletContext servletContext)` 方法，初始化 Root WebApplicationContext 容器。代码如下：

```java
// ContextLoader.java

/**
 * Initialize Spring's web application context for the given servlet context,
 * using the application context provided at construction time, or creating a new one
 * according to the "{@link #CONTEXT_CLASS_PARAM contextClass}" and
 * "{@link #CONFIG_LOCATION_PARAM contextConfigLocation}" context-params.
 * @param servletContext current servlet context
 * @return the new WebApplicationContext
 * @see #ContextLoader(WebApplicationContext)
 * @see #CONTEXT_CLASS_PARAM
 * @see #CONFIG_LOCATION_PARAM
 */
public WebApplicationContext initWebApplicationContext(ServletContext servletContext) {
    // <1> 如果已经存在 ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE 对应的 WebApplicationContext 对象，则抛出 IllegalStateException 异常
    if (servletContext.getAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE) != null) {
        throw new IllegalStateException(
                "Cannot initialize context because there is already a root application context present - " +
                "check whether you have multiple ContextLoader definitions in your web.xml!");
    }

    Log logger = LogFactory.getLog(ContextLoader.class);
    servletContext.log("Initializing Spring root WebApplicationContext");
    if (logger.isInfoEnabled()) {
        logger.info("Root WebApplicationContext: initialization started");
    }
    long startTime = System.currentTimeMillis();

    try {
        // Store context in local instance variable, to guarantee that
        // it is available on ServletContext shutdown.
        // <2> 如果 context 为空，则进行初始化。
        if (this.context == null) {
            this.context = createWebApplicationContext(servletContext);
        }
        // <3> 如果是 ConfigurableWebApplicationContext 类型，并且未激活，则进行配置和初始化。
        if (this.context instanceof ConfigurableWebApplicationContext) {
            ConfigurableWebApplicationContext cwac = (ConfigurableWebApplicationContext) this.context;
            if (!cwac.isActive()) {
                // The context has not yet been refreshed -> provide services such as
                // setting the parent context, setting the application context id, etc
                // <3.1> 设置父容器
                if (cwac.getParent() == null) {
                    // The context instance was injected without an explicit parent ->
                    // determine parent for root web application context, if any.
                    ApplicationContext parent = loadParentContext(servletContext);
                    cwac.setParent(parent);
                }
                // <3.2> 配置并初始化 WebApplicationContext
                configureAndRefreshWebApplicationContext(cwac, servletContext);
            }
        }
        // <4> 记录到 servletContext 中
        servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, this.context);

        // <5> 记录到 currentContext 或 currentContextPerThread 中
        ClassLoader ccl = Thread.currentThread().getContextClassLoader();
        if (ccl == ContextLoader.class.getClassLoader()) {
            currentContext = this.context;
        } else if (ccl != null) {
            currentContextPerThread.put(ccl, this.context);
        }

        // <6> 打印日志
        if (logger.isDebugEnabled()) {
            logger.debug("Published root WebApplicationContext as ServletContext attribute with name [" +
                    WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE + "]");
        }
        if (logger.isInfoEnabled()) {
            long elapsedTime = System.currentTimeMillis() - startTime;
            logger.info("Root WebApplicationContext: initialization completed in " + elapsedTime + " ms");
        }

        return this.context;
    } catch (RuntimeException | Error ex) {
        logger.error("Context initialization failed", ex);
        servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, ex);
        throw ex;
    }
}
```

- 和 `org.springframework.web.servlet.FrameworkServlet#initWebApplicationContext()` 方法，整体逻辑是**类似**的。所以，下面我们主要说**差异**的地方。

- `<1>` 处，如果已经存在 `ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE` 对应的 WebApplicationContext 对象，则抛出 IllegalStateException 异常。也就是说，Root WebApplicationContext 容器，只能有一个。

- `<2>` 处，如果 `context` 为空，则调用 `#createWebApplicationContext(ServletContext sc)` 方法，进行创建。详细解析，见 [「4.3 createWebApplicationContext」](http://svip.iocoder.cn/Spring-MVC/context-init-Root-WebApplicationContext/#) 。

- `<3>` 处，如果是 ConfigurableWebApplicationContext 类型，并且未激活，则进行配置和初始化。

  - `<3.1>` 处，设置父容器。但是，目前这个父容器，默认情况下是 `null` 。详细解析，见 [「4.4 loadParentContext」](http://svip.iocoder.cn/Spring-MVC/context-init-Root-WebApplicationContext/#) 。
  - `<3.2>` 处，调用 `#configureAndRefreshWebApplicationContext(ConfigurableWebApplicationContext wac, ServletContext sc)` 方法，配置并初始化 WebApplicationContext 。详细解析，见 [「4.5 configureAndRefreshWebApplicationContext」](http://svip.iocoder.cn/Spring-MVC/context-init-Root-WebApplicationContext/#) 。

- `<4>` 处，记录到 `servletContext` 中。

- `<5>` 处，记录到 `currentContext` 或 `currentContextPerThread` 中。代码如下：

  ```java
  // ContextLoader.java
  
  /**
   * Map from (thread context) ClassLoader to corresponding 'current' WebApplicationContext.
   */
  private static final Map<ClassLoader, WebApplicationContext> currentContextPerThread = new ConcurrentHashMap<>(1);
  
  /**
   * The 'current' WebApplicationContext, if the ContextLoader class is
   * deployed in the web app ClassLoader itself.
   */
  private static WebApplicationContext currentContext;
  ```

  - 一般情况下，使用 `currentContext` 进行记录。

- `<6>` 处，打印日志。

## 4.3 createWebApplicationContext

`#createWebApplicationContext(ServletContext sc)` 方法，创建 WebApplicationContext 容器。代码如下：

```java
// ContextLoader.java

protected WebApplicationContext createWebApplicationContext(ServletContext sc) {
    // <1> 获得 context 的类
    Class<?> contextClass = determineContextClass(sc);
    // <2> 判断 contextClass 是否是 ConfigurableWebApplicationContext 的类型
    if (!ConfigurableWebApplicationContext.class.isAssignableFrom(contextClass)) {
        throw new ApplicationContextException("Custom context class [" + contextClass.getName() +
                "] is not of type [" + ConfigurableWebApplicationContext.class.getName() + "]");
    }
    // <3> 创建 contextClass 对应的对象
    return (ConfigurableWebApplicationContext) BeanUtils.instantiateClass(contextClass);
}
```

- `<1>` 处，调用 `#determineContextClass(ServletContext servletContext)` 方法，获得 context 的类。代码如下：

  ```java
  // ContextLoader.java
  
  protected Class<?> determineContextClass(ServletContext servletContext) {
      // 获得 servletContext 的 contextClass 属性
      String contextClassName = servletContext.getInitParameter(CONTEXT_CLASS_PARAM);
      // 如果配置，则使用该配置的
      if (contextClassName != null) {
          try {
              return ClassUtils.forName(contextClassName, ClassUtils.getDefaultClassLoader());
          } catch (ClassNotFoundException ex) {
              throw new ApplicationContextException(
                      "Failed to load custom context class [" + contextClassName + "]", ex);
          }
      // 如果未配置，则使用 defaultStrategies 的默认配置
      } else {
          contextClassName = defaultStrategies.getProperty(WebApplicationContext.class.getName());
         

2025-08-25 11:51:02,416 - evaluation_logger_Cross-113 - INFO - Complete Result: {'score': 0, 'reason': "The response does not address any of the requested information in the user's query."}
2025-08-25 11:51:09,767 - evaluation_logger_Cross-113 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 11:51:09,768 - evaluation_logger_Cross-113 - INFO - Message: Success.
2025-08-25 11:51:09,768 - evaluation_logger_Cross-113 - INFO - Success turn num = 3
2025-08-25 11:51:09,768 - evaluation_logger_Cross-113 - INFO - ----------------------------------------------------------------------------------------------------
