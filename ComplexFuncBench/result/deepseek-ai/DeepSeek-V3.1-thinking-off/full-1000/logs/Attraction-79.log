2025-08-25 13:04:17,928 - evaluation_logger_Attraction-79 - INFO - Test Example Attraction-79
2025-08-25 13:04:17,928 - evaluation_logger_Attraction-79 - INFO - Query: Check if tickets are available for the two most trending attractions in Copenhagen on any Tuesday in November 2024.
2025-08-25 13:04:25,514 - evaluation_logger_Attraction-79 - INFO - Function Calls: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Copenhagen"
        }
    }
]

2025-08-25 13:04:25,514 - evaluation_logger_Attraction-79 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Copenhagen"
        }
    },
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0yNzQ1NjM2fQ==",
            "sortBy": "trending"
        }
    }
]

2025-08-25 13:04:25,514 - evaluation_logger_Attraction-79 - INFO - Start compare_single_call: 
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Copenhagen'}}
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Copenhagen'}}
2025-08-25 13:04:25,514 - evaluation_logger_Attraction-79 - INFO - Rule-based compare success.
2025-08-25 13:04:25,514 - evaluation_logger_Attraction-79 - INFO - Success matched: [{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Copenhagen'}}]
2025-08-25 13:04:25,514 - evaluation_logger_Attraction-79 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "products": [
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJuS0RhT01MTEY2IiwidWZpIjotMjc0NTYzNn0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Copenhagen Private Transfer from Copenhagen city centre to Copenhagen airport",
                    "productId": "PRnKDaOMLLF6",
                    "productSlug": "prnkdaomllf6-copenhagen-private-transfer-from-copenhagen-city-centre-to-copenhag",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -2745636,
                    "cityName": "Copenhagen",
                    "countryCode": "dk"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJqcFFaYVc2ZFpsIiwidWZpIjotMjc0NTYzNn0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Copenhagen Card",
                    "productId": "PRjpQZaW6dZl",
                    "productSlug": "prjpqzaw6dzl-copenhagen-card",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -2745636,
                    "cityName": "Copenhagen",
                    "countryCode": "dk"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJwbFJiSjhUbDRsIiwidWZpIjotMjc0NTYzNn0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Departure Transfer: Copenhagen city to Copenhagen Cruise Port",
                    "productId": "PRplRbJ8Tl4l",
                    "productSlug": "prplrbj8tl4l-departure-transfer-copenhagen-city-to-copenhagen-cruise-port",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -2745636,
                    "cityName": "Copenhagen",
                    "countryCode": "dk"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFI1ZGRMR2hvVFF3IiwidWZpIjotMjc0NTYzNn0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Private Transfer from Copenhagen Hotels to Copenhagen Port",
                    "productId": "PR5ddLGhoTQw",
                    "productSlug": "pr5ddlghotqw-private-transfer-from-copenhagen-hotels-to-copenhagen-port",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -2745636,
                    "cityName": "Copenhagen",
                    "countryCode": "dk"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJZTFpVZ1VZRGU0IiwidWZpIjotMjc0NTYzNn0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Copenhagen Card for Visitors",
                    "productId": "PRYLZUgUYDe4",
                    "productSlug": "prylzuguyde4-copenhagen-card-for-visitors",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -2745636,
                    "cityName": "Copenhagen",
                    "countryCode": "dk"
                }
            ],
            "destinations": [
                {
                    "id": "eyJ1ZmkiOi0yNzQ1NjM2fQ==",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": -2745636,
                    "country": "Denmark",
                    "cityName": "Copenhagen",
                    "productCount": 270,
                    "cc1": "dk"
                },
                {
                    "id": "eyJ1ZmkiOi0xNTAyNTU0fQ==",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": -1502554,
                    "country": "Ireland",
                    "cityName": "Dublin",
                    "productCount": 795,
                    "cc1": "ie"
                }
            ]
        }
    }
]

2025-08-25 13:04:36,235 - evaluation_logger_Attraction-79 - INFO - Function Calls: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0yNzQ1NjM2fQ==",
            "sortBy": "trending"
        }
    }
]

2025-08-25 13:04:36,235 - evaluation_logger_Attraction-79 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0yNzQ1NjM2fQ==",
            "sortBy": "trending"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRjpQZaW6dZl"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRyFBtGdlpTy"
        }
    }
]

2025-08-25 13:04:36,236 - evaluation_logger_Attraction-79 - INFO - Start compare_single_call: 
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0yNzQ1NjM2fQ==', 'sortBy': 'trending'}}
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0yNzQ1NjM2fQ==', 'sortBy': 'trending'}}
2025-08-25 13:04:36,236 - evaluation_logger_Attraction-79 - INFO - Rule-based compare success.
2025-08-25 13:04:36,236 - evaluation_logger_Attraction-79 - INFO - Success matched: [{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0yNzQ1NjM2fQ==', 'sortBy': 'trending'}}]
2025-08-25 13:04:36,236 - evaluation_logger_Attraction-79 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProductSearchResponse",
            "products": [
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": false
                    },
                    "id": "PRjpQZaW6dZl",
                    "name": "Copenhagen Card",
                    "slug": "prjpqzaw6dzl-copenhagen-card",
                    "shortDescription": "A city card with over 80 museums and attractions and unlimited public transport",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 72.07,
                        "currency": "USD",
                        "publicAmount": 72.07
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 2,
                        "percentage": "100%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.7,
                            "total": 598
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Copenhagen",
                        "ufi": -2745636
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIEbrxbsDp9Y"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI0ppqpv7le0"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIFFMgZcuo62"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIruEg2CmKFw"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIbbzoNmlSTA"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIQIfjWpFajh"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI25EBWLlHWH"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIdNe5E4Xwet"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIomBv6Qv5Ot"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIDlMkhfOAOt"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIP7J443qQpZ"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIBf8YpvVImF"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OINYYtH9sG7W"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIY5VrQwe5Ee"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIuIIcAkQGYX"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 1
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRyFBtGdlpTy",
                    "name": "Copenhagen Sightseeing Classic Canal Tour With Live Guide",
                    "slug": "pryfbtgdlpty-copenhagen-sightseeing-classic-canal-tour-with-live-guide",
                    "shortDescription": "See the sights of Copenhagen from the water on a 1-hour canal cruise! Relax inside the lower salo...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 25.67,
                        "currency": "USD",
                        "publicAmount": 25.67
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.5,
                            "total": 34
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Copenhagen",
                        "ufi": -2745636
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIfHMbOkupj3"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIkJBagWlWK1"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIM7sakwtJrx"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    }
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRIv4zHGUVMm",
                    "name": "Copenhagen Highlights Walking Tour",
                    "slug": "priv4zhguvmm-copenhagen-highlights-walking-tour",
                    "shortDescription": "Book this tour to guarantee your spot on the public, tips-based Politically Incorrect Copenhagen ...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 5.48,
                        "currency": "USD",
                        "publicAmount": 5.48
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.4,
                            "total": 28
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Copenhagen",
                        "ufi": -2745636
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIpAf3PkbVTA"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIUPdJxlpia7"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIHGjgxOJWRR"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIZVheyBptcI"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    }
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": false
                    },
                    "id": "PRsLLI3iKjqf",
                    "name": "Tivoli Gardens",
                    "slug": "prslli3ikjqf-tivoli-gardens",
                    "shortDescription": "Admission to a captivating theme park home to one of the world's oldest wooden rollercoasters",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 26.02,
                        "currency": "USD",
                        "publicAmount": 26.02
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 2,
                        "percentage": "100%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.5,
                            "total": 117
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Copenhagen",
                        "ufi": -2745636
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI5DJY6ZMGnP"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI3R4bxhS2p0"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIGBcbEmZbzP"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIHsH9NkW9uZ"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIVF2WZsWGID"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIYRvngrql6s"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI5HsmHk0FyO"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIcgQ7FmdYwt"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 2
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PR5DnBK4586g",
                    "name": "Hippies & Christianshavn Walking Tour",
                    "slug": "pr5dnbk4586g-hippies-christianshavn-walking-tour",
                    "shortDescription": "Book this tour to guarantee your spot on the public, tips-based Politically Incorrect Hippies & C...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 5.48,
                        "currency": "USD",
                        "publicAmount": 5.48
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.6,
                            "total": 13
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Copenhagen",
                        "ufi": -2745636
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIyNTowhU6mU"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIwl7551451C"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    }
                }
            ],
            "filterStats": {
                "__typename": "FilterStats",
                "unfilteredProductCount": 272,
                "filteredProductCount": 272
            },
            "sorters": [
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Our top picks",
                    "value": "trending"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Most popular",
                    "value": "attr_book_score"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Lowest price",
                    "value": "lowest_price"
                }
            ],
            "defaultSorter": {
                "__typename": "AttractionsSorterOption",
                "name": "Our top picks",
                "value": "trending"
            },
            "filterOptions": {
                "__typename": "FilterOptions",
                "typeFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Tours",
                        "tagname": "tours",
                        "productCount": 52
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Nature & outdoor",
                        "tagname": "nature-outdoor",
                        "productCount": 36
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Museums, arts & culture",
                        "tagname": "museums-arts-culture",
                        "productCount": 26
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Entertainment & tickets",
                        "tagname": "entertainment-tickets",
                        "productCount": 14
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Food & drinks",
                        "tagname": "food-drinks",
                        "productCount": 5
                    }
                ],
                "labelFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Free cancellation",
                        "tagname": "free_cancellation",
                        "productCount": 236
                    }
                ],
                "ufiFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Copenhagen",
                        "tagname": "-2745636",
                        "productCount": 272
                    }
                ],
                "priceFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "US$0 - US$22",
                        "tagname": "b0",
                        "productCount": 28
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$22 - US$44",
                        "tagname": "b1",
                        "productCount": 31
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$44 - US$83",
                        "tagname": "b2",
                        "productCount": 38
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$83 - US$138",
                        "tagname": "b3",
                        "productCount": 18
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$138+",
                        "tagname": "b4",
                        "productCount": 158
                    }
                ]
            }
        }
    }
]

2025-08-25 13:04:45,557 - evaluation_logger_Attraction-79 - INFO - Function Calls: 
[
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRjpQZaW6dZl"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRyFBtGdlpTy"
        }
    }
]

2025-08-25 13:04:45,557 - evaluation_logger_Attraction-79 - INFO - Golden Function Call: 
[
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRjpQZaW6dZl"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRyFBtGdlpTy"
        }
    }
]

2025-08-25 13:04:45,557 - evaluation_logger_Attraction-79 - INFO - Start compare_single_call: 
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRjpQZaW6dZl'}}
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRjpQZaW6dZl'}}
2025-08-25 13:04:45,557 - evaluation_logger_Attraction-79 - INFO - Rule-based compare success.
2025-08-25 13:04:45,557 - evaluation_logger_Attraction-79 - INFO - Start compare_single_call: 
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRyFBtGdlpTy'}}
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRyFBtGdlpTy'}}
2025-08-25 13:04:45,557 - evaluation_logger_Attraction-79 - INFO - Rule-based compare success.
2025-08-25 13:04:45,557 - evaluation_logger_Attraction-79 - INFO - Success matched: [{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRjpQZaW6dZl'}}, {'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRyFBtGdlpTy'}}]
2025-08-25 13:04:45,557 - evaluation_logger_Attraction-79 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "timestamp": 1729838539470,
        "data": [
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-31"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-31"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-23"
            }
        ]
    },
    {
        "status": true,
        "message": "Success",
        "timestamp": 1729838583714,
        "data": [
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-31"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-31"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-23"
            }
        ]
    }
]

2025-08-25 13:07:54,036 - evaluation_logger_Attraction-79 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 概述

本文，我们来分享 [MyBatis 的脚本模块](https://github.com/YunaiV/mybatis-3/tree/master/src/main/java/org/apache/ibatis/scripting)，对应 `scripting` 包。如下图所示：[![`scripting` 包](http://static.iocoder.cn/images/MyBatis/2020_02_12/01.png)](http://static.iocoder.cn/images/MyBatis/2020_02_12/01.png)`scripting` 包

在 [《精尽 MyBatis 源码解析 —— 项目结构一览》](http://svip.iocoder.cn/MyBatis/intro) 中，简单介绍了这个模块如下：

> 拼凑 SQL 语句是一件烦琐且易出错的过程，MyBatis 支持动态 SQL 功能，通过 MyBatis 提供的动态 SQL 语言，在 XML 映射文件中，通过灵活的表达式来拼凑 SQL 语句。

- 核心类请看：[`org.apache.ibatis.scripting.xmltags`](https://github.com/YunaiV/mybatis-3/tree/master/src/main/java/org/apache/ibatis/scripting/xmltags) 包。
- 语言驱动请看：[`org.apache.ibatis.scripting.defaults`](https://github.com/YunaiV/mybatis-3/tree/master/src/main/java/org/apache/ibatis/scripting/defaults) 和 [`org.apache.ibatis.scripting.language`](https://github.com/YunaiV/mybatis-3/tree/master/src/main/java/org/apache/ibatis/scripting/language) 包。

另外，`scripting` 模块中，还有 [`org.apache.ibatis.scripting.scripting`](https://github.com/YunaiV/mybatis-3/tree/master/src/main/java/org/apache/ibatis/scripting) 包，提供了**脚本**相关的**运行时**功能。

下面，我们就来看看具体的源码。因为 `scripting` 是 MyBatis 非常核心和复杂的一块，所以笔者会分成多篇文章，细细解析。

# 2. LanguageDriver

`org.apache.ibatis.scripting.LanguageDriver` ，语言驱动接口。代码如下：

```java
// LanguageDriver.java

public interface LanguageDriver {

    /**
     * Creates a {@link ParameterHandler} that passes the actual parameters to the the JDBC statement.
     *
     * 创建 ParameterHandler 对象。
     *
     * @param mappedStatement The mapped statement that is being executed
     * @param parameterObject The input parameter object (can be null)
     * @param boundSql The resulting SQL once the dynamic language has been executed.
     * @return the parameter handler
     * @see DefaultParameterHandler
     */
    ParameterHandler createParameterHandler(MappedStatement mappedStatement, Object parameterObject, BoundSql boundSql);

    /**
     * Creates an {@link SqlSource} that will hold the statement read from a mapper xml file.
     * It is called during startup, when the mapped statement is read from a class or an xml file.
     *
     * 创建 SqlSource 对象，从 Mapper XML 配置的 Statement 标签中，即 <select /> 等。
     *
     * @param configuration The MyBatis configuration
     * @param script XNode parsed from a XML file
     * @param parameterType input parameter type got from a mapper method or specified in the parameterType xml attribute. Can be null.
     * @return the sql source
     */
    SqlSource createSqlSource(Configuration configuration, XNode script, Class<?> parameterType);

    /**
     * Creates an {@link SqlSource} that will hold the statement read from an annotation.
     * It is called during startup, when the mapped statement is read from a class or an xml file.
     *
     * 创建 SqlSource 对象，从方法注解配置，即 @Select 等。
     *
     * @param configuration The MyBatis configuration
     * @param script The content of the annotation
     * @param parameterType input parameter type got from a mapper method or specified in the parameterType xml attribute. Can be null.
     * @return the sql source
     */
    SqlSource createSqlSource(Configuration configuration, String script, Class<?> parameterType);

}
```

- 一共有三个方法，具体看代码注释。

## 2.1 XMLLanguageDriver

`org.apache.ibatis.scripting.xmltags.XMLLanguageDriver` ，实现 LanguageDriver 接口，XML 语言驱动实现类。代码如下：

```java
// XMLLanguageDriver.java

public class XMLLanguageDriver implements LanguageDriver {

    @Override
    public ParameterHandler createParameterHandler(MappedStatement mappedStatement, Object parameterObject, BoundSql boundSql) {
        // 创建 DefaultParameterHandler 对象
        return new DefaultParameterHandler(mappedStatement, parameterObject, boundSql);
    }

    @Override
    public SqlSource createSqlSource(Configuration configuration, XNode script, Class<?> parameterType) {
        // 创建 XMLScriptBuilder 对象，执行解析
        XMLScriptBuilder builder = new XMLScriptBuilder(configuration, script, parameterType);
        return builder.parseScriptNode();
    }

    @Override
    public SqlSource createSqlSource(Configuration configuration, String script, Class<?> parameterType) {
        // 如果是 <script> 开头，使用 XML 配置的方式，使用动态 SQL 
        if (script.startsWith("<script>")) {
            // 创建 XPathParser 对象，解析出 <script /> 节点
            XPathParser parser = new XPathParser(script, false, configuration.getVariables(), null);
            return createSqlSource(configuration, parser.evalNode("/script"), parameterType);
        } else {
            // 如果是变量，则替换成对应的值
            // issue #127
            script = PropertyParser.parse(script, configuration.getVariables());
            // 创建 TextSqlNode 对象
            TextSqlNode textSqlNode = new TextSqlNode(script);
            // 如果是动态 SQL ，则创建 DynamicSqlSource 对象
            if (textSqlNode.isDynamic()) {
                return new DynamicSqlSource(configuration, textSqlNode);
            } else {
                // 如果非动态 SQL ，则创建 RawSqlSource 对象
                return new RawSqlSource(configuration, script, parameterType);
            }
        }
    }

}
```

- 对于 `#createSqlSource(Configuration configuration, String script, Class<?> parameterType)` 方法，胖友可以简单理解，就是注解上使用动态 SQL 的方式。例如：

  ```java
  @Update("<script>...<script>")
  ```

- 关于 XMLScriptBuilder 类，我们在后续的文章中，详细解析。

## 2.2 RawLanguageDriver

`org.apache.ibatis.scripting.defaults.RawLanguageDriver` ，继承 XMLLanguageDriver 类，**Raw** 语言驱动实现类。代码如下：

```java
// RawLanguageDriver.java

public class RawLanguageDriver extends XMLLanguageDriver {

    @Override
    public SqlSource createSqlSource(Configuration configuration, XNode script, Class<?> parameterType) {
        // 调用父类，创建 SqlSource 对象
        SqlSource source = super.createSqlSource(configuration, script, parameterType);
        // 创建 RawSqlSource 对象
        checkIsNotDynamic(source);
        return source;
    }

    @Override
    public SqlSource createSqlSource(Configuration configuration, String script, Class<?> parameterType) {
        // 调用父类，创建 SqlSource 对象
        SqlSource source = super.createSqlSource(configuration, script, parameterType);
        // 创建 RawSqlSource 对象
        checkIsNotDynamic(source);
        return source;
    }

    /**
     * 校验创建的 SqlSource 对象，非 DynamicSqlSource 类型
     *
     * @param source 创建的 SqlSource 对象
     */
    private void checkIsNotDynamic(SqlSource source) {
        if (!RawSqlSource.class.equals(source.getClass())) {
            throw new BuilderException("Dynamic content is not allowed when using RAW language");
        }
    }

}
```

- 从方法实现上，我们可以看出，RawLanguageDriver 会**校验**创建的 SqlSource 对象，**必须**是 RawSqlSource 类。也就是说，**不允许**使用动态 SQL 。所以，RawLanguageDriver 是 XMLLanguageDriver 的**限制**版本。

## 2.3 LanguageDriverRegistry

`org.apache.ibatis.scripting.LanguageDriverRegistry` ，LanguageDriver 注册表。代码如下：

```java
// LanguageDriverRegistry.java

public class LanguageDriverRegistry {

    /**
     * LanguageDriver 映射
     */
    private final Map<Class<? extends LanguageDriver>, LanguageDriver> LANGUAGE_DRIVER_MAP = new HashMap<>();
    /**
     * 默认的 LanguageDriver 类
     */
    private Class<? extends LanguageDriver> defaultDriverClass;

    public void register(Class<? extends LanguageDriver> cls) {
        if (cls == null) {
            throw new IllegalArgumentException("null is not a valid Language Driver");
        }
        // 创建 cls 对应的对象，并添加到 LANGUAGE_DRIVER_MAP 中
        if (!LANGUAGE_DRIVER_MAP.containsKey(cls)) {
            try {
                LANGUAGE_DRIVER_MAP.put(cls, cls.newInstance());
            } catch (Exception ex) {
                throw new ScriptingException("Failed to load language driver for " + cls.getName(), ex);
            }
        }
    }

    public void register(LanguageDriver instance) {
        if (instance == null) {
            throw new IllegalArgumentException("null is not a valid Language Driver");
        }
        // 添加到 LANGUAGE_DRIVER_MAP 中
        Class<? extends LanguageDriver> cls = instance.getClass();
        if (!LANGUAGE_DRIVER_MAP.containsKey(cls)) {
            LANGUAGE_DRIVER_MAP.put(cls, instance);
        }
    }

    public LanguageDriver getDriver(Class<? extends LanguageDriver> cls) {
        return LANGUAGE_DRIVER_MAP.get(cls);
    }

    public LanguageDriver getDefaultDriver() {
        return getDriver(getDefaultDriverClass());
    }

    public Class<? extends LanguageDriver> getDefaultDriverClass() {
        return defaultDriverClass;
    }

    /**
     * 设置 {@link #defaultDriverClass}
     *
     * @param defaultDriverClass 默认的 LanguageDriver 类
     */
    public void setDefaultDriverClass(Class<? extends LanguageDriver> defaultDriverClass) {
        // 注册到 LANGUAGE_DRIVER_MAP 中
        register(defaultDriverClass);
        // 设置 defaultDriverClass
        this.defaultDriverClass = defaultDriverClass;
    }

}
```

- 比较简单，胖友自己瞅瞅。

在 Configuration 中，相关代码如下：

```java
// Configuration.java

/**
 * LanguageDriverRegistry 对象
 */
protected final LanguageDriverRegistry languageRegistry = new LanguageDriverRegistry();

public LanguageDriverRegistry getLanguageRegistry() {
    return languageRegistry;
}

public void setDefaultScriptingLanguage(Class<? extends LanguageDriver> driver) {
    // 设置默认的 LanguageDriver 类
    languageRegistry.setDefaultDriverClass(driver);
}
```

- 在 `org.apache.ibatis.session.Configuration` 的构造方法中，会进行初始化。代码如下：

  ```java
  // Configuration.java
  
  public Configuration() {
      // ...
      // 注册默认的 LanguageDriver 类
      languageRegistry.setDefaultDriverClass(XMLLanguageDriver.class);
      languageRegistry.register(RawLanguageDriver.class);
  }
  ```

# 3. SqlSource

`org.apache.ibatis.mapping.SqlSource` ，SQL 来源接口。它代表从 Mapper XML 或方法注解上，读取的 SQL 内容。代码如下：

```java
// SqlSource.java

public interface SqlSource {

    /**
     * 根据传入的参数对象，返回 BoundSql 对象
     *
     * @param parameterObject 参数对象
     * @return BoundSql 对象
     */
    BoundSql getBoundSql(Object parameterObject);

}
```

## 3.1 DynamicSqlSource

`org.apache.ibatis.scripting.xmltags.DynamicSqlSource` ，实现 SqlSource 接口，**动态**的 SqlSource 实现类。代码如下：

```java
// DynamicSqlSource.java

public class DynamicSqlSource implements SqlSource {

    private final Configuration configuration;
    private final SqlNode rootSqlNode;

    public DynamicSqlSource(Configuration configuration, SqlNode rootSqlNode) {
        this.configuration = configuration;
        this.rootSqlNode = rootSqlNode;
    }

    @Override
    public BoundSql getBoundSql(Object parameterObject) {
        // 创建 DynamicContext 对象
        DynamicContext context = new DynamicContext(configuration, parameterObject);
        // 解析出 SqlSource 对象
        rootSqlNode.apply(context);
        // 创建 SqlSourceBuilder 对象
        SqlSourceBuilder sqlSourceParser = new SqlSourceBuilder(configuration);
        // 解析出 SqlSource 对象
        Class<?> parameterType = parameterObject == null ? Object.class : parameterObject.getClass();
        SqlSource sqlSource = sqlSourceParser.parse(context.getSql(), parameterType, context.getBindings());
        // 获得 BoundSql 对象
        BoundSql boundSql = sqlSource.getBoundSql(parameterObject);
        // 添加附加参数到 BoundSql 中
        for (Map.Entry<String, Object> entry : context.getBindings().entrySet()) {
            boundSql.setAdditionalParameter(entry.getKey(), entry.getValue());
        }
        return boundSql;
    }

}
```

- 关于 SqlNode 相关类，我们在后续的文章中，详细解析。在这里，胖友只需要知道，通过 `rootSqlNode.apply(context)` 方法，可以生成 SQL 。生成的 SQL ，

  ```sql
  SELECT * FROM subject WHERE id = #{id}
  ```

  - 注意，此时的 SQL 中，可能还包含 `#{}` 表达式，或者 `${}` 表达式。所以，需要继续使用 SqlSourceBuilder 进行解析，获得 SqlSource 对象。
  - 也就是说，DynamicSqlSource 的**动态**，体现在，每次都需要根据参数，**动态**生成 SQL 和 `#{}` 表达式，或者 `${}` 表达式。

- 关于 SqlSourceBuilder 类，在 [「4. SqlSourceBuilder」](http://svip.iocoder.cn/MyBatis/scripting-1/#) 中详细解析。

## 3.2 RawSqlSource

`org.apache.ibatis.scripting.xmltags.RawSqlSource` ，实现 SqlSource 接口，**原始**的 SqlSource 实现类。代码如下：

```java
// RawSqlSource.java

public class RawSqlSource implements SqlSource {

    private final SqlSource sqlSource;

    public RawSqlSource(Configuration configuration, String sql, Class<?> parameterType) {
        // 创建 SqlSourceBuilder 对象
        SqlSourceBuilder sqlSourceParser = new SqlSourceBuilder(configuration);
        // 获得 SqlSource 对象
        Class<?> clazz = parameterType == null ? Object.class : parameterType;
        sqlSource = sqlSourceParser.parse(sql, clazz, null);
    }

    public RawSqlSource(Configuration configuration, String sql, Class<?> parameterType, boolean dynamic) {
        // 创建 SqlSourceBuilder 对象
        SqlSourceBuilder sqlSourceParser = new SqlSourceBuilder(configuration);
        // 解析出 SqlSource 对象
        Class<?> clazz = parameterType == null ? Object.class : parameterType;
        SqlSource sqlSource = sqlSourceParser.parse(sql, clazz, null);
    }

    @Override
    public BoundSql getBoundSql(Object parameterObject) {
        return sqlSource.getBoundSql(parameterObject);
    }

}
```

- 从构造方法中，我们可以发现，RawSqlSource 是基于 SqlSourceBuilder 进行构建的。而 SqlSourceBuilder 的 `#parse(String sql, Class<?> parameterType, Map<String, Object> additionalParameters)` 方法，返回的是 StaticSqlSource 对象。所以，`sqlSource` 属性，是 StaticSqlSource 类型。
- 也就是说，RawSqlSource 的**原始**，体现在，SQL 是**静态**的，**不需要**每次执行时，都**动态**生成。

## 3.3 StaticSqlSource

`org.apache.ibatis.builder.StaticSqlSource` ，实现 SqlSource 接口，**静态**的 SqlSource 实现类。代码如下：

```java
// StaticSqlSource.java

public class StaticSqlSource implements SqlSource {

    /**
     * 静态的 SQL
     */
    private final String sql;
    /**
     * 参数列表
     */
    private final List<ParameterMapping> parameterMappings;
    private final Configuration configuration;

    public StaticSqlSource(Configuration configuration, String sql) {
        this(configuration, sql, null);
    }

    public StaticSqlSource(Configuration configuration, String sql, List<ParameterMapping> parameterMappings) {
        this.sql = sql;
        this.parameterMappings = parameterMappings;
        this.configuration = configuration;
    }

    @Override
    public BoundSql getBoundSql(Object parameterObject) {
        // 创建 BoundSql 对象
        return new BoundSql(configuration, sql, parameterMappings, parameterObject);
    }

}
```

- 从实现上，我们可以看出，StaticSqlSource 的 SQL 是**静态**的，**不需要**进行任何动态处理。并且，`#getBoundSql(Object parameterObject)` 方法，是直接创建 BoundSql 对象。也就是说，SQL 字符串中，已经没有 `#{}` 表达式，或者 `${}` 表达式，已经被替换成 `?` 占位符。

## 3.4 ProviderSqlSource

`org.apache.ibatis.scripting.defaults.ProviderSqlSource` ，实现 SqlSource 接口，基于方法上的 `@ProviderXXX` 注解的 SqlSource 实现类。代码如下：

```java
// ProviderSqlSource.java

public class ProviderSqlSource implements SqlSource {

    private final Configuration configuration;
    private final SqlSourceBuilder sqlSourceParser;
    /**
     * `@ProviderXXX` 注解的对应的类
     */
    private final Class<?> providerType;
    private final Method providerMethod;
    /**
     * `@ProviderXXX` 注解的对应的方法
     */
    private final String[] providerMethodArgumentNames;
    /**
     * `@ProviderXXX` 注解的对应的方法的参数类型
     */
    private final Class<?>[] providerMethodParameterTypes;
    /**
     * 提供的语言驱动
     */
    private final LanguageDriver languageDriver;

    /**
     * @deprecated Please use the {@link #ProviderSqlSource(Configuration, Object, Class, Method)} instead.
     */
    @Deprecated
    public ProviderSqlSource(Configuration configuration, Object provider) {
        this(configuration, provider, null, null);
    }

    /**
     * @deprecated Please use the {@link #ProviderSqlSource(Configuration, Object, Class, Method)} instead

2025-08-25 13:07:59,486 - evaluation_logger_Attraction-79 - INFO - Complete Result: {'score': 0, 'reason': 'The response does not address any of the requested information about ticket availability for attractions in Copenhagen.'}
2025-08-25 13:08:06,053 - evaluation_logger_Attraction-79 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 13:08:06,053 - evaluation_logger_Attraction-79 - INFO - Message: Success.
2025-08-25 13:08:06,053 - evaluation_logger_Attraction-79 - INFO - Success turn num = 3
2025-08-25 13:08:06,053 - evaluation_logger_Attraction-79 - INFO - ----------------------------------------------------------------------------------------------------
