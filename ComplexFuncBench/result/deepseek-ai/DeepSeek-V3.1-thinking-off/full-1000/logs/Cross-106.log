2025-08-25 11:46:18,510 - evaluation_logger_Cross-106 - INFO - Test Example Cross-106
2025-08-25 11:46:18,510 - evaluation_logger_Cross-106 - INFO - Query: My two friends and I are planning to have a party in Beverly Hills, Los Angeles, on November 15, 2024. Recommend the most popular hotel there for us. For easy travel, we need to rent a car, hoping to pick it up at 8 am on the 15th near the party hotel and return it at 4 pm the next day at the same location.
2025-08-25 11:46:29,424 - evaluation_logger_Cross-106 - INFO - Function Calls: 
[
    {
        "name": "Search_Hotel_Destination",
        "arguments": {
            "query": "Beverly Hills, Los Angeles"
        }
    }
]

2025-08-25 11:46:29,424 - evaluation_logger_Cross-106 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Hotel_Destination",
        "arguments": {
            "query": "Beverly Hills, Los Angeles"
        }
    },
    {
        "name": "Search_Hotels",
        "arguments": {
            "dest_id": 1930,
            "search_type": "district",
            "arrival_date": "2024-11-15",
            "departure_date": "2024-11-16",
            "adults": 3,
            "sort_by": "popularity"
        }
    }
]

2025-08-25 11:46:29,424 - evaluation_logger_Cross-106 - INFO - Start compare_single_call: 
{'name': 'Search_Hotel_Destination', 'arguments': {'query': 'Beverly Hills, Los Angeles'}}
{'name': 'Search_Hotel_Destination', 'arguments': {'query': 'Beverly Hills, Los Angeles'}}
2025-08-25 11:46:29,424 - evaluation_logger_Cross-106 - INFO - Rule-based compare success.
2025-08-25 11:46:29,424 - evaluation_logger_Cross-106 - INFO - Success matched: [{'name': 'Search_Hotel_Destination', 'arguments': {'query': 'Beverly Hills, Los Angeles'}}]
2025-08-25 11:46:29,425 - evaluation_logger_Cross-106 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": [
            {
                "dest_id": "1930",
                "search_type": "district",
                "cc1": "us",
                "lc": "en",
                "label": "Beverly Hills, Los Angeles, California, United States",
                "region": "California",
                "city_name": "Los Angeles",
                "nr_hotels": 182,
                "longitude": -118.40395,
                "dest_type": "district",
                "latitude": 34.082687,
                "hotels": 182,
                "country": "United States",
                "type": "di",
                "roundtrip": "GgEwIAAoATICZW46GkJldmVybHkgSGlsbHMsIExvcyBBbmdlbGVzQABKAFAA",
                "name": "Beverly Hills",
                "city_ufi": 20014181
            }
        ]
    }
]

2025-08-25 11:46:40,743 - evaluation_logger_Cross-106 - INFO - Function Calls: 
[
    {
        "name": "Search_Hotels",
        "arguments": {
            "dest_id": 1930,
            "search_type": "district",
            "arrival_date": "2024-11-15",
            "departure_date": "2024-11-16",
            "adults": 3,
            "sort_by": "popularity"
        }
    }
]

2025-08-25 11:46:40,743 - evaluation_logger_Cross-106 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Hotels",
        "arguments": {
            "adults": 3,
            "arrival_date": "2024-11-15",
            "departure_date": "2024-11-16",
            "dest_id": 1930,
            "search_type": "district",
            "sort_by": "popularity"
        }
    },
    {
        "name": "Search_Car_Rentals",
        "arguments": {
            "pick_up_latitude": 34.063869,
            "pick_up_longitude": -118.368036,
            "drop_off_latitude": 34.063869,
            "drop_off_longitude": -118.368036,
            "pick_up_date": "2024-11-15",
            "drop_off_date": "2024-11-16",
            "pick_up_time": "08:00",
            "drop_off_time": "16:00"
        }
    }
]

2025-08-25 11:46:40,743 - evaluation_logger_Cross-106 - INFO - Start compare_single_call: 
{'name': 'Search_Hotels', 'arguments': {'adults': 3, 'arrival_date': '2024-11-15', 'departure_date': '2024-11-16', 'dest_id': 1930, 'search_type': 'district', 'sort_by': 'popularity'}}
{'name': 'Search_Hotels', 'arguments': {'adults': 3, 'arrival_date': '2024-11-15', 'departure_date': '2024-11-16', 'dest_id': 1930, 'search_type': 'district', 'sort_by': 'popularity'}}
2025-08-25 11:46:40,743 - evaluation_logger_Cross-106 - INFO - Rule-based compare success.
2025-08-25 11:46:40,743 - evaluation_logger_Cross-106 - INFO - Success matched: [{'name': 'Search_Hotels', 'arguments': {'adults': 3, 'arrival_date': '2024-11-15', 'departure_date': '2024-11-16', 'dest_id': 1930, 'search_type': 'district', 'sort_by': 'popularity'}}]
2025-08-25 11:46:40,744 - evaluation_logger_Cross-106 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "hotels": [
                {
                    "hotel_id": 3712675,
                    "accessibilityLabel": "AC Hotel by Marriott Beverly Hills.\n4 out of 5 stars.\n7.9 Good 342 reviews.\n‎2.2 km from centre‬.\n Hotel room : 2 beds.\n347 USD.\nIncludes taxes and charges.",
                    "property": {
                        "optOutFromGalleryChanges": 0,
                        "rankingPosition": 7,
                        "reviewScore": 7.9,
                        "checkinDate": "2024-11-15",
                        "position": 7,
                        "name": "AC Hotel by Marriott Beverly Hills",
                        "ufi": 20014181,
                        "accuratePropertyClass": 4,
                        "checkoutDate": "2024-11-16",
                        "wishlistName": "Los Angeles",
                        "longitude": -118.368036,
                        "blockIds": [
                            "371267503_119834766_4_34_0"
                        ],
                        "latitude": 34.063869,
                        "currency": "USD",
                        "id": 3712675,
                        "checkin": {
                            "untilTime": "00:00",
                            "fromTime": "16:00"
                        },
                        "countryCode": "us",
                        "mainPhotoId": 525271793,
                        "reviewCount": 342,
                        "reviewScoreWord": "Good",
                        "checkout": {
                            "untilTime": "11:00",
                            "fromTime": "00:00"
                        },
                        "qualityClass": 0,
                        "priceBreakdown": {
                            "grossPrice": {
                                "value": 346.6304,
                                "currency": "USD"
                            }
                        },
                        "isFirstPage": true,
                        "isPreferred": true,
                        "propertyClass": 4
                    }
                }
            ],
            "meta": [
                {
                    "title": "32 properties"
                }
            ],
            "appear": [
                {
                    "id": "cma",
                    "component": {
                        "props": {
                            "fill": true,
                            "content": {
                                "props": {
                                    "fitContentWidth": true,
                                    "items": [
                                        {
                                            "props": {
                                                "component": {
                                                    "props": {
                                                        "spacing": "spacing_half",
                                                        "items": [
                                                            {
                                                                "props": {
                                                                    "text": [
                                                                        {
                                                                            "text": "Commission paid and other benefits may affect an accommodation's ranking.",
                                                                            "font": "body_2"
                                                                        },
                                                                        {
                                                                            "color": "foreground",
                                                                            "text": "  ",
                                                                            "font": "strong_2"
                                                                        },
                                                                        {
                                                                            "linkActions": [
                                                                                {}
                                                                            ],
                                                                            "font": "body_2",
                                                                            "color": "action_foreground",
                                                                            "text": "Find out more"
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                }
                                            }
                                        },
                                        {},
                                        {
                                            "props": {
                                                "component": {
                                                    "props": {
                                                        "icon": "close",
                                                        "accessibilityLabel": "Close",
                                                        "tertiaryTintedColor": "foreground",
                                                        "variant": "tertiary_tinted"
                                                    }
                                                }
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    }
                },
                {},
                {
                    "id": "signin_now",
                    "component": {
                        "props": {
                            "text": "Get instant access to our Genius loyalty programme and enjoy discounts at properties worldwide.",
                            "title": "Sign in and save money"
                        }
                    }
                },
                {
                    "component": {
                        "props": {
                            "text": "Properties with these icons have been awarded Booking.com's quality rating for homes"
                        }
                    },
                    "id": "banner_qualityrating"
                }
            ]
        }
    }
]

2025-08-25 11:46:54,783 - evaluation_logger_Cross-106 - INFO - Function Calls: 
[
    {
        "name": "Search_Car_Rentals",
        "arguments": {
            "pick_up_latitude": 34.063869,
            "pick_up_longitude": -118.368036,
            "drop_off_latitude": 34.063869,
            "drop_off_longitude": -118.368036,
            "pick_up_date": "2024-11-15",
            "drop_off_date": "2024-11-16",
            "pick_up_time": "08:00",
            "drop_off_time": "16:00"
        }
    }
]

2025-08-25 11:46:54,783 - evaluation_logger_Cross-106 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Car_Rentals",
        "arguments": {
            "drop_off_date": "2024-11-16",
            "drop_off_latitude": 34.063869,
            "drop_off_longitude": -118.368036,
            "drop_off_time": "16:00",
            "pick_up_date": "2024-11-15",
            "pick_up_latitude": 34.063869,
            "pick_up_longitude": -118.368036,
            "pick_up_time": "08:00"
        }
    }
]

2025-08-25 11:46:54,783 - evaluation_logger_Cross-106 - INFO - Start compare_single_call: 
{'name': 'Search_Car_Rentals', 'arguments': {'drop_off_date': '2024-11-16', 'drop_off_latitude': 34.063869, 'drop_off_longitude': -118.368036, 'drop_off_time': '16:00', 'pick_up_date': '2024-11-15', 'pick_up_latitude': 34.063869, 'pick_up_longitude': -118.368036, 'pick_up_time': '08:00'}}
{'name': 'Search_Car_Rentals', 'arguments': {'drop_off_date': '2024-11-16', 'drop_off_latitude': 34.063869, 'drop_off_longitude': -118.368036, 'drop_off_time': '16:00', 'pick_up_date': '2024-11-15', 'pick_up_latitude': 34.063869, 'pick_up_longitude': -118.368036, 'pick_up_time': '08:00'}}
2025-08-25 11:46:54,783 - evaluation_logger_Cross-106 - INFO - Rule-based compare success.
2025-08-25 11:46:54,783 - evaluation_logger_Cross-106 - INFO - Success matched: [{'name': 'Search_Car_Rentals', 'arguments': {'drop_off_date': '2024-11-16', 'drop_off_latitude': 34.063869, 'drop_off_longitude': -118.368036, 'drop_off_time': '16:00', 'pick_up_date': '2024-11-15', 'pick_up_latitude': 34.063869, 'pick_up_longitude': -118.368036, 'pick_up_time': '08:00'}}]
2025-08-25 11:46:54,784 - evaluation_logger_Cross-106 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "title": "Car rentals",
            "count": 33,
            "provider": "rentalcars",
            "sort": [
                {
                    "name": "Recommended – best first",
                    "title_tag": "tr.searchresults.sortBy.recommended",
                    "identifier": "recommended"
                },
                {
                    "identifier": "price_low_to_high",
                    "title_tag": "tr.searchresults.sortBy.price.lowHigh",
                    "name": "Price - lowest first"
                },
                {
                    "identifier": "review_score",
                    "name": "Review score - highest first",
                    "title_tag": "tr.searchresults.sortBy.reviews.highLow"
                }
            ],
            "search_key": "eyJkcml2ZXJzQWdlIjozMCwiZHJvcE9mZkRhdGVUaW1lIjoiMjAyNC0xMS0xNlQxNjowMDowMCIsImRyb3BPZmZMb2NhdGlvbiI6IjM0LjA2Mzg2OSwtMTE4LjM2ODAzNiIsImRyb3BPZmZMb2NhdGlvblR5cGUiOiJMQVRMT05HIiwicGlja1VwRGF0ZVRpbWUiOiIyMDI0LTExLTE1VDA4OjAwOjAwIiwicGlja1VwTG9jYXRpb24iOiIzNC4wNjM4NjksLTExOC4zNjgwMzYiLCJwaWNrVXBMb2NhdGlvblR5cGUiOiJMQVRMT05HIiwicmVudGFsRHVyYXRpb25JbkRheXMiOjIsInNlcnZpY2VGZWF0dXJlcyI6WyJOT19PUEFRVUVTIiwiU1VQUkVTU19GSVhFRF9QUklDRV9WRUhJQ0xFUyIsIklOQ0xVREVfUFJPRFVDVF9SRUxBVElPTlNISVBTIiwiSU5DTFVERV9FWFRSQVNfQ09OVEFJTklOR19GRUVTIl19",
            "meta": {
                "response_code": 200
            },
            "filter": [
                {
                    "layout": {
                        "is_collapsed": "false",
                        "collapsed_count": 2,
                        "layout_type": "list",
                        "is_collapsable": "false"
                    },
                    "type": "multiple_union",
                    "categories": [
                        {
                            "count": 10,
                            "id": "depotLocationType::IN_TERMINAL",
                            "name": "Airport (in terminal)",
                            "nameWithCount": "Airport (in terminal) (10)"
                        },
                        {
                            "count": 23,
                            "id": "depotLocationType::CAR_RENTAL_CENTRE",
                            "nameWithCount": "Airport (car rental centre) (23)",
                            "name": "Airport (car rental centre)"
                        }
                    ],
                    "id": "depotLocationType",
                    "title": "Location"
                },
                {
                    "layout": {
                        "is_collapsed": "true",
                        "collapsed_count": 5,
                        "is_collapsable": "true",
                        "layout_type": "list"
                    },
                    "type": "multiple_union",
                    "id": "carCategory",
                    "categories": [
                        {
                            "name": "Small",
                            "nameWithCount": "Small (2)",
                            "id": "carCategory::small",
                            "count": 2
                        },
                        {
                            "id": "carCategory::medium",
                            "count": 10,
                            "name": "Medium",
                            "nameWithCount": "Medium (10)"
                        },
                        {
                            "name": "Large",
                            "nameWithCount": "Large (25)",
                            "id": "carCategory::large",
                            "count": 25
                        },
                        {
                            "nameWithCount": "Premium (9)",
                            "name": "Premium",
                            "count": 9,
                            "id": "carCategory::premium"
                        },
                        {
                            "id": "carCategory::carriers",
                            "count": 3,
                            "nameWithCount": "People carriers (3)",
                            "name": "People carriers"
                        }
                    ],
                    "title": "Car Type"
                },
                {
                    "layout": {
                        "collapsed_count": 5,
                        "is_collapsed": "false",
                        "is_collapsable": "false",
                        "layout_type": "list"
                    },
                    "type": "multiple_union",
                    "title": "Price per day",
                    "id": "pricePerDayBuckets",
                    "categories": [
                        {
                            "nameWithCount": "US$0 - US$50 (0)",
                            "name": "US$0 - US$50",
                            "id": "pricePerDayBuckets::BUCKET_1",
                            "count": 0
                        },
                        {
                            "nameWithCount": "US$50 - US$100 (23)",
                            "name": "US$50 - US$100",
                            "count": 23,
                            "id": "pricePerDayBuckets::BUCKET_2"
                        },
                        {
                            "nameWithCount": "US$100 - US$150 (9)",
                            "name": "US$100 - US$150",
                            "count": 9,
                            "id": "pricePerDayBuckets::BUCKET_3"
                        },
                        {
                            "id": "pricePerDayBuckets::BUCKET_4",
                            "count": 1,
                            "name": "US$150 - US$200",
                            "nameWithCount": "US$150 - US$200 (1)"
                        },
                        {
                            "id": "pricePerDayBuckets::BUCKET_5",
                            "count": 0,
                            "name": "US$200+",
                            "nameWithCount": "US$200+ (0)"
                        }
                    ]
                },
                {
                    "title": "Supplier",
                    "id": "supplier",
                    "categories": [
                        {
                            "name": "Avis",
                            "nameWithCount": "Avis (11)",
                            "count": 11,
                            "id": "supplier::Avis"
                        },
                        {
                            "nameWithCount": "Europcar (12)",
                            "name": "Europcar",
                            "id": "supplier::Europcar",
                            "count": 12
                        },
                        {
                            "name": "Hertz",
                            "nameWithCount": "Hertz (10)",
                            "count": 10,
                            "id": "supplier::Hertz"
                        }
                    ],
                    "type": "multiple_union",
                    "layout": {
                        "layout_type": "list",
                        "is_collapsable": "true",
                        "is_collapsed": "true",
                        "collapsed_count": 5
                    }
                },
                {
                    "type": "multiple_union",
                    "layout": {
                        "layout_type": "list",
                        "is_collapsable": "true",
                        "collapsed_count": 5,
                        "is_collapsed": "true"
                    },
                    "categories": [
                        {
                            "name": "Automatic",
                            "nameWithCount": "Automatic (33)",
                            "id": "transmission::AUTOMATIC",
                            "count": 33
                        }
                    ],
                    "id": "transmission",
                    "title": "Transmission"
                }
            ],
            "is_genius_location": false,
            "search_results": [
                {
                    "vehicle_id": "637360656",
                    "route_info": {
                        "dropoff": {
                            "longitude": "-118.348891",
                            "location_type": "IN_TERMINAL",
                            "location_id": "3887426",
                            "latitude": "34.195803",
                            "address": "2627, North Hollywood Way, Burbank, USA, 91505",
                            "country_code": "US",
                            "location_hash": "SG9sbHl3b29kIEJ1cmJhbmsgQWlycG9ydA==",
                            "name": "Hollywood Burbank Airport"
                        },
                        "pickup": {
                            "longitude": "-118.348891",
                            "name": "Hollywood Burbank Airport",
                            "location_hash": "SG9sbHl3b29kIEJ1cmJhbmsgQWlycG9ydA==",
                            "location_id": "3887426",
                            "address": "2627, North Hollywood Way, Burbank, USA, 91505",
                            "latitude": "34.195803",
                            "country_code": "US",
                            "location_type": "IN_TERMINAL"
                        }
                    },
                    "supplier_info": {
                        "location_type": "In Terminal",
                        "address": "2627, North Hollywood Way, Burbank, USA, 91505",
                        "latitude": "34.195803",
                        "pickup_instructions": "-",
                        "may_require_credit_card_guarantee": false,
                        "name": "Hertz",
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/137_logo_200.png",
                        "dropoff_instructions": "-",
                        "longitude": "-118.348891"
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "fee_info": {
                        "tax": 0,
                        "fee": 0
                    },
                    "rating_info": {
                        "dropoff_time": 9.1,
                        "cleanliness": 7.2,
                        "average": 7.6,
                        "pickup_time": 7.5,
                        "value_for_money": 8,
                        "no_of_ratings": 26,
                        "location": 7.1,
                        "condition": 7.5,
                        "average_text": "Very good",
                        "efficiency": 7.3
                    },
                    "content": {
                        "supplier": {
                            "name": "Hertz",
                            "rating": {
                                "average": "7.6",
                                "subtitle": "26 reviews",
                                "localisedRating": {
                                    "rawValue": 7.6,
                                    "displayValue": "7.6"
                                },
                                "title": "Good"
                            }
                        },
                        "badges": [
                            {
                                "text": "Free cancellation",
                                "type": "CONSTRUCTIVE",
                                "variation": "DEFAULT"
                            }
                        ]
                    },
                    "pricing_info": {
                        "drive_away_price_is_approx": true,
                        "deposit": 108.18,
                        "base_currency": "INR",
                        "base_price": 9098.79,
                        "price": 108.18,
                        "currency": "USD",
                        "base_deposit": 9098.79,
                        "discount": 0,
                        "drive_away_price": 108.18,
                        "quote_allowed": 1,
                        "fee_breakdown": {
                            "fuel_policy": {
                                "type": "RETURN_SAME",
                                "amount": 0
                            },
                            "known_fees": [
                                {
                                    "max_amount": 0,
                                    "min_amount": 0,
                                    "amount": 0,
                                    "is_tax_included": 1,
                                    "currency": "USD",
                                    "type": "THEFT_EXCESS",
                                    "is_always_payable": 0
                                },
                                {
                                    "is_tax_included": 1,
                                    "currency": "USD",
                                    "type": "DEPOSIT",
                                    "is_always_payable": 0,
                                    "amount": 640.96,
                                    "min_amount": 256.38,
                                    "max_amount": 640.96
                                },
                                {
                                    "is_tax_included": 1,
                                    "currency": "USD",
                                    "type": "DAMAGE_EXCESS",
                                    "is_always_payable": 0,
                                    "min_amount": 0,
                                    "amount": 0,
                                    "max_amount": 0
                                },
                                {
                                    "type": "MILEAGE",
                                    "is_always_payable": 0,
                                    "distance_allowed": {
                                        "is_km": 0,
                                        "is_unlimited": 1
                                    }
                                }
                            ]
                        },
                        "pay_when": "PAY_NOW"
                    },
                    "accessibility": {
                        "pick_up_location": "Pick-up information: In Terminal",
                        "transmission": "Automatic gearbox",
                        "fuel_policy": "Fuel policy is: Like for like",
                        "supplier_rating": "At this location, our customers have rated Hertz as 7.6 out of 10, Good."
                    },
                    "vehicle_info": {
                        "mileage": "Unlimited mileage",
                        "label": "Intermediate car with:",
                        "seats": "5",
                        "cma_compliant": -1,
                        "aircon": 1,
                        "v_name": "Toyota Corolla",
                        "suitcases": {
                            "small": "3",
                            "big": "0"
                        },
                        "doors": "2/4",
                        "fuel_policy": "Like for like",
                        "fuel_type": "N/A",
                        "transmission": "Automatic",
                        "v_id": "637360656",
                        "free_cancellation": 1,
                        "unlimited_mileage": 1,
                        "group": "Intermediate",
                        "airbags": 1
                    }
                },
                {
                    "vehicle_id": "613820236",
                    "content": {
                        "supplier": {
                            "rating": {
                                "localisedRating": {
                                    "rawValue": 7.6,
                                    "displayValue": "7.6"
                                },
                                "title": "Good",
                                "subtitle": "26 reviews",
                                "average": "7.6"
                            },
                            "name": "Hertz"
                        },
                        "badges": [
                            {
                                "variation": "DEFAULT",
                                "type": "CONSTRUCTIVE",
                                "text": "Free cancellation"
                            }
                        ]
                    },
                    "rating_info": {
                        "average_text": "Very good",
                        "efficiency": 7.3,
                        "condition": 7.5,
                        "location": 7.1,
                        "no_of_ratings": 26,
                        "value_for_money": 8,
                        "pickup_time": 7.5,
                        "average": 7.6,
                        "cleanliness": 7.2,
                        "dropoff_time": 9.1
                    },
                    "fee_info": {
                        "fee": 0,
                        "tax": 0
                    },
                    "accessibility": {
                        "fuel_policy": "Fuel policy is: Like for like",
                        "supplier_rating": "At this location, our customers have rated Hertz as 7.6 out of 10, Good.",
                        "pick_up_location": "Pick-up information: In Terminal",
                        "transmission": "Automatic gearbox"
                    },
                    "vehicle_info": {
                        "doors": "4",
                        "suitcases": {
                            "big": "0",
                            "small": "4"
                        },
                        "v_name": "Nissan Rogue  ",
                        "aircon": 1,
                        "cma_compliant": -1,
                        "seats": "5",
                        "label": "Intermediate car with:",
                        "mileage": "Unlimited mileage",
                        "airbags": 1,
                        "group": "Intermediate",
                        "unlimited_mileage": 1,
                        "free_cancellation": 1,
                        "v_id": "613820236",
                        "transmission": "Automatic",
                        "fuel_type": "N/A",
                        "fuel_policy": "Like for like"
                    },
                    "pricing_info": {
                        "pay_when": "PAY_NOW",
                        "drive_away_price": 130.91,
                        "quote_allowed": 1,
                        "fee_breakdown": {
                            "fuel_policy": {
                                "amount": 0,
                                "type": "RETURN_SAME"
                            },
                            "known_fees": [
                                {
                                    "is_always_payable": 0,
                                    "currency": "USD",
                                    "type": "THEFT_EXCESS",
                                    "is_tax_included": 1,
                                    "max_amount": 0,
                                    "amount": 0,
                                    "min_amount": 0
                                },
                                {
                                    "currency": "USD",
                                    "type": "DEPOSIT",
                                    "is_tax_included": 1,
                                    "is_always_payable": 0,
                                    "min_amount": 256.38,
                                    "amount": 640.96,
                                    "max_amount": 640.96
                                },
                                {
                                    "max_amount": 0,
                                    "amount": 0,
                                    "min_amount": 0,
                                    "is_tax_included": 1,
                                    "currency": "USD",
                                    "type": "DAMAGE_EXCESS",
                                    "is_always_payable": 0
                                },
                                {
                                    "type": "MILEAGE",
                                    "is_always_payable": 0,
                                    "distance_allowed": {
                                        "is_km": 0,
                                        "is_unlimited": 1
                                    }
                                }
                            ]
                        },
                        "discount": 0,
                        "base_deposit": 11010.4,
                        "deposit": 130.91,
                        "drive_away_price_is_approx": true,
                        "base_currency": "INR",
                        "base_price": 11010.4,
                        "price": 130.91,
                        "currency": "USD"
                    },
                    "route_info": {
                        "dropoff": {
                            "longitude": "-118.348891",
                            "name": "Hollywood Burbank Airport",
                            "location_hash": "SG9sbHl3b29kIEJ1cmJhbmsgQWlycG9ydA==",
                            "latitude": "34.195803",
                            "address": "2627, North Hollywood Way, Burbank, USA, 91505",
                            "country_code": "US",
                            "location_id": "3887426",
                            "location_type": "IN_TERMINAL"
                        },
                        "pickup": {
                            "location_type": "IN_TERMINAL",
                            "address": "2627, North Hollywood Way, Burbank, USA, 91505",
                            "latitude": "34.195803",
                            "country_code": "US",
                            "location_id": "3887426",
                            "location_hash": "SG9sbHl3b29kIEJ1cmJhbmsgQWlycG9ydA==",
                            "name": "Hollywood Burbank Airport",
                            "longitude": "-118.348891"
                        }
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "supplier_info": {
                        "dropoff_instructions": "-",
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/137_logo_200.png",
                        "longitude": "-118.348891",
                        "latitude": "34.195803",
                        "address": "2627, North Hollywood Way, Burbank, USA, 91505",
                        "location_type": "In Terminal",
                        "name": "Hertz",
                        "pickup_instructions": "-",
                        "may_require_credit_card_guarantee": false
                    }
                },
                {
                    "vehicle_id": "637382406",
                    "content": {
                        "badges": [
                            {
                                "text": "Free cancellation",
                                "variation": "DEFAULT",
                                "type": "CONSTRUCTIVE"
                            }
                        ],
                        "supplier": {
                            "rating": {
                                "subtitle": "26 reviews",
                                "average": "7.6",
                                "title": "Good",
                                "localisedRating": {
                                    "rawValue": 7.6,
                                    "displayValue": "7.6"
                                }
                            },
                            "name": "Hertz"
                        }
                    },
                    "rating_info": {
                        "dropoff_time": 9.1,
                        "cleanliness": 7.2,
                        "pickup_time": 7.5,
                        "average": 7.6,
                        "no_of_ratings": 26,
                        "value_for_money": 8,
                        "condition": 7.5,
                        "location": 7.1,
                        "efficiency": 7.3,
                        "average_text": "Very good"
                    },
                    "fee_info": {
                        "tax": 0,
                        "fee": 0
                    },
                    "accessibility": {
                        "supplier_rating": "At this location, our customers have rated Hertz as 7.6 out of 10, Good.",
                        "fuel_policy": "Fuel policy is: Like for like",
                        "transmission": "Automatic gearbox",
                        "pick_up_location": "Pick-up information: In Terminal"
                    },
                    "vehicle_info": {
                        "v_name": "Volkswagen Jetta  ",
                        "suitcases": {
                            "big": "0",
                            "small": "3"
                        },
                        "doors": "2",
                        "cma_compliant": -1,
                        "aircon": 1,
                        "mileage": "Unlimited mileage",
                        "label": "Standard car with:",
                        "seats": "5",
                        "group": "Standard",
                        "airbags": 1,
                        "fuel_type": "N/A",
                        "v_id": "637382406",
                        "transmission": "Automatic",
                        "free_cancellation": 1,
                        "unlimited_mileage": 1,
                        "fuel_policy": "Like for like"
                    },
                    "pricing_info": {
                        "drive_away_price": 121.33,
                        "quote_allowed": 1,
                        "fee_breakdown": {
                            "fuel_policy": {
                                "amount": 0,
                                "type": "RETURN_SAME"
                            },
                            "known_fees": [
                                {
                                    "is_always_payable": 0,
                                    "currency": "USD",
                                    "type": "THEFT_EXCESS",
                                    "is_tax_included": 1,
                                    "min_amount": 0,
                                    "amount": 0,
                                    "max_amount": 0
                                },
                                {
                                    "amount": 640.96,
                                    "min_amount": 256.38,
                                    "max_amount": 640.96,
                                    "currency": "USD",
                                    "is_tax_included": 1,
                                    "type": "DEPOSIT",
                                    "is_always_payable": 0
                                },
                                {
                                    "currency": "USD",
                                    "type": "DAMAGE_EXCESS",
                                    "is_tax_included": 1,
                                    "is_always_payable": 0,
                                    "max_amount": 0,
                                    "min_amount": 0,
                                    "amount": 0
                                },
                                {
                                    "distance_allowed": {
                                        "is_unlimited": 1,
                                        "is_km": 0
                                    },
                                    "type": "MILEAGE",
                                    "is_always_payable": 0
                                }
                            ]
                        },
                        "pay_when": "PAY_NOW",
                        "base_deposit": 10204.51,
                        "discount": 0,
                        "deposit": 121.33,
                        "drive_away_price_is_approx": true,
                        "base_currency": "INR",
                        "base_price": 10204.51,
                        "price": 121.33,
                        "currency": "USD"
                    },
                    "route_info": {
                        "pickup": {
                            "longitude": "-118.348891",
                            "location_hash": "SG9sbHl3b29kIEJ1cmJhbmsgQWlycG9ydA==",
                            "name": "Hollywood Burbank Airport",
                            "location_type": "IN_TERMINAL",
                            "country_code": "US",
                            "address": "2627, North Hollywood Way, Burbank, USA, 91505",
                            "latitude": "34.195803",
                            "location_id": "3887426"
                        },
                        "dropoff": {
                            "longitude": "-118.348891",
                            "location_hash": "SG9sbHl3b29kIEJ1cmJhbmsgQWlycG9ydA==",
                            "name": "Hollywood Burbank Airport",
                            "location_type": "IN_TERMINAL",
                            "country_code": "US",
                            "address": "2627, North Hollywood Way, Burbank, USA, 91505",
                            "latitude": "34.195803",
                            "location_id": "3887426"
                        }
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "supplier_info": {
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/137_logo_200.png",
                        "dropoff_instructions": "-",
                        "longitude": "-118.348891",
                        "location_type": "In Terminal",
                        "address": "2627, North Hollywood Way, Burbank, USA, 91505",
                        "latitude": "34.195803",
                        "pickup_instructions": "-",
                        "may_require_credit_card_guarantee": false,
                        "name": "Hertz"
                    }
                },
                {
                    "vehicle_id": "613820296",
                    "fee_info": {
                        "tax": 0,
                        "fee": 0
                    },
                    "rating_info": {
                        "dropoff_time": 9.1,
                        "cleanliness": 7.2,
                        "average": 7.6,
                        "pickup_time": 7.5,
                        "no_of_ratings": 26,
                        "value_for_money": 8,
                        "condition": 7.5,
                        "location": 7.1,
                        "efficiency": 7.3,
                        "average_text": "Very good"
                    },
                    "content": {
                        "badges": [
                            {
                                "text": "Free cancellation",
                                "variation": "DEFAULT",
                                "type": "CONSTRUCTIVE"
                            }
                        ],
                        "supplier": {
                            "name": "Hertz",
                            "rating": {
                                "localisedRating": {
                                    "displayValue": "7.6",
                                    "rawValue": 7.6
                                },
                                "title": "Good",
                                "subtitle": "26 reviews",
                                "average": "7.6"
                            }
                        }
                    },
                    "pricing_info": {
                        "price": 175.32,
                        "currency": "USD",
                        "base_price": 14745.23,
                        "base_currency": "INR",
                        "drive_away_price_is_approx": true,
                        "deposit": 175.32,
                        "discount": 0,
                        "base_deposit": 14745.23,
                        "pay_when": "PAY_NOW",
                        "quote_allowed": 1,
                        "fee_breakdown": {
                            "known_fees": [
                                {
                                    "min_amount": 0,
                                    "amount": 0,
                                    "max_amount": 0,
                                    "currency": "USD",
                                    "type": "THEFT_EXCESS",
                                    "is_tax_included": 1,
                                    "is_always_payable": 0
                                },
                                {
                                    "currency": "USD",
                                    "is_tax_included": 1,
                                    "type": "DEPOSIT",
                                    "is_always_payable": 0,
                                    "max_amount": 640.96,
                                    "amount": 640.96,
                                    "min_amount": 256.38
                                },
                                {
                                    "max_amount": 0,
                                    "amount": 0,
                                    "min_amount": 0,
                                    "currency": "USD",
                                    "is_tax_included": 1,
                                    "type": "DAMAGE_EXCESS",
                                    "is_always_payable": 0
                                },
                                {
                                    "is_always_payable": 0,
                                    "type": "MILEAGE",
                                    "distance_allowed": {
                                        "is_unlimited": 1,
                                        "is_km": 0
                                    }
                                }
                            ],
                            "fuel_policy": {
                                "type": "RETURN_SAME",
                                "amount": 0
                            }
                        },
                        "drive_away_price": 175.32
                    },
                    "vehicle_info": {
                        "mileage": "Unlimited mileage",
                        "label": "Premium car with:",
                        "seats": "7",
                        "cma_compliant": -1,
                        "aircon": 1,
                        "v_name": "Ford Expedition  ",
                        "suitcases": {
                            "small": "6",
                            "big": "0"
                        },
                        "doors": "4",
                        "fuel_policy": "Like for like",
                        "fuel_type": "N/A",
                        "free_cancellation": 1,
                        "unlimited_mileage": 1,
                        "v_id": "613820296",
                        "transmission": "Automatic",
                        "group": "Premium",
                        "airbags": 1
                    },
                    "accessibility": {
                        "pick_up_location": "Pick-up information: In Terminal",
                        "transmission": "Automatic gearbox",
                        "fuel_policy": "Fuel policy is: Like for like",
                        "supplier_rating": "At this location, our customers have rated Hertz as 7.6 out of 10, Good."
                    },
                    "route_info": {
                        "pickup": {
                            "longitude": "-118.348891",
                            "location_type": "IN_TERMINAL",
                            "location_id": "3887426",
                            "address": "2627, North Hollywood Way, Burbank, USA, 91505",
                            "country_code": "US",
                            "latitude": "34.195803",
                            "location_hash": "SG9sbHl3b29kIEJ1cmJhbmsgQWlycG9ydA==",
                            "name": "Hollywood Burbank Airport"
                        },
                        "dropoff": {
                            "longitude": "-118.348891",
                            "location_type": "IN_TERMINAL",
                            "country_code": "US",
                            "address": "2627, North Hollywood Way, Burbank, USA, 91505",
                            "latitude": "34.195803",
                            "location_id": "3887426",
                            "location_hash": "SG9sbHl3b29kIEJ1cmJhbmsgQWlycG9ydA==",
                            "name": "Hollywood Burbank Airport"
                        }
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "supplier_info": {
                        "name": "Hertz",
                        "pickup_instructions": "-",
                        "may_require_credit_card_guarantee": false,
                        "latitude": "34.195803",
                        "address": "2627, North Hollywood Way, Burbank, USA, 91505",
                        "location_type": "In Terminal",
                        "longitude": "-118.348891",
                        "dropoff_instructions": "-",
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/137_logo_200.png"
                    }
                },
                {
                    "vehicle_id": "768079776",
                    "vehicle_info": {
                        "group": "Compact",
                        "airbags": 1,
                        "fuel_policy": "Like for like",
                        "fuel_type": "N/A",
                        "transmission": "Automatic",
                        "v_id": "768079776",
                        "unlimited_mileage": 1,
                        "free_cancellation": 1,
                        "cma_compliant": -1,
                        "aircon": 1,
                        "v_name": "Buick Encore",
                        "suitcases": {
                            "small": "2",
                            "big": "0"
                        },
                        "doors": "4",
                        "label": "Compact car with:",
                        "mileage": "Unlimited mileage",
                        "seats": "5"
                    },
                    "accessibility": {
                        "transmission": "Automatic gearbox",
                        "pick_up_location": "Pick-up information: In Terminal",
                        "supplier_rating": "At this location, our customers have rated Hertz as 7.6 out of 10, Good.",
                        "fuel_policy": "Fuel policy is: Like for like"
                    },
                    "pricing_info": {
                        "discount": 0,
                        "base_deposit": 11279.03,
                        "drive_away_price_is_approx": true,
                        "deposit": 134.11,
                        "base_currency": "INR",
                        "base_price": 11279.03,
                        "price": 134.11,
                        "currency": "USD",
                        "pay_when": "PAY_NOW",
                        "drive_away_price": 134.11,
                        "quote_allowed": 1,
                        "fee_breakdown": {
                            "fuel_policy": {
                                "amount": 0,
                                "type": "RETURN_SAME"
                            },
                            "known_fees": [
                                {
                                    "max_amount": 0,
                                    "amount": 0,
                                    "min_amount": 0,
                                    "currency": "USD",
                                    "type": "THEFT_EXCESS",
                                    "is_tax_included": 1,
                                    "is_always_payable": 0
                                },
                                {
                                    "is_always_payable": 0,
                                    "is_tax_included": 1,
                                    "currency": "USD",
                                    "type": "DEPOSIT",
                                    "amount": 640.96,
                                    "min_amount": 256.38,
                                    "max_amount": 640.96
                                },
                                {
                                    "min_amount": 0,
                                    "amount": 0,
                                    "max_amount": 0,
                                    "currency": "USD",
                                    "is_tax_included": 1,
                                    "type": "DAMAGE_EXCESS",
                                    "is_always_payable": 0
                                },
                                {
                                    "distance_allowed": {
                                        "is_unlimited": 1,
                                        "is_km": 0
                                    },
                                    "is_always_payable": 0,
                                    "type": "MILEAGE"
                                }
                            ]
                        }
                    },
                    "content": {
                        "supplier": {
                            "name": "Hertz",
                            "rating": {
                                "localisedRating": {
                                    "displayValue": "7.6",
                                    "rawValue": 7.6
                                },
                                "title": "Good",
                                "subtitle": "26 reviews",
                                "average": "7.6"
                            }
                        },
                        "badges": [
                            {
                                "text": "Free cancellation",
                                "type": "CONSTRUCTIVE",
                                "variation": "DEFAULT"
                            }
                        ]
                    },
                    "fee_info": {
                        "fee": 0,
                        "tax": 0
                    },
                    "rating_info": {
                        "efficiency": 7.3,
                        "average_text": "Very good",
                        "condition": 7.5,
                        "location": 7.1,
                        "no_of_ratings": 26,
                        "value_for_money": 8,
                        "pickup_time": 7.5,
                        "average": 7.6,
                        "cleanliness": 7.2,
                        "dropoff_time": 9.1
                    },
                    "supplier_info": {
                        "dropoff_instructions": "-",
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/137_logo_200.png",
                        "longitude": "-118.348891",
                        "address": "2627, North Hollywood Way, Burbank, USA, 91505",
                        "latitude": "34.195803",
                        "location_type": "In Terminal",
                        "name": "Hertz",
                        "may_require_credit_card_guarantee": false,
                        "pickup_instructions": "-"
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "route_info": {
                        "dropoff": {
                            "address": "2627, North Hollywood Way, Burbank, USA, 91505",
                            "latitude": "34.195803",
                            "country_code": "US",
                            "location_id": "3887426",
                            "location_type": "IN_TERMINAL",
                            "name": "Hollywood Burbank Airport",
                            "location_hash": "SG9sbHl3b29kIEJ1cmJhbmsgQWlycG9ydA==",
                            "longitude": "-118.348891"
                        },
                        "pickup": {
                            "longitude": "-118.348891",
                            "location_hash": "SG9sbHl3b29kIEJ1cmJhbmsgQWlycG9ydA==",
                            "name": "Hollywood Burbank Airport",
                            "location_type": "IN_TERMINAL",
                            "location_id": "3887426",
                            "latitude": "34.195803",
                            "address": "2627, North Hollywood Way, Burbank, USA, 91505",
                            "country_code": "US"
                        }
                    }
                }
            ],
            "search_context": {
                "recommendationsSearchUniqueId": "66c9387a-0e85-45f7-a0e7-ec18600ca3f7",
                "searchId": "c1bc0e23-d1c1-47ec-b8b0-5bb7d05190c7",
                "searchKey": "eyJkcml2ZXJzQWdlIjozMCwiZHJvcE9mZkRhdGVUaW1lIjoiMjAyNC0xMS0xNlQxNjowMDowMCIsImRyb3BPZmZMb2NhdGlvbiI6IjM0LjA2Mzg2OSwtMTE4LjM2ODAzNiIsImRyb3BPZmZMb2NhdGlvblR5cGUiOiJMQVRMT05HIiwicGlja1VwRGF0ZVRpbWUiOiIyMDI0LTExLTE1VDA4OjAwOjAwIiwicGlja1VwTG9jYXRpb24iOiIzNC4wNjM4NjksLTExOC4zNjgwMzYiLCJwaWNrVXBMb2NhdGlvblR5cGUiOiJMQVRMT05HIiwicmVudGFsRHVyYXRpb25JbkRheXMiOjIsInNlcnZpY2VGZWF0dXJlcyI6WyJOT19PUEFRVUVTIiwiU1VQUkVTU19GSVhFRF9QUklDRV9WRUhJQ0xFUyIsIklOQ0xVREVfUFJPRFVDVF9SRUxBVElPTlNISVBTIiwiSU5DTFVERV9FWFRSQVNfQ09OVEFJTklOR19GRUVTIl19"
            },
            "type": "cars",
            "content": {
                "items": [
                    {
                        "content": {
                            "contentType": "carsSearchResultsSecondaryPromotional"
                        },
                        "type": "SHELL_REGION_VIEW",
                        "positionInList": 3
                    }
                ],
                "filters": {
                    "countLabel": "33 results"
                }
            }
        }
    }
]

2025-08-25 11:49:59,807 - evaluation_logger_Cross-106 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 概述

本文，我们来分享 MyBatis 的日志模块，对应 `logging` 包。如下图所示：[![`logging` 包](http://static.iocoder.cn/images/MyBatis/2020_01_07/01.png)](http://static.iocoder.cn/images/MyBatis/2020_01_07/01.png)`logging` 包

在 [《精尽 MyBatis 源码解析 —— 项目结构一览》](http://svip.iocoder.cn/MyBatis/intro) 中，简单介绍了这个模块如下：

> 无论在开发测试环境中，还是在线上生产环境中，日志在整个系统中的地位都是非常重要的。良好的日志功能可以帮助开发人员和测试人员快速定位 Bug 代码，也可以帮助运维人员快速定位性能瓶颈等问题。目前的 Java 世界中存在很多优秀的日志框架，例如 Log4j、 Log4j2、Slf4j 等。
>
> MyBatis 作为一个设计优良的框架，除了提供详细的日志输出信息，还要能够集成多种日志框架，其日志模块的一个主要功能就是**集成第三方日志框架**。

本文涉及的类如下图所示：![类图](http://static.iocoder.cn/images/MyBatis/2020_01_07/02.png)

- 从图的**上面**部分，我们可以看到，MyBatis 直接使用了市面上常用的日志框架，或者说“门面”。并且，通过组合模式，集成各个日志框架。
- 从图的**下面**部分，我们可以看到，MyBatis 提供了 `jdbc` 包，实现将数据库操作相关的信息，打印到日志中。即我们在使用 MyBatis 过程中，看到的类似 `==> Preparing: xxx` 和 `==> Parameters: xxx` 等等。并且，`BaseJdbcLogger` 是一个抽象类，其下继承了四个子类，分别打印不同级别的日志。

下面，我们逐小节来分享。

# 2. LogFactory

`org.apache.ibatis.logging.LogFactory` ，Log 工厂类。

## 2.1 构造方法

```java
// LogFactory.java

/**
 * Marker to be used by logging implementations that support markers
 */
public static final String MARKER = "MYBATIS";

/**
 * 使用的 Log 的构造方法
 */
private static Constructor<? extends Log> logConstructor;

static {
    // <1> 尝试依次初始化每个日志框架的 Log 构造方法
    tryImplementation(LogFactory::useSlf4jLogging);
    tryImplementation(LogFactory::useCommonsLogging);
    tryImplementation(LogFactory::useLog4J2Logging);
    tryImplementation(LogFactory::useLog4JLogging);
    tryImplementation(LogFactory::useJdkLogging);
    tryImplementation(LogFactory::useNoLogging);
}
```

- `logConstructor` 静态属性，使用的 Log 的构造方法。

- `<1>` 处，在类加载时，通过 `#tryImplementation(Runnable runnable)` 方法，尝试依次初始化每个日志框架的 Log 构造方法。代码如下：

  ```java
  // LogFactory.java
  
  private static void tryImplementation(Runnable runnable) {
      if (logConstructor == null) {
          try {
              runnable.run();
          } catch (Throwable t) {
              // ignore
          }
      }
  }
  ```

  - 通过这样的方式，达到使用**首个**可用的日志框架。

- 具体有哪些日志框架，可看如下的 `#useSlf4jLogging()` 等方法。代码如下：

  ```java
  // LogFactory.java
  
  public static synchronized void useSlf4jLogging() {
      setImplementation(org.apache.ibatis.logging.slf4j.Slf4jImpl.class);
  }
  
  public static synchronized void useCommonsLogging() {
      setImplementation(org.apache.ibatis.logging.commons.JakartaCommonsLoggingImpl.class);
  }
  
  public static synchronized void useLog4JLogging() {
      setImplementation(org.apache.ibatis.logging.log4j.Log4jImpl.class);
  }
  
  public static synchronized void useLog4J2Logging() {
      setImplementation(org.apache.ibatis.logging.log4j2.Log4j2Impl.class);
  }
  
  public static synchronized void useJdkLogging() {
      setImplementation(org.apache.ibatis.logging.jdk14.Jdk14LoggingImpl.class);
  }
  
  public static synchronized void useStdOutLogging() {
      setImplementation(org.apache.ibatis.logging.stdout.StdOutImpl.class);
  }
  
  public static synchronized void useNoLogging() {
      setImplementation(org.apache.ibatis.logging.nologging.NoLoggingImpl.class);
  }
  ```

  - 每个方法，都调用了 `#setImplementation(Class<? extends Log> implClass)` 方法。代码如下：

    ```java
    // LogFactory.java
    
    private static void setImplementation(Class<? extends Log> implClass) {
        try {
            // 获得参数为 String 的构造方法
            Constructor<? extends Log> candidate = implClass.getConstructor(String.class);
            // 创建 Log 对象
            Log log = candidate.newInstance(LogFactory.class.getName());
            if (log.isDebugEnabled()) {
                log.debug("Logging initialized using '" + implClass + "' adapter.");
            }
            // 创建成功，意味着可以使用，设置为 logConstructor
            logConstructor = candidate;
        } catch (Throwable t) {
            throw new LogException("Error setting Log implementation.  Cause: " + t, t);
        }
    }
    ```

    - 通过这样的方式，初始化 `logConstructor` 。

## 2.2 getLog

`#getLog(...)` 方法，获得 Log 对象。代码如下：

```java
// LogFactory.java

public static Log getLog(Class<?> aClass) {
    return getLog(aClass.getName());
}

public static Log getLog(String logger) {
    try {
        return logConstructor.newInstance(logger);
    } catch (Throwable t) {
        throw new LogException("Error creating logger for logger " + logger + ".  Cause: " + t, t);
    }
}
```

## 2.3 小结

LogFactory 负责**自动扫描**日志实现，并且**实例化**对应的日志框架。

# 3. Log

`org.apache.ibatis.logging.Log` ，MyBatis Log 接口。代码如下：

```java
// Log.java

public interface Log {

    boolean isDebugEnabled();

    boolean isTraceEnabled();

    void error(String s, Throwable e);

    void error(String s);

    void debug(String s);

    void trace(String s);

    void warn(String s);

}
```

- 每个日志框架，都有其对应的实现类。如下图：![Log 实现类](http://static.iocoder.cn/images/MyBatis/2020_01_07/03.png)

- 因为每个实现类，代码都非常简单，所以本文就不详细解析。以 `org.apache.ibatis.logging.slf4j.Slf4jImpl` 为例子，代码如下：

  ```java
  // Slf4jImpl.java
  
  public class Slf4jImpl implements Log {
  
      private Log log;
  
      public Slf4jImpl(String clazz) {
          Logger logger = LoggerFactory.getLogger(clazz);
  
          if (logger instanceof LocationAwareLogger) {
              try {
                  // check for slf4j >= 1.6 method signature
                  logger.getClass().getMethod("log", Marker.class, String.class, int.class, String.class, Object[].class, Throwable.class);
                  log = new Slf4jLocationAwareLoggerImpl((LocationAwareLogger) logger);
                  return;
              } catch (SecurityException e) {
                  // fail-back to Slf4jLoggerImpl
              } catch (NoSuchMethodException e) {
                  // fail-back to Slf4jLoggerImpl
              }
          }
  
          // Logger is not LocationAwareLogger or slf4j version < 1.6
          log = new Slf4jLoggerImpl(logger);
      }
  
      @Override
      public boolean isDebugEnabled() {
          return log.isDebugEnabled();
      }
  
      @Override
      public boolean isTraceEnabled() {
          return log.isTraceEnabled();
      }
  
      @Override
      public void error(String s, Throwable e) {
          log.error(s, e);
      }
  
      @Override
      public void error(String s) {
          log.error(s);
      }
  
      @Override
      public void debug(String s) {
          log.debug(s);
      }
  
      @Override
      public void trace(String s) {
          log.trace(s);
      }
  
      @Override
      public void warn(String s) {
          log.warn(s);
      }
  
  }
  ```

  - 组合 `org.slf4j.Logger` 对象，实现 Log 接口的方法。

# 4. JDBC 日志

`org.apache.ibatis.logging.jdbc` 包，负责打印 JDBC 日志。核心是 `BaseJdbcLogger` 抽象类，以及其下的四个子类。

## 4.1 BaseJdbcLogger

`org.apache.ibatis.logging.jdbc.BaseJdbcLogger` ，实现 Log 接口，基础 JDBC Logger 抽象类。

### 4.1.1 构造方法

```java
// BaseJdbcLogger.java

// 支持的 Set 方法的名字的集合
protected static final Set<String> SET_METHODS = new HashSet<>();
// 执行的 SQL 类型的方法的集合
protected static final Set<String> EXECUTE_METHODS = new HashSet<>();

/**
 * 连接的参数集合，例如 PreparedStatement 或 CallableStatement
 */
private final Map<Object, Object> columnMap = new HashMap<>();

/**
 * 参数集合
 */
private final List<Object> columnNames = new ArrayList<>();
private final List<Object> columnValues = new ArrayList<>();

/**
 * 使用的 Log 对象
 */
protected Log statementLog;

/**
 * 查询的层级
 */
protected int queryStack;

static {
    SET_METHODS.add("setString");
    SET_METHODS.add("setInt");
    SET_METHODS.add("setByte");
    SET_METHODS.add("setShort");
    SET_METHODS.add("setLong");
    SET_METHODS.add("setDouble");
    SET_METHODS.add("setFloat");
    SET_METHODS.add("setTimestamp");
    SET_METHODS.add("setDate");
    SET_METHODS.add("setTime");
    SET_METHODS.add("setArray");
    SET_METHODS.add("setBigDecimal");
    SET_METHODS.add("setAsciiStream");
    SET_METHODS.add("setBinaryStream");
    SET_METHODS.add("setBlob");
    SET_METHODS.add("setBoolean");
    SET_METHODS.add("setBytes");
    SET_METHODS.add("setCharacterStream");
    SET_METHODS.add("setClob");
    SET_METHODS.add("setObject");
    SET_METHODS.add("setNull");
    // ... 省略不常用的
}
```

- `SET_METHODS` 静态属性，支持的 Set 方法的名字的集合。通过 `#isPmd()` 方法，判断是否为 Set 方法。代码如下：

  ```java
  // BaseJdbcLogger.java
  
  protected boolean isPmd() {
      return ParameterMetaData.class.equals(method.getDeclaringClass());
  }
  ```

- `EXECUTE_METHODS` 静态属性，执行的 SQL 类型的方法的集合。通过 `#isExecuteMethod()` 方法，判断是否为执行 SQL 的方法。代码如下：

  ```java
  // BaseJdbcLogger.java
  
  protected boolean isExecuteMethod() {
      return EXECUTE_METHODS.contains(method.getName());
  }
  ```

- `columnMap` 属性，连接的参数集合，例如 PreparedStatement 或 CallableStatement 。通过 `#debug()` 方法，打印日志时，会使用到该属性。代码如下：

  ```java
  // BaseJdbcLogger.java
  
  protected void debug(Object text, boolean input) {
      if (statementLog.isDebugEnabled()) {
          statementLog.debug(toString() + text + (input ? " \"" + columnValues.get(columnValues.size() - 1) + "\"" : ""));
      }
  }
  ```

- `columnNames` 属性，参数名集合。

- `columnValues` 属性，参数值集合。

- `statementLog` 属性，使用的 Log 对象。

- `queryStack` 属性，查询的层级。通过 `#pushColumn()` 和 `#popColumn()` 方法，进行增减。代码如下：

  ```java
  // BaseJdbcLogger.java
  
  protected void pushColumn(Object column) {
      columnNames.add(column);
  }
  
  protected Object popColumn() {
      return columnNames.remove(columnNames.size() - 1);
  }
  ```

### 4.1.2 其他方法

BaseJdbcLogger 中，还有其它方法，比较简单，胖友自己研究。

## 4.2 ConnectionLogger

`org.apache.ibatis.logging.jdbc.ConnectionLogger` ，继承 BaseJdbcLogger 类，Connection 日志增强类。

### 4.2.1 构造方法

```java
// ConnectionLogger.java

/**
 * 连接的编号
 */
private final Integer connectionId;

/**
 * 连接的时间戳
 */
private final Long connectionTimeStamp;

/**
 * 连接日志的构造函数
 *
 * @param log 日志对象
 * @param connectionId 连接编号
 * @param connectionTimeStamp 连接的时间戳
 */
private ConnectionLogger(Log log, int connectionId, Long connectionTimeStamp) {
    super(log);
    this.connectionId = connectionId;
    this.connectionTimeStamp = connectionTimeStamp;
}
```

### 4.2.2 newInstance

`#newInstance(Connection connection, Log statementLog, int connectionId)` **静态**方法，创建 Connection 的代理对象。代码如下：

```java
// ConnectionLogger.java

public static Connection newInstance(Connection connection, Log statementLog, int connectionId) {
    // 创建 InvocationHandler 对象
    InvocationHandler handler = new ConnectionLogger(connection, statementLog, connectionId);
    ClassLoader cl = Connection.class.getClassLoader();
    // 创建 Connection 代理对象
    return (Connection) Proxy.newProxyInstance(cl, new Class[]{Connection.class}, handler);
}
```

- 其中，创建了 ConnectionLogger 对象，作为 InvocationHandler 对象。

### 4.2.3 invoke

`#invoke(Object proxy, Method method, Object[] params)` 方法，代理方法。代码如下：

```java
// ConnectionLogger.java

@Override
public Object invoke(Object proxy, Method method, Object[] params) throws Throwable {
    try {
        // 如果是调用 Object 定义的方法，直接调用
        if (Object.class.equals(method.getDeclaringClass())) {
            return method.invoke(this, params);
        }
        // 如果是调用 prepareStatement 方法，则创建 PreparedStatementLogger 代理对象
        if ("prepareStatement".equals(method.getName())) {
            if (isDebugEnabled()) {
                debug(" Preparing: " + removeBreakingWhitespace((String) params[0]), true);
            }
            PreparedStatement stmt = (PreparedStatement) method.invoke(connection, params);
            stmt = PreparedStatementLogger.newInstance(stmt, statementLog, queryStack);
            return stmt;
        // 如果是调用 prepareCall 方法，则创建 CallableStatementLogger 代理对象
        } else if ("prepareCall".equals(method.getName())) {
            if (isDebugEnabled()) {
                debug(" Preparing: " + removeBreakingWhitespace((String) params[0]), true);
            }
            PreparedStatement stmt = (PreparedStatement) method.invoke(connection, params);
            stmt = PreparedStatementLogger.newInstance(stmt, statementLog, queryStack);
            return stmt;
        // 如果是调用 createStatement 方法，则创建 StatementLogger 代理对象
        } else if ("createStatement".equals(method.getName())) {
            Statement stmt = (Statement) method.invoke(connection, params);
            stmt = StatementLogger.newInstance(stmt, statementLog, queryStack);
            return stmt;
        } else {
            // 其他方法，直接调用
            return method.invoke(connection, params);
        }
    } catch (Throwable t) {
        throw ExceptionUtil.unwrapThrowable(t);
    }
}
```

- 根据不同的方法，进行不同的日志增强处理。

## 4.3 StatementLogger

`org.apache.ibatis.logging.jdbc.StatementLogger` ，继承 BaseJdbcLogger 类，Statement 日志增强类。

### 4.3.1 构造方法

```java
// StatementLogger.java

/**
 * Statement 对象
 */
private final Statement statement;

private StatementLogger(Statement stmt, Log statementLog, int queryStack) {
    super(statementLog);
    this.statement = stmt;
    this.queryStack = queryStack;
}
```

### 4.3.2 newInstance

`#newInstance(Statement stmt, Log statementLog, int queryStack)` **静态**方法，创建 Statement 的代理对象。代码如下：

```java
// StatementLogger.java

public static Statement newInstance(Statement stmt, Log statementLog, int queryStack) {
    // 创建 InvocationHandler 对象
    InvocationHandler handler = new StatementLogger(stmt, statementLog, queryStack);
    ClassLoader cl = Statement.class.getClassLoader();
    // 创建 Statement 代理对象
    return (Statement) Proxy.newProxyInstance(cl, new Class[]{Statement.class}, handler);
}
```

- 其中，创建了 StatementLogger 对象，作为 InvocationHandler 对象。

### 4.3.3 invoke

`#invoke(Object proxy, Method method, Object[] params)` 方法，代理方法。代码如下：

```java
// StatementLogger.java

@Override
public Object invoke(Object proxy, Method method, Object[] params) throws Throwable {
    try {
        // 如果是调用 Object 定义的方法，直接调用
        if (Object.class.equals(method.getDeclaringClass())) {
            return method.invoke(this, params);
        }
        // 如果是调用 SQL 相关的方法，则打印日志
        if (EXECUTE_METHODS.contains(method.getName())) {
            if (isDebugEnabled()) {
                debug("Parameters: " + getParameterValueString(), true);
            }
            // 清除 columnMap 和 columnNames、columnValues
            clearColumnInfo();
            // 执行方法
            Object result = method.invoke(statement, params);
            // 打印日志
            if (result instanceof ResultSet) {
                ResultSet rs = (ResultSet) result;
                rs = ResultSetLogger.newInstance(rs, statementLog, queryStack);
                return rs;
            } else {
                return

2025-08-25 11:50:07,465 - evaluation_logger_Cross-106 - INFO - Complete Result: {'score': 0, 'reason': "The response does not address any of the requested information in the user's query."}
2025-08-25 11:50:13,709 - evaluation_logger_Cross-106 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 11:50:13,709 - evaluation_logger_Cross-106 - INFO - Message: Success.
2025-08-25 11:50:13,710 - evaluation_logger_Cross-106 - INFO - Success turn num = 3
2025-08-25 11:50:13,710 - evaluation_logger_Cross-106 - INFO - ----------------------------------------------------------------------------------------------------
