2025-08-25 12:57:09,846 - evaluation_logger_Attraction-32 - INFO - Test Example Attraction-32
2025-08-25 12:57:09,846 - evaluation_logger_Attraction-32 - INFO - Query: Our company is planning a trip to Rome for the employees. What is the highest-rated attraction there?
2025-08-25 12:57:20,405 - evaluation_logger_Attraction-32 - INFO - Function Calls: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Rome"
        }
    }
]

2025-08-25 12:57:20,405 - evaluation_logger_Attraction-32 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Rome"
        }
    },
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0xMjY2OTN9",
            "sortBy": "attr_book_score"
        }
    }
]

2025-08-25 12:57:20,405 - evaluation_logger_Attraction-32 - INFO - Start compare_single_call: 
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Rome'}}
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Rome'}}
2025-08-25 12:57:20,405 - evaluation_logger_Attraction-32 - INFO - Rule-based compare success.
2025-08-25 12:57:20,405 - evaluation_logger_Attraction-32 - INFO - Success matched: [{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Rome'}}]
2025-08-25 12:57:20,405 - evaluation_logger_Attraction-32 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "products": [
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJjZHJDbGdmVWtyIiwidWZpIjotMTI2NjkzfQ==",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Vespa Scooter Tour in Rome with RomeIsMyLove Pro Photo Team",
                    "productId": "PRcdrClgfUkr",
                    "productSlug": "prcdrclgfukr-shared-vespa-tour-in-rome-with-professional-photographer",
                    "taxonomySlug": "tours",
                    "cityUfi": -126693,
                    "cityName": "Rome",
                    "countryCode": "it"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJEUTNWWTJsYU1iIiwidWZpIjotMTI2NjkzfQ==",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Rome.Vatican Museum And Sistine Chapel Tour",
                    "productId": "PRDQ3VY2laMb",
                    "productSlug": "prdq3vy2lamb-romevatican-museum-and-sistine-chapel-tour",
                    "taxonomySlug": "tours",
                    "cityUfi": -126693,
                    "cityName": "Rome",
                    "countryCode": "it"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJ0VE5SdVZ1MVBkIiwidWZpIjotMTI2NjkzfQ==",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Rome:Capuchin Crypts And Museum Private Tour",
                    "productId": "PRtTNRuVu1Pd",
                    "productSlug": "prttnruvu1pd-romecapuchin-crypts-and-museum-private-tour",
                    "taxonomySlug": "tours",
                    "cityUfi": -126693,
                    "cityName": "Rome",
                    "countryCode": "it"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJmTklkNExHY0RQIiwidWZpIjotMTMyMDkyfQ==",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Fascinating Verona: in the Footprints of Romeo and Juliet",
                    "productId": "PRfNId4LGcDP",
                    "productSlug": "prfnid4lgcdp-verona-in-the-footsteps-of-romeo-and-juliet",
                    "taxonomySlug": "tours",
                    "cityUfi": -132092,
                    "cityName": "Verona",
                    "countryCode": "it"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFIybUJVZTJwZVlNIiwidWZpIjotMTI2NjkzfQ==",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Rome: Colosseum and Ancient Rome Tour",
                    "productId": "PR2mBUe2peYM",
                    "productSlug": "pr2mbue2peym-colosseum-and-ancient-rome-skip-the-line-tour",
                    "taxonomySlug": "tours",
                    "cityUfi": -126693,
                    "cityName": "Rome",
                    "countryCode": "it"
                }
            ],
            "destinations": [
                {
                    "id": "eyJ1ZmkiOi0xMjY2OTN9",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": -126693,
                    "country": "Italy",
                    "cityName": "Rome",
                    "productCount": 4837,
                    "cc1": "it"
                }
            ]
        }
    }
]

2025-08-25 12:57:30,553 - evaluation_logger_Attraction-32 - INFO - Function Calls: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0xMjY2OTN9",
            "sortBy": "attr_book_score"
        }
    }
]

2025-08-25 12:57:30,553 - evaluation_logger_Attraction-32 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0xMjY2OTN9",
            "sortBy": "attr_book_score"
        }
    }
]

2025-08-25 12:57:30,553 - evaluation_logger_Attraction-32 - INFO - Start compare_single_call: 
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0xMjY2OTN9', 'sortBy': 'attr_book_score'}}
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0xMjY2OTN9', 'sortBy': 'attr_book_score'}}
2025-08-25 12:57:30,553 - evaluation_logger_Attraction-32 - INFO - Rule-based compare success.
2025-08-25 12:57:30,553 - evaluation_logger_Attraction-32 - INFO - Success matched: [{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0xMjY2OTN9', 'sortBy': 'attr_book_score'}}]
2025-08-25 12:57:30,553 - evaluation_logger_Attraction-32 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProductSearchResponse",
            "products": [
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PR4xrlV2VQsG",
                    "name": "Rome: Castel Sant'Angelo Skip the Line Entry Ticket",
                    "slug": "pr4xrlv2vqsg-rome-castel-santangelo-skip-the-line-entry-ticket",
                    "shortDescription": "Escape the crowds with fast track entry tickets and spend more time exploring.\nVisit the castle's...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 29.49,
                        "currency": "USD",
                        "publicAmount": 29.49
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.7,
                            "total": 109
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Rome",
                        "ufi": -126693
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI8CWId6EUIR"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIKYq6T8JLeD"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIizKJ7iED73"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIdN9Rl1Xy6l"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI6U2YlOslHk"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    }
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRGolUz8z9Ci",
                    "name": "Vatican Museums, Sistine Chapel & Saint Peter’s",
                    "slug": "prgoluz8z9ci-vatican-museums-sistine-chapel-saint-peters",
                    "shortDescription": "A small-group morning tour to explore Rome’s must-see sights",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 108.14,
                        "currency": "USD",
                        "publicAmount": 108.14
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 56,
                        "percentage": "95%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.5,
                            "total": 557
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Rome",
                        "ufi": -126693
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OITSw3NOqrMZ"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OILMOXNQUm78"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OInArNDDLGkm"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIpVjlwCQlWy"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI9sjkxkTqec"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI81yDYC6Wv5"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 8
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRlRifPhM7jf",
                    "name": "Transfer Rome center - Fiumicino airport",
                    "slug": "prlrifphm7jf-transfer-rome-center-fiumicino-airport",
                    "shortDescription": "Convenient and convenient bus transfer between Rome city center (Termini Station) and Fiumicino A...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 7.65,
                        "currency": "USD",
                        "publicAmount": 7.65
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.5,
                            "total": 359
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Rome",
                        "ufi": -126693
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OILxbo7VMI8F"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIwjS1GLT6eI"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIxkho8sJNyU"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 7
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": false
                    },
                    "id": "PRKpOnqb3lfr",
                    "name": "Bus Transport between Fiumicino Airport and Rome",
                    "slug": "prkponqb3lfr-bus-transport-between-fiumicino-airport-and-rome",
                    "shortDescription": "One-way or round-trip journey between Rome's main airport and downtown",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 7.65,
                        "currency": "USD",
                        "publicAmount": 7.65
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.4,
                            "total": 1161
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Rome",
                        "ufi": -126693
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI4eL7r7neBb"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIq1viRc8mTU"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIMgIOizENej"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIDCRYE9mxav"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIsFY883aLZB"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIS26uDTiZTp"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 1
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PR6RdzCuLqa0",
                    "name": "Admission to the Leonardo da Vinci Museum",
                    "slug": "pr6rdzculqa0-admission-to-the-leonardo-da-vinci-museum",
                    "shortDescription": "A ticket to experience Leonardo da Vinci's inventions",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 10.09,
                        "currency": "USD",
                        "publicAmount": 10.09
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 276,
                        "percentage": "90%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.3,
                            "total": 634
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Rome",
                        "ufi": -126693
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIQxPv5EsvDd"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OItOHKmasIgw"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIajhv67Hsku"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIFg2ZvjlkmP"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 9
                        }
                    ]
                }
            ],
            "filterStats": {
                "__typename": "FilterStats",
                "unfilteredProductCount": 4836,
                "filteredProductCount": 4836
            },
            "sorters": [
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Our top picks",
                    "value": "trending"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Most popular",
                    "value": "attr_book_score"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Lowest price",
                    "value": "lowest_price"
                }
            ],
            "defaultSorter": {
                "__typename": "AttractionsSorterOption",
                "name": "Our top picks",
                "value": "trending"
            },
            "filterOptions": {
                "__typename": "FilterOptions",
                "typeFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Tours",
                        "tagname": "tours",
                        "productCount": 3908
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Transfers & services",
                        "tagname": "transfers-services",
                        "productCount": 392
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Activities",
                        "tagname": "activities",
                        "productCount": 365
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Attractions",
                        "tagname": "attractions",
                        "productCount": 73
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Landmarks",
                        "tagname": "landmarks",
                        "productCount": 55
                    }
                ],
                "labelFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Free cancellation",
                        "tagname": "free_cancellation",
                        "productCount": 3814
                    }
                ],
                "ufiFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Rome",
                        "tagname": "-126693",
                        "productCount": 4671
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Bracciano",
                        "tagname": "-112072",
                        "productCount": 121
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Lido di Ostia",
                        "tagname": "-120159",
                        "productCount": 35
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Centocelle",
                        "tagname": "-115026",
                        "productCount": 6
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Tivoli",
                        "tagname": "-130829",
                        "productCount": 2
                    }
                ],
                "priceFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "US$0 - US$22",
                        "tagname": "b0",
                        "productCount": 179
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$22 - US$44",
                        "tagname": "b1",
                        "productCount": 325
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$44 - US$83",
                        "tagname": "b2",
                        "productCount": 665
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$83 - US$138",
                        "tagname": "b3",
                        "productCount": 844
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$138+",
                        "tagname": "b4",
                        "productCount": 3043
                    }
                ]
            }
        }
    }
]

2025-08-25 13:00:35,884 - evaluation_logger_Attraction-32 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 概述

## 1.1 什么是Spring

Spring是一个开源框架，Spring是于2003 年兴起的一个轻量级的Java 开发框架，由Rod Johnson 在其著作Expert One-On-One J2EE Development and Design中阐述的部分理念和原型衍生而来。它是为了解决企业应用开发的复杂性而创建的。框架的主要优势之一就是其分层架构，分层架构允许使用者选择使用哪一个组件，同时为 J2EE 应用程序开发提供集成的框架。Spring使用基本的JavaBean来完成以前只可能由EJB完成的事情。然而，Spring的用途不仅限于服务器端的开发。从简单性、可测试性和松耦合的角度而言，任何Java应用都可以从Spring中受益。Spring的核心是控制反转（IoC）和面向切面（AOP）。简单来说，Spring是一个分层的JavaSE/EE full-stack(一站式) 轻量级开源框架。

## 1.2 Spring的优势

- 方便解耦，简化开发

  通过Spring提供的IoC容器，我们可以将对象之间的依赖关系交由Spring进行控制，避免硬编码所造成的过度程序耦合。有了Spring，用户不必再为单实例模式类、属性文件解析等这些很底层的需求编写代码，可以更专注于上层的应用。

- AOP编程的支持

  通过Spring提供的AOP功能，方便进行面向切面的编程，许多不容易用传统OOP实现的功能可以通过AOP轻松应付。

- 声明式事务的支持

  在Spring中，我们可以从单调烦闷的事务管理代码中解脱出来，通过声明式方式灵活地进行事务的管理，提高开发效率和质量。

- 方便程序的测试

  可以用非容器依赖的编程方式进行几乎所有的测试工作，在Spring里，测试不再是昂贵的操作，而是随手可做的事情。例如：Spring对Junit4支持，可以通过注解方便的测试Spring程序。

- 方便集成各种优秀框架

  Spring不排斥各种优秀的开源框架，相反，Spring可以降低各种框架的使用难度，Spring提供了对各种优秀框架（如Struts,Hibernate、Hessian、Quartz）等的直接支持。

- 降低Java EE API的使用难度

  Spring对很多难用的Java EE API（如JDBC，JavaMail，远程调用等）提供了一个薄薄的封装层，通过Spring的简易封装，这些Java EE API的使用难度大为降低。

- Java 源码是经典学习范例

  Spring的源代码设计精妙、结构清晰、匠心独用，处处体现着大师对Java设计模式灵活运用以及对Java技术的高深造诣。它的源代码无意是Java技术的最佳实践的范例。

## 1.3 Spring的体系结构

Spring 框架是一个分层架构，由 7 个定义良好的模块组成。Spring 模块构建在核心容器之上，核心容器定义了创建、配置和管理 bean 的方式 .

![image-20210729100050356](https://gitee.com/kongyin/picture_bed/raw/master/wx_picture/image-20210729100050356.png)

组成 Spring 框架的每个模块（或组件）都可以单独存在，或者与其他一个或多个模块联合实现。每个模块的功能如下：

- **核心容器**：核心容器提供 Spring 框架的基本功能。核心容器的主要组件是 BeanFactory，它是工厂模式的实现。BeanFactory 使用*控制反转*（IOC） 模式将应用程序的配置和依赖性规范与实际的应用程序代码分开。
- **Spring 上下文**：Spring 上下文是一个配置文件，向 Spring 框架提供上下文信息。Spring 上下文包括企业服务，例如 JNDI、EJB、电子邮件、国际化、校验和调度功能。
- **Spring AOP**：通过配置管理特性，Spring AOP 模块直接将面向切面的编程功能集成到了 Spring 框架中。所以，可以很容易地使 Spring 框架管理的任何对象支持 AOP。Spring AOP 模块为基于 Spring 的应用程序中的对象提供了事务管理服务。通过使用 Spring AOP，不用依赖 EJB 组件，就可以将声明性事务管理集成到应用程序中。
- **Spring DAO**：JDBC DAO 抽象层提供了有意义的异常层次结构，可用该结构来管理异常处理和不同数据库供应商抛出的错误消息。异常层次结构简化了错误处理，并且极大地降低了需要编写的异常代码数量（例如打开和关闭连接）。Spring DAO 的面向 JDBC 的异常遵从通用的 DAO 异常层次结构。
- **Spring ORM**：Spring 框架插入了若干个 ORM 框架，从而提供了 ORM 的对象关系工具，其中包括 JDO、Hibernate 和 iBatis SQL Map。所有这些都遵从 Spring 的通用事务和 DAO 异常层次结构。
- **Spring Web 模块**：Web 上下文模块建立在应用程序上下文模块之上，为基于 Web 的应用程序提供了上下文。所以，Spring 框架支持与 Jakarta Struts 的集成。Web 模块还简化了处理多部分请求以及将请求参数绑定到域对象的工作。
- **Spring MVC 框架**：MVC 框架是一个全功能的构建 Web 应用程序的 MVC 实现。通过策略接口，MVC 框架变成为高度可配置的，MVC 容纳了大量视图技术，其中包括 JSP、Velocity、Tiles、iText 和 POI。

# 2. IoC的概念和作用

## 2.1 什么是程序的耦合

耦合性(Coupling)，也叫耦合度，是对模块间关联程度的度量。耦合的强弱取决于模块间接口的复杂性、调用模块的方式以及通过界面传送数据的多少。模块间的耦合度是指模块之间的依赖关系，包括控制关系、调用关系、数据传递关系。模块间联系越多，其耦合性越强，同时表明其独立性越差( 降低耦合性，可以提高其独立性)。耦合性存在于各个领域，而非软件设计中独有的，但是我们只讨论软件工程中的耦合。

在软件工程中，耦合指的就是就是对象之间的依赖性。对象之间的耦合越高，维护成本越高。因此对象的设计应使类和构件之间的耦合最小。软件设计中通常用耦合度和内聚度作为衡量模块独立程度的标准。划分模块的一个准则就是高内聚低耦合。

**耦合分类**

- 内容耦合

  一个模块直接访问另一个模块的内部数据

  一个模块不通过正常入口转到另一模块内部

  两个模块有一部分程序代码重叠(只可能出现在汇编语言中)

  一个模块有多个入口

- 公共耦合

  一组模块都访问同一个全局数据结构

- 外部耦合

  一组模块都访问同一全局简单变量，而且不通过参数表传递该变量的信息

- 控制耦合

  一个模块通过接口向另一个模块传递一个控制信号，接受信号的模块根据信号值而进行适当的动作

- 标记耦合

  若一个模块A通过接口向两个模块B和C传递一个公共参数，那么称模块B和C之间存在一个标记耦合

- 数据耦合

  模块之间通过参数来传递数据

- 非直接耦合

  两个模块之间没有直接关系，它们之间的联系完全是通过主模块的控制和调用来实现的

**解耦**

解耦，字面意思就是解除耦合关系。

在软件工程中，降低耦合度即可以理解为解耦，模块间有依赖关系必然存在耦合，理论上的绝对零耦合是做不到的，但可以通过一些现有的方法将耦合度降至最低。

设计的核心思想：尽可能减少代码耦合，如果发现代码耦合，就要采取解耦技术。

让数据模型，业务逻辑和视图显示三层之间彼此降低耦合，把关联依赖降到最低，而不至于牵一发而动全身。原则就是A功能的代码不要写在B的功能代码中，如果两者之间需要交互，可以通过接口，通过消息，甚至可以引入框架，但总之就是不要直接交叉写。

观察如下代码：

```java
/**
 * 账户的业务层实现类
 */
public class AccountServiceImpl implements IAccountService {
    private IAccountDao accountDao = new AccountDaoImpl();
}
```

上面的代码表示：

业务层调用持久层，并且此时业务层在依赖持久层的接口和实现类。如果此时没有持久层实现类，编译将不能通过。这种编译期依赖关系，应该在我们开发中杜绝。我们需要优化代码解决。

再比如：

早期我们的JDBC操作，注册驱动时，我们为什么不使用`DriverManager`的`register`方法，而是采用`Class.forName`的方式？

```java
public class JdbcDemo1 {
    public static void main(String[] args) throws Exception {
        //1.注册驱动
        //DriverManager.registerDriver(new com.mysql.jdbc.Driver());
        Class.forName("com.mysql.jdbc.Driver");
        //2.获取连接
        //3.获取预处理sql语句对象
        //4.获取结果集
        //5.遍历结果集
    }
}
```

原因就是：

我们的类依赖了数据库的具体驱动类（MySQL），如果这时候更换了数据库品牌（比如Oracle），需要修改源码来重新数据库驱动。这显然不是我们想要的。

## 2.2 解决程序耦合的思路

当是我们讲解`jdbc`时，是通过反射来注册驱动的，代码如下：

```java
Class.forName("com.mysql.jdbc.Driver");//此处只是一个字符串
```

此时的好处是，我们的类中不再依赖具体的驱动类，此时就算删除`mysql`的驱动jar包，依然可以编译（运行就不要想了，没有驱动不可能运行成功的）。

同时，也产生了一个新的问题，`mysql`驱动的全限定类名字符串是在java类中写死的，一旦要改还是要修改源码。

解决这个问题也很简单，使用配置文件配置。

## 2.3 工厂模式解耦

在实际开发中我们可以把三层的对象都使用配置文件配置起来，当启动服务器应用加载的时候，让一个类中的方法通过读取配置文件，把这些对象创建出来并存起来。在接下来的使用的时候，直接拿过来用就好了。

那么，这个读取配置文件，创建和获取三层对象的类就是工厂。

## 2.4 控制反转-Inversion Of Control

上一小节解耦的思路有2个问题：

1. 存哪去？

   分析：由于我们是很多对象，肯定要找个集合来存。这时候有Map和List供选择。

   到底选Map还是List就看我们有没有查找需求。有查找需求，选Map。

   所以我们的答案就是

   在应用加载时，创建一个Map，用于存放三层对象。

   我们把这个map称之为容器。

2. 还是没解释什么是工厂？

   工厂就是负责给我们从容器中获取指定对象的类。这时候我们获取对象的方式发生了改变。

   原来：

   我们在获取对象时，都是采用new的方式。是主动的。

   现在：

   我们获取对象时，同时跟工厂要，有工厂为我们查找或者创建对象。是被动的。

   这种被动接收的方式获取对象的思想就是控制反转，它是spring框架的核心之一。

**明确ioc的作用：**

削减计算机程序的耦合(解除我们代码中的依赖关系)。

# 3. 使用Spring的IOC解决程序耦合

## 3.1 案例的前期准备

本章我们使用的案例是，账户的业务层和持久层的依赖关系解决。在开始spring的配置之前，我们要先准备一下环境。由于我们是使用spring解决依赖关系，并不是真正的要做增删改查操作，所以此时我们没必要写实体类。并且我们在此处使用的是java工程，不是java web工程。

### 3.1.1 准备spring的开发包

官网：http://spring.io/

下载地址：http://repo.springsource.org/libs-release-local/org/springframework/spring

解压:(Spring目录结构:)

- docs      :API和开发规范
- libs        :jar包和源码
- schema  :约束

![image-20210729102739733](https://gitee.com/kongyin/picture_bed/raw/master/wx_picture/image-20210729102739733.png)

### 3.1.2 创建业务层接口和实现类

```java
/**
 * 账户的业务层接口
 */
public interface IAccountService {
    /**
     * 保存账户（此处只是模拟，并不是真的要保存）
     */
    void saveAccount();
}
```

```java
/**
 * 账户的业务层实现类
 */
public class AccountServiceImpl implements IAccountService {
    private IAccountDao accountDao = new AccountDaoImpl();//此处的依赖关系有待解决
    @Override
    public void saveAccount() {
        accountDao.saveAccount();
    }
}
```

### 3.1.3 创建持久层接口和实现类

```java
/**
 * 账户的持久层接口
 */
public interface IAccountDao {
    /**
     * 保存账户
     */
    void saveAccount();
}
```

```java
/**
 * 账户的持久层实现类
 */
public class AccountDaoImpl implements IAccountDao {
    @Override
    public void saveAccount() {
        System.out.println("保存了账户");
    }
}
```

## 3.2 基于XML的配置（入门案例）

### 3.2.1 第一步：拷贝必备的jar包到工程的lib目录中

![image-20210729103105266](https://gitee.com/kongyin/picture_bed/raw/master/wx_picture/image-20210729103105266.png)

### 3.2.2 第二步：在类的根路径下创建一个任意名称的xml文件

不能是中文） 给配置文件导入约束：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd">
</beans>
```

### 3.2.3 第三步：让spring管理资源，在配置文件中配置service和dao

```xml
<!-- bean标签：用于配置让spring创建对象，并且存入ioc容器之中
        id属性：对象的唯一标识。
        class属性：指定要创建对象的全限定类名
-->
<!-- 配置service -->
<bean id="accountService" class="com.itheima.service.impl.AccountServiceImpl"></bean>
<!-- 配置dao -->
<bean id="accountDao" class="com.itheima.dao.impl.AccountDaoImpl"></bean>
```

### 3.2.4 测试配置是否成功

```java
/**
 * 模拟一个表现层
 */
public class Client {
    /**
     * 使用main方法获取容器测试执行
     */
    public static void main(String[] args) {
        //1.使用ApplicationContext接口，就是在获取spring容器
        ApplicationContext ac = new ClassPathXmlApplicationContext("bean.xml");
        //2.根据bean的id获取对象
        IAccountService aService = (IAccountService) ac.getBean("accountService");
        System.out.println(aService);
        IAccountDao aDao = (IAccountDao) ac.getBean("accountDao");
        System.out.println(aDao);
    }
}
```

## 3.3 Spring基于XML的IOC细节

### 3.3.1 spring中工厂的类结构图

![image-20210729103539784](https://gitee.com/kongyin/picture_bed/raw/master/wx_picture/image-20210729103539784.png)

**BeanFactory 和 ApplicationContext 的区别**

BeanFactory 才是 Spring 容器中的顶层接口。

ApplicationContext 是它的子接口。

BeanFactory 和 ApplicationContext 的区别：

创建对象的时间点不一样。

ApplicationContext：只要一读取配置文件，默认情况下就会创建对象。

BeanFactory：什么使用什么时候创建对象。

### 3.3.2 ApplicationContext接口的实现类

ClassPathXmlApplicationContext：

它是从类的根路径下加载配置文件 推荐使用这种

FileSystemXmlApplicationContext：

它是从磁盘路径上加载配置文件，配置文件可以在磁盘的任意位置。

AnnotationConfigApplicationContext:

当我们使用注解配置容器对象时，需要使用此类来创建 spring 容器。它用来读取注解。

### 3.3.3 IOC中bean标签和管理对象细节

**bean标签**

作用：

用于配置对象让 spring 来创建的。

默认情况下它调用的是类中的无参构造函数。如果没有无参构造函数则不能创建成功。

属性：

id：给对象在容器中提供一个唯一标识。用于获取对象。

class：指定类的全限定类名。用于反射创建对象。默认情况下调用无参构造函数。

scope：指定对象的作用范围。

- singleton :默认值，单例的.
- prototype :多例的.
- request :WEB 项目中,Spring 创建一个 Bean 的对象,将对象存入到 request 域中.
- session :WEB 项目中,Spring 创建一个 Bean 的对象,将对象存入到 session 域中.
- global session :WEB 项目中,应用在 Portlet 环境.如果没有 Portlet 环境那么globalSession 相当于 session.

init-method：指定类中的初始化方法名称。

destroy-method：指定类中销毁方法名称。

**bean的作用范围和生命周期**

单例对象：scope="singleton"

一个应用只有一个对象的实例。它的作用范围就是整个引用。

生命周期：

对象出生：当应用加载，创建容器时，对象就被创建了。

对象活着：只要容器在，对象一直活着。

对象死亡：当应用卸载，销毁容器时，对象就被销毁了。

多例对象：scope="prototype"

每次访问对象时，都会重新创建对象实例。

生命周期：

对象出生：当使用对象时，创建新的对象实例。

对象活着：只要对象在使用中，就一直活着。

对象死亡：当对象长时间不用时，被 java 的垃圾回收器回收了。

### 3.3.4 实例化Bean的三种方式

第一种方式：使用默认无参构造函数

```xml
<!--在默认情况下：
        它会根据默认无参构造函数来创建类对象。如果bean中没有默认无参构造函数，将会创建失败。
-->
<bean id="accountService" class="com.itheima.service.impl.AccountServiceImpl"/>
```

第二种方式：spring 管理静态工厂-使用静态工厂的方法创建对象

```java
/**
 * 模拟一个静态工厂，创建业务层实现类
 */
public class StaticFactory {
    public static IAccountService createAccountService(){
        return new AccountServiceImpl();
    }
}
```

```xml
<!-- 此种方式是:
        使用StaticFactory类中的静态方法createAccountService创建对象，并存入spring容器
        id属性：指定bean的id，用于从容器中获取
        class属性：指定静态工厂的全限定类名
        factory-method属性：指定生产对象的静态方法
-->
<bean id="accountService" class="com.itheima.factory.StaticFactory" factory-method="createAccountService"></bean>
```

第三种方式：spring 管理实例工厂-使用实例工厂的方法创建对象

```java
/**
 * 模拟一个实例工厂，创建业务层实现类
 * 此工厂创建对象，必须现有工厂实例对象，再调用方法
 */
public class InstanceFactory {
    public IAccountService createAccountService(){
        return new AccountServiceImpl();
    }
}
```

```xml
<!-- 此种方式是：
        先把工厂的创建交给spring来管理。
        然后在使用工厂的bean来调用里面的方法
        factory-bean属性：用于指定实例工厂bean

2025-08-25 13:00:44,343 - evaluation_logger_Attraction-32 - INFO - Complete Result: {'score': 0, 'reason': 'The response does not address any of the requested information about the highest-rated attraction in Rome.'}
2025-08-25 13:00:49,448 - evaluation_logger_Attraction-32 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 13:00:49,448 - evaluation_logger_Attraction-32 - INFO - Message: Success.
2025-08-25 13:00:49,448 - evaluation_logger_Attraction-32 - INFO - Success turn num = 2
2025-08-25 13:00:49,448 - evaluation_logger_Attraction-32 - INFO - ----------------------------------------------------------------------------------------------------
