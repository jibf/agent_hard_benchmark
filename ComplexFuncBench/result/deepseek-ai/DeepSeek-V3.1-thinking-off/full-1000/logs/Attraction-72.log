2025-08-25 13:03:03,948 - evaluation_logger_Attraction-72 - INFO - Test Example Attraction-72
2025-08-25 13:03:03,948 - evaluation_logger_Attraction-72 - INFO - Query: Check if tickets are available for the two most trending attractions in Helsinki on any Tuesday in November 2024.
2025-08-25 13:03:11,858 - evaluation_logger_Attraction-72 - INFO - Function Calls: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Helsinki"
        }
    }
]

2025-08-25 13:03:11,858 - evaluation_logger_Attraction-72 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Helsinki"
        }
    },
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0xMzY0OTk1fQ==",
            "sortBy": "trending"
        }
    }
]

2025-08-25 13:03:11,858 - evaluation_logger_Attraction-72 - INFO - Start compare_single_call: 
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Helsinki'}}
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Helsinki'}}
2025-08-25 13:03:11,858 - evaluation_logger_Attraction-72 - INFO - Rule-based compare success.
2025-08-25 13:03:11,858 - evaluation_logger_Attraction-72 - INFO - Success matched: [{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Helsinki'}}]
2025-08-25 13:03:11,859 - evaluation_logger_Attraction-72 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "products": [
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJHYzRqSjhZTndIIiwidWZpIjotMTM2NDk5NX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Helsinki Private Transfer from Helsinki city centre to Helsinki airport",
                    "productId": "PRGc4jJ8YNwH",
                    "productSlug": "prgc4jj8ynwh-helsinki-private-transfer-from-helsinki-city-centre-to-helsinki-air",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -1364995,
                    "cityName": "Helsinki",
                    "countryCode": "fi"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFI2OE1TWW1vQ2JMIiwidWZpIjotMTM2NDk5NX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Helsinki Walking Tour at Helsinki Architecture",
                    "productId": "PR68MSYmoCbL",
                    "productSlug": "pr68msymocbl-helsinki-walking-tour-at-helsinki-architecture",
                    "taxonomySlug": "tours",
                    "cityUfi": -1364995,
                    "cityName": "Helsinki",
                    "countryCode": "fi"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJsN0Z6OVcwR3Y4IiwidWZpIjotMTM2NDk5NX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Helsinki Card City and Helsinki Card Region",
                    "productId": "PRl7Fz9W0Gv8",
                    "productSlug": "prl7fz9w0gv8-helsinki-card-city-and-helsinki-card-region",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -1364995,
                    "cityName": "Helsinki",
                    "countryCode": "fi"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFI4ampLanpjRWRZIiwidWZpIjotMTM2NDk5NX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Helsinki City hotels to Helsinki Airport (HEL) Departure Transfer",
                    "productId": "PR8jjKjzcEdY",
                    "productSlug": "pr8jjkjzcedy-helsinki-city-hotels-to-helsinki-airport-hel-departure-transfer",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -1364995,
                    "cityName": "Helsinki",
                    "countryCode": "fi"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJJMWt3d2h1UlZ6IiwidWZpIjotMTM2NDk5NX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Private Transfer from Helsinki Hotels to Helsinki Cruise Terminal",
                    "productId": "PRI1kwwhuRVz",
                    "productSlug": "pri1kwwhurvz-private-transfer-from-helsinki-hotels-to-helsinki-cruise-terminal",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -1364995,
                    "cityName": "Helsinki",
                    "countryCode": "fi"
                }
            ],
            "destinations": [
                {
                    "id": "eyJ1ZmkiOi0xMzY0OTk1fQ==",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": -1364995,
                    "country": "Finland",
                    "cityName": "Helsinki",
                    "productCount": 204,
                    "cc1": "fi"
                },
                {
                    "id": "eyJ1ZmkiOi0yNjI1NjYwfQ==",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": -2625660,
                    "country": "Estonia",
                    "cityName": "Tallinn",
                    "productCount": 130,
                    "cc1": "ee"
                }
            ]
        }
    }
]

2025-08-25 13:03:22,138 - evaluation_logger_Attraction-72 - INFO - Function Calls: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0xMzY0OTk1fQ==",
            "sortBy": "trending"
        }
    }
]

2025-08-25 13:03:22,138 - evaluation_logger_Attraction-72 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0xMzY0OTk1fQ==",
            "sortBy": "trending"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRMppJ2UgjvC"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PR5AATXQIZtX"
        }
    }
]

2025-08-25 13:03:22,138 - evaluation_logger_Attraction-72 - INFO - Start compare_single_call: 
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0xMzY0OTk1fQ==', 'sortBy': 'trending'}}
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0xMzY0OTk1fQ==', 'sortBy': 'trending'}}
2025-08-25 13:03:22,138 - evaluation_logger_Attraction-72 - INFO - Rule-based compare success.
2025-08-25 13:03:22,138 - evaluation_logger_Attraction-72 - INFO - Success matched: [{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0xMzY0OTk1fQ==', 'sortBy': 'trending'}}]
2025-08-25 13:03:22,139 - evaluation_logger_Attraction-72 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProductSearchResponse",
            "products": [
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRMppJ2UgjvC",
                    "name": "Helsinki to Tallinn Self-Guided Day Return Voyage MyStar/Megastar",
                    "slug": "prmppj2ugjvc-tallink-shuttle-round-trip-ferry-tickets-from-helsinki-to-tallinn",
                    "shortDescription": "Discover the beautiful Medieval city of Tallinn in one day. Your one-way ferry crossing on board ...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 44.18,
                        "currency": "USD",
                        "publicAmount": 44.18
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.8,
                            "total": 142
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Helsinki",
                        "ufi": -1364995
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIhmXcmxyVfI"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIqMQqoCBgAg"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIvtP3P9VlZI"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIGzJnjbLbfY"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI95q8ScJGrL"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIDfwG4K6eTl"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OITK8ZC8NDki"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIbpSlBCFxMH"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI77O80t6Pb0"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIElvmOEtx6i"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIIFM8gAnwh9"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIxPmtC4lQsZ"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIXUJdOkfPwH"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIyEoCH95F9w"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIH6a2by8Wuc"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 1
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PR5AATXQIZtX",
                    "name": "Tip-based Free Walking Tour of Helsinki - RED UMBRELLA TOURS",
                    "slug": "pr5aatxqiztx-free-tip-based-tour-historic-helsinki-walking-tour",
                    "shortDescription": "DISCOVER HELSINKI on our FREE TO JOIN walking tour \n\nMultiple tours every day - check our booking...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 3.23,
                        "currency": "USD",
                        "publicAmount": 3.23
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.5,
                            "total": 109
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Helsinki",
                        "ufi": -1364995
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIFtQUcmdH9y"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 2
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRbmgpj458IA",
                    "name": "A Finntastic Walking Tour in Helsinki",
                    "slug": "prbmgpj458ia-free-walking-tour-in-helsinki-tip-based",
                    "shortDescription": "In this Finntastic tour, we are going to visit the highlights of Helsinki and learn together abou...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 20.47,
                        "currency": "USD",
                        "publicAmount": 20.47
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.8,
                            "total": 94
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Helsinki",
                        "ufi": -1364995
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIHeNf0vDKrs"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIj8hpzvcDCB"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIpqUQ9QGF4d"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 5
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRgWY0k6IaAD",
                    "name": "Helsinki Archipelago Sightseeing Cruise",
                    "slug": "prgwy0k6iaad-90-minute-helsinki-archipelago-cruise",
                    "shortDescription": "A relaxing cruise to explore Helsinki's archipelago and see historical sights",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 28.02,
                        "currency": "USD",
                        "publicAmount": 28.02
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 29,
                        "percentage": "97%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.2,
                            "total": 56
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Helsinki",
                        "ufi": -1364995
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIai4roPGnMc"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OISBtjUpM6wo"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIYhGfYhl8LX"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIoKrOVrupze"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIhnmQNDIDBm"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIiJSf4HAJFy"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIoB4z1tEdNk"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIlLq36PlCId"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OISSvKqbJEPw"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI5jTnt6CkMx"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIntuBJkjnFS"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIpGcxCnxqzW"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIIzdP6Ab08N"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIOACorfVpkJ"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIUcgniNRoJU"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 7
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRZ3S5MYcisS",
                    "name": "Helsinki Panorama Sightseeing Audio-Guided Bus Tour",
                    "slug": "prz3s5myciss-sightseeing-bus-tour",
                    "shortDescription": "Choose from 11 languages on this audio-guided Helsinki Panorama Sightseeing. The tour takes you i...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 37.58,
                        "currency": "USD",
                        "publicAmount": 37.58
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 11,
                        "percentage": "100%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.3,
                            "total": 42
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Helsinki",
                        "ufi": -1364995
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIJr1CwLNGbM"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI8mIfRA7U2h"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OInUsbgNk78b"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForTours",
                            "value": true,
                            "rank": 1
                        }
                    ]
                }
            ],
            "filterStats": {
                "__typename": "FilterStats",
                "unfilteredProductCount": 209,
                "filteredProductCount": 209
            },
            "sorters": [
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Our top picks",
                    "value": "trending"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Most popular",
                    "value": "attr_book_score"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Lowest price",
                    "value": "lowest_price"
                }
            ],
            "defaultSorter": {
                "__typename": "AttractionsSorterOption",
                "name": "Our top picks",
                "value": "trending"
            },
            "filterOptions": {
                "__typename": "FilterOptions",
                "typeFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Tours",
                        "tagname": "tours",
                        "productCount": 48
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Nature & outdoor",
                        "tagname": "nature-outdoor",
                        "productCount": 35
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Museums, arts & culture",
                        "tagname": "museums-arts-culture",
                        "productCount": 32
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Entertainment & tickets",
                        "tagname": "entertainment-tickets",
                        "productCount": 7
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Travel services & rentals",
                        "tagname": "travel-services-rental",
                        "productCount": 2
                    }
                ],
                "labelFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Free cancellation",
                        "tagname": "free_cancellation",
                        "productCount": 179
                    }
                ],
                "ufiFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Helsinki",
                        "tagname": "-1364995",
                        "productCount": 209
                    }
                ],
                "priceFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "US$0 - US$22",
                        "tagname": "b0",
                        "productCount": 14
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$22 - US$44",
                        "tagname": "b1",
                        "productCount": 6
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$44 - US$83",
                        "tagname": "b2",
                        "productCount": 16
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$83 - US$138",
                        "tagname": "b3",
                        "productCount": 22
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$138+",
                        "tagname": "b4",
                        "productCount": 153
                    }
                ]
            }
        }
    }
]

2025-08-25 13:03:32,283 - evaluation_logger_Attraction-72 - INFO - Function Calls: 
[
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRMppJ2UgjvC"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PR5AATXQIZtX"
        }
    }
]

2025-08-25 13:03:32,283 - evaluation_logger_Attraction-72 - INFO - Golden Function Call: 
[
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRMppJ2UgjvC"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PR5AATXQIZtX"
        }
    }
]

2025-08-25 13:03:32,283 - evaluation_logger_Attraction-72 - INFO - Start compare_single_call: 
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRMppJ2UgjvC'}}
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRMppJ2UgjvC'}}
2025-08-25 13:03:32,283 - evaluation_logger_Attraction-72 - INFO - Rule-based compare success.
2025-08-25 13:03:32,283 - evaluation_logger_Attraction-72 - INFO - Start compare_single_call: 
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PR5AATXQIZtX'}}
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PR5AATXQIZtX'}}
2025-08-25 13:03:32,283 - evaluation_logger_Attraction-72 - INFO - Rule-based compare success.
2025-08-25 13:03:32,283 - evaluation_logger_Attraction-72 - INFO - Success matched: [{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRMppJ2UgjvC'}}, {'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PR5AATXQIZtX'}}]
2025-08-25 13:03:32,284 - evaluation_logger_Attraction-72 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "timestamp": 1729840026345,
        "data": [
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-10-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-10-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-31"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-31"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-23"
            }
        ]
    },
    {
        "status": true,
        "message": "Success",
        "timestamp": 1729840051792,
        "data": [
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-31"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-31"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-23"
            }
        ]
    }
]

2025-08-25 13:05:45,694 - evaluation_logger_Attraction-72 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 前言

在上一篇文章中，我们实现了`axios`的请求和响应配置化，即让用户可以对请求和响应进行相关配置。那么在这一篇文章中，我们就要来实现`axios`的拦截器功能。拦截器是`axios`非常强大的一个功能，用户可以通过拦截器在请求发送之前和响应返回之后做一些额外的事情。

# 2. 拦截器介绍

## 2.1 请求拦截器

请求拦截器的作用是在请求发送前统一执行某些操作，比如在请求头中添加`token`字段。

## 2.2 响应拦截器

响应拦截器的作用是在接收到服务器响应后统一执行某些操作，比如发现响应状态码为`401`时，自动跳转到登录页。

## 2.3 取消拦截器

`axios` 拦截器支持取消，可以基于如下方式取消拦截器：

```javascript
const myInterceptor = axios.interceptors.request.use(function () {
  /*...*/
});
axios.interceptors.request.eject(myInterceptor);
```

## 2.4 使用示例

```javascript
// 添加一个请求拦截器
axios.interceptors.request.use(
  function (config) {
    // 在发送请求之前可以做一些事情
    return config;
  },
  function (error) {
    // 处理请求错误
    return Promise.reject(error);
  }
);

// 添加一个响应拦截器
axios.interceptors.response.use(
  function (response) {
    // 处理响应数据
    return response;
  },
  function (error) {
    // 处理响应错误
    return Promise.reject(error);
  }
);
```

# 3. 实现思路

从使用示例中我们可以看到，`axios` 对象上有一个 `interceptors` 对象属性，该属性又有 `request` 和 `response` 2 个属性，它们都有一个 `use` 方法和 `eject` 方法。`use` 方法用于添加拦截器函数，`eject` 方法用于移除拦截器函数。

通过观察 `use` 方法的使用方式，我们可以知道：`use` 方法接收两个函数作为参数，第一个函数用于处理正常情况，第二个函数用于处理异常情况。并且，我们可以多次调用 `use` 方法来添加多个拦截器，拦截器的执行顺序是：对于请求拦截器，后添加的拦截器先执行；对于响应拦截器，先添加的拦截器先执行。

那么，我们应该如何实现拦截器呢？其实也很简单，我们可以在 `axios` 对象上添加一个 `interceptors` 属性，该属性有 `request` 和 `response` 两个属性，它们都是一个拦截器管理类的实例，该管理类可以用来添加拦截器和移除拦截器，并且还可以将添加的拦截器按照顺序存储起来，以便于后续按顺序执行。

另外，我们还需要修改之前的 `request` 方法，在发送请求前先按顺序执行所有请求拦截器，然后再发送请求；在请求返回后先按顺序执行所有响应拦截器，然后再将响应返回。

OK，思路已经理清，接下来我们就按照这个思路来实现拦截器。

# 4. 拦截器管理类实现

根据之前思路，我们需要先实现一个拦截器管理类，用于添加、移除和遍历拦截器。我们在`src`目录下创建`interceptorManager.ts`文件，作为拦截器管理类。

```typescript
// src/interceptorManager.ts

import { ResolvedFn, RejectedFn } from "../types";

interface Interceptor<T> {
  resolved: ResolvedFn<T>;
  rejected?: RejectedFn;
}

export default class InterceptorManager<T> {
  private interceptors: Array<Interceptor<T> | null>;

  constructor() {
    this.interceptors = [];
  }

  use(resolved: ResolvedFn<T>, rejected?: RejectedFn): number {
    this.interceptors.push({
      resolved,
      rejected,
    });
    return this.interceptors.length - 1;
  }

  forEach(fn: (interceptor: Interceptor<T>) => void): void {
    this.interceptors.forEach((interceptor) => {
      if (interceptor !== null) {
        fn(interceptor);
      }
    });
  }

  eject(id: number): void {
    if (this.interceptors[id]) {
      this.interceptors[id] = null;
    }
  }
}
```

我们定义了一个 `InterceptorManager` 泛型类，内部维护了一个私有属性 `interceptors`，它是一个数组，用来存储拦截器。该类还对外提供了 3 个方法，其中：

- `use`：添加一个拦截器到拦截器数组中，并返回一个 `id` 用于删除；
- `forEach`：遍历拦截器；
- `eject`：删除一个拦截器；

另外，我们定义了 `Interceptor` 泛型接口，它支持两个函数属性：`resolved` 和 `rejected`，分别作为成功回调和失败回调。

# 5. 给 Axios 类添加 interceptors 属性

接下来，我们给 `Axios` 类添加 `interceptors` 属性，该属性类型为 `Interceptor` 类型，它包含 `request` 和 `response` 属性，并且它们都是 `InterceptorManager` 的实例。

首先，我们需要在 `src/types/index.ts` 中定义 `Interceptor` 类型。

```typescript
// src/types/index.ts

export interface Interceptors {
  request: InterceptorManager<AxiosRequestConfig>;
  response: InterceptorManager<AxiosResponse>;
}
```

然后，在 `Axios` 类中添加 `interceptors` 属性。

```typescript
// src/core/Axios.ts

import { Interceptors } from "./types";
import InterceptorManager from "./interceptorManager";

export default class Axios {
  interceptors: Interceptors;

  constructor() {
    this.interceptors = {
      request: new InterceptorManager<AxiosRequestConfig>(),
      response: new InterceptorManager<AxiosResponse>(),
    };
  }

  // ...
}
```

# 6. 修改 request 方法

接下来，我们需要修改 `request` 方法，在发送请求前先按顺序执行所有请求拦截器，然后再发送请求；在请求返回后先按顺序执行所有响应拦截器，然后再将响应返回。

由于拦截器的执行过程是一个链式调用的过程，我们往往会实现一个链式调用的 `Promise`，并且需要给每个拦截器传入 `request config` 或 `response`，所以我们先要定义一个拦截器链类型。

在 `src/types/index.ts` 中定义：

```typescript
export interface PromiseChain<T> {
  resolved: ResolvedFn<T> | ((config: AxiosRequestConfig) => AxiosPromise);
  rejected?: RejectedFn;
}
```

然后，我们修改 `request` 方法，添加拦截器链式调用逻辑：

```typescript
// src/core/Axios.ts

request(url: any, config?: any): AxiosPromise {
  if (typeof url === 'string') {
    if (!config) {
      config = {}
    }
    config.url = url
  } else {
    config = url
  }

  const chain: PromiseChain<any>[] = [{
    resolved: dispatchRequest,
    rejected: undefined
  }]

  this.interceptors.request.forEach(interceptor => {
    chain.unshift(interceptor)
  })

  this.interceptors.response.forEach(interceptor => {
    chain.push(interceptor)
  })

  let promise = Promise.resolve(config)

  while (chain.length) {
    const { resolved, rejected } = chain.shift()!
    promise = promise.then(resolved, rejected)
  }

  return promise
}
```

首先，我们构造一个 `PromiseChain` 类型的数组 `chain`，并把 `dispatchRequest` 函数赋值给 `resolved` 属性；接着先遍历请求拦截器插入到 `chain` 的前面；然后再遍历响应拦截器插入到 `chain` 的后面。

接下来定义一个已经 `resolve` 的 `promise`，循环这个 `chain`，拿到每个拦截器对象，把它们的 `resolved` 函数和 `rejected` 函数添加到 `promise.then` 的参数中，这样就相当于通过 `Promise` 的链式调用方式，实现了拦截器一层层的链式调用的效果。

注意：我们拦截器的执行顺序是对于请求拦截器，先执行后添加的，再执行先添加的；而对于响应拦截器，先执行先添加的，后执行后添加的。

# 7. 编写 demo

接下来，我们编写 `demo` 来测试拦截器功能是否正常。

在 `examples` 目录下创建 `interceptors` 目录，并在该目录下创建 `index.html`:

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>interceptors demo</title>
  </head>
  <body>
    <script src="/__build__/interceptors.js"></script>
  </body>
</html>
```

接着再创建 `app.ts` 作为入口文件：

```typescript
// examples/interceptors/app.ts

import axios from "../../src/index";

axios.interceptors.request.use((config) => {
  config.headers.test += "1";
  return config;
});
axios.interceptors.request.use((config) => {
  config.headers.test += "2";
  return config;
});
axios.interceptors.request.use((config) => {
  config.headers.test += "3";
  return config;
});

axios.interceptors.response.use((res) => {
  res.data += "1";
  return res;
});
let interceptor = axios.interceptors.response.use((res) => {
  res.data += "2";
  return res;
});
axios.interceptors.response.use((res) => {
  res.data += "3";
  return res;
});

axios.interceptors.response.eject(interceptor);

axios({
  url: "/interceptor/get",
  method: "get",
  headers: {
    test: "",
  },
}).then((res) => {
  console.log(res.data);
});
```

该 `demo` 中我们添加了 3 个请求拦截器，添加了 3 个响应拦截器并移除了一个响应拦截器。运行该 `demo` 后我们会在控制台看到输出：`13`。

我们打开浏览器，访问 `http://localhost:8000/` 后，点击 `interceptors`，通过 `F12` 的 `network` 部分我们可以看到多个请求，其中有一个请求的请求头为：`test: 321`，而响应数据为：`13`。

![](~@/axios/13/01.png)

![](~@/axios/13/02.png)

OK，拦截器功能正常。

# 8. 遗留问题

我们虽然实现了拦截器功能，但是还是有一个小问题：在 `Axios` 类的 `request` 方法中，我们创建了一个 `Promise` 对象，然后把 `config` 传递进去，这个 `Promise` 对象链式调用了拦截器和 `dispatchRequest` 方法，最终返回了 `promise`。但是我们在 `dispatchRequest` 方法中返回的却是一个 `AxiosPromise` 类型，即 `Promise<AxiosResponse>` 类型。那么，如果用户拦截器里面异步修改了 `config`，那么我们在 `dispatchRequest` 方法中收到的 `config` 就已经被修改了，但是它的类型依然是 `AxiosRequestConfig`，这显然是不合理的，因为用户可能会在拦截器中修改 `config` 中的属性，比如把 `url` 从字符串变成对象，那么我们在 `dispatchRequest` 方法中就会出错。

所以，我们需要在 `dispatchRequest` 方法中处理这种情况，但是目前我们还没有实现，这个问题我们先记下，后面再来解决。

# 9. 总结

在本篇文章中，我们给 `axios` 实现了拦截器功能，并且通过 `Promise` 链式调用的方式实现了拦截器的执行顺序。在下一篇文章中，我们将会实现 `axios` 的配置化，即允许用户为所有请求设置默认配置，并且允许用户为每个请求设置自定义配置，并且自定义配置会与默认配置合并。



2025-08-25 13:05:52,140 - evaluation_logger_Attraction-72 - INFO - Complete Result: {'score': 0, 'reason': 'The response does not address any of the requested information about ticket availability for attractions in Helsinki.'}
2025-08-25 13:05:59,123 - evaluation_logger_Attraction-72 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 13:05:59,124 - evaluation_logger_Attraction-72 - INFO - Message: Success.
2025-08-25 13:05:59,124 - evaluation_logger_Attraction-72 - INFO - Success turn num = 3
2025-08-25 13:05:59,124 - evaluation_logger_Attraction-72 - INFO - ----------------------------------------------------------------------------------------------------
