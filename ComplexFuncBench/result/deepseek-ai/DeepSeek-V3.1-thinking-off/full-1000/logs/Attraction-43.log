2025-08-25 12:59:06,171 - evaluation_logger_Attraction-43 - INFO - Test Example Attraction-43
2025-08-25 12:59:06,172 - evaluation_logger_Attraction-43 - INFO - Query: I'm thinking about heading to Chicago. Can you tell me which museums are currently trending?
2025-08-25 12:59:13,830 - evaluation_logger_Attraction-43 - INFO - Function Calls: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Chicago"
        }
    }
]

2025-08-25 12:59:13,830 - evaluation_logger_Attraction-43 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Chicago"
        }
    },
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOjIwMDMzMTczfQ==",
            "sortBy": "trending"
        }
    }
]

2025-08-25 12:59:13,830 - evaluation_logger_Attraction-43 - INFO - Start compare_single_call: 
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Chicago'}}
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Chicago'}}
2025-08-25 12:59:13,830 - evaluation_logger_Attraction-43 - INFO - Rule-based compare success.
2025-08-25 12:59:13,830 - evaluation_logger_Attraction-43 - INFO - Success matched: [{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Chicago'}}]
2025-08-25 12:59:13,830 - evaluation_logger_Attraction-43 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "destinations": [
                {
                    "id": "eyJ1ZmkiOjIwMDMzMTczfQ==",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": 20033173,
                    "country": "United States",
                    "cityName": "Chicago",
                    "productCount": 362,
                    "cc1": "us"
                }
            ]
        }
    }
]

2025-08-25 12:59:24,677 - evaluation_logger_Attraction-43 - INFO - Function Calls: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOjIwMDMzMTczfQ==",
            "sortBy": "trending"
        }
    }
]

2025-08-25 12:59:24,677 - evaluation_logger_Attraction-43 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOjIwMDMzMTczfQ==",
            "sortBy": "trending"
        }
    }
]

2025-08-25 12:59:24,677 - evaluation_logger_Attraction-43 - INFO - Start compare_single_call: 
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOjIwMDMzMTczfQ==', 'sortBy': 'trending'}}
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOjIwMDMzMTczfQ==', 'sortBy': 'trending'}}
2025-08-25 12:59:24,677 - evaluation_logger_Attraction-43 - INFO - Rule-based compare success.
2025-08-25 12:59:24,677 - evaluation_logger_Attraction-43 - INFO - Success matched: [{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOjIwMDMzMTczfQ==', 'sortBy': 'trending'}}]
2025-08-25 12:59:24,678 - evaluation_logger_Attraction-43 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProductSearchResponse",
            "products": [
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRvnLxjqvCAI",
                    "name": "90-minute Tour of the Chicago River",
                    "slug": "prvnlxjqvcai-90-minute-tour-of-the-chicago-river",
                    "shortDescription": "Visit on a boat to see the architecture of the buildings along the river",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 44,
                        "currency": "USD",
                        "publicAmount": 44
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 402,
                        "percentage": "96%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.6,
                            "total": 517
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Chicago",
                        "ufi": 20033173
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIzb7WVjzM5E"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIPrju5yCuWn"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIlTiL30RUMp"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIanC5pUZbT9"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInMonth",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInWeek",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerOnWeekends",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForTours",
                            "value": true,
                            "rank": 2
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": false
                    },
                    "id": "PR1wbMkxhvpQ",
                    "name": "45-minute Architecture River Cruise",
                    "slug": "pr1wbmkxhvpq-45-minute-architecture-river-cruise",
                    "shortDescription": "A chance to take a leisurely river cruise to explore Chicago's iconic architecture",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 28,
                        "currency": "USD",
                        "publicAmount": 28
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 207,
                        "percentage": "98%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.7,
                            "total": 387
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Chicago",
                        "ufi": 20033173
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI0FO6vbHygI"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIe2wCiSFFbq"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIp8qzSzl5Ko"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIqV8DciuR08"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInMonth",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInWeek",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerOnWeekends",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForTours",
                            "value": true,
                            "rank": 1
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PROaaAjV9hgb",
                    "name": "Architecture River Cruise",
                    "slug": "proaaajv9hgb-architecture-river-cruise",
                    "shortDescription": "A scenic river cruise to explore Chicago's iconic architecture and famous landmarks by water",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 53.7,
                        "currency": "USD",
                        "publicAmount": 53.7
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 59,
                        "percentage": "98%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.8,
                            "total": 149
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Chicago",
                        "ufi": 20033173
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI1oHTJ0hDrY"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIAHxrI82jIJ"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIyXhemS1hOI"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIOBmo6RBoJu"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIko1EbTogj8"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIDQjmeTVgan"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIeVQ6vyz5qQ"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI7JdQUFFQov"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIdx7RYTBcya"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIjkDZuVLaDU"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIlozK4FGe0M"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIjEzcwHRmYh"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIRtkOIrStP4"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIx0DUj3dvkQ"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIalJaW4JaQp"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIchH4Hi25Zn"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI2jP0u79Nrs"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIpKiXRxdnmV"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIu6a0cMNIim"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIMcNUVJQNrb"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIGOubB8eq7X"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OILY6F97OIVY"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIqcdXt1Hpmi"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 7
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForTours",
                            "value": true,
                            "rank": 3
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRe0DPOBCAMB",
                    "name": "45-minute Chicago River Architecture Boat Tour",
                    "slug": "pre0dpobcamb-45-minute-chicago-river-architecture-boat-tour",
                    "shortDescription": "A discovery of the city's most iconic buildings and landmarks",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 28,
                        "currency": "USD",
                        "publicAmount": 28
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 32,
                        "percentage": "97%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.7,
                            "total": 583
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Chicago",
                        "ufi": 20033173
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIVmXpSINtra"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIpng7kT2ld7"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI4WXZ4L7tpX"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 3
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": false
                    },
                    "id": "PR24xqhSVHog",
                    "name": "CityPASS Ticket",
                    "slug": "pr24xqhsvhog-citypass-ticket",
                    "shortDescription": "A ticket that grants entry to some of Chicago's most iconic attractions",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 139,
                        "currency": "USD",
                        "publicAmount": 139
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 50,
                        "percentage": "82%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.8,
                            "total": 54
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Chicago",
                        "ufi": 20033173
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIx9ihFO275M"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIbohNsWGV7A"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIk6r3nEEDl5"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIBKukku3iKt"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIliiPLfFc6m"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIZXQcSai0d7"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIGd6ouAeX32"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 5
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInMonth",
                            "value": true,
                            "rank": 3
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInWeek",
                            "value": true,
                            "rank": 3
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerOnWeekends",
                            "value": true,
                            "rank": 3
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForAttractions",
                            "value": true,
                            "rank": 1
                        }
                    ]
                }
            ],
            "filterStats": {
                "__typename": "FilterStats",
                "unfilteredProductCount": 292,
                "filteredProductCount": 292
            },
            "sorters": [
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Our top picks",
                    "value": "trending"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Most popular",
                    "value": "attr_book_score"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Lowest price",
                    "value": "lowest_price"
                }
            ],
            "defaultSorter": {
                "__typename": "AttractionsSorterOption",
                "name": "Our top picks",
                "value": "trending"
            },
            "filterOptions": {
                "__typename": "FilterOptions",
                "typeFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Tours",
                        "tagname": "tours",
                        "productCount": 200
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Transfers & services",
                        "tagname": "transfers-services",
                        "productCount": 50
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Activities",
                        "tagname": "activities",
                        "productCount": 24
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Museums",
                        "tagname": "museums",
                        "productCount": 8
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Landmarks",
                        "tagname": "landmarks",
                        "productCount": 5
                    }
                ],
                "labelFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Free cancellation",
                        "tagname": "free_cancellation",
                        "productCount": 254
                    }
                ],
                "ufiFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Chicago",
                        "tagname": "20033173",
                        "productCount": 292
                    }
                ],
                "priceFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "US$0 - US$22",
                        "tagname": "b0",
                        "productCount": 34
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$22 - US$44",
                        "tagname": "b1",
                        "productCount": 51
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$44 - US$83",
                        "tagname": "b2",
                        "productCount": 60
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$83 - US$138",
                        "tagname": "b3",
                        "productCount": 44
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$138+",
                        "tagname": "b4",
                        "productCount": 104
                    }
                ]
            }
        }
    }
]

2025-08-25 13:02:34,565 - evaluation_logger_Attraction-43 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 概述

本文，我们来分享 [MyBatis 的日志模块](https://github.com/YunaiV/mybatis-3/tree/master/src/main/java/org/apache/ibatis/logging)，对应 `logging` 包。如下图所示：[![`logging` 包](http://static.iocoder.cn/images/MyBatis/2020_01_07/01.png)](http://static.iocoder.cn/images/MyBatis/2020_01_07/01.png)`logging` 包

在 [《精尽 MyBatis 源码解析 —— 项目结构一览》](http://svip.iocoder.cn/MyBatis/intro) 中，简单介绍了这个模块如下：

> 无论在开发测试环境中，还是在线上生产环境中，日志在整个系统中的地位都是非常重要的。良好的日志功能可以帮助开发人员和测试人员快速定位 Bug 代码，也可以帮助运维人员快速定位故障点。MyBatis 作为一个设计优良的框架，除了提供详细的日志输出信息，还要能够集成多种日志框架，其日志模块的一个主要功能就是**集成第三方日志框架**。

本文涉及的类如下图所示：![类图](http://static.iocoder.cn/images/MyBatis/2020_01_07/02.png)

- 从图的**上面**部分，我们可以看到，MyBatis 直接使用了多种第三方日志框架；
- 从图的**下面**部分，我们可以看到，MyBatis 提供了 `Log` 接口，组合第三方日志框架。并且，提供了 `LogFactory` 工厂，用于创建对应的 Log 对象。

下面，我们逐小节来分享。

# 2. Log

`org.apache.ibatis.logging.Log` ，MyBatis Log 接口。代码如下：

```java
// Log.java

public interface Log {

    boolean isDebugEnabled();

    boolean isTraceEnabled();

    void error(String s, Throwable e);

    void error(String s);

    void debug(String s);

    void trace(String s);

    void warn(String s);

}
```

## 2.1 LogFactory

`org.apache.ibatis.logging.LogFactory` ，Log 工厂类。代码如下：

```java
// LogFactory.java

public final class LogFactory {

    /**
     * Marker to be used by logging implementations that support markers.
     */
    public static final String MARKER = "MYBATIS";

    /**
     * 使用的 Log 的构造方法
     */
    private static Constructor<? extends Log> logConstructor;

    static {
        // <1> 尝试逐个初始化，直到成功
        tryImplementation(LogFactory::useSlf4jLogging);
        tryImplementation(LogFactory::useCommonsLogging);
        tryImplementation(LogFactory::useLog4J2Logging);
        tryImplementation(LogFactory::useLog4JLogging);
        tryImplementation(LogFactory::useJdkLogging);
        tryImplementation(LogFactory::useNoLogging);
    }

    private LogFactory() {
        // disable construction
    }

    public static Log getLog(Class<?> aClass) {
        return getLog(aClass.getName());
    }

    public static Log getLog(String logger) {
        try {
            // 创建 Log 对象
            return logConstructor.newInstance(logger);
        } catch (Throwable t) {
            throw new LogException("Error creating logger for logger " + logger + ".  Cause: " + t, t);
        }
    }

    public static synchronized void useCustomLogging(Class<? extends Log> clazz) {
        setImplementation(clazz);
    }

    public static synchronized void useSlf4jLogging() {
        setImplementation(org.apache.ibatis.logging.slf4j.Slf4jImpl.class);
    }

    public static synchronized void useCommonsLogging() {
        setImplementation(org.apache.ibatis.logging.commons.JakartaCommonsLoggingImpl.class);
    }

    public static synchronized void useLog4JLogging() {
        setImplementation(org.apache.ibatis.logging.log4j.Log4jImpl.class);
    }

    public static synchronized void useLog4J2Logging() {
        setImplementation(org.apache.ibatis.logging.log4j2.Log4j2Impl.class);
    }

    public static synchronized void useJdkLogging() {
        setImplementation(org.apache.ibatis.logging.jdk14.Jdk14LoggingImpl.class);
    }

    public static synchronized void useStdOutLogging() {
        setImplementation(org.apache.ibatis.logging.stdout.StdOutImpl.class);
    }

    public static synchronized void useNoLogging() {
        setImplementation(org.apache.ibatis.logging.nologging.NoLoggingImpl.class);
    }

    private static void tryImplementation(Runnable runnable) {
        if (logConstructor == null) {
            try {
                runnable.run();
            } catch (Throwable t) {
                // ignore
            }
        }
    }

    private static void setImplementation(Class<? extends Log> implClass) {
        try {
            // 获得参数为 String 的构造方法
            Constructor<? extends Log> candidate = implClass.getConstructor(String.class);
            // 创建 Log 对象
            Log log = candidate.newInstance(LogFactory.class.getName());
            if (log.isDebugEnabled()) {
                log.debug("Logging initialized using '" + implClass + "' adapter.");
            }
            // 创建成功，意味着可以使用，设置为 logConstructor
            logConstructor = candidate;
        } catch (Throwable t) {
            throw new LogException("Error setting Log implementation.  Cause: " + t, t);
        }
    }

}
```

- `logConstructor` 静态属性，使用的 Log 的构造方法。在 `#setImplementation(Class<? extends Log> implClass)` 方法中，会初始化和设置该属性。
- `<1>` 处，在**静态**代码块中，会尝试逐个初始化，直到成功。代码如下：

  ```java
  // LogFactory.java
  
  static {
      // <1> 尝试逐个初始化，直到成功
      tryImplementation(LogFactory::useSlf4jLogging);
      tryImplementation(LogFactory::useCommonsLogging);
      tryImplementation(LogFactory::useLog4J2Logging);
      tryImplementation(LogFactory::useLog4JLogging);
      tryImplementation(LogFactory::useJdkLogging);
      tryImplementation(LogFactory::useNoLogging);
  }
  
  private static void tryImplementation(Runnable runnable) {
      if (logConstructor == null) { // 若 logConstructor 为空，说明还未初始化过
          try {
              runnable.run();
          } catch (Throwable t) {
              // ignore
          }
      }
  }
  ```

  - 从代码中，我们可以看到，按照 `SLF4J` > `Commons Logging` > `Log4J2` > `Log4J` > `Jdk Logging` > `No Logging` 的顺序尝试初始化。
  - 也就是说，`SLF4J` 的优先级最高，而 `No Logging` 的优先级最低。如果我们有多个日志框架同时存在，**希望使用哪个日志框架，需要前置配置**。

- `#setImplementation(Class<? extends Log> implClass)` 方法，初始化 `logConstructor` 。代码如下：

  ```java
  // LogFactory.java
  
  private static void setImplementation(Class<? extends Log> implClass) {
      try {
          // 获得参数为 String 的构造方法
          Constructor<? extends Log> candidate = implClass.getConstructor(String.class);
          // 创建 Log 对象
          Log log = candidate.newInstance(LogFactory.class.getName());
          if (log.isDebugEnabled()) {
              log.debug("Logging initialized using '" + implClass + "' adapter.");
          }
          // 创建成功，意味着可以使用，设置为 logConstructor
          logConstructor = candidate;
      } catch (Throwable t) {
          throw new LogException("Error setting Log implementation.  Cause: " + t, t);
      }
  }
  ```

  - 通过调用该方法，从而初始化 `logConstructor` 属性。

- `#getLog(...)` 方法，创建 Log 对象。代码如下：

  ```java
  // LogFactory.java
  
  public static Log getLog(Class<?> aClass) {
      return getLog(aClass.getName());
  }
  
  public static Log getLog(String logger) {
      try {
          // 创建 Log 对象
          return logConstructor.newInstance(logger);
      } catch (Throwable t) {
          throw new LogException("Error creating logger for logger " + logger + ".  Cause: " + t, t);
      }
  }
  ```

  - 通过 `logConstructor` 反射的方式，创建 Log 对象。

## 2.2 Adapter

在 `logging` 包下，有多个包，分别对应多种日志框架。每个包下，都有对应的 Log 实现类。如下图所示：![Adapter 包](http://static.iocoder.cn/images/MyBatis/2020_01_07/03.png)

- 每个 Log 实现类，都实现 Log 接口，从而对应一种日志框架的**适配**。

因为每种日志框架的适配，代码都是非常相似的，所以，我们仅仅选择 `slf4j` 和 `jdk14` 包下的两个 Log 实现类，进行简单的分享。

### 2.2.1 Slf4jImpl

`org.apache.ibatis.logging.slf4j.Slf4jImpl` ，实现 Log 接口，SLF4J 实现类。代码如下：

```java
// Slf4jImpl.java

public class Slf4jImpl implements Log {

    private Log log;

    public Slf4jImpl(String clazz) {
        // 使用 SLF4J 的 LoggerFactory 创建 org.slf4j.Logger 对象
        Logger logger = LoggerFactory.getLogger(clazz);

        // 如果使用了 SLF4J 的 LocationAwareLogger 实现，则创建 LocationAwareLogger 对象
        if (logger instanceof LocationAwareLogger) {
            try {
                // check for slf4j >= 1.6 method signature
                logger.getClass().getMethod("log", Marker.class, String.class, int.class, String.class, Object[].class, Throwable.class);
                log = new Slf4jLocationAwareLoggerImpl((LocationAwareLogger) logger);
                return;
            } catch (SecurityException | NoSuchMethodException e) {
                // fail-back to Slf4jLoggerImpl
            }
        }

        // Logger is not LocationAwareLogger or slf4j version < 1.6
        // 否则，创建 Slf4jLoggerImpl 对象
        log = new Slf4jLoggerImpl(logger);
    }

    @Override
    public boolean isDebugEnabled() {
        return log.isDebugEnabled();
    }

    @Override
    public boolean isTraceEnabled() {
        return log.isTraceEnabled();
    }

    @Override
    public void error(String s, Throwable e) {
        log.error(s, e);
    }

    @Override
    public void error(String s) {
        log.error(s);
    }

    @Override
    public void debug(String s) {
        log.debug(s);
    }

    @Override
    public void trace(String s) {
        log.trace(s);
    }

    @Override
    public void warn(String s) {
        log.warn(s);
    }

}
```

- 在构造方法中，我们可以看到，根据不同的情况，会创建 `Slf4jLocationAwareLoggerImpl` 或 `Slf4jLoggerImpl` 对象。那么，这两个类有什么区别呢？实际上，`Slf4jLocationAwareLoggerImpl` 适配的是 `slf4j` 有 `LocationAwareLogger` 实现的情况，而 `Slf4jLoggerImpl` 适配的是普通的情况。那么，为什么要有这样的区分呢？因为 `slf4j` 有 `LocationAwareLogger` 的实现，需要**特殊**处理，才能打印出**准确的代码位置**。感兴趣的胖友，可以看看 [《MyBatis 日志模块分析》](https://blog.csdn.net/benhuo931115/article/details/78745380) 。

- `org.apache.ibatis.logging.slf4j.Slf4jLocationAwareLoggerImpl` ，实现 Log 接口，代码如下：

  ```java
  // Slf4jLocationAwareLoggerImpl.java
  
  public class Slf4jLocationAwareLoggerImpl implements Log {
  
      private static final String FQCN = Slf4jLocationAwareLoggerImpl.class.getName();
  
      private final LocationAwareLogger logger;
  
      public Slf4jLocationAwareLoggerImpl(LocationAwareLogger logger) {
          this.logger = logger;
      }
  
      @Override
      public boolean isDebugEnabled() {
          return logger.isDebugEnabled();
      }
  
      @Override
      public boolean isTraceEnabled() {
          return logger.isTraceEnabled();
      }
  
      @Override
      public void error(String s, Throwable e) {
          logger.log(null, FQCN, LocationAwareLogger.ERROR_INT, s, null, e);
      }
  
      @Override
      public void error(String s) {
          logger.log(null, FQCN, LocationAwareLogger.ERROR_INT, s, null, null);
      }
  
      @Override
      public void debug(String s) {
          logger.log(null, FQCN, LocationAwareLogger.DEBUG_INT, s, null, null);
      }
  
      @Override
      public void trace(String s) {
          logger.log(null, FQCN, LocationAwareLogger.TRACE_INT, s, null, null);
      }
  
      @Override
      public void warn(String s) {
          logger.log(null, FQCN, LocationAwareLogger.WARN_INT, s, null, null);
      }
  
  }
  ```

  - 通过 `FQCN` 属性，保证打印的代码位置是准确的。

- `org.apache.ibatis.logging.slf4j.Slf4jLoggerImpl` ，实现 Log 接口，代码如下：

  ```java
  // Slf4jLoggerImpl.java
  
  public class Slf4jLoggerImpl implements Log {
  
      private final Logger log;
  
      public Slf4jLoggerImpl(Logger logger) {
          log = logger;
      }
  
      @Override
      public boolean isDebugEnabled() {
          return log.isDebugEnabled();
      }
  
      @Override
      public boolean isTraceEnabled() {
          return log.isTraceEnabled();
      }
  
      @Override
      public void error(String s, Throwable e) {
          log.error(s, e);
      }
  
      @Override
      public void error(String s) {
          log.error(s);
      }
  
      @Override
      public void debug(String s) {
          log.debug(s);
      }
  
      @Override
      public void trace(String s) {
          log.trace(s);
      }
  
      @Override
      public void warn(String s) {
          log.warn(s);
      }
  
  }
  ```

  - 直接使用 `org.slf4j.Logger` 的方法。

### 2.2.2 Jdk14LoggingImpl

`org.apache.ibatis.logging.jdk14.Jdk14LoggingImpl` ，实现 Log 接口，Jdk14 Logging 实现类。代码如下：

```java
// Jdk14LoggingImpl.java

public class Jdk14LoggingImpl implements Log {

    private final Logger log;

    public Jdk14LoggingImpl(String clazz) {
        log = Logger.getLogger(clazz);
    }

    @Override
    public boolean isDebugEnabled() {
        return log.isLoggable(Level.FINE);
    }

    @Override
    public boolean isTraceEnabled() {
        return log.isLoggable(Level.FINER);
    }

    @Override
    public void error(String s, Throwable e) {
        log.log(Level.SEVERE, s, e);
    }

    @Override
    public void error(String s) {
        log.log(Level.SEVERE, s);
    }

    @Override
    public void debug(String s) {
        log.log(Level.FINE, s);
    }

    @Override
    public void trace(String s) {
        log.log(Level.FINER, s);
    }

    @Override
    public void warn(String s) {
        log.log(Level.WARNING, s);
    }

}
```

- 直接使用 `java.util.logging.Logger` 的方法。

# 3. BaseJdbcLogger

在 `logging` 包下，还有 `jdbc` 包，里面包含多种和 JDBC 相关的 Logger 类。但是，这个包下的 Logger 类，并不是直接用于打印日志，而是用于**记录 JDBC 相关的操作的时间**。后续，在 `#debug(String s)` 方法中，会打印出记录的时间。所以，我们先看 `jdbc` 包下的类。

`org.apache.ibatis.logging.jdbc.BaseJdbcLogger` ，抽象类，是 JDBC 日志打印的基类。代码如下：

```java
// BaseJdbcLogger.java

public abstract class BaseJdbcLogger {

    /**
     * SET 方法名的前缀
     */
    protected static final String SET_METHOD_PREFIX = "set";
    /**
     * 执行方法名的前缀
     */
    protected static final String EXECUTE_METHOD_PREFIX = "execute";
    /**
     * 记录的 PreparedStatement 的参数集合
     */
    protected final Map<Object, Object> columnMap = new HashMap<>();
    /**
     * 记录的 PreparedStatement 的参数列表
     */
    protected final List<Object> columnNames = new ArrayList<>();
    /**
     * 记录的 PreparedStatement 的参数值
     */
    protected final List<Object> columnValues = new ArrayList<>();

    /**
     * Log 对象
     */
    protected final Log statementLog;
    /**
     * 查询超时时间
     */
    protected final int queryStack;

    /**
     * 构造方法
     *
     * @param log 日志打印对象
     * @param queryStack 查询超时时间
     */
    public BaseJdbcLogger(Log log, int queryStack) {
        this.statementLog = log;
        if (queryStack == 0) {
            this.queryStack = 1;
        } else {
            this.queryStack = queryStack;
        }
    }

    protected void setColumn(Object key, Object value) {
        columnMap.put(key, value);
        columnNames.add(key);
        columnValues.add(value);
    }

    protected Object getColumn(Object key) {
        return columnMap.get(key);
    }

    protected String getParameterValueString() {
        List<Object> typeList = new ArrayList<>(columnValues.size());
        for (Object value : columnValues) {
            if (value == null) {
                typeList.add("null

2025-08-25 13:02:41,499 - evaluation_logger_Attraction-43 - INFO - Complete Result: {'score': 0, 'reason': 'The response does not address any of the requested information about trending museums in Chicago.'}
2025-08-25 13:02:47,740 - evaluation_logger_Attraction-43 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 13:02:47,740 - evaluation_logger_Attraction-43 - INFO - Message: Success.
2025-08-25 13:02:47,740 - evaluation_logger_Attraction-43 - INFO - Success turn num = 2
2025-08-25 13:02:47,740 - evaluation_logger_Attraction-43 - INFO - ----------------------------------------------------------------------------------------------------
