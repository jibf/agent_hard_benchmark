2025-08-25 13:09:57,622 - evaluation_logger_Attraction-113 - INFO - Test Example Attraction-113
2025-08-25 13:09:57,622 - evaluation_logger_Attraction-113 - INFO - Query: Can you find the two most trending attractions in Rio de Janeiro and provide a detailed comparison of them? Also, check if there are any tickets available for both attractions in November.
2025-08-25 13:10:06,071 - evaluation_logger_Attraction-113 - INFO - Function Calls: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Rio de Janeiro"
        }
    }
]

2025-08-25 13:10:06,071 - evaluation_logger_Attraction-113 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Rio de Janeiro, Brasil"
        }
    },
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi02NjY2MTB9",
            "sortBy": "trending"
        }
    }
]

2025-08-25 13:10:07,030 - evaluation_logger_Attraction-113 - INFO - Start compare_single_call: 
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Rio de Janeiro'}}
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Rio de Janeiro, Brasil'}}
2025-08-25 13:10:17,138 - evaluation_logger_Attraction-113 - DEBUG - LLM-based comparison output: {'is_equal': True, 'reason': "The parameter 'query' in both function calls refers to the same location, 'Rio de Janeiro'. The addition of 'Brasil' in Function call 2 does not change the location being queried, as 'Rio de Janeiro' is a well-known city in Brazil. Therefore, both function calls are equivalent."}
2025-08-25 13:10:17,138 - evaluation_logger_Attraction-113 - INFO - LLM-based compare success.
2025-08-25 13:10:17,138 - evaluation_logger_Attraction-113 - INFO - Success matched: [{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Rio de Janeiro, Brasil'}}]
2025-08-25 13:10:17,139 - evaluation_logger_Attraction-113 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "products": [
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJIbWlodldjRkkwIiwidWZpIjotNjY2NjEwfQ==",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Private Transfer from Rio de Janeiro to Rio de Janeiro Port",
                    "productId": "PRHmihvWcFI0",
                    "productSlug": "prhmihvwcfi0-private-transfer-from-rio-de-janeiro-to-rio-de-janeiro-port",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -666610,
                    "cityName": "Rio de Janeiro",
                    "countryCode": "br"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFIxVm5SRzNqcFVmIiwidWZpIjotNjY2NjEwfQ==",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Parasailing in Rio de Janeiro",
                    "productId": "PR1VnRG3jpUf",
                    "productSlug": "pr1vnrg3jpuf-parasailing-in-rio-de-janeiro",
                    "taxonomySlug": "activities",
                    "cityUfi": -666610,
                    "cityName": "Rio de Janeiro",
                    "countryCode": "br"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJrdkZQV29KZURwIiwidWZpIjotNjY2NjEwfQ==",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Private Transfer from Rio de Janeiro Port to Rio de Janeiro",
                    "productId": "PRkvFPWoJeDp",
                    "productSlug": "prkvfpwojedp-private-transfer-from-rio-de-janeiro-port-to-rio-de-janeiro",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -666610,
                    "cityName": "Rio de Janeiro",
                    "countryCode": "br"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJtVVUyV2NHa2FuIiwidWZpIjotNjY2NjEwfQ==",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "A day in Rio de Janeiro",
                    "productId": "PRmUU2WcGkan",
                    "productSlug": "prmuu2wcgkan-a-day-in-rio-de-janeiro",
                    "taxonomySlug": "tours",
                    "cityUfi": -666610,
                    "cityName": "Rio de Janeiro",
                    "countryCode": "br"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJ2MDRMMUpXdEdXIiwidWZpIjotNjY2NjEwfQ==",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Private Transfer from Rio de Janeiro City to Rio de Janeiro Port",
                    "productId": "PRv04L1JWtGW",
                    "productSlug": "prv04l1jwtgw-private-transfer-from-rio-de-janeiro-city-to-rio-de-janeiro-port",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -666610,
                    "cityName": "Rio de Janeiro",
                    "countryCode": "br"
                }
            ],
            "destinations": [
                {
                    "id": "eyJ1ZmkiOi02NjY2MTB9",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": -666610,
                    "country": "Brasil",
                    "cityName": "Rio de Janeiro",
                    "productCount": 907,
                    "cc1": "br"
                },
                {
                    "id": "eyJ1ZmkiOi02NDA2Mjh9",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": -640628,
                    "country": "Brasil",
                    "cityName": "Duque de Caxias",
                    "productCount": 907,
                    "cc1": "br"
                }
            ]
        }
    }
]

2025-08-25 13:10:26,201 - evaluation_logger_Attraction-113 - INFO - Function Calls: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi02NjY2MTB9",
            "sortBy": "trending"
        }
    }
]

2025-08-25 13:10:26,201 - evaluation_logger_Attraction-113 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi02NjY2MTB9",
            "sortBy": "trending"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PR1U39ofE8kT"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRdWQ2xXF0f6"
        }
    },
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "pr1u39ofe8kt-full-day-guided-city-tour"
        }
    },
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "prdwq2xxf0f6-christ-the-redeemer-and-city-sights-tour"
        }
    }
]

2025-08-25 13:10:26,201 - evaluation_logger_Attraction-113 - INFO - Start compare_single_call: 
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi02NjY2MTB9', 'sortBy': 'trending'}}
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi02NjY2MTB9', 'sortBy': 'trending'}}
2025-08-25 13:10:26,201 - evaluation_logger_Attraction-113 - INFO - Rule-based compare success.
2025-08-25 13:10:26,201 - evaluation_logger_Attraction-113 - INFO - Success matched: [{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi02NjY2MTB9', 'sortBy': 'trending'}}]
2025-08-25 13:10:26,202 - evaluation_logger_Attraction-113 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProductSearchResponse",
            "products": [
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PR1U39ofE8kT",
                    "name": "Christ the Redeemer, Sugarloaf, Lunch and Small Group City Tour",
                    "slug": "pr1u39ofe8kt-full-day-guided-city-tour",
                    "shortDescription": "Embark on this full-day Rio de Janeiro City Tour with a guide and visit Rio de Janeiro's top land...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 105,
                        "currency": "USD",
                        "publicAmount": 105
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 54,
                        "percentage": "89%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.3,
                            "total": 122
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Rio de Janeiro",
                        "ufi": -666610
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIrHZuUDePSF"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OImjrPeBKZiB"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIieO9fAnarC"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInWeek",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForLandmarks",
                            "value": true,
                            "rank": 2
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRdWQ2xXF0f6",
                    "name": "Christ the Redeemer and City Sights Tour",
                    "slug": "prdwq2xxf0f6-christ-the-redeemer-and-city-sights-tour",
                    "shortDescription": "Half-day tour viewing the highlights of Rio including the world-famous statue",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 50,
                        "currency": "USD",
                        "publicAmount": 50
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 21,
                        "percentage": "81%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.4,
                            "total": 177
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Rio de Janeiro",
                        "ufi": -666610
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIciF3ebnAJh"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI8IeSdA10sp"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OISvMFYrWfQM"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 3
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PR5HGgnOYvP2",
                    "name": "Rio de Janeiro Sightseeing Cruise with Morning and Sunset Option",
                    "slug": "pr5hggnoyvp2-rio-de-janeiro-sightseeing-cruise-with-morning-and-sunset-option",
                    "shortDescription": "Begin our tour at Marina da Gloria, boarding our exclusive catamaran. We depart toward the Museum...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 28,
                        "currency": "USD",
                        "publicAmount": 28
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.6,
                            "total": 114
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Rio de Janeiro",
                        "ufi": -666610
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIniafbMgBVk"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIm9wOIocVKH"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIYoUHLsnzt5"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIwxR7OqaxzJ"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIrkSGDppBhF"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OItZ2tJo5h8S"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 2
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": false
                    },
                    "id": "PRMuVYRnND0H",
                    "name": "Skip the Line Christ the Redeemer Admission Ticket",
                    "slug": "prmuvyrnnd0h-christ-the-redeemer-skip-the-line-admission",
                    "shortDescription": "Christ the Redeemer (Corcovado) is Brazil's most iconic landmark and a trip to Rio is not complet...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 39,
                        "currency": "USD",
                        "publicAmount": 39
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 74,
                        "percentage": "76%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4,
                            "total": 188
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Rio de Janeiro",
                        "ufi": -666610
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIcP22C30jSw"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIX6TZK8bu2W"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIlkRmLxSSOD"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIf35eVtZXQL"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIteX6yWzgWS"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIP0rYFuZE2n"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 6
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInMonth",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerOnWeekends",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForLandmarks",
                            "value": true,
                            "rank": 1
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRNc8dzAUJCQ",
                    "name": "The Best Half Day in Rio with Christ Redeemer and Sugar Loaf Hill",
                    "slug": "prnc8dzaujcq-the-best-half-day-in-rio-with-christ-redeemer-and-sugar-loaf-hill",
                    "shortDescription": "Enjoy a small-group tour to visit the most iconics landmarks in Rio de Janeiro. First visit the C...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 84.5,
                        "currency": "USD",
                        "publicAmount": 84.5
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.8,
                            "total": 406
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Rio de Janeiro",
                        "ufi": -666610
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OICXFv7Naxx8"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI5O5NjgbmkI"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIif4He0F7Tc"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIIYGEuP2byT"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OILaeEjEuL9W"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI6kds0SlvH1"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 4
                        }
                    ]
                }
            ],
            "filterStats": {
                "__typename": "FilterStats",
                "unfilteredProductCount": 874,
                "filteredProductCount": 874
            },
            "sorters": [
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Our top picks",
                    "value": "trending"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Most popular",
                    "value": "attr_book_score"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Lowest price",
                    "value": "lowest_price"
                }
            ],
            "defaultSorter": {
                "__typename": "AttractionsSorterOption",
                "name": "Our top picks",
                "value": "trending"
            },
            "filterOptions": {
                "__typename": "FilterOptions",
                "typeFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Tours",
                        "tagname": "tours",
                        "productCount": 87
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Nature & outdoor",
                        "tagname": "nature-outdoor",
                        "productCount": 53
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Museums, arts & culture",
                        "tagname": "museums-arts-culture",
                        "productCount": 44
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Entertainment & tickets",
                        "tagname": "entertainment-tickets",
                        "productCount": 14
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Food & drinks",
                        "tagname": "food-drinks",
                        "productCount": 2
                    }
                ],
                "labelFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Free cancellation",
                        "tagname": "free_cancellation",
                        "productCount": 821
                    }
                ],
                "ufiFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Rio de Janeiro",
                        "tagname": "-666610",
                        "productCount": 874
                    }
                ],
                "priceFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "US$0 - US$22",
                        "tagname": "b0",
                        "productCount": 20
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$22 - US$44",
                        "tagname": "b1",
                        "productCount": 67
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$44 - US$83",
                        "tagname": "b2",
                        "productCount": 230
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$83 - US$138",
                        "tagname": "b3",
                        "productCount": 222
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$138+",
                        "tagname": "b4",
                        "productCount": 369
                    }
                ]
            }
        }
    }
]

2025-08-25 13:10:40,071 - evaluation_logger_Attraction-113 - INFO - Function Calls: 
[
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "pr1u39ofe8kt-full-day-guided-city-tour"
        }
    },
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "pr5hggnoyvp2-rio-de-janeiro-sightseeing-cruise-with-morning-and-sunset-option"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PR1U39ofE8kT"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PR5HGgnOYvP2"
        }
    }
]

2025-08-25 13:10:40,071 - evaluation_logger_Attraction-113 - INFO - Golden Function Call: 
[
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PR1U39ofE8kT"
        }
    },
    {
        "name": "Get_Availability_Calendar",
        "arguments": {
            "id": "PRdWQ2xXF0f6"
        }
    },
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "pr1u39ofe8kt-full-day-guided-city-tour"
        }
    },
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "prdwq2xxf0f6-christ-the-redeemer-and-city-sights-tour"
        }
    }
]

2025-08-25 13:10:41,023 - evaluation_logger_Attraction-113 - INFO - Start compare_single_call: 
{'name': 'Get_Attraction_Details', 'arguments': {'slug': 'pr1u39ofe8kt-full-day-guided-city-tour'}}
{'name': 'Get_Attraction_Details', 'arguments': {'slug': 'pr1u39ofe8kt-full-day-guided-city-tour'}}
2025-08-25 13:10:41,023 - evaluation_logger_Attraction-113 - INFO - Rule-based compare success.
2025-08-25 13:10:41,023 - evaluation_logger_Attraction-113 - INFO - Start compare_single_call: 
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PR1U39ofE8kT'}}
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PR1U39ofE8kT'}}
2025-08-25 13:10:41,024 - evaluation_logger_Attraction-113 - INFO - Rule-based compare success.
2025-08-25 13:10:41,024 - evaluation_logger_Attraction-113 - INFO - Start compare_single_call: 
{'name': 'Get_Attraction_Details', 'arguments': {'slug': 'pr5hggnoyvp2-rio-de-janeiro-sightseeing-cruise-with-morning-and-sunset-option'}}
{'name': 'Get_Attraction_Details', 'arguments': {'slug': 'prdwq2xxf0f6-christ-the-redeemer-and-city-sights-tour'}}
2025-08-25 13:10:41,024 - evaluation_logger_Attraction-113 - INFO - {'error_type': 'value_error', 'content': 'Parameter slug value is not correct in prediction.'}
2025-08-25 13:10:41,024 - evaluation_logger_Attraction-113 - INFO - Start compare_single_call: 
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PR5HGgnOYvP2'}}
{'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PRdWQ2xXF0f6'}}
2025-08-25 13:10:41,024 - evaluation_logger_Attraction-113 - INFO - {'error_type': 'value_error', 'content': 'Parameter id value is not correct in prediction.'}
2025-08-25 13:10:41,024 - evaluation_logger_Attraction-113 - INFO - Success matched: [{'name': 'Get_Attraction_Details', 'arguments': {'slug': 'pr1u39ofe8kt-full-day-guided-city-tour'}}, {'name': 'Get_Availability_Calendar', 'arguments': {'id': 'PR1U39ofE8kT'}}]
2025-08-25 13:10:41,024 - evaluation_logger_Attraction-113 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProduct",
            "additionalInfo": "Infants and small children can ride in a pram or stroller\n\nInfants are required to sit on an adult’s lap\n\nSuitable for all physical fitness levels\n\nWe contact you back in order to provide proper pickup time. Check your emails and/or cell phone.\n\nSugarloaf and Christ the Redeemer request ID for children in order to confirm the age discount. If requested, you must present a copy of ID.\n\nThis tour is unavailable on Carnival season.\n\nComfortable clothing and walking shoes are recommended for this tour.\n\nThe tour itinerary may change order, but the highlights remain.\n\nMinimum of 2 people to confirm German or French speaking tour guide.\n\nContact us to confirm the pickup time according to hotel location.\n\nPickup is available from most hotels in the areas of Leblon, Ipanema, Copacabana, Flamengo and Downtown (Centro). Contact us back to adjust the pickup time.\nThe pickup between 08:00 am and 09:30 am.\n\nNot wheelchair accessible\n\nPlease bring your ticket with you to the attraction.\n\nBe aware that operators may cancel for unforeseen reasons.\n\nYou need to be 18 years or older to book or be accompanied by an adult. ",
            "applicableTerms": [
                {
                    "__typename": "TermsConditions",
                    "policyProvider": "Booking.com"
                },
                {
                    "__typename": "TermsConditions",
                    "policyProvider": "Viator"
                }
            ],
            "cancellationPolicy": {
                "__typename": "AttractionsCancellationPolicy",
                "hasFreeCancellation": true
            },
            "description": "Embark on this full-day Rio de Janeiro City Tour with a guide and visit Rio de Janeiro's top landmarks and highlights.\nWe visit to Corcovado Mountain and the Christ the Redeemer statue going through the Paineiras route. The 20-minute drive to the base of the statue takes you through the Tijuca Forest and gives you a preview of the landscapes ahead. The statue stands 710 meters tall and from this vantage point, you’ll have sweeping views of the city.\nWe also visit the Sugar Loaf. The cable car ride to the top of the mountain is done in 2 stages: begin at the boarding station to Urca Mountain (224 meters) and then from Urca Mountain to the top of Sugarloaf Mountain (395 meters).\nLet’s also stop at the Metropolitan Cathedral, the Arcos da Lapa with the traditional Selarón Staircase, the Sambadrome and the Maracanã Stadium.\nThis tour includes tour guide, tickets to the Christ the Redeemer and the Sugarloaf, Buffet lunch and round-trip transportation.",
            "flags": [
                {
                    "__typename": "AttractionsProductFlags",
                    "flag": "bestseller",
                    "value": true,
                    "rank": 1
                },
                {
                    "__typename": "AttractionsProductFlags",
                    "flag": "bestsellerInWeek",
                    "value": true,
                    "rank": 1
                },
                {
                    "__typename": "AttractionsProductFlags",
                    "flag": "bestsellerForLandmarks",
                    "value": true,
                    "rank": 2
                }
            ],
            "guideSupportedLanguages": [
                "English (UK)",
                "Brazilian Portuguese",
                "Spanish",
                "French",
                "Italian",
                "German"
            ],
            "id": "PR1U39ofE8kT",
            "isBookable": true,
            "labels": [
                {
                    "__typename": "AttractionsLabel",
                    "text": "Free cancellation",
                    "type": "free_cancellation"
                }
            ],
            "name": "Christ the Redeemer, Sugarloaf, Lunch and Small Group City Tour",
            "notIncluded": [
                "Souvenir photos (available to purchase)",
                "Entrance to the Sambodromo.",
                "Entrance to the Maracana Stadium."
            ],
            "offers": [
                {
                    "__typename": "Offer",
                    "availabilityType": "date_time",
                    "id": "OFlF9okw7L7Z"
                }
            ],
            "onSiteRequirements": {
                "__typename": "OnSiteRequirements"
            },
            "operatedBy": "Rio Carioca Tour Ltda",
            "representativePrice": {
                "__typename": "AttractionsPrice",
                "chargeAmount": 105,
                "currency": "USD",
                "publicAmount": 105
            },
            "reviews": {
                "__typename": "AttractionsGetReviewsResponse",
                "total": 122,
                "reviews": [
                    {
                        "__typename": "AttractionsReview",
                        "id": "RS5PFWlmtI4J",
                        "epochMs": 1729507171000,
                        "numericRating": 5,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "Lucas",
                            "cc1": "br"
                        }
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSO8H0pYvZil",
                        "epochMs": 1729075383000,
                        "language": "es",
                        "numericRating": 4,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "Virginia",
                            "cc1": "uy"
                        }
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSvAA6GjKdlH",
                        "epochMs": 1728985326000,
                        "language": "en-us",
                        "numericRating": 4,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "Hoang",
                            "cc1": "us"
                        }
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSA22rSeHhz8",
                        "epochMs": 1728649291000,
                        "language": "de",
                        "numericRating": 5,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "Duy-Tam",
                            "cc1": "de"
                        }
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RStgyiBeXDtH",
                        "epochMs": 1728033860000,
                        "language": "fr",
                        "numericRating": 5
                    }
                ]
            },
            "reviewsStats": {
                "__typename": "AttractionsProductReviewStats",
                "allReviewsCount": 54,
                "percentage": "89%",
                "combinedNumericStats": {
                    "__typename": "AttractionsProductCombinedReviewStats",
                    "average": 4.3,
                    "total": 122
                }
            },
            "slug": "pr1u39ofe8kt-full-day-guided-city-tour",
            "supportedFeatures": {
                "__typename": "AttractionsProductSupportedFeatures",
                "nativeApp": true,
                "nativeAppBookProcess": false,
                "liveAvailabilityCheckSupported": true
            },
            "ufiDetails": {
                "__typename": "AttractionLocationResponse",
                "ufi": -666610,
                "bCityName": "Rio de Janeiro"
            },
            "whatsIncluded": [
                "Bilingual Tour guide",
                "Entrance to the Christ the Redeemer.",
                "Air-conditioned vehicle",
                "Entrance to the Sugarloaf.",
                "Buffet lunch (drinks and desserts not included)"
            ]
        }
    },
    {
        "api_status": true,
        "content": "There is a problem with your api call, please double-check for possible problems."
    },
    {
        "status": true,
        "message": "Success",
        "timestamp": 1729532185110,
        "data": [
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-10-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-10-31"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-11-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-19"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-20"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-21"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-22"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-23"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-24"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-25"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-26"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-27"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-28"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-29"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2024-12-30"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2024-12-31"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": false,
                "date": "2025-01-01"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-02"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-03"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-04"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-05"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-06"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-07"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-08"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-09"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-10"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-11"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-12"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-13"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-14"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-15"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-16"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-17"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-18"
            },
            {
                "__typename": "AttractionsCalendarItem",
                "available": true,
                "date": "2025-01-19"
            }
        ]
    },
    {
        "api_status": true,
        "content": "There is a problem with your api call, please double-check for possible problems."
    }
]

2025-08-25 13:13:48,122 - evaluation_logger_Attraction-113 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 概述

本文，我们来分享 [《精尽 Spring Boot 源码分析 —— 自动配置》](http://svip.iocoder.cn/Spring-Boot/AutoConfiguration/) 的**源码解析**。

在 Spring Boot 中，提供了 `@EnableAutoConfiguration` 注解，用于开启自动配置功能。`@EnableAutoConfiguration` 注解的代码如下：

```java
// EnableAutoConfiguration.java

@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
@AutoConfigurationPackage
@Import(AutoConfigurationImportSelector.class)
public @interface EnableAutoConfiguration {

	String ENABLED_OVERRIDE_PROPERTY = "spring.boot.enableautoconfiguration";

	/**
	 * Exclude specific auto-configuration classes such that they will never be applied.
	 * @return the classes to exclude
	 */
	Class<?>[] exclude() default {};

	/**
	 * Exclude specific auto-configuration class names such that they will never be
	 * applied.
	 * @return the class names to exclude
	 */
	String[] excludeName() default {};

}
```

- 注意，`@EnableAutoConfiguration` 注解上，有 `@Import(AutoConfigurationImportSelector.class)` 注解。关于 `@Import` 注解，可以看看 [《Spring 3.0 的新注解：@Import》](https://www.cnblogs.com/lcngu/p/5080702.html) 文章。

- 另外，`@EnableAutoConfiguration` 注解上，有 `@AutoConfigurationPackage` 注解。它也是用于自动配置的功能，不过暂时和本文无关，我们先不解析。感兴趣的胖友，可以自己先去看看 [《SpringBoot 源码解析（二）@AutoConfigurationPackage》](https://www.jianshu.com/p/9382f8c41b0e) 。

# 2. AutoConfigurationImportSelector

`org.springframework.boot.autoconfigure.AutoConfigurationImportSelector` ，实现 DeferredImportSelector、BeanClassLoaderAware、ResourceLoaderAware、BeanFactoryAware、EnvironmentAware、Ordered 接口，处理自动配置的导入。

## 2.1 构造方法

```java
// AutoConfigurationImportSelector.java

private static final String[] NO_IMPORTS = {};

private static final Log logger = LogFactory.getLog(AutoConfigurationImportSelector.class);

private static final String PROPERTY_NAME_AUTOCONFIGURE_EXCLUDE = "spring.autoconfigure.exclude";

private ConfigurableListableBeanFactory beanFactory;

private Environment environment;

private ClassLoader beanClassLoader;

private ResourceLoader resourceLoader;

/**
 * 自动配置的 Group
 */
private AutoConfigurationGroup group;
```

- `group` 属性，AutoConfigurationGroup 对象，自动配置的 Group 。在本文的 [「2.3 AutoConfigurationGroup」](http://svip.iocoder.cn/Spring-Boot/AutoConfiguration/#) 中，详细解析。

## 2.2 selectImports

实现 `#selectImports(AnnotationMetadata annotationMetadata)` 方法，代码如下：

```java
// AutoConfigurationImportSelector.java

@Override
public String[] selectImports(AnnotationMetadata annotationMetadata) {
    // <1> 如果自动配置功能没有开启，则返回空数组
    if (!isEnabled(annotationMetadata)) {
        return NO_IMPORTS;
    }
    // <2> 获得自动配置的 AutoConfigurationEntry 对象
    AutoConfigurationEntry autoConfigurationEntry = getAutoConfigurationEntry(annotationMetadata);
    // <3> 返回符合条件的配置类的数组
    return StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());
}
```

- `<1>` 处，如果自动配置功能没有开启，则返回空数组。判断是否开启的逻辑，代码如下：

  ```java
  // AutoConfigurationImportSelector.java
  
  protected boolean isEnabled(AnnotationMetadata metadata) {
  	if (getClass() == AutoConfigurationImportSelector.class) {
  		return getEnvironment().getProperty(EnableAutoConfiguration.ENABLED_OVERRIDE_PROPERTY, Boolean.class, true);
  	}
  	return true;
  }
  ```

  - 通过 `"spring.boot.enableautoconfiguration"` 配置项，来设置是否开启。默认情况下，为 `true` 开启。

- `<2>` 处，调用 `#getAutoConfigurationEntry(AnnotationMetadata annotationMetadata)` 方法，获得自动配置的 AutoConfigurationEntry 对象。详细解析，见 [「2.2.1 getAutoConfigurationEntry」](http://svip.iocoder.cn/Spring-Boot/AutoConfiguration/#) 。

- `<3>` 处，返回符合条件的配置类的数组。

### 2.2.1 getAutoConfigurationEntry

`#getAutoConfigurationEntry(AnnotationMetadata annotationMetadata)` 方法，获得自动配置的 AutoConfigurationEntry 对象。代码如下：

```java
// AutoConfigurationImportSelector.java

protected AutoConfigurationEntry getAutoConfigurationEntry(AnnotationMetadata annotationMetadata) {
    // <1> 如果不可用，返回空数组
    if (!isEnabled(annotationMetadata)) {
        return EMPTY_ENTRY;
    }
    // <2> 获得注解的属性
    AnnotationAttributes attributes = getAttributes(annotationMetadata);
    // <3> 获得所有需要自动配置的配置类的数组
    List<String> configurations = getCandidateConfigurations(annotationMetadata, attributes);
    // <4> 移除重复的配置类
    configurations = removeDuplicates(configurations);
    // <5> 获得需要排除的配置类
    Set<String> exclusions = getExclusions(annotationMetadata, attributes);
    // 校验需要排除的配置类
    checkExcludedClasses(configurations, exclusions);
    // <6> 从 configurations 中，移除需要排除的配置类
    configurations.removeAll(exclusions);
    // <7> 对 configurations 进行过滤
    configurations = getConfigurationClassFilter().filter(configurations);
    // <8> 触发自动配置导入事件
    fireAutoConfigurationImportEvents(configurations, exclusions);
    // <9> 创建 AutoConfigurationEntry 对象
    return new AutoConfigurationEntry(configurations, exclusions);
}
```

- `<1>` 处，如果不可用，返回空数组。

- `<2>` 处，调用 `#getAttributes(AnnotationMetadata metadata)` 方法，获得注解的属性。代码如下：

  ```java
  // AutoConfigurationImportSelector.java
  
  protected AnnotationAttributes getAttributes(AnnotationMetadata metadata) {
      // 获得注解名
      String name = getAnnotationClass().getName();
      // 获得注解的属性
      AnnotationAttributes attributes = AnnotationAttributes.fromMap(metadata.getAnnotationAttributes(name, true));
      Assert.notNull(attributes, () -> "No auto-configuration attributes found. Is " + metadata.getClassName()
              + " annotated with " + ClassUtils.getShortName(name) + "?");
      return attributes;
  }
  
  protected Class<?> getAnnotationClass() {
      return EnableAutoConfiguration.class;
  }
  ```

  - 返回的是 `@EnableAutoConfiguration` 注解的属性。

- `<3>` 处，调用 `#getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes)` 方法，获得所有需要自动配置的配置类的数组。详细解析，见 [「2.2.2 getCandidateConfigurations」](http://svip.iocoder.cn/Spring-Boot/AutoConfiguration/#) 。

- `<4>` 处，调用 `#removeDuplicates(List<?> list)` 方法，移除重复的配置类。该方法在父类 SpringFactoriesLoader 中实现，代码如下：

  ```java
  // SpringFactoriesLoader.java
  
  protected final <T> List<T> removeDuplicates(List<T> list) {
  	return new ArrayList<>(new LinkedHashSet<>(list));
  }
  ```

- `<5>` 处，调用 `#getExclusions(AnnotationMetadata metadata, AnnotationAttributes attributes)` 方法，获得需要排除的配置类。代码如下：

  ```java
  // AutoConfigurationImportSelector.java
  
  protected Set<String> getExclusions(AnnotationMetadata metadata, AnnotationAttributes attributes) {
      // 获得需要排除的配置类数组
      Set<String> excluded = new LinkedHashSet<>();
      // 从 `exclude` 属性
      excluded.addAll(asList(attributes, "exclude"));
      // 从 `excludeName` 属性
      excluded.addAll(Arrays.asList(attributes.getStringArray("excludeName")));
      // 从 `"spring.autoconfigure.exclude"` 配置项
      excluded.addAll(getExcludeAutoConfigurationsProperty());
      return excluded;
  }
  ```

  - 有三种方式，可以配置需要排除的配置类。

- `<6>` 处，从 `configurations` 中，移除需要排除的配置类。

- `<7>` 处，调用 `ConfigurationClassFilter#filter(List<String> configurations)` 方法，对 `configurations` 进行过滤。详细解析，见 [「2.4 ConfigurationClassFilter」](http://svip.iocoder.cn/Spring-Boot/AutoConfiguration/#) 。

- `<8>` 处，调用 `#fireAutoConfigurationImportEvents(List<String> configurations, Set<String> exclusions)` 方法，触发自动配置导入事件。详细解析，见 [「2.2.3 fireAutoConfigurationImportEvents」](http://svip.iocoder.cn/Spring-Boot/AutoConfiguration/#) 。

- `<9>` 处，创建 AutoConfigurationEntry 对象。

### 2.2.2 getCandidateConfigurations

`#getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes)` 方法，获得所有需要自动配置的配置类的数组。代码如下：

```java
// AutoConfigurationImportSelector.java

protected List<String> getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes) {
    // 加载指定类型 EnableAutoConfiguration 对应的，在 `META-INF/spring.factories` 里的类名的数组
    List<String> configurations = SpringFactoriesLoader.loadFactoryNames(getSpringFactoriesLoaderFactoryClass(),
            getBeanClassLoader());
    // 断言，非空
    Assert.notEmpty(configurations, "No auto configuration classes found in META-INF/spring.factories. If you "
            + "are using a custom packaging, make sure that file is correct.");
    return configurations;
}

protected Class<?> getSpringFactoriesLoaderFactoryClass() {
    return EnableAutoConfiguration.class;
}
```

- 通过 `SpringFactoriesLoader#loadFactoryNames(Class<?> factoryClass, ClassLoader classLoader)` 方法，加载指定类型 EnableAutoConfiguration 对应的，在 `META-INF/spring.factories` 里的类名的数组。

- 例如，在 `spring-boot-autoconfigure` 项目中的 `META-INF/spring.factories` 文件中，有一段如下：

  ```properties
  # Auto Configure
  org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
  org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\
  org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\
  org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\
  ... ...
  ```

  - 因为太长，所以这里不全部列出。

### 2.2.3 fireAutoConfigurationImportEvents

`#fireAutoConfigurationImportEvents(List<String> configurations, Set<String> exclusions)` 方法，触发自动配置导入事件。代码如下：

```java
// AutoConfigurationImportSelector.java

private void fireAutoConfigurationImportEvents(List<String> configurations, Set<String> exclusions) {
    // 获得 AutoConfigurationImportListener 的数组
    List<AutoConfigurationImportListener> listeners = getAutoConfigurationImportListeners();
    // 如果非空
    if (!listeners.isEmpty()) {
        // 创建 AutoConfigurationImportEvent 事件
        AutoConfigurationImportEvent event = new AutoConfigurationImportEvent(this, configurations, exclusions);
        // 遍历 listeners 数组
        for (AutoConfigurationImportListener listener : listeners) {
            // 设置属性
            invokeAwareMethods(listener);
            // 监听事件
            listener.onAutoConfigurationImportEvent(event);
        }
    }
}

protected List<AutoConfigurationImportListener> getAutoConfigurationImportListeners() {
    return SpringFactoriesLoader.loadFactories(AutoConfigurationImportListener.class, this.beanClassLoader);
}
```

- 通过 `SpringFactoriesLoader#loadFactories(Class<T> factoryClass, ClassLoader classLoader)` 方法，加载 AutoConfigurationImportListener 类型的类的数组。

- 例如，在 `spring-boot-autoconfigure` 项目中的 `META-INF/spring.factories` 文件中，有一段如下：

  ```properties
  # Auto Configuration Import Listeners
  org.springframework.boot.autoconfigure.AutoConfigurationImportListener=\
  org.springframework.boot.autoconfigure.condition.ConditionEvaluationReportAutoConfigurationImportListener
  ```

  - 所以，此处会加载到 ConditionEvaluationReportAutoConfigurationImportListener 类。

## 2.3 AutoConfigurationGroup

在 AutoConfigurationImportSelector 中，有一个 AutoConfigurationGroup 内部类，实现 DeferredImportSelector.Group、BeanClassLoaderAware、BeanFactoryAware、ResourceLoaderAware 接口，自动配置的 Group 实现类。

### 2.3.1 process

`#process(AnnotationMetadata metadata, DeferredImportSelector selector)` 方法，处理导入。代码如下：

```java
// AutoConfigurationImportSelector#AutoConfigurationGroup.java

@Override
public void process(AnnotationMetadata metadata, DeferredImportSelector selector) {
    Assert.state(selector instanceof AutoConfigurationImportSelector,
            () -> String.format("Only %s implementations are supported, got %s",
                    AutoConfigurationImportSelector.class.getSimpleName(), selector.getClass().getName()));
    // <1> 获得 AutoConfigurationEntry 对象
    AutoConfigurationEntry autoConfigurationEntry = ((AutoConfigurationImportSelector) selector)
            .getAutoConfigurationEntry(metadata);
    // <2> 添加到 autoConfigurationEntries 中
    this.autoConfigurationEntries.add(autoConfigurationEntry);
    // <3> 遍历 autoConfigurationEntry 的 configurations 数组，添加到 entries 中
    for (String importClassName : autoConfigurationEntry.getConfigurations()) {
        this.entries.putIfAbsent(importClassName, metadata);
    }
}
```

- `<1>` 处，调用 `AutoConfigurationImportSelector#getAutoConfigurationEntry(AnnotationMetadata annotationMetadata)` 方法，获得 AutoConfigurationEntry 对象。也就是说，和 `#selectImports(AnnotationMetadata annotationMetadata)` 方法的处理逻辑，是一致的。

- `<2>` 处，添加到 `autoConfigurationEntries` 中。

- `<3>` 处，遍历 `autoConfigurationEntry` 的 `configurations` 数组，添加到 `entries` 中。

### 2.3.2 selectImports

`#selectImports()` 方法，选择需要导入的配置类。代码如下：

```java
// AutoConfigurationImportSelector#AutoConfigurationGroup.java

@Override
public Iterable<Entry> selectImports() {
    // 如果为空，则返回空数组
    if (this.autoConfigurationEntries.isEmpty()) {
        return Collections.emptyList();
    }
    // 获得所有要排除的配置类的集合
    Set<String> allExclusions = this.autoConfigurationEntries.stream()
            .map(AutoConfigurationEntry::getExclusions).flatMap(Collection::stream).collect(Collectors.toSet());
    // 获得经过处理后的配置类集合
    Set<String> processedConfigurations = this.autoConfigurationEntries.stream()
            .map(AutoConfigurationEntry::getConfigurations).flatMap(Collection::stream)
            .collect(Collectors.toCollection(LinkedHashSet::new));
    // 移除所有要排除的配置类
    processedConfigurations.removeAll(allExclusions);

    // 排序
    return sortAutoConfigurations(processedConfigurations, getAutoConfigurationMetadata()).stream()
            .map((importClassName) -> new Entry(this.entries.get(importClassName), importClassName))
            .collect(Collectors.toList());
}
```

- 虽然代码长，但是核心逻辑和 `AutoConfigurationImportSelector#getAutoConfigurationEntry(AnnotationMetadata annotationMetadata)` 方法，是一致的。

## 2.4 ConfigurationClassFilter

`org.springframework.boot.autoconfigure.AutoConfigurationImportSelector.ConfigurationClassFilter` ，是 AutoConfigurationImportSelector 的内部类，负责对配置类进行过滤。

### 2.4.1 filter

`#filter(List<String> configurations)` 方法，过滤配置类。代码如下：

```java
// AutoConfigurationImportSelector#ConfigurationClassFilter.java

List<String> filter(List<String> configurations) {
    // 初始化
    long startTime = System.nanoTime();
    // 获得配置类的字符串数组
    String[] candidates = StringUtils.toStringArray(configurations);
    // 是否需要跳过
    boolean skipped = false;
    // 遍历 AutoConfigurationImportFilter 数组
    for (AutoConfigurationImportFilter filter : this.filters) {
        // 判断每个配置类是否匹配
        boolean[] match = filter.match(candidates, this.autoConfigurationMetadata);
        // 如果都不匹配，则跳过
        for (int i = 0; i < match.length; i++) {
            if (!match[i]) {
                candidates[i] = null;
                skipped = true;
            }
        }
    }
    // 如果有不匹配的，则进行移除
    if (!skipped) {
        return configurations;
    }
    // 创建 result 数组
    List<String> result = new ArrayList<>(candidates.length);
    for (String candidate : candidates) {
        if (candidate != null) {
            result.add(candidate);
        }
    }
    // 打印日志
    if (logger.isTraceEnabled()) {
        int numberFiltered = configurations.size() - result.size();
        logger.trace("Filtered " + numberFiltered + " auto configuration class in "
                + TimeUnit.NANOSECONDS.toMillis(System.nanoTime() - startTime) + " ms");
    }
    return result;
}
```

- 核心逻辑，是遍历 `filters` 数组，调用其 `AutoConfigurationImportFilter#match(String[] autoConfigurationClasses, AutoConfigurationMetadata autoConfigurationMetadata)` 方法，来判断每个配置类是否匹配。如果**不匹配**，则标记为 `null` ，最后统一移除。

- 那么 `filters` 是怎么来的呢？在 ConfigurationClassFilter 的构造方法中，代码如下：

  ```java
  // AutoConfigurationImportSelector#ConfigurationClassFilter.java
  
  ConfigurationClassFilter(ClassLoader beanClassLoader) {
      // 加载 AutoConfigurationImportFilter 类型的类的数组
      List<AutoConfigurationImportFilter> filters = SpringFactoriesLoader.loadFactories(AutoConfigurationImportFilter.class,
              beanClassLoader);
      this.filters = filters;
  }
  ```

  - 通过 `SpringFactoriesLoader#loadFactories(Class<T> factoryClass, ClassLoader classLoader)` 方法，加载 AutoConfigurationImportFilter 类型的类的数组。

  - 例如，在 `spring-boot-autoconfigure` 项目中的 `META-INF/spring.factories` 文件中，有一段如下：

    ```properties


2025-08-25 13:13:55,571 - evaluation_logger_Attraction-113 - INFO - Complete Result: {'score': 0, 'reason': "The response does not address any part of the user's query about trending attractions in Rio de Janeiro or ticket availability."}
2025-08-25 13:14:02,434 - evaluation_logger_Attraction-113 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 13:14:02,434 - evaluation_logger_Attraction-113 - INFO - Message: [{'error_type': 'value_error', 'content': 'Parameter slug value is not correct in prediction.'}, {'error_type': 'value_error', 'content': 'Parameter id value is not correct in prediction.'}]
2025-08-25 13:14:02,434 - evaluation_logger_Attraction-113 - INFO - Success turn num = 2
2025-08-25 13:14:02,434 - evaluation_logger_Attraction-113 - INFO - ----------------------------------------------------------------------------------------------------
