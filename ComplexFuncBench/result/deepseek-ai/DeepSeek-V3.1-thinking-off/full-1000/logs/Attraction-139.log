2025-08-25 13:13:35,465 - evaluation_logger_Attraction-139 - INFO - Test Example Attraction-139
2025-08-25 13:13:35,465 - evaluation_logger_Attraction-139 - INFO - Query: Our family of four is planning a vacation from December 23, 2024, to January 17, 2025, and we're trying to choose between Madrid and Munich. Can you check the ticket availability for attractions that offer free entry for our three-year-old on January 5 in both places?
2025-08-25 13:13:43,165 - evaluation_logger_Attraction-139 - INFO - Function Calls: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Madrid"
        }
    },
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Munich"
        }
    }
]

2025-08-25 13:13:43,165 - evaluation_logger_Attraction-139 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Madrid"
        }
    },
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Munich"
        }
    },
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0zOTA2MjV9"
        }
    },
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0xODI5MTQ5fQ=="
        }
    }
]

2025-08-25 13:13:43,165 - evaluation_logger_Attraction-139 - INFO - Start compare_single_call: 
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Madrid'}}
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Madrid'}}
2025-08-25 13:13:43,166 - evaluation_logger_Attraction-139 - INFO - Rule-based compare success.
2025-08-25 13:13:43,166 - evaluation_logger_Attraction-139 - INFO - Start compare_single_call: 
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Munich'}}
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Munich'}}
2025-08-25 13:13:43,166 - evaluation_logger_Attraction-139 - INFO - Rule-based compare success.
2025-08-25 13:13:43,166 - evaluation_logger_Attraction-139 - INFO - Success matched: [{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Madrid'}}, {'name': 'Search_Attraction_Location', 'arguments': {'query': 'Munich'}}]
2025-08-25 13:13:43,166 - evaluation_logger_Attraction-139 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "destinations": [
                {
                    "id": "eyJ1ZmkiOi0zOTA2MjV9",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": -390625,
                    "country": "Spain",
                    "cityName": "Madrid",
                    "productCount": 1190,
                    "cc1": "es"
                },
                {
                    "id": "eyJ1ZmkiOi0zNzI0OTB9",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": -372490,
                    "country": "Spain",
                    "cityName": "Barcelona",
                    "productCount": 1956,
                    "cc1": "es"
                }
            ]
        }
    },
    {
        "status": true,
        "message": "Success",
        "data": {
            "destinations": [
                {
                    "id": "eyJ1ZmkiOi0xODI5MTQ5fQ==",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": -1829149,
                    "country": "Germany",
                    "cityName": "Munich",
                    "productCount": 485,
                    "cc1": "de"
                },
                {
                    "id": "eyJ1ZmkiOi0yNTU0OTM1fQ==",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": -2554935,
                    "country": "Switzerland",
                    "cityName": "Zürich",
                    "productCount": 479,
                    "cc1": "ch"
                }
            ]
        }
    }
]

2025-08-25 13:13:53,731 - evaluation_logger_Attraction-139 - INFO - Function Calls: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0zOTA2MjV9"
        }
    },
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0xODI5MTQ5fQ=="
        }
    }
]

2025-08-25 13:13:53,731 - evaluation_logger_Attraction-139 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0zOTA2MjV9"
        }
    },
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0xODI5MTQ5fQ=="
        }
    },
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "prkzizln3gwg-santiago-bernabeu-stadium-tour"
        }
    },
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "prbwatkvt70w-admission-to-sea-life-munich"
        }
    }
]

2025-08-25 13:13:53,731 - evaluation_logger_Attraction-139 - INFO - Start compare_single_call: 
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0zOTA2MjV9'}}
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0zOTA2MjV9'}}
2025-08-25 13:13:53,731 - evaluation_logger_Attraction-139 - INFO - Rule-based compare success.
2025-08-25 13:13:53,731 - evaluation_logger_Attraction-139 - INFO - Start compare_single_call: 
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0xODI5MTQ5fQ=='}}
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0xODI5MTQ5fQ=='}}
2025-08-25 13:13:53,731 - evaluation_logger_Attraction-139 - INFO - Rule-based compare success.
2025-08-25 13:13:53,731 - evaluation_logger_Attraction-139 - INFO - Success matched: [{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0zOTA2MjV9'}}, {'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0xODI5MTQ5fQ=='}}]
2025-08-25 13:13:53,732 - evaluation_logger_Attraction-139 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProductSearchResponse",
            "products": [
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": false
                    },
                    "id": "PRkzizLn3GwG",
                    "name": "Santiago Bernabéu Stadium & Real Madrid Museum",
                    "slug": "prkzizln3gwg-santiago-bernabeu-stadium-tour",
                    "shortDescription": "A ticket to see trophies and artefacts at the Real Madrid C.F. Museum",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 37.71,
                        "currency": "USD",
                        "publicAmount": 37.71
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 782,
                        "percentage": "60%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 3.9,
                            "total": 2264
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Madrid",
                        "ufi": -390625
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIhjX0WnXHS5"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIZDBC7UGcKx"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIDZhkdnpPAU"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI72WXVEMxXE"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI7aFj5s9vCO"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIOWDBO1aFWA"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInMonth",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInWeek",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerOnWeekends",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForLandmarks",
                            "value": true,
                            "rank": 1
                        }
                    ]
                }
            ],
            "filterStats": {
                "__typename": "FilterStats",
                "unfilteredProductCount": 1189,
                "filteredProductCount": 1189
            },
            "sorters": [
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Our top picks",
                    "value": "trending"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Most popular",
                    "value": "attr_book_score"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Lowest price",
                    "value": "lowest_price"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Best reviewed",
                    "value": "highest_weighted_rating"
                }
            ],
            "defaultSorter": {
                "__typename": "AttractionsSorterOption",
                "name": "Our top picks",
                "value": "trending"
            },
            "filterOptions": {
                "__typename": "FilterOptions",
                "typeFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Tours",
                        "tagname": "tours",
                        "productCount": 283
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Museums, arts & culture",
                        "tagname": "museums-arts-culture",
                        "productCount": 189
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Nature & outdoor",
                        "tagname": "nature-outdoor",
                        "productCount": 133
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Entertainment & tickets",
                        "tagname": "entertainment-tickets",
                        "productCount": 83
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Food & drinks",
                        "tagname": "food-drinks",
                        "productCount": 37
                    }
                ],
                "labelFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Free cancellation",
                        "tagname": "free_cancellation",
                        "productCount": 1051
                    }
                ],
                "ufiFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Madrid",
                        "tagname": "-390625",
                        "productCount": 1171
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Pena Grande",
                        "tagname": "-396042",
                        "productCount": 17
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "El Escorial",
                        "tagname": "-380642",
                        "productCount": 1
                    }
                ],
                "priceFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "US$0 - US$22",
                        "tagname": "b0",
                        "productCount": 119
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$22 - US$44",
                        "tagname": "b1",
                        "productCount": 192
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$44 - US$83",
                        "tagname": "b2",
                        "productCount": 240
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$83 - US$138",
                        "tagname": "b3",
                        "productCount": 177
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$138+",
                        "tagname": "b4",
                        "productCount": 512
                    }
                ]
            }
        }
    },
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProductSearchResponse",
            "products": [
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRbWatKvt70w",
                    "name": "Admission to SEA LIFE Munich",
                    "slug": "prbwatkvt70w-admission-to-sea-life-munich",
                    "shortDescription": "A ticket to see Germany's largest variety of sharks and marine wildlife",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 23.7,
                        "currency": "USD",
                        "publicAmount": 23.7
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 48,
                        "percentage": "88%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.2,
                            "total": 166
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Munich",
                        "ufi": -1829149
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI34lIjkaCh6"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIMBHowroXZe"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OISvvAPYjpyY"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIhcKMPnVzDc"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI9SZEQLGmA7"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIxY2oKQWeqe"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIK3FWOQGYvX"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIlTcQQZqQhg"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIIHyT63riFX"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OITGRreheuhs"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI40IG8njIHY"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 4
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerOnWeekends",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForMuseums",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "popularFor3Travelers",
                            "value": true,
                            "rank": 4
                        }
                    ]
                }
            ],
            "filterStats": {
                "__typename": "FilterStats",
                "unfilteredProductCount": 484,
                "filteredProductCount": 484
            },
            "sorters": [
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Our top picks",
                    "value": "trending"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Most popular",
                    "value": "attr_book_score"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Lowest price",
                    "value": "lowest_price"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Best reviewed",
                    "value": "highest_weighted_rating"
                }
            ],
            "defaultSorter": {
                "__typename": "AttractionsSorterOption",
                "name": "Our top picks",
                "value": "trending"
            },
            "filterOptions": {
                "__typename": "FilterOptions",
                "typeFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Tours",
                        "tagname": "tours",
                        "productCount": 124
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Museums, arts & culture",
                        "tagname": "museums-arts-culture",
                        "productCount": 62
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Nature & outdoor",
                        "tagname": "nature-outdoor",
                        "productCount": 57
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Entertainment & tickets",
                        "tagname": "entertainment-tickets",
                        "productCount": 40
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Food & drinks",
                        "tagname": "food-drinks",
                        "productCount": 21
                    }
                ],
                "labelFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Free cancellation",
                        "tagname": "free_cancellation",
                        "productCount": 435
                    }
                ],
                "ufiFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Munich",
                        "tagname": "-1829149",
                        "productCount": 484
                    }
                ],
                "priceFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "US$0 - US$22",
                        "tagname": "b0",
                        "productCount": 41
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$22 - US$44",
                        "tagname": "b1",
                        "productCount": 44
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$44 - US$83",
                        "tagname": "b2",
                        "productCount": 55
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$83 - US$138",
                        "tagname": "b3",
                        "productCount": 38
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$138+",
                        "tagname": "b4",
                        "productCount": 314
                    }
                ]
            }
        }
    }
]

2025-08-25 13:14:04,124 - evaluation_logger_Attraction-139 - INFO - Function Calls: 
[
    {
        "name": "Get_Availability",
        "arguments": {
            "slug": "prkzizln3gwg-santiago-bernabeu-stadium-tour",
            "date": "2025-01-05"
        }
    },
    {
        "name": "Get_Availability",
        "arguments": {
            "slug": "prbwatkvt70w-admission-to-sea-life-munich",
            "date": "2025-01-05"
        }
    }
]

2025-08-25 13:14:04,124 - evaluation_logger_Attraction-139 - INFO - Golden Function Call: 
[
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "prkzizln3gwg-santiago-bernabeu-stadium-tour"
        }
    },
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "prbwatkvt70w-admission-to-sea-life-munich"
        }
    },
    {
        "name": "Get_Availability",
        "arguments": {
            "slug": "prkzizln3gwg-santiago-bernabeu-stadium-tour",
            "date": "2025-01-05"
        }
    }
]

2025-08-25 13:14:04,765 - evaluation_logger_Attraction-139 - INFO - Start compare_single_call: 
{'name': 'Get_Availability', 'arguments': {'date': '2025-01-05', 'slug': 'prkzizln3gwg-santiago-bernabeu-stadium-tour'}}
{'name': 'Get_Availability', 'arguments': {'date': '2025-01-05', 'slug': 'prkzizln3gwg-santiago-bernabeu-stadium-tour'}}
2025-08-25 13:14:04,766 - evaluation_logger_Attraction-139 - INFO - Rule-based compare success.
2025-08-25 13:14:04,766 - evaluation_logger_Attraction-139 - INFO - Start compare_single_call: 
{'name': 'Get_Availability', 'arguments': {'date': '2025-01-05', 'slug': 'prbwatkvt70w-admission-to-sea-life-munich'}}
{'name': 'Get_Attraction_Details', 'arguments': {'slug': 'prbwatkvt70w-admission-to-sea-life-munich'}}
2025-08-25 13:14:04,766 - evaluation_logger_Attraction-139 - INFO - {'error_type': 'func_error', 'content': 'Do not call the correct function.'}
2025-08-25 13:14:04,766 - evaluation_logger_Attraction-139 - INFO - Success matched: [{'name': 'Get_Availability', 'arguments': {'date': '2025-01-05', 'slug': 'prkzizln3gwg-santiago-bernabeu-stadium-tour'}}]
2025-08-25 13:14:04,766 - evaluation_logger_Attraction-139 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": [
            {
                "__typename": "AttractionTimeSlot",
                "fullDay": false,
                "start": "2025-01-05T10:00:00+01:00",
                "timeSlotId": "TS2qaPVToEZg",
                "timeSlotOffers": [
                    {
                        "__typename": "AttractionTimeSlotOffer",
                        "benefits": {
                            "__typename": "Benefits"
                        },
                        "id": "OFt6MdBfC1aP",
                        "items": [
                            {
                                "__typename": "AttractionTimeSlotOfferItem",
                                "cancellationPolicy": {
                                    "__typename": "AttractionsCancellationPolicy",
                                    "hasFreeCancellation": false,
                                    "isStillRefundable": false
                                },
                                "constraint": {
                                    "__typename": "Constraint",
                                    "label": "(age 15+)"
                                },
                                "id": "TOuKjtyGTsfd",
                                "offerItemId": "OIDZhkdnpPAU",
                                "type": "adult",
                                "tieredPricing": false,
                                "price": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 35,
                                    "currency": "EUR",
                                    "publicAmount": 35
                                },
                                "convertedPrice": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 37.71,
                                    "currency": "USD",
                                    "publicAmount": 37.71
                                },
                                "ticketsAvailable": 10000,
                                "maxPerReservation": 15,
                                "minPerReservation": 1,
                                "label": "Adult"
                            },
                            {
                                "__typename": "AttractionTimeSlotOfferItem",
                                "cancellationPolicy": {
                                    "__typename": "AttractionsCancellationPolicy",
                                    "hasFreeCancellation": false,
                                    "isStillRefundable": false
                                },
                                "constraint": {
                                    "__typename": "Constraint",
                                    "label": "(age 5-14)"
                                },
                                "id": "TOO7ltXGeWE7",
                                "offerItemId": "OI72WXVEMxXE",
                                "type": "children",
                                "tieredPricing": false,
                                "price": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 29,
                                    "currency": "EUR",
                                    "publicAmount": 29
                                },
                                "convertedPrice": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 31.25,
                                    "currency": "USD",
                                    "publicAmount": 31.25
                                },
                                "ticketsAvailable": 10000,
                                "maxPerReservation": 15,
                                "minPerReservation": 1,
                                "label": "Child"
                            }
                        ],
                        "label": "Entrance ticket",
                        "reservationRestrictions": {
                            "__typename": "ReservationRestrictions",
                            "adultRequiredForReservation": true,
                            "minOfferItemsPerReservation": 0
                        }
                    }
                ]
            },
            {
                "__typename": "AttractionTimeSlot",
                "fullDay": false,
                "start": "2025-01-05T10:30:00+01:00",
                "timeSlotId": "TSQQpeh4QRjP",
                "timeSlotOffers": [
                    {
                        "__typename": "AttractionTimeSlotOffer",
                        "benefits": {
                            "__typename": "Benefits"
                        },
                        "id": "OFt6MdBfC1aP",
                        "items": [
                            {
                                "__typename": "AttractionTimeSlotOfferItem",
                                "cancellationPolicy": {
                                    "__typename": "AttractionsCancellationPolicy",
                                    "hasFreeCancellation": false,
                                    "isStillRefundable": false
                                },
                                "constraint": {
                                    "__typename": "Constraint",
                                    "label": "(age 15+)"
                                },
                                "id": "TOlZEICDeRsn",
                                "offerItemId": "OIDZhkdnpPAU",
                                "type": "adult",
                                "tieredPricing": false,
                                "price": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 35,
                                    "currency": "EUR",
                                    "publicAmount": 35
                                },
                                "convertedPrice": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 37.71,
                                    "currency": "USD",
                                    "publicAmount": 37.71
                                },
                                "ticketsAvailable": 10000,
                                "maxPerReservation": 15,
                                "minPerReservation": 1,
                                "label": "Adult"
                            },
                            {
                                "__typename": "AttractionTimeSlotOfferItem",
                                "cancellationPolicy": {
                                    "__typename": "AttractionsCancellationPolicy",
                                    "hasFreeCancellation": false,
                                    "isStillRefundable": false
                                },
                                "constraint": {
                                    "__typename": "Constraint",
                                    "label": "(age 5-14)"
                                },
                                "id": "TOd6qd4XpFkD",
                                "offerItemId": "OI72WXVEMxXE",
                                "type": "children",
                                "tieredPricing": false,
                                "price": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 29,
                                    "currency": "EUR",
                                    "publicAmount": 29
                                },
                                "convertedPrice": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 31.25,
                                    "currency": "USD",
                                    "publicAmount": 31.25
                                },
                                "ticketsAvailable": 10000,
                                "maxPerReservation": 15,
                                "minPerReservation": 1,
                                "label": "Child"
                            }
                        ],
                        "label": "Entrance ticket",
                        "reservationRestrictions": {
                            "__typename": "ReservationRestrictions",
                            "adultRequiredForReservation": true,
                            "minOfferItemsPerReservation": 0
                        }
                    }
                ]
            },
            {
                "__typename": "AttractionTimeSlot",
                "fullDay": false,
                "start": "2025-01-05T11:00:00+01:00",
                "timeSlotId": "TSsgz9eXScYv",
                "timeSlotOffers": [
                    {
                        "__typename": "AttractionTimeSlotOffer",
                        "benefits": {
                            "__typename": "Benefits"
                        },
                        "id": "OFt6MdBfC1aP",
                        "items": [
                            {
                                "__typename": "AttractionTimeSlotOfferItem",
                                "cancellationPolicy": {
                                    "__typename": "AttractionsCancellationPolicy",
                                    "hasFreeCancellation": false,
                                    "isStillRefundable": false
                                },
                                "constraint": {
                                    "__typename": "Constraint",
                                    "label": "(age 15+)"
                                },
                                "id": "TOBT95mDLF0Z",
                                "offerItemId": "OIDZhkdnpPAU",
                                "type": "adult",
                                "tieredPricing": false,
                                "price": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 35,
                                    "currency": "EUR",
                                    "publicAmount": 35
                                },
                                "convertedPrice": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 37.71,
                                    "currency": "USD",
                                    "publicAmount": 37.71
                                },
                                "ticketsAvailable": 10000,
                                "maxPerReservation": 15,
                                "minPerReservation": 1,
                                "label": "Adult"
                            },
                            {
                                "__typename": "AttractionTimeSlotOfferItem",
                                "cancellationPolicy": {
                                    "__typename": "AttractionsCancellationPolicy",
                                    "hasFreeCancellation": false,
                                    "isStillRefundable": false
                                },
                                "constraint": {
                                    "__typename": "Constraint",
                                    "label": "(age 5-14)"
                                },
                                "id": "TO0Z9AE4R0Dw",
                                "offerItemId": "OI72WXVEMxXE",
                                "type": "children",
                                "tieredPricing": false,
                                "price": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 29,
                                    "currency": "EUR",
                                    "publicAmount": 29
                                },
                                "convertedPrice": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 31.25,
                                    "currency": "USD",
                                    "publicAmount": 31.25
                                },
                                "ticketsAvailable": 10000,
                                "maxPerReservation": 15,
                                "minPerReservation": 1,
                                "label": "Child"
                            }
                        ],
                        "label": "Entrance ticket",
                        "reservationRestrictions": {
                            "__typename": "ReservationRestrictions",
                            "adultRequiredForReservation": true,
                            "minOfferItemsPerReservation": 0
                        }
                    }
                ]
            },
            {
                "__typename": "AttractionTimeSlot",
                "fullDay": false,
                "start": "2025-01-05T11:30:00+01:00",
                "timeSlotId": "TSmCsS7qapD6",
                "timeSlotOffers": [
                    {
                        "__typename": "AttractionTimeSlotOffer",
                        "benefits": {
                            "__typename": "Benefits"
                        },
                        "id": "OFt6MdBfC1aP",
                        "items": [
                            {
                                "__typename": "AttractionTimeSlotOfferItem",
                                "cancellationPolicy": {
                                    "__typename": "AttractionsCancellationPolicy",
                                    "hasFreeCancellation": false,
                                    "isStillRefundable": false
                                },
                                "constraint": {
                                    "__typename": "Constraint",
                                    "label": "(age 15+)"
                                },
                                "id": "TOVbIexEcK1Z",
                                "offerItemId": "OIDZhkdnpPAU",
                                "type": "adult",
                                "tieredPricing": false,
                                "price": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 35,
                                    "currency": "EUR",
                                    "publicAmount": 35
                                },
                                "convertedPrice": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 37.71,
                                    "currency": "USD",
                                    "publicAmount": 37.71
                                },
                                "ticketsAvailable": 10000,
                                "maxPerReservation": 15,
                                "minPerReservation": 1,
                                "label": "Adult"
                            },
                            {
                                "__typename": "AttractionTimeSlotOfferItem",
                                "cancellationPolicy": {
                                    "__typename": "AttractionsCancellationPolicy",
                                    "hasFreeCancellation": false,
                                    "isStillRefundable": false
                                },
                                "constraint": {
                                    "__typename": "Constraint",
                                    "label": "(age 5-14)"
                                },
                                "id": "TOBbUzaYlF4n",
                                "offerItemId": "OI72WXVEMxXE",
                                "type": "children",
                                "tieredPricing": false,
                                "price": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 29,
                                    "currency": "EUR",
                                    "publicAmount": 29
                                },
                                "convertedPrice": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 31.25,
                                    "currency": "USD",
                                    "publicAmount": 31.25
                                },
                                "ticketsAvailable": 10000,
                                "maxPerReservation": 15,
                                "minPerReservation": 1,
                                "label": "Child"
                            }
                        ],
                        "label": "Entrance ticket",
                        "reservationRestrictions": {
                            "__typename": "ReservationRestrictions",
                            "adultRequiredForReservation": true,
                            "minOfferItemsPerReservation": 0
                        }
                    }
                ]
            },
            {
                "__typename": "AttractionTimeSlot",
                "fullDay": false,
                "start": "2025-01-05T12:00:00+01:00",
                "timeSlotId": "TSX2sO90LEW8",
                "timeSlotOffers": [
                    {
                        "__typename": "AttractionTimeSlotOffer",
                        "benefits": {
                            "__typename": "Benefits"
                        },
                        "id": "OFt6MdBfC1aP",
                        "items": [
                            {
                                "__typename": "AttractionTimeSlotOfferItem",
                                "cancellationPolicy": {
                                    "__typename": "AttractionsCancellationPolicy",
                                    "hasFreeCancellation": false,
                                    "isStillRefundable": false
                                },
                                "constraint": {
                                    "__typename": "Constraint",
                                    "label": "(age 15+)"
                                },
                                "id": "TOn1CaRAVewo",
                                "offerItemId": "OIDZhkdnpPAU",
                                "type": "adult",
                                "tieredPricing": false,
                                "price": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 35,
                                    "currency": "EUR",
                                    "publicAmount": 35
                                },
                                "convertedPrice": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 37.71,
                                    "currency": "USD",
                                    "publicAmount": 37.71
                                },
                                "ticketsAvailable": 10000,
                                "maxPerReservation": 15,
                                "minPerReservation": 1,
                                "label": "Adult"
                            },
                            {
                                "__typename": "AttractionTimeSlotOfferItem",
                                "cancellationPolicy": {
                                    "__typename": "AttractionsCancellationPolicy",
                                    "hasFreeCancellation": false,
                                    "isStillRefundable": false
                                },
                                "constraint": {
                                    "__typename": "Constraint",
                                    "label": "(age 5-14)"
                                },
                                "id": "TO7AAwYnA7EB",
                                "offerItemId": "OI72WXVEMxXE",
                                "type": "children",
                                "tieredPricing": false,
                                "price": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 29,
                                    "currency": "EUR",
                                    "publicAmount": 29
                                },
                                "convertedPrice": {
                                    "__typename": "AttractionsPrice",
                                    "chargeAmount": 31.25,
                                    "currency": "USD",
                                    "publicAmount": 31.25
                                },
                                "ticketsAvailable": 10000,
                                "maxPerReservation": 15,
                                "minPerReservation": 1,
                                "label": "Child"
                            }
                        ],
                        "label": "Entrance ticket",
                        "reservationRestrictions": {
                            "__typename": "ReservationRestrictions",
                            "adultRequiredForReservation": true,
                            "minOfferItemsPerReservation": 0
                        }
                    }
                ]
            }
        ]
    },
    {
        "api_status": true,
        "content": "There is a problem with your api call, please double-check for possible problems."
    }
]

2025-08-25 13:14:14,432 - evaluation_logger_Attraction-139 - INFO - Function Calls: 
[
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "prbwatkvt70w-admission-to-sea-life-munich"
        }
    }
]

2025-08-25 13:14:14,432 - evaluation_logger_Attraction-139 - INFO - Golden Function Call: 
[
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "prkzizln3gwg-santiago-bernabeu-stadium-tour"
        }
    },
    {
        "name": "Get_Attraction_Details",
        "arguments": {
            "slug": "prbwatkvt70w-admission-to-sea-life-munich"
        }
    }
]

2025-08-25 13:14:14,432 - evaluation_logger_Attraction-139 - INFO - Start compare_single_call: 
{'name': 'Get_Attraction_Details', 'arguments': {'slug': 'prbwatkvt70w-admission-to-sea-life-munich'}}
{'name': 'Get_Attraction_Details', 'arguments': {'slug': 'prbwatkvt70w-admission-to-sea-life-munich'}}
2025-08-25 13:14:14,432 - evaluation_logger_Attraction-139 - INFO - Rule-based compare success.
2025-08-25 13:14:14,432 - evaluation_logger_Attraction-139 - INFO - Success matched: [{'name': 'Get_Attraction_Details', 'arguments': {'slug': 'prbwatkvt70w-admission-to-sea-life-munich'}}]
2025-08-25 13:14:14,433 - evaluation_logger_Attraction-139 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProduct",
            "additionalInfo": "Children aged 0–2 years can enter for free. \r\n\r\nPlease note that pets are not allowed on the tour except for service dogs.\r\n\r\nPlease present your mobile voucher at the entrance of the attraction. \r\n\r\nAdmission to the attraction is only granted on the booked day and time slot.\n\nPlease bring your ticket with you to the attraction.\n\nBe aware that operators may cancel for unforeseen reasons.\n\nYou need to be 18 years or older to book or be accompanied by an adult. ",
            "applicableTerms": [
                {
                    "__typename": "TermsConditions",
                    "policyProvider": "Booking.com"
                },
                {
                    "__typename": "TermsConditions",
                    "policyProvider": "Musement"
                }
            ],
            "cancellationPolicy": {
                "__typename": "AttractionsCancellationPolicy",
                "hasFreeCancellation": true
            },
            "description": "This ticket will give you access to SEA LIFE Munich, the home of Germany's largest shark variety. During your visit, you'll be able to see over 20 diverse shark species, including the pyjama shark, the zebra shark, the school shark and the Japanese wobbegong, known for its camouflage and motionless behaviour. \r\n\r\nYou'll also have the chance to admire some of the 3,000 marine inhabitants that live in the centre's tropical pools, as well as meet Lady Pünktchen – the largest shark at SEA LIFE.",
            "flags": [
                {
                    "__typename": "AttractionsProductFlags",
                    "flag": "bestseller",
                    "value": true,
                    "rank": 4
                },
                {
                    "__typename": "AttractionsProductFlags",
                    "flag": "bestsellerOnWeekends",
                    "value": true,
                    "rank": 2
                },
                {
                    "__typename": "AttractionsProductFlags",
                    "flag": "bestsellerForMuseums",
                    "value": true,
                    "rank": 1
                },
                {
                    "__typename": "AttractionsProductFlags",
                    "flag": "popularFor3Travelers",
                    "value": true,
                    "rank": 4
                }
            ],
            "id": "PRbWatKvt70w",
            "isBookable": true,
            "labels": [
                {
                    "__typename": "AttractionsLabel",
                    "text": "Free cancellation",
                    "type": "free_cancellation"
                }
            ],
            "name": "Admission to SEA LIFE Munich",
            "offers": [
                {
                    "__typename": "Offer",
                    "availabilityType": "date_time",
                    "id": "OFIiLRdv1iox"
                },
                {
                    "__typename": "Offer",
                    "availabilityType": "date_time",
                    "id": "OFK6feOwwmpG"
                },
                {
                    "__typename": "Offer",
                    "availabilityType": "date_time",
                    "id": "OFRAj5eLoNt7"
                }
            ],
            "onSiteRequirements": {
                "__typename": "OnSiteRequirements"
            },
            "operatedBy": "Musement",
            "representativePrice": {
                "__typename": "AttractionsPrice",
                "chargeAmount": 23.7,
                "currency": "USD",
                "publicAmount": 23.7
            },
            "restrictions": [
                "Children under 14 years old must be accompanied by an adult."
            ],
            "reviews": {
                "__typename": "AttractionsGetReviewsResponse",
                "total": 174,
                "reviews": [
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSrBxQ5md5PU",
                        "epochMs": 1730018510000,
                        "language": "de",
                        "numericRating": 3,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "Sabrina",
                            "cc1": "de"
                        }
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSczmcBvGjYT",
                        "epochMs": 1729587208000,
                        "numericRating": 5,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "Angelika",
                            "cc1": "de"
                        }
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSggvWHhTl2l",
                        "epochMs": 1729068578000,
                        "numericRating": 4
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RS3uRBgJnHNZ",
                        "epochMs": 1728880498000,
                        "language": "de",
                        "numericRating": 5,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "Diana",
                            "cc1": "de"
                        }
                    },
                    {
                        "__typename": "AttractionsReview",
                        "id": "RSNlqRni0fnR",
                        "epochMs": 1727457262000,
                        "numericRating": 5,
                        "user": {
                            "__typename": "AttractionsReviewUser",
                            "name": "Klaudia"
                        }
                    }
                ]
            },
            "reviewsStats": {
                "__typename": "AttractionsProductReviewStats",
                "allReviewsCount": 48,
                "percentage": "88%",
                "combinedNumericStats": {
                    "__typename": "AttractionsProductCombinedReviewStats",
                    "average": 4.2,
                    "total": 166
                }
            },
            "shortDescription": "A ticket to see Germany's largest variety of sharks and marine wildlife",
            "slug": "prbwatkvt70w-admission-to-sea-life-munich",
            "supportedFeatures": {
                "__typename": "AttractionsProductSupportedFeatures",
                "nativeApp": true,
                "nativeAppBookProcess": true,
                "liveAvailabilityCheckSupported": true
            },
            "uniqueSellingPoints": [
                "Home to Germany's largest variety of sharks",
                "Chance to meet Lady Pünktchen, the zebra shark",
                "33 pools featuring 3,000 marine inhabitants"
            ],
            "ufiDetails": {
                "__typename": "AttractionLocationResponse",
                "ufi": -1829149,
                "bCityName": "Munich"
            },
            "whatsIncluded": [
                "Admission"
            ]
        }
    }
]

2025-08-25 13:17:23,855 - evaluation_logger_Attraction-139 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 概述

## 1.1 什么是Spring

Spring是一个开源框架，它由[Rod Johnson](https://baike.baidu.com/item/Rod Johnson)创建。它是为了解决企业应用开发的复杂性而创建的。

Spring使用基本的JavaBean来完成以前只可能由EJB完成的事情。

然而，Spring的用途不仅限于服务器端的开发。从简单性、可测试性和松耦合的角度而言，任何Java应用都可以从Spring中受益。

**目的：**解决企业应用开发的复杂性

**功能：**使用基本的JavaBean代替EJB，并提供了更多的企业应用功能

**范围：**任何Java应用

简单来说，Spring是一个轻量级的控制反转(IoC)和面向切面(AOP)的容器框架。

## 1.2 Spring框架的特点

- **轻量**：从大小与开销两方面而言Spring都是轻量的。完整的Spring框架可以在一个大小只有1MB多的JAR文件里发布。并且Spring所需的处理开销也是微不足道的。此外，Spring是非侵入式的：典型地，Spring应用中的对象不依赖于Spring的特定类。
- **控制反转**：Spring通过一种称作控制反转（IoC）的技术促进了松耦合。当应用了IoC，一个对象依赖的其它对象会通过被动的方式传递进来，而不是这个对象自己创建或者查找依赖对象。你可以认为IoC与JNDI相反——不是对象从容器中查找依赖，而是容器在对象初始化时不等对象请求就主动将依赖传递给它。
- **面向切面**：Spring提供了面向切面编程的丰富支持，允许通过分离应用的业务逻辑与系统级服务（例如审计（auditing）和事务（transaction）管理）进行内聚性的开发。应用对象只实现它们应该做的——完成业务逻辑——仅此而已。它们并不负责（甚至是意识）其它的系统级关注点，例如日志或事务支持。
- **容器**：Spring包含并管理应用对象的配置和生命周期，在这个意义上它是一种容器，你可以配置你的每个bean如何被创建——基于一个可配置原型（prototype），你的bean可以创建一个单独的实例或者每次需要时都生成一个新的实例——以及它们是如何相互关联的。然而，Spring不应该被混同于传统的重量级的EJB容器，它们经常是庞大与笨重的，难以使用。
- **框架**：Spring可以将简单的组件配置、组合成为复杂的应用。在Spring中，应用对象被声明式地组合，典型地是在一个XML文件里。Spring也提供了很多基础功能（事务管理、持久化框架集成等等），将应用逻辑的开发留给了你。

所有Spring的这些特征使你能够编写更干净、更可管理、并且更易于测试的代码。它们也为Spring中的各种模块提供了基础支持。

## 1.3 Spring的体系结构

Spring框架是一个分层架构，由7个定义良好的模块组成。Spring模块构建在核心容器之上，核心容器定义了创建、配置和管理bean的方式，如图1所示。

![Spring框架的7个模块](https://gitee.com/jiao_qianjin/zhishiku/raw/master/img/20211207144142.png)

组成Spring框架的每个模块（或组件）都可以单独存在，或者与其他一个或多个模块联合实现。每个模块的功能如下：

- **核心容器**：核心容器提供Spring框架的基本功能。核心容器的主要组件是BeanFactory，它是工厂模式的实现。BeanFactory使用控制反转（IOC）模式将应用程序的配置和依赖性规范与实际的应用程序代码分开。
- **Spring上下文**：Spring上下文是一个配置文件，向Spring框架提供上下文信息。Spring上下文包括企业服务，例如JNDI、EJB、电子邮件、国际化、校验和调度功能。
- **Spring AOP**：通过配置管理特性，Spring AOP模块直接将面向切面的编程功能集成到了Spring框架中。所以，可以很容易地使Spring框架管理的任何对象支持AOP。Spring AOP模块为基于Spring的应用程序中的对象提供了事务管理服务。通过使用Spring AOP，不用依赖EJB组件，就可以将声明性事务管理集成到应用程序中。
- **Spring DAO**：JDBC DAO抽象层提供了有意义的异常层次结构，可用该结构来管理异常处理和不同数据库供应商抛出的错误消息。异常层次结构简化了错误处理，并且极大地降低了需要编写的异常代码数量（例如打开和关闭连接）。Spring DAO的面向JDBC的异常遵从通用的DAO异常层次结构。
- **Spring ORM**：Spring框架插入了若干个ORM框架，从而提供了ORM的对象关系工具，其中包括JDO、Hibernate和iBatis SQL Map。所有这些都遵从Spring的通用事务和DAO异常层次结构。
- **Spring Web模块**：Web上下文模块建立在应用程序上下文模块之上，为基于Web的应用程序提供了上下文。所以，Spring框架支持与Jakarta Struts的集成。Web模块还简化了处理多部分请求以及将请求参数绑定到域对象的工作。
- **Spring MVC框架**：MVC框架是一个全功能的构建Web应用程序的MVC实现。通过策略接口，MVC框架变成为高度可配置的，MVC容纳了大量视图技术，其中包括JSP、Velocity、Tiles、iText和POI。

Spring框架的功能可以用在任何J2EE服务器中，大多数功能也适用于不受管理的环境。Spring的核心要点是：支持不绑定到特定J2EE服务的可重用业务和数据访问对象。毫无疑问，这样的对象可以在不同J2EE环境（Web或EJB）、独立应用程序、测试环境之间重用。

# 2. IoC基础

## 2.1 什么是IoC

IoC是Inversion of Control的缩写，多数书籍翻译成“控制反转”。

1996年，Michael Mattson在一篇有关探讨面向对象框架的文章中，首先提出了IoC 这个概念。对于面向对象设计及编程的基本思想，前面我们已经讲了很多了，不再赘述，简单来说就是把复杂系统分解成相互合作的对象，这些对象类通过封装以后，内部实现对外部是透明的，从而降低了解决问题的复杂度，而且可以灵活地被重用和扩展。

IoC理论提出的观点大体是这样的：借助于“第三方”实现具有依赖关系的对象之间的解耦，如下图：

![img](https://gitee.com/jiao_qianjin/zhishiku/raw/master/img/20211207144142.png)

由于引进了中间位置的“第三方”，也就是IoC容器，使得A、B、C、D这4个对象没有了耦合关系，齿轮之间的传动全部依靠“第三方”了，全部对象的控制权全部上缴给“第三方”IoC容器，所以，IoC容器成了整个系统的关键核心，它起到了一种类似“粘合剂”的作用，把系统中的所有对象粘合在一起发挥作用，如果没有这个“粘合剂”，对象与对象之间会彼此失去联系，这就是有人把IoC容器比喻成“粘合剂”的由来。

我们再来做个试验：把上图中间的IoC容器拿掉，然后再来看看这套系统：

![img](https://gitee.com/jiao_qianjin/zhishiku/raw/master/img/20211207144142.png)

我们现在看到的画面，就是我们要实现整个系统所需要完成的全部内容。这时候，A、B、C、D这4个对象之间已经没有了耦合关系，彼此毫无联系，这样的话，当你在实现A的时候，根本无须再去考虑B、C和D了，对象之间的依赖关系已经降低到了最低程度。所以，如果真能实现IoC容器，对于系统开发而言，这将是一件多么美好的事情，参与开发的每一成员只要实现自己的类就可以了，跟别人没有任何关系！

我们再来看看，控制反转(IoC)到底为什么要起这么个名字？我们来对比一下：

- 软件系统在没有引入IoC容器之前，如图1所示，对象A依赖于对象B，那么对象A在初始化或者运行到某一点的时候，自己必须主动去创建对象B或者使用已经创建的对象B。无论是创建还是使用对象B，控制权都在自己手上。
- 软件系统在引入IoC容器之后，这种情形就完全改变了，如图3所示，由于IoC容器的加入，对象A与对象B之间失去了直接联系，所以，当对象A运行到需要对象B的时候，IoC容器会主动创建一个对象B注入到对象A需要的地方。

通过前后的对比，我们不难看出来：对象A获得依赖对象B的过程,由主动行为变为了被动行为，控制权颠倒过来了，这就是“控制反转”这个名称的由来。

## 2.2 IoC的别名：依赖注入(DI)

2004年，Martin Fowler探讨了同一个问题，既然IoC是控制反转，那么到底是“哪些方面的控制被反转了呢？”，经过详细地分析和论证后，他得出了答案：“获得依赖对象的过程被反转了”。控制被反转之后，获得依赖对象的过程由自身管理变为了由IoC容器主动注入。于是，他给“控制反转”取了一个更合适的名字叫做“依赖注入（Dependency Injection）”。他的这个答案，实际上给出了实现IoC的方法：注入。所谓依赖注入，就是由IoC容器在运行期间，动态地将某种依赖关系注入到对象之中。

所以，依赖注入(DI)和控制反转(IoC)是从不同的角度的描述的同一件事情，就是指通过引入IoC容器，利用依赖关系注入的方式，实现对象之间的解耦。

我们举一个生活中的例子，来帮助理解依赖注入的过程。大家对USB接口和USB设备应该都很熟悉吧，USB为我们使用电脑提供了很大的方便，现在有很多的外部设备都支持USB接口。

![img](https://gitee.com/jiao_qianjin/zhishiku/raw/master/img/20211207144142.png)

现在，我们利用电脑主机和USB接口来实现一个任务：从外部硬盘拷贝一个文件到电脑中。

如果我们没有使用USB接口，而是将外部硬盘与电脑主机直接连接起来，那么我们就必须把硬盘拆开，把硬盘的接口与电脑主机的接口焊接起来，如果后面我们又要拷贝文件到另外一台电脑上，那么又要拆开硬盘和电脑主机，再重新焊接...显然这样做是不现实的。

但是，如果使用USB接口，情况就完全不一样了。主机上预留了USB插槽，硬盘上也有USB插槽，那么我们要连接硬盘和主机，只需要通过一根USB线连接即可。而且，如果以后要连接其他的USB设备，也只需要通过USB线连接即可。

在这个例子中，电脑主机和外部硬盘之间没有直接依赖，它们都依赖与USB接口。USB接口就相当于IoC容器，它使得电脑主机和外部硬盘之间实现了解耦。这就是依赖注入的思维。

## 2.3 我们理解的IoC

在Spring中，IoC容器是实现IoC的载体，它可以在对象生成或初始化时直接将数据注入到对象中，也可以通过将对象引用注入到对象数据域中的方式来注入对方法调用的依赖。这种依赖注入是可以递归的，对象被逐层注入。就此而言，这种方案是彻底解耦的。

IoC是一种新的设计模式，即IoC模式，系统中通过引入实现了IoC模式的IoC容器，即可由IoC容器来管理对象的生命周期、依赖关系等，从而使得应用程序的配置和依赖性规范与实际的应用程序代码分开。其中一个特点就是通过文本的配置文件进行应用程序组件间相互关系的配置，而不用重新修改并编译具体的代码。

当前比较知名的IoC容器有：Pico Container、Avalon 、Spring、JBoss、HiveMind、EJB等。

在上面的几个IoC容器中，轻量级的有Pico Container、Avalon、Spring、HiveMind等，超重量级的有EJB，而半轻半重的有容器有JBoss，Jdon等。

可以把IoC模式看做是工厂模式的升华，可以把IoC容器看作是一个工厂，这个工厂里要生产的对象都在配置文件中给出定义，然后利用编程语言的的反射编程，根据配置文件中给出的类名生成相应的对象。从实现来看，IoC是把以前在工厂方法里写死的对象生成代码，改变为由配置文件来定义，也就是把工厂和对象生成这两者独立分隔开来，目的就是提高灵活性和可维护性。

## 2.4 IoC的类型

从注入方法上看，主要可以划分为三种类型：构造函数注入、属性注入和接口注入。Spring支持构造函数注入和属性注入。

### 2.4.1 构造函数注入

构造函数注入，顾名思义，就是被注入对象可以通过在其构造方法中声明依赖对象的参数列表，让外部（通常是IoC容器）知道它需要哪些依赖对象。

IoC Service Provider会检查被注入对象的构造方法，取得它所需要的依赖对象列表，进而为其注入相应的对象。同一个对象是不可能被构造两次的，因此，被注入对象的构造乃至其整个生命周期，应该是由IoC Service Provider来管理的。

构造方法注入方式比较直观，对象被构造完成后，即进入就绪状态，可以马上使用。这就好比你刚进公司，你的职位已经给你定好了，所有办公设备也已经准备就绪，你可以直接开始工作了。

### 2.4.2 属性注入

对于属性注入，可以是通过setter方法，也可以是通过字段（Field）注入，但不管采用哪种方式，思路都是相同的。通过属性注入，可以让我们在对象构造完成后再注入依赖对象。

属性注入的方式有几种变体，你可以根据你的使用场景选择合适的方式。

### 2.4.3 接口注入

相对于前两种注入方式来说，接口注入没有那么简单明了。被注入对象如果想要IoC Service Provider为其注入依赖对象，就必须实现某个接口，这个接口提供一个方法，用来为其注入依赖对象。IoC Service Provider最终通过这些接口来了解应该为被注入对象注入什么依赖对象。

相对于前两种依赖注入方式，接口注入比较死板和烦琐。如果需要注入依赖对象，被注入对象就必须声明和实现另外的接口。这就好像你刚到公司，你的老板对你说：“小A，为了能够更好地为你服务，你需要实现我给你的这个IServiceProvider接口，这样我才能给你提供你需要的服务！”显然，这种方式没有前两种方式友好。

## 2.5 IoC的优缺点

IoC最大的好处是什么？因为把对象生成放在了XML里定义，所以当我们需要换一个实现子类将会变成很简单（一般这样的对象都是实现于某种接口的），只要修改XML就可以了，这样我们甚至可以实现对象的热插拔（有点像USB接口和SCSI硬盘了）。

IoC最大的缺点是什么？（1）生成一个对象的步骤变复杂了（其实上操作上还是挺简单的），对于不习惯这种方式的人，会觉得有些别扭和不直观。（2）对象生成因为是使用反射编程，在效率上有些损耗。但相对于IoC提高的维护性和灵活性来说，这点损耗是微不足道的，除非某对象的生成对效率要求特别高。（3）缺少IDE重构操作的支持，如果在Eclipse要对类改名，那么你还需要去XML文件里手工去改了，这似乎是所有XML方式的缺憾所在。

# 3. Spring IoC容器

## 3.1 Spring IoC容器的设计

Spring框架的核心是Spring IoC容器。容器创建Bean对象，将它们装配在一起，配置它们并管理它们的完整生命周期。Spring容器使用依赖注入来管理组成应用程序的组件。

Spring提供了两种类型的容器：

- **BeanFactory**：`org.springframework.beans.factory.BeanFactory`是Spring IoC容器的根接口，它提供了配置框架和基本功能。BeanFactory是用于访问Spring bean容器的根接口。这是一个基本的工厂模式，用于创建和管理任何类型的对象。
- **ApplicationContext**：`org.springframework.context.ApplicationContext`是BeanFactory的子接口，它添加了更多的企业特定的功能，例如更容易的集成Spring的AOP功能，消息资源处理（用于国际化），事件发布，以及应用层特定的上下文，例如WebApplicationContext用于Web应用程序。

ApplicationContext包括BeanFactory的所有功能，通常推荐超过BeanFactory。然而，BeanFactory仍然可以用于轻量级的应用程序，如移动设备或基于applet的应用程序，其中数据量和速度是重要的。

## 3.2 BeanFactory

BeanFactory是Spring框架最核心的接口，它提供了高级IoC的配置机制。BeanFactory是用于管理Bean的工厂，它负责实例化、定位、配置应用程序中的对象及建立这些对象间的依赖。

BeanFactory实际上是个工厂，它根据客户端的要求，创建Bean实例。BeanFactory有很多的实现类，其中最常用的是`org.springframework.beans.factory.xml.XmlBeanFactory`，它根据XML文件中的定义装载Bean。

ApplicationContext是BeanFactory的子接口，也被称为Spring上下文。ApplicationContext接口由BeanFactory接口派生而来，因而提供了BeanFactory所有的功能。ApplicationContext以一种更向面向框架的方式工作以及对上下文进行分层和实现继承，ApplicationContext包还提供了以下的功能：

- MessageSource, 提供国际化的消息访问
- 资源访问，如URL和文件
- 事件传播
- 载入多个（有继承关系）上下文 ，使得每一个上下文都专注于一个特定的层次，比如应用的web层

## 3.3 ApplicationContext

ApplicationContext是Spring提供的一个高级的IoC容器，它提供了BeanFactory的所有功能，并且添加了更多的企业特定的功能。ApplicationContext包括BeanFactory的所有功能，通常推荐超过BeanFactory。

ApplicationContext的主要实现类有：

- `ClassPathXmlApplicationContext`：从类路径下的XML配置文件中加载上下文定义，把上下文定义文件当做类路径资源。
- `FileSystemXmlApplicationContext`：从文件系统下的XML配置文件中加载上下文定义。
- `XmlWebApplicationContext`：从Web应用下的XML配置文件中加载上下文定义。

除了XML配置文件，ApplicationContext也支持基于注解的配置，这可以通过`AnnotationConfigApplicationContext`来实现。

## 3.4 Bean的定义

在Spring中，构成应用程序主干并由Spring IoC容器管理的对象称为bean。bean是一个由Spring IoC容器实例化、组装和管理的对象。

Bean定义包含称为配置元数据的信息，容器需要知道以下内容：

- 如何创建一个bean
- Bean的生命周期的详细信息
- Bean的依赖关系

所有这些配置元数据转换成一组构成每个bean定义的下列属性。

| 属性                     | 描述                                                         |
| :----------------------- | :----------------------------------------------------------- |
| class                    | 这个属性是强制性的，并且指定用来创建bean的bean类。           |
| name                     | 这个属性指定唯一的bean标识符。在基于XML的配置元数据中，你可以使用ID和/或name属性来指定bean标识符。 |
| scope                    | 这个属性指定由特定的bean定义创建的对象的作用域，它将会在bean作用域的章节中进行讨论。 |
| constructor-arg          | 它是用来注入依赖关系的，并将会在接下来的章节中进行讨论。     |
| properties               | 它是用来注入依赖关系的，并将会在接下来的章节中进行讨论。     |
| autowiring mode          | 它是用来注入依赖关系的，并将会在接下来的章节中进行讨论。     |
| lazy-initialization mode | 延迟初始化的bean告诉IoC容器在它第一次被请求时，而不是在启动时去创建一个bean实例。 |
| initialization method    | 在bean的所有必需的属性被容器设置之后，调用回调方法。         |
| destruction method       | 当包含该bean的容器被销毁时，使用回调方法。                   |

## 3.5 Bean的作用域

当在Spring中定义一个bean时，你必须声明该bean的作用域的选项。例如，为了强制Spring在每次需要时都生成一个新的bean实例，你应该

2025-08-25 13:17:23,856 - evaluation_logger_Attraction-139 - INFO - turn id  = 5; len(golden_answer) = 4
2025-08-25 13:17:23,856 - evaluation_logger_Attraction-139 - INFO - golden_function_calls = [{'name': 'Get_Attraction_Details', 'arguments': {'slug': 'prkzizln3gwg-santiago-bernabeu-stadium-tour'}}]
2025-08-25 13:17:29,817 - evaluation_logger_Attraction-139 - INFO - Complete Result: {'score': 0, 'reason': 'The response does not address any of the requested information about ticket availability for attractions in Madrid and Munich.'}
2025-08-25 13:17:35,880 - evaluation_logger_Attraction-139 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 13:17:35,880 - evaluation_logger_Attraction-139 - INFO - Message: {'error_type': 'stop_early', 'content': 'Stop early.'}
2025-08-25 13:17:35,880 - evaluation_logger_Attraction-139 - INFO - Success turn num = 2
2025-08-25 13:17:35,880 - evaluation_logger_Attraction-139 - INFO - ----------------------------------------------------------------------------------------------------
