2025-08-25 11:46:42,845 - evaluation_logger_Cross-109 - INFO - Test Example Cross-109
2025-08-25 11:46:42,845 - evaluation_logger_Cross-109 - INFO - Query: My four friends and I are planning to have a party in Beverly Hills, Los Angeles, on December 26, 2024. Recommend the most popular hotel there for us. For easy travel, we need to rent a car, hoping to pick it up at 10 am on the 26th near the party hotel and return it at 5 pm the next day at the same location.
2025-08-25 11:46:51,109 - evaluation_logger_Cross-109 - INFO - Function Calls: 
[
    {
        "name": "Search_Hotel_Destination",
        "arguments": {
            "query": "Beverly Hills, Los Angeles"
        }
    }
]

2025-08-25 11:46:51,109 - evaluation_logger_Cross-109 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Hotel_Destination",
        "arguments": {
            "query": "Beverly Hills, Los Angeles"
        }
    },
    {
        "name": "Search_Hotels",
        "arguments": {
            "dest_id": 1930,
            "search_type": "district",
            "arrival_date": "2024-12-26",
            "departure_date": "2024-12-27",
            "adults": 5,
            "sort_by": "popularity"
        }
    }
]

2025-08-25 11:46:51,109 - evaluation_logger_Cross-109 - INFO - Start compare_single_call: 
{'name': 'Search_Hotel_Destination', 'arguments': {'query': 'Beverly Hills, Los Angeles'}}
{'name': 'Search_Hotel_Destination', 'arguments': {'query': 'Beverly Hills, Los Angeles'}}
2025-08-25 11:46:51,109 - evaluation_logger_Cross-109 - INFO - Rule-based compare success.
2025-08-25 11:46:51,109 - evaluation_logger_Cross-109 - INFO - Success matched: [{'name': 'Search_Hotel_Destination', 'arguments': {'query': 'Beverly Hills, Los Angeles'}}]
2025-08-25 11:46:51,110 - evaluation_logger_Cross-109 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": [
            {
                "dest_id": "1930",
                "search_type": "district",
                "longitude": -118.40395,
                "dest_type": "district",
                "cc1": "us",
                "latitude": 34.082687,
                "name": "Beverly Hills",
                "country": "United States",
                "label": "Beverly Hills, Los Angeles, California, United States",
                "lc": "en",
                "type": "di",
                "roundtrip": "GgEwIAAoATICZW46GkJldmVybHkgSGlsbHMsIExvcyBBbmdlbGVzQABKAFAA",
                "hotels": 182,
                "nr_hotels": 182,
                "city_ufi": 20014181,
                "region": "California",
                "city_name": "Los Angeles"
            }
        ]
    }
]

2025-08-25 11:47:02,327 - evaluation_logger_Cross-109 - INFO - Function Calls: 
[
    {
        "name": "Search_Hotels",
        "arguments": {
            "dest_id": 1930,
            "search_type": "district",
            "arrival_date": "2024-12-26",
            "departure_date": "2024-12-27",
            "adults": 5,
            "sort_by": "popularity"
        }
    }
]

2025-08-25 11:47:02,327 - evaluation_logger_Cross-109 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Hotels",
        "arguments": {
            "adults": 5,
            "arrival_date": "2024-12-26",
            "departure_date": "2024-12-27",
            "dest_id": 1930,
            "search_type": "district",
            "sort_by": "popularity"
        }
    },
    {
        "name": "Search_Car_Rentals",
        "arguments": {
            "pick_up_latitude": 34.063869,
            "pick_up_longitude": -118.368036,
            "drop_off_latitude": 34.063869,
            "drop_off_longitude": -118.368036,
            "pick_up_date": "2024-12-26",
            "drop_off_date": "2024-12-27",
            "pick_up_time": "10:00",
            "drop_off_time": "17:00"
        }
    }
]

2025-08-25 11:47:02,327 - evaluation_logger_Cross-109 - INFO - Start compare_single_call: 
{'name': 'Search_Hotels', 'arguments': {'adults': 5, 'arrival_date': '2024-12-26', 'departure_date': '2024-12-27', 'dest_id': 1930, 'search_type': 'district', 'sort_by': 'popularity'}}
{'name': 'Search_Hotels', 'arguments': {'adults': 5, 'arrival_date': '2024-12-26', 'departure_date': '2024-12-27', 'dest_id': 1930, 'search_type': 'district', 'sort_by': 'popularity'}}
2025-08-25 11:47:02,327 - evaluation_logger_Cross-109 - INFO - Rule-based compare success.
2025-08-25 11:47:02,328 - evaluation_logger_Cross-109 - INFO - Success matched: [{'name': 'Search_Hotels', 'arguments': {'adults': 5, 'arrival_date': '2024-12-26', 'departure_date': '2024-12-27', 'dest_id': 1930, 'search_type': 'district', 'sort_by': 'popularity'}}]
2025-08-25 11:47:02,329 - evaluation_logger_Cross-109 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "hotels": [
                {
                    "hotel_id": 3712675,
                    "accessibilityLabel": "AC Hotel by Marriott Beverly Hills.\n4 out of 5 stars.\n7.9 Good 341 reviews.\n‎2.2 km from centre‬.\n 2 hotel rooms : 4 beds.\n498 USD.\nIncludes taxes and charges.",
                    "property": {
                        "isPreferred": true,
                        "checkoutDate": "2024-12-27",
                        "position": 17,
                        "id": 3712675,
                        "reviewScoreWord": "Good",
                        "reviewCount": 341,
                        "wishlistName": "Los Angeles",
                        "checkin": {
                            "fromTime": "16:00",
                            "untilTime": "00:00"
                        },
                        "isFirstPage": true,
                        "currency": "USD",
                        "countryCode": "us",
                        "accuratePropertyClass": 4,
                        "propertyClass": 4,
                        "latitude": 34.063869,
                        "rankingPosition": 17,
                        "ufi": 20014181,
                        "optOutFromGalleryChanges": 0,
                        "checkinDate": "2024-12-26",
                        "name": "AC Hotel by Marriott Beverly Hills",
                        "longitude": -118.368036,
                        "reviewScore": 7.9,
                        "priceBreakdown": {
                            "grossPrice": {
                                "currency": "USD",
                                "value": 497.8264
                            }
                        },
                        "checkout": {
                            "fromTime": "00:00",
                            "untilTime": "11:00"
                        },
                        "qualityClass": 0,
                        "mainPhotoId": 525271793,
                        "blockIds": [
                            "371267503_119834766_4_34_0",
                            "371267503_119834766_4_34_0"
                        ]
                    }
                }
            ],
            "meta": [
                {
                    "title": "35 properties"
                }
            ],
            "appear": [
                {
                    "component": {
                        "props": {
                            "content": {
                                "props": {
                                    "items": [
                                        {
                                            "props": {
                                                "component": {
                                                    "props": {
                                                        "spacing": "spacing_half",
                                                        "items": [
                                                            {
                                                                "props": {
                                                                    "text": [
                                                                        {
                                                                            "font": "body_2",
                                                                            "text": "Commission paid and other benefits may affect an accommodation's ranking."
                                                                        },
                                                                        {
                                                                            "color": "foreground",
                                                                            "text": "  ",
                                                                            "font": "strong_2"
                                                                        },
                                                                        {
                                                                            "text": "Find out more",
                                                                            "color": "action_foreground",
                                                                            "linkActions": [
                                                                                {}
                                                                            ],
                                                                            "font": "body_2"
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                }
                                            }
                                        },
                                        {},
                                        {
                                            "props": {
                                                "component": {
                                                    "props": {
                                                        "variant": "tertiary_tinted",
                                                        "accessibilityLabel": "Close",
                                                        "icon": "close",
                                                        "tertiaryTintedColor": "foreground"
                                                    }
                                                }
                                            }
                                        }
                                    ],
                                    "fitContentWidth": true
                                }
                            },
                            "fill": true
                        }
                    },
                    "id": "cma"
                },
                {},
                {
                    "component": {
                        "props": {
                            "text": "Properties with these icons have been awarded Booking.com's quality rating for homes"
                        }
                    },
                    "id": "banner_qualityrating"
                },
                {
                    "id": "signin_now",
                    "component": {
                        "props": {
                            "text": "Get instant access to our Genius loyalty programme and enjoy discounts at properties worldwide.",
                            "title": "Sign in and save money"
                        }
                    }
                }
            ]
        }
    }
]

2025-08-25 11:47:15,975 - evaluation_logger_Cross-109 - INFO - Function Calls: 
[
    {
        "name": "Search_Car_Rentals",
        "arguments": {
            "pick_up_latitude": 34.063869,
            "pick_up_longitude": -118.368036,
            "drop_off_latitude": 34.063869,
            "drop_off_longitude": -118.368036,
            "pick_up_date": "2024-12-26",
            "drop_off_date": "2024-12-27",
            "pick_up_time": "10:00",
            "drop_off_time": "17:00"
        }
    }
]

2025-08-25 11:47:15,975 - evaluation_logger_Cross-109 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Car_Rentals",
        "arguments": {
            "drop_off_date": "2024-12-27",
            "drop_off_latitude": 34.063869,
            "drop_off_longitude": -118.368036,
            "drop_off_time": "17:00",
            "pick_up_date": "2024-12-26",
            "pick_up_latitude": 34.063869,
            "pick_up_longitude": -118.368036,
            "pick_up_time": "10:00"
        }
    }
]

2025-08-25 11:47:15,975 - evaluation_logger_Cross-109 - INFO - Start compare_single_call: 
{'name': 'Search_Car_Rentals', 'arguments': {'drop_off_date': '2024-12-27', 'drop_off_latitude': 34.063869, 'drop_off_longitude': -118.368036, 'drop_off_time': '17:00', 'pick_up_date': '2024-12-26', 'pick_up_latitude': 34.063869, 'pick_up_longitude': -118.368036, 'pick_up_time': '10:00'}}
{'name': 'Search_Car_Rentals', 'arguments': {'drop_off_date': '2024-12-27', 'drop_off_latitude': 34.063869, 'drop_off_longitude': -118.368036, 'drop_off_time': '17:00', 'pick_up_date': '2024-12-26', 'pick_up_latitude': 34.063869, 'pick_up_longitude': -118.368036, 'pick_up_time': '10:00'}}
2025-08-25 11:47:15,975 - evaluation_logger_Cross-109 - INFO - Rule-based compare success.
2025-08-25 11:47:15,975 - evaluation_logger_Cross-109 - INFO - Success matched: [{'name': 'Search_Car_Rentals', 'arguments': {'drop_off_date': '2024-12-27', 'drop_off_latitude': 34.063869, 'drop_off_longitude': -118.368036, 'drop_off_time': '17:00', 'pick_up_date': '2024-12-26', 'pick_up_latitude': 34.063869, 'pick_up_longitude': -118.368036, 'pick_up_time': '10:00'}}]
2025-08-25 11:47:15,976 - evaluation_logger_Cross-109 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "count": 176,
            "search_key": "eyJkcml2ZXJzQWdlIjozMCwiZHJvcE9mZkRhdGVUaW1lIjoiMjAyNC0xMi0yN1QxNzowMDowMCIsImRyb3BPZmZMb2NhdGlvbiI6IjM0LjA2Mzg2OSwtMTE4LjM2ODAzNiIsImRyb3BPZmZMb2NhdGlvblR5cGUiOiJMQVRMT05HIiwicGlja1VwRGF0ZVRpbWUiOiIyMDI0LTEyLTI2VDEwOjAwOjAwIiwicGlja1VwTG9jYXRpb24iOiIzNC4wNjM4NjksLTExOC4zNjgwMzYiLCJwaWNrVXBMb2NhdGlvblR5cGUiOiJMQVRMT05HIiwicmVudGFsRHVyYXRpb25JbkRheXMiOjIsInNlcnZpY2VGZWF0dXJlcyI6WyJOT19PUEFRVUVTIiwiU1VQUkVTU19GSVhFRF9QUklDRV9WRUhJQ0xFUyIsIklOQ0xVREVfUFJPRFVDVF9SRUxBVElPTlNISVBTIiwiSU5DTFVERV9FWFRSQVNfQ09OVEFJTklOR19GRUVTIl19",
            "meta": {
                "response_code": 200
            },
            "search_context": {
                "searchId": "d8066879-a7e6-4508-8250-4bd421071487",
                "searchKey": "eyJkcml2ZXJzQWdlIjozMCwiZHJvcE9mZkRhdGVUaW1lIjoiMjAyNC0xMi0yN1QxNzowMDowMCIsImRyb3BPZmZMb2NhdGlvbiI6IjM0LjA2Mzg2OSwtMTE4LjM2ODAzNiIsImRyb3BPZmZMb2NhdGlvblR5cGUiOiJMQVRMT05HIiwicGlja1VwRGF0ZVRpbWUiOiIyMDI0LTEyLTI2VDEwOjAwOjAwIiwicGlja1VwTG9jYXRpb24iOiIzNC4wNjM4NjksLTExOC4zNjgwMzYiLCJwaWNrVXBMb2NhdGlvblR5cGUiOiJMQVRMT05HIiwicmVudGFsRHVyYXRpb25JbkRheXMiOjIsInNlcnZpY2VGZWF0dXJlcyI6WyJOT19PUEFRVUVTIiwiU1VQUkVTU19GSVhFRF9QUklDRV9WRUhJQ0xFUyIsIklOQ0xVREVfUFJPRFVDVF9SRUxBVElPTlNISVBTIiwiSU5DTFVERV9FWFRSQVNfQ09OVEFJTklOR19GRUVTIl19",
                "recommendationsSearchUniqueId": "95ff4f94-d72c-43e2-a3d8-f1fb6d1f4b37"
            },
            "content": {
                "items": [
                    {
                        "content": {
                            "contentType": "carsSearchResultsSecondaryPromotional"
                        },
                        "type": "SHELL_REGION_VIEW",
                        "positionInList": 3
                    }
                ],
                "filters": {
                    "countLabel": "180 results"
                }
            },
            "sort": [
                {
                    "name": "Recommended – best first",
                    "title_tag": "tr.searchresults.sortBy.recommended",
                    "identifier": "recommended"
                },
                {
                    "name": "Price - lowest first",
                    "identifier": "price_low_to_high",
                    "title_tag": "tr.searchresults.sortBy.price.lowHigh"
                },
                {
                    "name": "Review score - highest first",
                    "identifier": "review_score",
                    "title_tag": "tr.searchresults.sortBy.reviews.highLow"
                }
            ],
            "type": "cars",
            "title": "Car rentals",
            "filter": [
                {
                    "title": "Location",
                    "type": "multiple_union",
                    "id": "depotLocationType",
                    "categories": [
                        {
                            "nameWithCount": "All other locations (145)",
                            "count": 145,
                            "id": "depotLocationType::DOWNTOWN",
                            "name": "All other locations"
                        },
                        {
                            "count": 12,
                            "id": "depotLocationType::IN_TERMINAL",
                            "name": "Airport (in terminal)",
                            "nameWithCount": "Airport (in terminal) (12)"
                        },
                        {
                            "id": "depotLocationType::CAR_RENTAL_CENTRE",
                            "name": "Airport (car rental centre)",
                            "count": 23,
                            "nameWithCount": "Airport (car rental centre) (23)"
                        }
                    ],
                    "layout": {
                        "collapsed_count": 3,
                        "layout_type": "list",
                        "is_collapsed": "false",
                        "is_collapsable": "false"
                    }
                },
                {
                    "id": "carCategory",
                    "title": "Car Type",
                    "type": "multiple_union",
                    "layout": {
                        "collapsed_count": 5,
                        "layout_type": "list",
                        "is_collapsed": "true",
                        "is_collapsable": "true"
                    },
                    "categories": [
                        {
                            "nameWithCount": "Small (11)",
                            "id": "carCategory::small",
                            "name": "Small",
                            "count": 11
                        },
                        {
                            "name": "Medium",
                            "id": "carCategory::medium",
                            "count": 57,
                            "nameWithCount": "Medium (57)"
                        },
                        {
                            "name": "Large",
                            "id": "carCategory::large",
                            "count": 139,
                            "nameWithCount": "Large (139)"
                        },
                        {
                            "nameWithCount": "Premium (48)",
                            "count": 48,
                            "name": "Premium",
                            "id": "carCategory::premium"
                        },
                        {
                            "nameWithCount": "People carriers (2)",
                            "count": 2,
                            "name": "People carriers",
                            "id": "carCategory::carriers"
                        }
                    ]
                },
                {
                    "categories": [
                        {
                            "nameWithCount": "US$0 - US$50 (0)",
                            "name": "US$0 - US$50",
                            "id": "pricePerDayBuckets::BUCKET_1",
                            "count": 0
                        },
                        {
                            "nameWithCount": "US$50 - US$100 (3)",
                            "name": "US$50 - US$100",
                            "id": "pricePerDayBuckets::BUCKET_2",
                            "count": 3
                        },
                        {
                            "nameWithCount": "US$100 - US$150 (99)",
                            "name": "US$100 - US$150",
                            "id": "pricePerDayBuckets::BUCKET_3",
                            "count": 99
                        },
                        {
                            "name": "US$150 - US$200",
                            "id": "pricePerDayBuckets::BUCKET_4",
                            "count": 48,
                            "nameWithCount": "US$150 - US$200 (48)"
                        },
                        {
                            "nameWithCount": "US$200+ (30)",
                            "count": 30,
                            "name": "US$200+",
                            "id": "pricePerDayBuckets::BUCKET_5"
                        }
                    ],
                    "layout": {
                        "collapsed_count": 5,
                        "layout_type": "list",
                        "is_collapsable": "false",
                        "is_collapsed": "false"
                    },
                    "type": "multiple_union",
                    "title": "Price per day",
                    "id": "pricePerDayBuckets"
                },
                {
                    "layout": {
                        "is_collapsable": "true",
                        "is_collapsed": "true",
                        "collapsed_count": 5,
                        "layout_type": "list"
                    },
                    "categories": [
                        {
                            "count": 31,
                            "name": "Avis",
                            "id": "supplier::Avis",
                            "nameWithCount": "Avis (31)"
                        },
                        {
                            "count": 12,
                            "id": "supplier::Europcar",
                            "name": "Europcar",
                            "nameWithCount": "Europcar (12)"
                        },
                        {
                            "nameWithCount": "Hertz (83)",
                            "id": "supplier::Hertz",
                            "name": "Hertz",
                            "count": 83
                        },
                        {
                            "nameWithCount": "Sixt (54)",
                            "count": 54,
                            "name": "Sixt",
                            "id": "supplier::Sixt"
                        }
                    ],
                    "id": "supplier",
                    "title": "Supplier",
                    "type": "multiple_union"
                },
                {
                    "title": "Transmission",
                    "type": "multiple_union",
                    "id": "transmission",
                    "categories": [
                        {
                            "count": 180,
                            "name": "Automatic",
                            "id": "transmission::AUTOMATIC",
                            "nameWithCount": "Automatic (180)"
                        }
                    ],
                    "layout": {
                        "collapsed_count": 5,
                        "layout_type": "list",
                        "is_collapsed": "true",
                        "is_collapsable": "true"
                    }
                }
            ],
            "provider": "rentalcars",
            "search_results": [
                {
                    "vehicle_id": "637382681",
                    "accessibility": {
                        "fuel_policy": "Fuel policy is: Like for like",
                        "pick_up_location": "Pick-up information: Downtown",
                        "transmission": "Automatic gearbox",
                        "supplier_rating": "At this location, our customers have rated Hertz as 7.4 out of 10, Good."
                    },
                    "content": {
                        "supplier": {
                            "rating": {
                                "average": "7.4",
                                "localisedRating": {
                                    "displayValue": "7.4",
                                    "rawValue": 7.4
                                },
                                "subtitle": "46 reviews",
                                "title": "Good"
                            },
                            "name": "Hertz"
                        },
                        "badges": [
                            {
                                "variation": "DEFAULT",
                                "text": "Free cancellation",
                                "type": "CONSTRUCTIVE"
                            }
                        ]
                    },
                    "fee_info": {
                        "tax": 0,
                        "fee": 0
                    },
                    "rating_info": {
                        "pickup_time": 6.6,
                        "value_for_money": 6.9,
                        "condition": 7.8,
                        "average_text": "Very good",
                        "cleanliness": 7.7,
                        "average": 7.4,
                        "efficiency": 7,
                        "no_of_ratings": 46,
                        "location": 7.7,
                        "dropoff_time": 8.3
                    },
                    "route_info": {
                        "pickup": {
                            "address": "361 North La Brea, Los Angeles, USA, 90036",
                            "latitude": "34.07824993",
                            "name": "Los Angeles - North La Brea",
                            "location_type": "DOWNTOWN",
                            "location_id": "3889591",
                            "location_hash": "TG9zIEFuZ2VsZXMgLSBOb3J0aCBMYSBCcmVh",
                            "longitude": "-118.34445",
                            "country_code": "US"
                        },
                        "dropoff": {
                            "address": "361 North La Brea, Los Angeles, USA, 90036",
                            "latitude": "34.07824993",
                            "location_type": "DOWNTOWN",
                            "name": "Los Angeles - North La Brea",
                            "location_id": "3889591",
                            "location_hash": "TG9zIEFuZ2VsZXMgLSBOb3J0aCBMYSBCcmVh",
                            "country_code": "US",
                            "longitude": "-118.34445"
                        }
                    },
                    "vehicle_info": {
                        "transmission": "Automatic",
                        "group": "Standard",
                        "fuel_policy": "Like for like",
                        "cma_compliant": -1,
                        "unlimited_mileage": 1,
                        "v_name": "Volkswagen Jetta  ",
                        "aircon": 1,
                        "seats": "5",
                        "doors": "2",
                        "v_id": "637382681",
                        "label": "Standard car with:",
                        "airbags": 1,
                        "free_cancellation": 1,
                        "mileage": "Unlimited mileage",
                        "suitcases": {
                            "big": "0",
                            "small": "3"
                        },
                        "fuel_type": "N/A"
                    },
                    "supplier_info": {
                        "latitude": "34.07824993",
                        "address": "361 North La Brea, Los Angeles, USA, 90036",
                        "may_require_credit_card_guarantee": false,
                        "pickup_instructions": "-",
                        "name": "Hertz",
                        "location_type": "Downtown",
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/137_logo_200.png",
                        "longitude": "-118.34445",
                        "dropoff_instructions": "-"
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "pricing_info": {
                        "pay_when": "PAY_NOW",
                        "deposit": 189.89,
                        "discount": 0,
                        "currency": "USD",
                        "base_deposit": 15970.54,
                        "drive_away_price": 189.89,
                        "drive_away_price_is_approx": true,
                        "price": 189.89,
                        "base_currency": "INR",
                        "base_price": 15970.54,
                        "quote_allowed": 1,
                        "fee_breakdown": {
                            "fuel_policy": {
                                "type": "RETURN_SAME",
                                "amount": 0
                            },
                            "known_fees": [
                                {
                                    "is_always_payable": 0,
                                    "min_amount": 0,
                                    "max_amount": 0,
                                    "type": "THEFT_EXCESS",
                                    "currency": "USD",
                                    "amount": 0,
                                    "is_tax_included": 1
                                },
                                {
                                    "is_always_payable": 0,
                                    "min_amount": 256.38,
                                    "max_amount": 640.96,
                                    "currency": "USD",
                                    "amount": 640.96,
                                    "type": "DEPOSIT",
                                    "is_tax_included": 1
                                },
                                {
                                    "is_tax_included": 1,
                                    "is_always_payable": 0,
                                    "min_amount": 0,
                                    "max_amount": 0,
                                    "currency": "USD",
                                    "type": "DAMAGE_EXCESS",
                                    "amount": 0
                                },
                                {
                                    "is_always_payable": 0,
                                    "distance_allowed": {
                                        "is_unlimited": 1,
                                        "is_km": 0
                                    },
                                    "type": "MILEAGE"
                                }
                            ]
                        }
                    }
                },
                {
                    "vehicle_id": "637404871",
                    "fee_info": {
                        "fee": 0,
                        "tax": 0
                    },
                    "accessibility": {
                        "transmission": "Automatic gearbox",
                        "pick_up_location": "Pick-up information: Downtown",
                        "fuel_policy": "Fuel policy is: Like for like",
                        "supplier_rating": "At this location, our customers have rated Hertz as 7.4 out of 10, Good."
                    },
                    "content": {
                        "supplier": {
                            "rating": {
                                "title": "Good",
                                "subtitle": "46 reviews",
                                "localisedRating": {
                                    "displayValue": "7.4",
                                    "rawValue": 7.4
                                },
                                "average": "7.4"
                            },
                            "name": "Hertz"
                        },
                        "badges": [
                            {
                                "variation": "DEFAULT",
                                "text": "Free cancellation",
                                "type": "CONSTRUCTIVE"
                            }
                        ]
                    },
                    "pricing_info": {
                        "base_deposit": 16811.09,
                        "drive_away_price": 199.88,
                        "drive_away_price_is_approx": true,
                        "base_currency": "INR",
                        "price": 199.88,
                        "base_price": 16811.09,
                        "fee_breakdown": {
                            "fuel_policy": {
                                "type": "RETURN_SAME",
                                "amount": 0
                            },
                            "known_fees": [
                                {
                                    "type": "THEFT_EXCESS",
                                    "currency": "USD",
                                    "amount": 0,
                                    "max_amount": 0,
                                    "min_amount": 0,
                                    "is_always_payable": 0,
                                    "is_tax_included": 1
                                },
                                {
                                    "min_amount": 256.38,
                                    "is_always_payable": 0,
                                    "amount": 640.96,
                                    "currency": "USD",
                                    "type": "DEPOSIT",
                                    "max_amount": 640.96,
                                    "is_tax_included": 1
                                },
                                {
                                    "type": "DAMAGE_EXCESS",
                                    "currency": "USD",
                                    "amount": 0,
                                    "max_amount": 0,
                                    "min_amount": 0,
                                    "is_always_payable": 0,
                                    "is_tax_included": 1
                                },
                                {
                                    "distance_allowed": {
                                        "is_unlimited": 1,
                                        "is_km": 0
                                    },
                                    "is_always_payable": 0,
                                    "type": "MILEAGE"
                                }
                            ]
                        },
                        "quote_allowed": 1,
                        "deposit": 199.88,
                        "pay_when": "PAY_NOW",
                        "discount": 0,
                        "currency": "USD"
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "supplier_info": {
                        "longitude": "-118.34445",
                        "dropoff_instructions": "-",
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/137_logo_200.png",
                        "may_require_credit_card_guarantee": false,
                        "address": "361 North La Brea, Los Angeles, USA, 90036",
                        "latitude": "34.07824993",
                        "location_type": "Downtown",
                        "pickup_instructions": "-",
                        "name": "Hertz"
                    },
                    "vehicle_info": {
                        "label": "Standard car with:",
                        "airbags": 1,
                        "free_cancellation": 1,
                        "mileage": "Unlimited mileage",
                        "fuel_type": "N/A",
                        "suitcases": {
                            "big": "0",
                            "small": "4"
                        },
                        "transmission": "Automatic",
                        "unlimited_mileage": 1,
                        "v_name": "Buick Verano  ",
                        "group": "Standard",
                        "cma_compliant": -1,
                        "fuel_policy": "Like for like",
                        "aircon": 1,
                        "seats": "5",
                        "v_id": "637404871",
                        "doors": "4"
                    },
                    "rating_info": {
                        "average": 7.4,
                        "cleanliness": 7.7,
                        "average_text": "Very good",
                        "condition": 7.8,
                        "pickup_time": 6.6,
                        "value_for_money": 6.9,
                        "location": 7.7,
                        "no_of_ratings": 46,
                        "dropoff_time": 8.3,
                        "efficiency": 7
                    },
                    "route_info": {
                        "dropoff": {
                            "location_hash": "TG9zIEFuZ2VsZXMgLSBOb3J0aCBMYSBCcmVh",
                            "country_code": "US",
                            "longitude": "-118.34445",
                            "address": "361 North La Brea, Los Angeles, USA, 90036",
                            "latitude": "34.07824993",
                            "name": "Los Angeles - North La Brea",
                            "location_type": "DOWNTOWN",
                            "location_id": "3889591"
                        },
                        "pickup": {
                            "location_hash": "TG9zIEFuZ2VsZXMgLSBOb3J0aCBMYSBCcmVh",
                            "country_code": "US",
                            "longitude": "-118.34445",
                            "address": "361 North La Brea, Los Angeles, USA, 90036",
                            "latitude": "34.07824993",
                            "location_type": "DOWNTOWN",
                            "name": "Los Angeles - North La Brea",
                            "location_id": "3889591"
                        }
                    }
                },
                {
                    "vehicle_id": "768079976",
                    "fee_info": {
                        "fee": 0,
                        "tax": 0
                    },
                    "content": {
                        "badges": [
                            {
                                "type": "CONSTRUCTIVE",
                                "variation": "DEFAULT",
                                "text": "Free cancellation"
                            }
                        ],
                        "supplier": {
                            "name": "Hertz",
                            "rating": {
                                "subtitle": "46 reviews",
                                "title": "Good",
                                "localisedRating": {
                                    "displayValue": "7.4",
                                    "rawValue": 7.4
                                },
                                "average": "7.4"
                            }
                        }
                    },
                    "accessibility": {
                        "pick_up_location": "Pick-up information: Downtown",
                        "transmission": "Automatic gearbox",
                        "fuel_policy": "Fuel policy is: Like for like",
                        "supplier_rating": "At this location, our customers have rated Hertz as 7.4 out of 10, Good."
                    },
                    "pricing_info": {
                        "discount": 0,
                        "pay_when": "PAY_NOW",
                        "deposit": 209.88,
                        "currency": "USD",
                        "drive_away_price_is_approx": true,
                        "drive_away_price": 209.88,
                        "base_deposit": 17651.65,
                        "fee_breakdown": {
                            "known_fees": [
                                {
                                    "is_tax_included": 1,
                                    "min_amount": 0,
                                    "is_always_payable": 0,
                                    "currency": "USD",
                                    "amount": 0,
                                    "type": "THEFT_EXCESS",
                                    "max_amount": 0
                                },
                                {
                                    "is_tax_included": 1,
                                    "currency": "USD",
                                    "type": "DEPOSIT",
                                    "amount": 640.96,
                                    "max_amount": 640.96,
                                    "min_amount": 256.38,
                                    "is_always_payable": 0
                                },
                                {
                                    "is_tax_included": 1,
                                    "max_amount": 0,
                                    "currency": "USD",
                                    "amount": 0,
                                    "type": "DAMAGE_EXCESS",
                                    "is_always_payable": 0,
                                    "min_amount": 0
                                },
                                {
                                    "distance_allowed": {
                                        "is_km": 0,
                                        "is_unlimited": 1
                                    },
                                    "is_always_payable": 0,
                                    "type": "MILEAGE"
                                }
                            ],
                            "fuel_policy": {
                                "amount": 0,
                                "type": "RETURN_SAME"
                            }
                        },
                        "quote_allowed": 1,
                        "base_price": 17651.65,
                        "base_currency": "INR",
                        "price": 209.88
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "supplier_info": {
                        "may_require_credit_card_guarantee": false,
                        "address": "361 North La Brea, Los Angeles, USA, 90036",
                        "latitude": "34.07824993",
                        "location_type": "Downtown",
                        "pickup_instructions": "-",
                        "name": "Hertz",
                        "dropoff_instructions": "-",
                        "longitude": "-118.34445",
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/137_logo_200.png"
                    },
                    "vehicle_info": {
                        "v_id": "768079976",
                        "doors": "4",
                        "seats": "5",
                        "aircon": 1,
                        "unlimited_mileage": 1,
                        "v_name": "Buick Encore",
                        "fuel_policy": "Like for like",
                        "cma_compliant": -1,
                        "group": "Compact",
                        "transmission": "Automatic",
                        "fuel_type": "N/A",
                        "suitcases": {
                            "small": "2",
                            "big": "0"
                        },
                        "mileage": "Unlimited mileage",
                        "label": "Compact car with:",
                        "free_cancellation": 1,
                        "airbags": 1
                    },
                    "route_info": {
                        "dropoff": {
                            "location_hash": "TG9zIEFuZ2VsZXMgLSBOb3J0aCBMYSBCcmVh",
                            "longitude": "-118.34445",
                            "country_code": "US",
                            "latitude": "34.07824993",
                            "address": "361 North La Brea, Los Angeles, USA, 90036",
                            "location_id": "3889591",
                            "location_type": "DOWNTOWN",
                            "name": "Los Angeles - North La Brea"
                        },
                        "pickup": {
                            "address": "361 North La Brea, Los Angeles, USA, 90036",
                            "latitude": "34.07824993",
                            "name": "Los Angeles - North La Brea",
                            "location_type": "DOWNTOWN",
                            "location_id": "3889591",
                            "location_hash": "TG9zIEFuZ2VsZXMgLSBOb3J0aCBMYSBCcmVh",
                            "country_code": "US",
                            "longitude": "-118.34445"
                        }
                    },
                    "rating_info": {
                        "dropoff_time": 8.3,
                        "no_of_ratings": 46,
                        "location": 7.7,
                        "efficiency": 7,
                        "cleanliness": 7.7,
                        "average": 7.4,
                        "pickup_time": 6.6,
                        "value_for_money": 6.9,
                        "condition": 7.8,
                        "average_text": "Very good"
                    }
                },
                {
                    "vehicle_id": "613825706",
                    "vehicle_info": {
                        "label": "Standard car with:",
                        "free_cancellation": 1,
                        "airbags": 1,
                        "mileage": "Unlimited mileage",
                        "fuel_type": "N/A",
                        "suitcases": {
                            "small": "4",
                            "big": "0"
                        },
                        "transmission": "Automatic",
                        "unlimited_mileage": 1,
                        "v_name": "GMC Terrain  ",
                        "cma_compliant": -1,
                        "fuel_policy": "Like for like",
                        "group": "Standard",
                        "seats": "5",
                        "aircon": 1,
                        "v_id": "613825706",
                        "doors": "4"
                    },
                    "route_info": {
                        "dropoff": {
                            "longitude": "-118.34445",
                            "country_code": "US",
                            "location_hash": "TG9zIEFuZ2VsZXMgLSBOb3J0aCBMYSBCcmVh",
                            "location_id": "3889591",
                            "name": "Los Angeles - North La Brea",
                            "location_type": "DOWNTOWN",
                            "latitude": "34.07824993",
                            "address": "361 North La Brea, Los Angeles, USA, 90036"
                        },
                        "pickup": {
                            "address": "361 North La Brea, Los Angeles, USA, 90036",
                            "latitude": "34.07824993",
                            "name": "Los Angeles - North La Brea",
                            "location_type": "DOWNTOWN",
                            "location_id": "3889591",
                            "location_hash": "TG9zIEFuZ2VsZXMgLSBOb3J0aCBMYSBCcmVh",
                            "longitude": "-118.34445",
                            "country_code": "US"
                        }
                    },
                    "rating_info": {
                        "cleanliness": 7.7,
                        "average": 7.4,
                        "condition": 7.8,
                        "pickup_time": 6.6,
                        "value_for_money": 6.9,
                        "average_text": "Very good",
                        "location": 7.7,
                        "no_of_ratings": 46,
                        "dropoff_time": 8.3,
                        "efficiency": 7
                    },
                    "pricing_info": {
                        "base_deposit": 19370.88,
                        "drive_away_price_is_approx": true,
                        "drive_away_price": 230.32,
                        "base_currency": "INR",
                        "price": 230.32,
                        "fee_breakdown": {
                            "known_fees": [
                                {
                                    "min_amount": 0,
                                    "is_always_payable": 0,
                                    "amount": 0,
                                    "currency": "USD",
                                    "type": "THEFT_EXCESS",
                                    "max_amount": 0,
                                    "is_tax_included": 1
                                },
                                {
                                    "is_always_payable": 0,
                                    "min_amount": 256.38,
                                    "max_amount": 640.96,
                                    "type": "DEPOSIT",
                                    "currency": "USD",
                                    "amount": 640.96,
                                    "is_tax_included": 1
                                },
                                {
                                    "is_tax_included": 1,
                                    "max_amount": 0,
                                    "currency": "USD",
                                    "amount": 0,
                                    "type": "DAMAGE_EXCESS",
                                    "is_always_payable": 0,
                                    "min_amount": 0
                                },
                                {
                                    "type": "MILEAGE",
                                    "is_always_payable": 0,
                                    "distance_allowed": {
                                        "is_km": 0,
                                        "is_unlimited": 1
                                    }
                                }
                            ],
                            "fuel_policy": {
                                "type": "RETURN_SAME",
                                "amount": 0
                            }
                        },
                        "quote_allowed": 1,
                        "base_price": 19370.88,
                        "discount": 0,
                        "deposit": 230.32,
                        "pay_when": "PAY_NOW",
                        "currency": "USD"
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "supplier_info": {
                        "may_require_credit_card_guarantee": false,
                        "address": "361 North La Brea, Los Angeles, USA, 90036",
                        "latitude": "34.07824993",
                        "name": "Hertz",
                        "pickup_instructions": "-",
                        "location_type": "Downtown",
                        "dropoff_instructions": "-",
                        "longitude": "-118.34445",
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/137_logo_200.png"
                    },
                    "content": {
                        "supplier": {
                            "rating": {
                                "average": "7.4",
                                "localisedRating": {
                                    "rawValue": 7.4,
                                    "displayValue": "7.4"
                                },
                                "subtitle": "46 reviews",
                                "title": "Good"
                            },
                            "name": "Hertz"
                        },
                        "badges": [
                            {
                                "type": "CONSTRUCTIVE",
                                "text": "Free cancellation",
                                "variation": "DEFAULT"
                            }
                        ]
                    },
                    "accessibility": {
                        "supplier_rating": "At this location, our customers have rated Hertz as 7.4 out of 10, Good.",
                        "fuel_policy": "Fuel policy is: Like for like",
                        "pick_up_location": "Pick-up information: Downtown",
                        "transmission": "Automatic gearbox"
                    },
                    "fee_info": {
                        "tax": 0,
                        "fee": 0
                    }
                },
                {
                    "vehicle_id": "637382676",
                    "supplier_info": {
                        "location_type": "Downtown",
                        "name": "Hertz",
                        "pickup_instructions": "-",
                        "latitude": "34.079601",
                        "may_require_credit_card_guarantee": false,
                        "address": "450, North Lacienega Boulevard, Los Angeles, USA, 90048",
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/137_logo_200.png",
                        "longitude": "-118.376074",
                        "dropoff_instructions": "-"
                    },
                    "pricing_info": {
                        "currency": "USD",
                        "pay_when": "PAY_NOW",
                        "deposit": 209.8,
                        "discount": 0,
                        "base_price": 17644.71,
                        "fee_breakdown": {
                            "fuel_policy": {
                                "type": "RETURN_SAME",
                                "amount": 0
                            },
                            "known_fees": [
                                {
                                    "is_tax_included": 1,
                                    "type": "THEFT_EXCESS",
                                    "currency": "USD",
                                    "amount": 0,
                                    "max_amount": 0,
                                    "min_amount": 0,
                                    "is_always_payable": 0
                                },
                                {
                                    "min_amount": 256.38,
                                    "is_always_payable": 0,
                                    "amount": 640.96,
                                    "currency": "USD",
                                    "type": "DEPOSIT",
                                    "max_amount": 640.96,
                                    "is_tax_included": 1
                                },
                                {
                                    "is_tax_included": 1,
                                    "currency": "USD",
                                    "amount": 0,
                                    "type": "DAMAGE_EXCESS",
                                    "max_amount": 0,
                                    "min_amount": 0,
                                    "is_always_payable": 0
                                },
                                {
                                    "type": "MILEAGE",
                                    "is_always_payable": 0,
                                    "distance_allowed": {
                                        "is_unlimited": 1,
                                        "is_km": 0
                                    }
                                }
                            ]
                        },
                        "quote_allowed": 1,
                        "base_currency": "INR",
                        "price": 209.8,
                        "drive_away_price": 209.8,
                        "drive_away_price_is_approx": true,
                        "base_deposit": 17644.71
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "route_info": {
                        "pickup": {
                            "address": "450, North Lacienega Boulevard, Los Angeles, USA, 90048",
                            "latitude": "34.079601",
                            "name": "Los Angeles - North Lacienega Boulevard",
                            "location_type": "DOWNTOWN",
                            "location_id": "3889590",
                            "location_hash": "TG9zIEFuZ2VsZXMgLSBOb3J0aCBMYWNpZW5lZ2EgQm91bGV2YXJk",
                            "longitude": "-118.376074",
                            "country_code": "US"
                        },
                        "dropoff": {
                            "address": "450, North Lacienega Boulevard, Los Angeles, USA, 90048",
                            "latitude": "34.079601",
                            "name": "Los Angeles - North Lacienega Boulevard",
                            "location_type": "DOWNTOWN",
                            "location_id": "3889590",
                            "location_hash": "TG9zIEFuZ2VsZXMgLSBOb3J0aCBMYWNpZW5lZ2EgQm91bGV2YXJk",
                            "country_code": "US",
                            "longitude": "-118.376074"
                        }
                    },
                    "rating_info": {
                        "efficiency": 8.7,
                        "no_of_ratings": 22,
                        "dropoff_time": 9.5,
                        "location": 9.2,
                        "average_text": "Superb",
                        "pickup_time": 7.2,
                        "condition": 9.3,
                        "value_for_money": 9.2,
                        "average": 9,
                        "cleanliness": 9.4
                    },
                    "vehicle_info": {
                        "fuel_type": "N/A",
                        "suitcases": {
                            "small": "3",
                            "big": "0"
                        },
                        "mileage": "Unlimited mileage",
                        "label": "Standard car with:",
                        "free_cancellation": 1,
                        "airbags": 1,
                        "v_id": "637382676",
                        "doors": "2",
                        "aircon": 1,
                        "seats": "5",
                        "unlimited_mileage": 1,
                        "v_name": "Volkswagen Jetta  ",
                        "group": "Standard",
                        "cma_compliant": -1,
                        "fuel_policy": "Like for like",
                        "transmission": "Automatic"
                    },
                    "fee_info": {
                        "tax": 0,
                        "fee": 0
                    },
                    "accessibility": {
                        "fuel_policy": "Fuel policy is: Like for like",
                        "pick_up_location": "Pick-up information: Downtown",
                        "transmission": "Automatic gearbox",
                        "supplier_rating": "At this location, our customers have rated Hertz as 9.0 out of 10, Superb."
                    },
                    "content": {
                        "badges": [
                            {
                                "type": "CONSTRUCTIVE",
                                "variation": "DEFAULT",
                                "text": "Free cancellation"
                            }
                        ],
                        "supplier": {
                            "rating": {
                                "localisedRating": {
                                    "rawValue": 9,
                                    "displayValue": "9"
                                },
                                "subtitle": "22 reviews",
                                "title": "Superb",
                                "average": "9.0"
                            },
                            "name": "Hertz"
                        }
                    }
                }
            ],
            "is_genius_location": false
        }
    }
]

2025-08-25 11:49:41,940 - evaluation_logger_Cross-109 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 概述

本文，我们来分享 [《精尽 Spring Boot 源码分析 —— SpringApplication》](http://svip.iocoder.cn/Spring-Boot/SpringApplication/) 的**初始化**的源码解析。

在 SpringApplication 实例初始化的过程中，会进行如下几部分的初始化：

- 配置 `resourceLoader` 属性
- 配置 `primarySources` 属性
- 配置 `webApplicationType` 属性
- 配置 `initializers` 属性
- 配置 `listeners` 属性
- 配置 `mainApplicationClass` 属性

# 2. 构造方法

SpringApplication 提供了**两类**构造方法：

- 第一个，SpringApplication 主构造方法，用于创建 SpringApplication 对象。
- 第二个，SpringApplication 静态方法，用于创建 SpringApplication 对象，并执行运行。

## 2.1 主构造方法

`#SpringApplication(ResourceLoader resourceLoader, Class<?>... primarySources)` 构造方法，用于创建 SpringApplication 对象。代码如下：

```java
// SpringApplication.java

/**
 * 资源加载器
 */
private ResourceLoader resourceLoader;
/**
 * 主要的 Java Config 类的数组
 */
private Set<Class<?>> primarySources;
/**
 * Web 应用类型
 */
private WebApplicationType webApplicationType;
/**
 * 应用上下文初始化器（ApplicationContextInitializer）数组
 */
private List<ApplicationContextInitializer<?>> initializers;
/**
 * 应用事件监听器（ApplicationListener）数组
 */
private List<ApplicationListener<?>> listeners;

public SpringApplication(ResourceLoader resourceLoader, Class<?>... primarySources) {
    // <1> 设置 resourceLoader
    this.resourceLoader = resourceLoader;
    // <2> 设置 primarySources
    Assert.notNull(primarySources, "PrimarySources must not be null");
    this.primarySources = new LinkedHashSet<>(Arrays.asList(primarySources));
    // <3> 判断 Web 应用类型
    this.webApplicationType = WebApplicationType.deduceFromClasspath();
    // <4> 设置初始化器
    setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class));
    // <5> 设置监听器
    setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));
    // <6> 设置主应用类
    this.mainApplicationClass = deduceMainApplicationClass();
}
```

- `<1>` 处，设置 `resourceLoader` 属性。如果 `resourceLoader` 为空，后续会变成默认的 `org.springframework.core.io.DefaultResourceLoader` 对象。

- `<2>` 处，设置 `primarySources` 属性。`primarySources` 是主要的 Java Config 类的数组，也是启动类。例如说，我们启动 Spring Boot 应用时，会传入 `XxxApplication` 类。

- `<3>` 处，调用 `WebApplicationType#deduceFromClasspath()` 方法，判断 Web 应用类型。详细解析，见 [「3. WebApplicationType」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 。

- `<4>` 处，设置 `initializers` 属性。详细解析，见 [「4. ApplicationContextInitializer」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 。

- `<5>` 处，设置 `listeners` 属性。详细解析，见 [「5. ApplicationListener」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 。

- `<6>` 处，设置 `mainApplicationClass` 属性。详细解析，见 [「6. mainApplicationClass」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 。

## 2.2 静态方法

`#run(Class<?> primarySource, String... args)` 静态方法，用于创建 SpringApplication 对象，并执行运行。代码如下：

```java
// SpringApplication.java

public static ConfigurableApplicationContext run(Class<?> primarySource, String... args) {
	return run(new Class<?>[] { primarySource }, args);
}

public static ConfigurableApplicationContext run(Class<?>[] primarySources, String[] args) {
    // 创建 SpringApplication 对象，并执行运行。
    return new SpringApplication(primarySources).run(args);
}
```

- 首先，调用 `#SpringApplication(Class<?>... primarySources)` 构造方法，创建 SpringApplication 对象。代码如下：

  ```java
  // SpringApplication.java
  
  public SpringApplication(Class<?>... primarySources) {
  	this(null, primarySources);
  }
  ```

  - 内部调用的是 `#SpringApplication(ResourceLoader resourceLoader, Class<?>... primarySources)` 构造方法。

- 然后，调用 `#run(String... args)` 方法，运行 Spring 应用。详细解析，见 [《精尽 Spring Boot 源码分析 —— SpringApplication》](http://svip.iocoder.cn/Spring-Boot/SpringApplication/) 。

# 3. WebApplicationType

`org.springframework.boot.WebApplicationType` 枚举类，表示 Web 应用类型。代码如下：

```java
// WebApplicationType.java

public enum WebApplicationType {

    /**
     * 非 Web 项目
     */
    NONE,
    /**
     * 基于 Servlet 的 Web 项目
     */
    SERVLET,
    /**
     * 基于 Reactive 的 Web 项目
     */
    REACTIVE;

}
```

## 3.1 deduceFromClasspath

`#deduceFromClasspath()` **静态**方法，基于 classpath 中，判断 Web 应用类型。代码如下：

```java
// WebApplicationType.java

private static final String[] SERVLET_INDICATOR_CLASSES = { "javax.servlet.Servlet",
        "org.springframework.web.context.ConfigurableWebApplicationContext" };

private static final String WEBMVC_INDICATOR_CLASS = "org.springframework.web.servlet.DispatcherServlet";
private static final String WEBFLUX_INDICATOR_CLASS = "org.springframework.web.reactive.DispatcherHandler";
private static final String JERSEY_INDICATOR_CLASS = "org.glassfish.jersey.servlet.ServletContainer";
private static final String SERVLET_APPLICATION_CONTEXT_CLASS = "org.springframework.web.context.WebApplicationContext";
private static final String REACTIVE_APPLICATION_CONTEXT_CLASS = "org.springframework.boot.web.reactive.context.ReactiveWebApplicationContext";

static WebApplicationType deduceFromClasspath() {
    // 如果存在 REACTIVE 相关的类，不存在 SERVLET 相关的类，则创建 REACTIVE 类型
    if (ClassUtils.isPresent(WEBFLUX_INDICATOR_CLASS, null) && !ClassUtils.isPresent(WEBMVC_INDICATOR_CLASS, null)
            && !ClassUtils.isPresent(JERSEY_INDICATOR_CLASS, null)) {
        return WebApplicationType.REACTIVE;
    }
    // 如果不存在 SERVLET 相关的类，则创建 NONE 类型
    for (String className : SERVLET_INDICATOR_CLASSES) {
        if (!ClassUtils.isPresent(className, null)) {
            return WebApplicationType.NONE;
        }
    }
    // 否则，创建 SERVLET 类型
    return WebApplicationType.SERVLET;
}
```

- 逻辑比较简单，根据 classpath 中，判断是否存在相应的类，从而判断 Web 应用类型。

# 4. ApplicationContextInitializer

`org.springframework.context.ApplicationContextInitializer` 接口，应用上下文初始化器。代码如下：

```java
// ApplicationContextInitializer.java

@FunctionalInterface
public interface ApplicationContextInitializer<C extends ConfigurableApplicationContext> {

    /**
     * Initialize the given application context.
     * @param applicationContext the application to initialize
     */
    void initialize(C applicationContext);

}
```

- 用于在 Spring 应用上下文（ConfigurableApplicationContext）刷新（refresh）之前，对应用上下文进行初始化操作。

## 4.1 getSpringFactoriesInstances

在 `#SpringApplication(ResourceLoader resourceLoader, Class<?>... primarySources)` 构造方法中，会调用 `#getSpringFactoriesInstances(Class<T> type)` 方法，获得指定类型的数组。代码如下：

```java
// SpringApplication.java

private <T> Collection<T> getSpringFactoriesInstances(Class<T> type) {
	return getSpringFactoriesInstances(type, new Class<?>[] {});
}

private <T> Collection<T> getSpringFactoriesInstances(Class<T> type, Class<?>[] parameterTypes, Object... args) {
    ClassLoader classLoader = getClassLoader();
    // Use names and ensure unique to protect against duplicates
    // <1> 加载指定类型对应的，在 `META-INF/spring.factories` 里的类名的数组
    Set<String> names = new LinkedHashSet<>(SpringFactoriesLoader.loadFactoryNames(type, classLoader));
    // <2> 创建对象
    List<T> instances = createSpringFactoriesInstances(type, parameterTypes, classLoader, args, names);
    // <3> 排序
    AnnotationAwareOrderComparator.sort(instances);
    return instances;
}
```

- `<1>` 处，调用 `SpringFactoriesLoader#loadFactoryNames(Class<?> factoryClass, ClassLoader classLoader)` 方法，加载指定类型对应的，在 `META-INF/spring.factories` 里的类名的数组。

  - 关于 `SpringFactoriesLoader` 的详细解析，见 [《【死磕 Spring】—— IoC 之加载 BeanDefinition》](http://svip.iocoder.cn/Spring/IoC-load-BeanDefinitions/?vip) 的 [「3. loadFactoryNames」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 小节。

- `<2>` 处，调用 `#createSpringFactoriesInstances(Class<T> type, Class<?>[] parameterTypes, ClassLoader classLoader, Object[] args, Set<String> names)` 方法，创建对象数组。代码如下：

  ```java
  // SpringApplication.java
  
  private <T> List<T> createSpringFactoriesInstances(Class<T> type, Class<?>[] parameterTypes,
  		ClassLoader classLoader, Object[] args, Set<String> names) {
      // 数组大小
      List<T> instances = new ArrayList<>(names.size());
      // 遍历 names 数组
      for (String name : names) {
          try {
              // 获得 name 对应的类
              Class<?> instanceClass = ClassUtils.forName(name, classLoader);
              // 判断类是否实现 type 接口
              Assert.isAssignable(type, instanceClass);
              // 获得构造方法
              Constructor<?> constructor = instanceClass.getDeclaredConstructor(parameterTypes);
              // 创建对象
              T instance = (T) BeanUtils.instantiateClass(constructor, args);
              // 添加到 instances 中
              instances.add(instance);
          } catch (Throwable ex) {
              throw new IllegalArgumentException("Cannot instantiate " + type + " : " + name, ex);
          }
      }
      return instances;
  }
  ```

  - 比较简单，胖友自己瞅瞅。

- `<3>` 处，调用 `AnnotationAwareOrderComparator#sort(List<?> list)` 方法，排序对象数组。

  - 关于 `AnnotationAwareOrderComparator` 的详细解析，见 [《【死磕 Spring】—— ﻿@Order 注解和 Ordered 接口》](http://svip.iocoder.cn/Spring/Order-Ordered/?vip) 。

- 这样，我们就获得了 `ApplicationContextInitializer` 的对象数组。

## 4.2 setInitializers

在 `#SpringApplication(ResourceLoader resourceLoader, Class<?>... primarySources)` 构造方法中，会调用 `#setInitializers(Collection<? extends ApplicationContextInitializer<?>> initializers)` 方法，设置 `initializers` 属性。代码如下：

```java
// SpringApplication.java

public void setInitializers(Collection<? extends ApplicationContextInitializer<?>> initializers) {
	this.initializers = new ArrayList<>();
	this.initializers.addAll(initializers);
}
```

# 5. ApplicationListener

`org.springframework.context.ApplicationListener` 接口，应用事件监听器。代码如下：

```java
// ApplicationListener.java

@FunctionalInterface
public interface ApplicationListener<E extends ApplicationEvent> extends EventListener {

    /**
     * Handle an application event.
     * @param event the event to respond to
     */
    void onApplicationEvent(E event);

}
```

- 用于监听 Spring 应用的事件。关于 Spring 事件的机制，可以看看 [《【死磕 Spring】—— IoC 之深入分析 Spring 事件的机制》](http://svip.iocoder.cn/Spring/IoC-ApplicationEvent/?vip) 。

## 5.1 getSpringFactoriesInstances

同 [「4.1 getSpringFactoriesInstances」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 一样，也是调用 `#getSpringFactoriesInstances(Class<T> type)` 方法，获得 `ApplicationListener` 的对象数组。

## 5.2 setListeners

在 `#SpringApplication(ResourceLoader resourceLoader, Class<?>... primarySources)` 构造方法中，会调用 `#setListeners(Collection<? extends ApplicationListener<?>> listeners)` 方法，设置 `listeners` 属性。代码如下：

```java
// SpringApplication.java

public void setListeners(Collection<? extends ApplicationListener<?>> listeners) {
	this.listeners = new ArrayList<>();
	this.listeners.addAll(listeners);
}
```

# 6. mainApplicationClass

在 `#SpringApplication(ResourceLoader resourceLoader, Class<?>... primarySources)` 构造方法中，会调用 `#deduceMainApplicationClass()` 方法，获得 `mainApplicationClass` 属性。代码如下：

```java
// SpringApplication.java

private Class<?> mainApplicationClass;

private Class<?> deduceMainApplicationClass() {
    try {
        // 获得当前栈
        StackTraceElement[] stackTrace = new RuntimeException().getStackTrace();
        // 遍历栈，判断哪个执行 main 方法
        for (StackTraceElement stackTraceElement : stackTrace) {
            if ("main".equals(stackTraceElement.getMethodName())) {
                return Class.forName(stackTraceElement.getClassName());
            }
        }
    } catch (ClassNotFoundException ex) {
        // Swallow and continue
    }
    return null;
}
```

- 通过异常的方式，获取当前执行的栈，从而判断哪个执行了 `#main(String[] args)` 方法，获得对应的类。

# 7. 小结

至此，我们已经完成了 SpringApplication 的初始化的源码解析。后续，我们会继续解析 `#run(String... args)` 方法的执行的过程。

2025-08-25 11:49:48,963 - evaluation_logger_Cross-109 - INFO - Complete Result: {'score': 0, 'reason': 'The response does not address any of the requested information about hotels or car rentals in Beverly Hills, Los Angeles.'}
2025-08-25 11:49:58,544 - evaluation_logger_Cross-109 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 11:49:58,544 - evaluation_logger_Cross-109 - INFO - Message: Success.
2025-08-25 11:49:58,544 - evaluation_logger_Cross-109 - INFO - Success turn num = 3
2025-08-25 11:49:58,544 - evaluation_logger_Cross-109 - INFO - ----------------------------------------------------------------------------------------------------
