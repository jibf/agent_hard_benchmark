2025-08-25 12:58:22,772 - evaluation_logger_Attraction-39 - INFO - Test Example Attraction-39
2025-08-25 12:58:22,772 - evaluation_logger_Attraction-39 - INFO - Query: Our company is planning a trip to Vienna for the employees. What is the highest-rated attraction there?
2025-08-25 12:58:31,475 - evaluation_logger_Attraction-39 - INFO - Function Calls: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Vienna"
        }
    }
]

2025-08-25 12:58:31,475 - evaluation_logger_Attraction-39 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Vienna"
        }
    },
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0xOTk1NDk5fQ==",
            "sortBy": "attr_book_score"
        }
    }
]

2025-08-25 12:58:31,475 - evaluation_logger_Attraction-39 - INFO - Start compare_single_call: 
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Vienna'}}
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Vienna'}}
2025-08-25 12:58:31,475 - evaluation_logger_Attraction-39 - INFO - Rule-based compare success.
2025-08-25 12:58:31,475 - evaluation_logger_Attraction-39 - INFO - Success matched: [{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Vienna'}}]
2025-08-25 12:58:31,475 - evaluation_logger_Attraction-39 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "products": [
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJTV1NrbldHbTl2IiwidWZpIjotMTk5NTQ5OX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Vienna Airport Transfer: Vienna to Vienna International Airport (VIE)",
                    "productId": "PRSWSknWGm9v",
                    "productSlug": "prswsknwgm9v-vienna-airport-transfer-vienna-to-vienna-international-airport-vie",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -1995499,
                    "cityName": "Vienna",
                    "countryCode": "at"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJHQVduVGYxUXhyIiwidWZpIjotMTk5MTQ0MH0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Vienna Arrival Private Transfers from Vienna Airport VIE to Vienna City",
                    "productId": "PRGAWnTf1Qxr",
                    "productSlug": "prgawntf1qxr-vienna-arrival-private-transfers-from-vienna-airport-vie-to-vienna-",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -1991440,
                    "cityName": "Schwechat",
                    "countryCode": "at"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFI3ajlZM29BaE01IiwidWZpIjotMTk5MTQ0MH0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Vienna Arrival Private Transfers from Vienna Airport VIE to Vienna City",
                    "productId": "PR7j9Y3oAhM5",
                    "productSlug": "pr7j9y3oahm5-vienna-arrival-private-transfers-from-vienna-airport-vie-to-vienna-",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -1991440,
                    "cityName": "Schwechat",
                    "countryCode": "at"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFI5aFFHVWdSSWI4IiwidWZpIjotMTk5NTQ5OX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Vienna Departure Private Transfers from Vienna City to Vienna Airport VIE",
                    "productId": "PR9hQGUgRIb8",
                    "productSlug": "pr9hqgugrib8-vienna-departure-private-transfers-from-vienna-city-to-vienna-airpo",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -1995499,
                    "cityName": "Vienna",
                    "countryCode": "at"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJoYWhFQmpaZ1FpIiwidWZpIjotMTk5NTQ5OX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Vienna Pass",
                    "productId": "PRhahEBjZgQi",
                    "productSlug": "prhahebjzgqi-vienna-pass",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -1995499,
                    "cityName": "Vienna",
                    "countryCode": "at"
                }
            ],
            "destinations": [
                {
                    "id": "eyJ1ZmkiOi0xOTk1NDk5fQ==",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": -1995499,
                    "country": "Austria",
                    "cityName": "Vienna",
                    "productCount": 777,
                    "cc1": "at"
                }
            ]
        }
    }
]

2025-08-25 12:58:41,751 - evaluation_logger_Attraction-39 - INFO - Function Calls: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0xOTk1NDk5fQ==",
            "sortBy": "attr_book_score"
        }
    }
]

2025-08-25 12:58:41,752 - evaluation_logger_Attraction-39 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0xOTk1NDk5fQ==",
            "sortBy": "attr_book_score"
        }
    }
]

2025-08-25 12:58:41,752 - evaluation_logger_Attraction-39 - INFO - Start compare_single_call: 
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0xOTk1NDk5fQ==', 'sortBy': 'attr_book_score'}}
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0xOTk1NDk5fQ==', 'sortBy': 'attr_book_score'}}
2025-08-25 12:58:41,752 - evaluation_logger_Attraction-39 - INFO - Rule-based compare success.
2025-08-25 12:58:41,752 - evaluation_logger_Attraction-39 - INFO - Success matched: [{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0xOTk1NDk5fQ==', 'sortBy': 'attr_book_score'}}]
2025-08-25 12:58:41,752 - evaluation_logger_Attraction-39 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProductSearchResponse",
            "products": [
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRtEAG8urN5F",
                    "name": "Admission to Schönbrunn Zoo",
                    "slug": "prteag8urn5f-admission-to-schonbrunn-zoo",
                    "shortDescription": "A ticket to the UNESCO-listed city zoo with skip-the-line access",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 29.49,
                        "currency": "USD",
                        "publicAmount": 29.49
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.8,
                            "total": 406
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Vienna",
                        "ufi": -1995499
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI7YOrDlLCdd"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIyOBQn2nF83"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 3
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRHGyAAOHyZ4",
                    "name": "Schönbrunn Palace Guided Tour with Admission",
                    "slug": "prhgyaaohyz4-schonbrunn-palace-guided-tour-with-admission",
                    "shortDescription": "A tour to explore the luxurious summer residence of the Habsburg monarchs",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 58.98,
                        "currency": "USD",
                        "publicAmount": 58.98
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 95,
                        "percentage": "88%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.7,
                            "total": 876
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Vienna",
                        "ufi": -1995499
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIIf0RkIgBkl"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI0QNDzZi0Qp"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIxoMm1c4yjD"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIMeghX2My2o"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIBGJruvQuyd"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIwHmv6ZwdlH"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI2qdiFYTqyC"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIsbKjB1KkaC"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OICMF7lj4dDH"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI5x4RqwCjo3"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIrpnt9XENrF"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIpA9XjgeSl7"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    }
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": false
                    },
                    "id": "PR2BfUVF6RVg",
                    "name": "Vienna Kunsthistorisches Museum",
                    "slug": "pr2bfuvf6rvg-vienna-kunsthistorisches-museum",
                    "shortDescription": "Magnificent art collection spanning from ancient Egypt to the 18th century",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 22.94,
                        "currency": "USD",
                        "publicAmount": 22.94
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 108,
                        "percentage": "96%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.7,
                            "total": 299
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Vienna",
                        "ufi": -1995499
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIfYreWL2ZSs"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIh1FIEJrjIe"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI7TXAE7b7sI"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIS6pcn0czxK"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIbkGffjCTZm"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIrlRREnk7XQ"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIkvlikz1S78"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIi4vPGz3jrn"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIHPTnxJyBXW"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIOJKwvAsbjL"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIIJhnFsO5Zt"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 8
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForMuseums",
                            "value": true,
                            "rank": 3
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRee2hR3j4X9",
                    "name": "Vienna Mozart Concert Ticket",
                    "slug": "pree2hr3j4x9-vienna-mozart-concert-ticket",
                    "shortDescription": "An 18th-century musical recreation at the Musikverein",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 64.45,
                        "currency": "USD",
                        "publicAmount": 64.45
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 7,
                        "percentage": "100%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.7,
                            "total": 212
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Vienna",
                        "ufi": -1995499
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIgcglXDmprb"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIt7ox3xpqxo"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIV5sdddHGpA"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIDvf24o5Xqu"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIGTBzGgcFAu"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIeGkD9T519Q"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIzakF3wht7w"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIlkEJhUaWvT"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    }
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": false
                    },
                    "id": "PRuYCCVyFX3d",
                    "name": "Vienna's Airport Train Ride to the City Centre",
                    "slug": "pruyccvyfx3d-ticket-for-viennas-city-airport-train",
                    "shortDescription": "A convenient transfer service between Vienna's main airport and downtown",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 16.28,
                        "currency": "USD",
                        "publicAmount": 16.28
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.7,
                            "total": 67
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Vienna",
                        "ufi": -1995499
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIO8GcZ3MJc9"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OITL0yyhKuEJ"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIb3y8xxlFG2"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIDy3SkC2uY8"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OItPKA1rz84g"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIpvD2WC5ITW"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIjZYViDBuXB"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OISTqhtBYWlH"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    }
                }
            ],
            "filterStats": {
                "__typename": "FilterStats",
                "unfilteredProductCount": 782,
                "filteredProductCount": 782
            },
            "sorters": [
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Our top picks",
                    "value": "trending"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Most popular",
                    "value": "attr_book_score"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Lowest price",
                    "value": "lowest_price"
                }
            ],
            "defaultSorter": {
                "__typename": "AttractionsSorterOption",
                "name": "Our top picks",
                "value": "trending"
            },
            "filterOptions": {
                "__typename": "FilterOptions",
                "typeFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Tours",
                        "tagname": "tours",
                        "productCount": 132
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Museums, arts & culture",
                        "tagname": "museums-arts-culture",
                        "productCount": 123
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Entertainment & tickets",
                        "tagname": "entertainment-tickets",
                        "productCount": 77
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Nature & outdoor",
                        "tagname": "nature-outdoor",
                        "productCount": 58
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Food & drinks",
                        "tagname": "food-drinks",
                        "productCount": 21
                    }
                ],
                "labelFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Free cancellation",
                        "tagname": "free_cancellation",
                        "productCount": 693
                    }
                ],
                "ufiFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Vienna",
                        "tagname": "-1995499",
                        "productCount": 766
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Schwechat",
                        "tagname": "-1991440",
                        "productCount": 15
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Klosterneuburg",
                        "tagname": "-1982773",
                        "productCount": 1
                    }
                ],
                "priceFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "US$0 - US$22",
                        "tagname": "b0",
                        "productCount": 117
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$22 - US$44",
                        "tagname": "b1",
                        "productCount": 93
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$44 - US$83",
                        "tagname": "b2",
                        "productCount": 87
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$83 - US$138",
                        "tagname": "b3",
                        "productCount": 65
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$138+",
                        "tagname": "b4",
                        "productCount": 434
                    }
                ]
            }
        }
    }
]

2025-08-25 13:00:10,019 - evaluation_logger_Attraction-39 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 概述

本文，我们来分享 [《精尽 Spring Boot 源码分析 —— SpringApplication》](http://svip.iocoder.cn/Spring-Boot/SpringApplication/) 的**初始化**的源码解析。

在 SpringApplication 实例初始化的过程中，会进行一些**初始化操作**。同时，因为 SpringApplication 的**构造参数**是应用程序的主要来源，所以会进行**一些相关的设置**。

# 2. 构造方法

`org.springframework.boot.SpringApplication` ，Spring 应用启动器。它的构造方法的代码如下：

```java
// SpringApplication.java

/**
 * Create a new {@link SpringApplication} instance. The application context will load
 * beans from the specified primary sources (see {@link SpringApplication class-level}
 * documentation for details. The instance can be customized before calling
 * {@link #run(String...)}.
 * @param resourceLoader the resource loader to use
 * @param primarySources the primary bean sources
 * @see #run(Class, String[])
 * @see #setSources(Set)
 */
@SuppressWarnings({ "unchecked", "rawtypes" })
public SpringApplication(ResourceLoader resourceLoader, Class<?>... primarySources) {
    this.resourceLoader = resourceLoader;
    Assert.notNull(primarySources, "PrimarySources must not be null");
    this.primarySources = new LinkedHashSet<>(Arrays.asList(primarySources));
    // <1> 推断 Web 应用的类型
    this.webApplicationType = WebApplicationType.deduceFromClasspath();
    // <2> 设置 ApplicationContextInitializer
    setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class));
    // <3> 设置 ApplicationListener
    setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));
    // <4> 推断主类
    this.mainApplicationClass = deduceMainApplicationClass();
}
```

- `resourceLoader` 参数，资源加载器。可以暂时不理解，等后续需要使用到的时候，在进行讲解。
- `primarySources` 参数，主要的 Java Config 类的数组。在文初提供的示例，就是 `Application.class` 。
- `<1>` 处，调用 `WebApplicationType#deduceFromClasspath()` 方法，推断 Web 应用的类型。WebApplicationType 枚举，有三个值，分别是 `NONE`( 非 Web )、`SERVLET`( Web Servlet )、`REACTIVE`( Web Reactive )。
- `<2>` 处，设置 ApplicationContextInitializer 数组。详细解析，见 [「2.1 设置 ApplicationContextInitializer」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 。
- `<3>` 处，设置 ApplicationListener 数组。详细解析，见 [「2.2 设置 ApplicationListener」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 。
- `<4>` 处，调用 `#deduceMainApplicationClass()` 方法，推断主类。详细解析，见 [「2.3 推断主类」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 。

## 2.1 设置 ApplicationContextInitializer

`#setInitializers(Collection<? extends ApplicationContextInitializer<?>> initializers)` 方法，设置 ApplicationContextInitializer 数组。代码如下：

```java
// SpringApplication.java

public void setInitializers(Collection<? extends ApplicationContextInitializer<?>> initializers) {
	this.initializers = new ArrayList<>();
	this.initializers.addAll(initializers);
}
```

- 关于 `#getSpringFactoriesInstances(Class<T> type)` 方法，在 [《精尽 Spring Boot 源码分析 —— 应用程序启动》](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 有详细解析。

## 2.2 设置 ApplicationListener

`#setListeners(Collection<? extends ApplicationListener<?>> listeners)` 方法，设置 ApplicationListener 数组。代码如下：

```java
// SpringApplication.java

public void setListeners(Collection<? extends ApplicationListener<?>> listeners) {
	this.listeners = new ArrayList<>();
	this.listeners.addAll(listeners);
}
```

## 2.3 推断主类

`#deduceMainApplicationClass()` 方法，推断主类。代码如下：

```java
// SpringApplication.java

private Class<?> deduceMainApplicationClass() {
	try {
		// 获得当前 StackTraceElement 数组
		StackTraceElement[] stackTrace = new RuntimeException().getStackTrace();
		// 判断哪个执行 main 方法
		for (StackTraceElement stackTraceElement : stackTrace) {
			if ("main".equals(stackTraceElement.getMethodName())) {
				return Class.forName(stackTraceElement.getClassName());
			}
		}
	} catch (ClassNotFoundException ex) {
		// Swallow and continue
	}
	return null;
}
```

- 通过获得当前 StackTraceElement 数组，然后判断哪个执行了 `#main(String[] args)` 方法，从而推断主类。

# 3. 自定义 SpringApplication

在 SpringApplication 实例初始化的过程中，我们可以**自定义** SpringApplication 对象。例如说，添加额外的 ApplicationContextInitializer 实现类，或者 ApplicationListener 实现类。

## 3.1 添加 ApplicationContextInitializer

`#addInitializers(ApplicationContextInitializer<?>... initializers)` 方法，添加一个或多个 ApplicationContextInitializer 对象。代码如下：

```java
// SpringApplication.java

public void addInitializers(ApplicationContextInitializer<?>... initializers) {
	this.initializers.addAll(Arrays.asList(initializers));
}
```

## 3.2 添加 ApplicationListener

`#addListeners(ApplicationListener<?>... listeners)` 方法，添加一个或多个 ApplicationListener 对象。代码如下：

```java
// SpringApplication.java

public void addListeners(ApplicationListener<?>... listeners) {
	this.listeners.addAll(Arrays.asList(listeners));
}
```

## 3.3 设置其他

还有其它方法，可以自定义 SpringApplication 对象。例如说：

```java
// SpringApplication.java

/**
 * Set if the application is headless and should not instantiate AWT. Defaults to
 * {@code true} to prevent java icons appearing.
 * @param headless if the application is headless
 */
public void setHeadless(boolean headless) {
	this.headless = headless;
}

/**
 * Sets if the created {@link ApplicationContext} should have a shutdown hook
 * registered. Defaults to {@code true} to ensure that JVM shutdowns are handled
 * gracefully.
 * @param registerShutdownHook if the shutdown hook should be registered
 */
public void setRegisterShutdownHook(boolean registerShutdownHook) {
	this.registerShutdownHook = registerShutdownHook;
}

/**
 * Sets the {@link ResourceLoader} that should be used when loading resources.
 * @param resourceLoader the resource loader
 */
public void setResourceLoader(ResourceLoader resourceLoader) {
	this.resourceLoader = resourceLoader;
}

/**
 * Sets the primary sources to be used by this application. The primary sources are used
 * to create an {@link ApplicationContext}. Typically these will be a set of
 * {@link Configuration @Configuration} classes that define the behavior of your
 * application. The primary sources may also be a set of JAX-RS resources if the JAX-RS
 * support is enabled.
 * @param primarySources the primary sources
 * @see #SpringApplication(Class...)
 * @see #getAllSources()
 */
public void setSources(Set<String> sources) {
	Assert.notNull(sources, "Sources must not be null");
	this.sources = new LinkedHashSet<>(sources);
}
```

- 比较简单，胖友自己瞅瞅。

# 4. 总结

总的来说，SpringApplication 的初始化过程，就是**收集各种配置**，方便后续的 `#run(String... args)` 方法的执行。

另外，本文涉及的类，胖友可以后续再去看看：

- ApplicationContextInitializer
- ApplicationListener



2025-08-25 13:00:15,450 - evaluation_logger_Attraction-39 - INFO - Complete Result: {'score': 0, 'reason': 'The response does not address any of the requested information about the highest-rated attraction in Vienna.'}
2025-08-25 13:00:21,786 - evaluation_logger_Attraction-39 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 13:00:21,787 - evaluation_logger_Attraction-39 - INFO - Message: Success.
2025-08-25 13:00:21,787 - evaluation_logger_Attraction-39 - INFO - Success turn num = 2
2025-08-25 13:00:21,787 - evaluation_logger_Attraction-39 - INFO - ----------------------------------------------------------------------------------------------------
