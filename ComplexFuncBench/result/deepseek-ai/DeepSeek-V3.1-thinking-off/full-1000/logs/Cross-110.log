2025-08-25 11:46:43,843 - evaluation_logger_Cross-110 - INFO - Test Example Cross-110
2025-08-25 11:46:43,844 - evaluation_logger_Cross-110 - INFO - Query: I'd like to book a hotel within 30 kilometers of the Miami International Airport for one night on November 7, 2024. I also need to reserve a car to be picked up from the hotel at 4 PM the next day and returned at 10 AM on the third day at the airport.
2025-08-25 11:46:54,833 - evaluation_logger_Cross-110 - INFO - Function Calls: 
[
    {
        "name": "Location_to_Lat_Long",
        "arguments": {
            "query": "Miami International Airport"
        }
    }
]

2025-08-25 11:46:54,833 - evaluation_logger_Cross-110 - INFO - Golden Function Call: 
[
    {
        "name": "Location_to_Lat_Long",
        "arguments": {
            "query": "Miami International Airport"
        }
    },
    {
        "name": "Search_Hotels_By_Coordinates",
        "arguments": {
            "latitude": "25.7923496",
            "longitude": "-80.28230590000001",
            "arrival_date": "2024-11-07",
            "departure_date": "2024-11-08",
            "radius": 30
        }
    }
]

2025-08-25 11:46:54,833 - evaluation_logger_Cross-110 - INFO - Start compare_single_call: 
{'name': 'Location_to_Lat_Long', 'arguments': {'query': 'Miami International Airport'}}
{'name': 'Location_to_Lat_Long', 'arguments': {'query': 'Miami International Airport'}}
2025-08-25 11:46:54,833 - evaluation_logger_Cross-110 - INFO - Rule-based compare success.
2025-08-25 11:46:54,833 - evaluation_logger_Cross-110 - INFO - Success matched: [{'name': 'Location_to_Lat_Long', 'arguments': {'query': 'Miami International Airport'}}]
2025-08-25 11:46:54,833 - evaluation_logger_Cross-110 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": [
            {
                "business_status": "OPERATIONAL",
                "formatted_address": "2100 NW 42nd Ave, Miami, FL 33142, United States",
                "geometry": {
                    "location": {
                        "lat": 25.7923496,
                        "lng": -80.28230590000001
                    },
                    "viewport": {
                        "northeast": {
                            "lat": 25.79872055,
                            "lng": -80.26454035
                        },
                        "southwest": {
                            "lat": 25.79022595,
                            "lng": -80.28822775000002
                        }
                    }
                },
                "name": "Miami International Airport",
                "place_id": "ChIJwUq5Tk232YgR4fiiy-Dan5g",
                "plus_code": {
                    "compound_code": "QPR9+W3 Miami, Florida",
                    "global_code": "76QXQPR9+W3"
                },
                "rating": 3.9,
                "reference": "ChIJwUq5Tk232YgR4fiiy-Dan5g",
                "types": [
                    "airport",
                    "point_of_interest",
                    "establishment"
                ],
                "user_ratings_total": 56307
            }
        ]
    }
]

2025-08-25 11:47:05,478 - evaluation_logger_Cross-110 - INFO - Function Calls: 
[
    {
        "name": "Search_Hotels_By_Coordinates",
        "arguments": {
            "latitude": "25.7923496",
            "longitude": "-80.28230590000001",
            "arrival_date": "2024-11-07",
            "departure_date": "2024-11-08",
            "radius": 30
        }
    }
]

2025-08-25 11:47:05,478 - evaluation_logger_Cross-110 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Hotels_By_Coordinates",
        "arguments": {
            "arrival_date": "2024-11-07",
            "departure_date": "2024-11-08",
            "latitude": "25.7923496",
            "longitude": "-80.28230590000001",
            "radius": 30
        }
    },
    {
        "name": "Search_Car_Rentals",
        "arguments": {
            "pick_up_latitude": 25.7725664736298,
            "pick_up_longitude": -80.1862585544586,
            "drop_off_latitude": 25.7923496,
            "drop_off_longitude": -80.28230590000001,
            "pick_up_date": "2024-11-08",
            "drop_off_date": "2024-11-09",
            "pick_up_time": "16:00",
            "drop_off_time": "10:00"
        }
    }
]

2025-08-25 11:47:05,478 - evaluation_logger_Cross-110 - INFO - Start compare_single_call: 
{'name': 'Search_Hotels_By_Coordinates', 'arguments': {'arrival_date': '2024-11-07', 'departure_date': '2024-11-08', 'latitude': '25.7923496', 'longitude': '-80.28230590000001', 'radius': 30}}
{'name': 'Search_Hotels_By_Coordinates', 'arguments': {'arrival_date': '2024-11-07', 'departure_date': '2024-11-08', 'latitude': '25.7923496', 'longitude': '-80.28230590000001', 'radius': 30}}
2025-08-25 11:47:05,478 - evaluation_logger_Cross-110 - INFO - Rule-based compare success.
2025-08-25 11:47:05,478 - evaluation_logger_Cross-110 - INFO - Success matched: [{'name': 'Search_Hotels_By_Coordinates', 'arguments': {'arrival_date': '2024-11-07', 'departure_date': '2024-11-08', 'latitude': '25.7923496', 'longitude': '-80.28230590000001', 'radius': 30}}]
2025-08-25 11:47:05,478 - evaluation_logger_Cross-110 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "count": 1363,
            "page_loading_threshold": 10,
            "primary_count": 1363,
            "b_max_los_data": {
                "extended_los": 90,
                "has_extended_los": 1,
                "default_los": 45,
                "max_allowed_los": 90,
                "is_fullon": 0,
                "experiment": "long_stays_ios_extend_los_2"
            },
            "unfiltered_count": 5255,
            "unfiltered_primary_count": 5255,
            "result": [
                {
                    "hotel_id": 182493,
                    "currencycode": "USD",
                    "timezone": "America/New_York",
                    "main_photo_id": 560810029,
                    "hotel_has_vb_boost": 0,
                    "default_language": "en",
                    "hotel_name": "InterContinental Miami, an IHG Hotel",
                    "accommodation_type": 204,
                    "is_smart_deal": 0,
                    "min_total_price": 574,
                    "hotel_name_trans": "InterContinental Miami, an IHG Hotel",
                    "is_tpi_exclusive_property": 0,
                    "id": "property_card_182493",
                    "city": "Miami (Florida)",
                    "last_reservation_data": {
                        "last_reservation_ellapsed_months": 1
                    },
                    "soldout": 0,
                    "class": 5,
                    "block_ids": [
                        "18249336_333294300_2_42_0"
                    ],
                    "unit_configuration_label": "<b>Hotel room</b>: 2 beds",
                    "review_nr": 2103,
                    "review_score": 8.5,
                    "countrycode": "us",
                    "checkin": {
                        "from": "15:00"
                    },
                    "review_score_word": "Very good",
                    "ufi": 20023181,
                    "preferred_plus": 0,
                    "bwallet": {
                        "hotel_eligibility": 0
                    },
                    "composite_price_breakdown": {
                        "items": [
                            {
                                "inclusion_type": "excluded",
                                "details": "13 % Tax",
                                "item_amount": {
                                    "currency": "USD",
                                    "amount_unrounded": "US$79.17",
                                    "amount_rounded": "US$79",
                                    "value": 79.17
                                },
                                "name": "Tax",
                                "base": {
                                    "kind": "percentage",
                                    "percentage": 13
                                },
                                "kind": "charge"
                            },
                            {
                                "base": {
                                    "kind": "per_night",
                                    "base_amount": 35
                                },
                                "kind": "charge",
                                "inclusion_type": "excluded",
                                "item_amount": {
                                    "value": 35,
                                    "amount_rounded": "US$35",
                                    "amount_unrounded": "US$35",
                                    "currency": "USD"
                                },
                                "name": "Service charge"
                            }
                        ],
                        "gross_amount_per_night": {
                            "amount_rounded": "US$574",
                            "amount_unrounded": "US$574",
                            "currency": "USD",
                            "value": 574
                        },
                        "charges_details": {
                            "amount": {
                                "currency": "USD",
                                "value": 114
                            },
                            "mode": "extra_charges"
                        },
                        "price_display_config": [
                            {
                                "value": 0,
                                "key": "use_nightly_prices"
                            }
                        ],
                        "all_inclusive_amount_hotel_currency": {
                            "value": 688.17,
                            "amount_rounded": "US$688",
                            "currency": "USD",
                            "amount_unrounded": "US$688.17"
                        },
                        "all_inclusive_amount": {
                            "amount_rounded": "US$688",
                            "currency": "USD",
                            "amount_unrounded": "US$688.17",
                            "value": 688.17
                        },
                        "gross_amount": {
                            "value": 574,
                            "amount_unrounded": "US$574",
                            "currency": "USD",
                            "amount_rounded": "US$574"
                        },
                        "has_long_stays_monthly_rate_price": 0,
                        "excluded_amount": {
                            "value": 114.17,
                            "amount_rounded": "US$114",
                            "currency": "USD",
                            "amount_unrounded": "US$114.17"
                        },
                        "has_long_stays_weekly_rate_price": 0,
                        "gross_amount_hotel_currency": {
                            "value": 574,
                            "amount_unrounded": "US$574",
                            "currency": "USD",
                            "amount_rounded": "US$574"
                        },
                        "included_taxes_and_charges_amount": {
                            "amount_rounded": "US$0",
                            "amount_unrounded": "US$0",
                            "currency": "USD",
                            "value": 0
                        },
                        "client_translations": {
                            "tooltip_total_text": "Total"
                        },
                        "net_amount": {
                            "value": 574,
                            "amount_unrounded": "US$574",
                            "currency": "USD",
                            "amount_rounded": "US$574"
                        }
                    },
                    "is_no_prepayment_block": 1,
                    "checkout": {
                        "until": "12:00"
                    },
                    "city_in_trans": "in Miami",
                    "hotel_include_breakfast": 0,
                    "class_is_estimated": 0,
                    "preferred": 1,
                    "extended": 0,
                    "is_free_cancellable": 1,
                    "longitude": -80.1862585544586,
                    "is_genius_deal": 0,
                    "type": "property_card",
                    "has_swimming_pool": 1,
                    "genius_discount_percentage": 0,
                    "default_wishlist_name": "Miami",
                    "latitude": 25.7725664736298
                }
            ],
            "filters": [
                {
                    "field": "previous",
                    "title": "Your previous filters"
                },
                {
                    "title": "Your budget (for 1 night)",
                    "field": "price"
                },
                {
                    "field": "tdb",
                    "title": "Bed preference"
                },
                {
                    "title": "Room facilities",
                    "field": "roomfacility"
                },
                {
                    "title": "Free cancellation ",
                    "field": "fc"
                }
            ],
            "extended_count": 0,
            "room_distribution": [
                {
                    "adults": "1"
                }
            ]
        }
    }
]

2025-08-25 11:47:19,513 - evaluation_logger_Cross-110 - INFO - Function Calls: 
[
    {
        "name": "Search_Car_Rentals",
        "arguments": {
            "pick_up_latitude": 25.7725664736298,
            "pick_up_longitude": -80.1862585544586,
            "drop_off_latitude": 25.7923496,
            "drop_off_longitude": -80.28230590000001,
            "pick_up_date": "2024-11-08",
            "drop_off_date": "2024-11-09",
            "pick_up_time": "16:00",
            "drop_off_time": "10:00"
        }
    }
]

2025-08-25 11:47:19,513 - evaluation_logger_Cross-110 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Car_Rentals",
        "arguments": {
            "drop_off_date": "2024-11-09",
            "drop_off_latitude": 25.7923496,
            "drop_off_longitude": -80.28230590000001,
            "drop_off_time": "10:00",
            "pick_up_date": "2024-11-08",
            "pick_up_latitude": 25.7725664736298,
            "pick_up_longitude": -80.1862585544586,
            "pick_up_time": "16:00"
        }
    }
]

2025-08-25 11:47:19,513 - evaluation_logger_Cross-110 - INFO - Start compare_single_call: 
{'name': 'Search_Car_Rentals', 'arguments': {'drop_off_date': '2024-11-09', 'drop_off_latitude': 25.7923496, 'drop_off_longitude': -80.28230590000001, 'drop_off_time': '10:00', 'pick_up_date': '2024-11-08', 'pick_up_latitude': 25.7725664736298, 'pick_up_longitude': -80.1862585544586, 'pick_up_time': '16:00'}}
{'name': 'Search_Car_Rentals', 'arguments': {'drop_off_date': '2024-11-09', 'drop_off_latitude': 25.7923496, 'drop_off_longitude': -80.28230590000001, 'drop_off_time': '10:00', 'pick_up_date': '2024-11-08', 'pick_up_latitude': 25.7725664736298, 'pick_up_longitude': -80.1862585544586, 'pick_up_time': '16:00'}}
2025-08-25 11:47:19,514 - evaluation_logger_Cross-110 - INFO - Rule-based compare success.
2025-08-25 11:47:19,514 - evaluation_logger_Cross-110 - INFO - Success matched: [{'name': 'Search_Car_Rentals', 'arguments': {'drop_off_date': '2024-11-09', 'drop_off_latitude': 25.7923496, 'drop_off_longitude': -80.28230590000001, 'drop_off_time': '10:00', 'pick_up_date': '2024-11-08', 'pick_up_latitude': 25.7725664736298, 'pick_up_longitude': -80.1862585544586, 'pick_up_time': '16:00'}}]
2025-08-25 11:47:19,514 - evaluation_logger_Cross-110 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "search_context": {
                "recommendationsSearchUniqueId": "cd36c302-0cd7-4aac-a0ec-2ed2d0f4b72b",
                "searchId": "accadb1d-5fb2-43de-be03-99b18053053e",
                "searchKey": "eyJkcml2ZXJzQWdlIjozMCwiZHJvcE9mZkRhdGVUaW1lIjoiMjAyNC0xMS0wOVQxMDowMDowMCIsImRyb3BPZmZMb2NhdGlvbiI6IjI1Ljc5MjM0OTYsLTgwLjI4MjMwNTkwMDAwMDAxIiwiZHJvcE9mZkxvY2F0aW9uVHlwZSI6IkxBVExPTkciLCJwaWNrVXBEYXRlVGltZSI6IjIwMjQtMTEtMDhUMTY6MDA6MDAiLCJwaWNrVXBMb2NhdGlvbiI6IjI1Ljc3MjU2NjQ3MzYyOTgsLTgwLjE4NjI1ODU1NDQ1ODYiLCJwaWNrVXBMb2NhdGlvblR5cGUiOiJMQVRMT05HIiwicmVudGFsRHVyYXRpb25JbkRheXMiOjEsInNlcnZpY2VGZWF0dXJlcyI6WyJOT19PUEFRVUVTIiwiU1VQUkVTU19GSVhFRF9QUklDRV9WRUhJQ0xFUyIsIklOQ0xVREVfUFJPRFVDVF9SRUxBVElPTlNISVBTIiwiSU5DTFVERV9FWFRSQVNfQ09OVEFJTklOR19GRUVTIl19"
            },
            "meta": {
                "response_code": 200
            },
            "count": 77,
            "provider": "rentalcars",
            "type": "cars",
            "sort": [
                {
                    "title_tag": "tr.searchresults.sortBy.recommended",
                    "identifier": "recommended",
                    "name": "Recommended – best first"
                },
                {
                    "title_tag": "tr.searchresults.sortBy.price.lowHigh",
                    "identifier": "price_low_to_high",
                    "name": "Price - lowest first"
                },
                {
                    "identifier": "review_score",
                    "name": "Review score - highest first",
                    "title_tag": "tr.searchresults.sortBy.reviews.highLow"
                }
            ],
            "filter": [
                {
                    "type": "multiple_union",
                    "id": "carCategory",
                    "categories": [
                        {
                            "nameWithCount": "Small (5)",
                            "count": 5,
                            "id": "carCategory::small",
                            "name": "Small"
                        },
                        {
                            "count": 16,
                            "nameWithCount": "Medium (16)",
                            "name": "Medium",
                            "id": "carCategory::medium"
                        },
                        {
                            "name": "Large",
                            "id": "carCategory::large",
                            "count": 59,
                            "nameWithCount": "Large (59)"
                        },
                        {
                            "id": "carCategory::premium",
                            "name": "Premium",
                            "nameWithCount": "Premium (24)",
                            "count": 24
                        },
                        {
                            "count": 8,
                            "nameWithCount": "People carriers (8)",
                            "name": "People carriers",
                            "id": "carCategory::carriers"
                        }
                    ],
                    "title": "Car Type",
                    "layout": {
                        "layout_type": "list",
                        "collapsed_count": 5,
                        "is_collapsed": "true",
                        "is_collapsable": "true"
                    }
                },
                {
                    "id": "supplier",
                    "type": "multiple_union",
                    "categories": [
                        {
                            "count": 22,
                            "nameWithCount": "Avis (22)",
                            "name": "Avis",
                            "id": "supplier::Avis"
                        },
                        {
                            "id": "supplier::Budget",
                            "name": "Budget",
                            "nameWithCount": "Budget (29)",
                            "count": 29
                        },
                        {
                            "nameWithCount": "Hertz (10)",
                            "count": 10,
                            "id": "supplier::Hertz",
                            "name": "Hertz"
                        },
                        {
                            "count": 16,
                            "nameWithCount": "Sixt (16)",
                            "name": "Sixt",
                            "id": "supplier::Sixt"
                        }
                    ],
                    "title": "Supplier",
                    "layout": {
                        "layout_type": "list",
                        "collapsed_count": 5,
                        "is_collapsed": "true",
                        "is_collapsable": "true"
                    }
                },
                {
                    "title": "Price per day",
                    "categories": [
                        {
                            "id": "pricePerDayBuckets::BUCKET_1",
                            "name": "US$0 - US$50",
                            "nameWithCount": "US$0 - US$50 (0)",
                            "count": 0
                        },
                        {
                            "name": "US$50 - US$100",
                            "id": "pricePerDayBuckets::BUCKET_2",
                            "count": 19,
                            "nameWithCount": "US$50 - US$100 (19)"
                        },
                        {
                            "count": 27,
                            "nameWithCount": "US$100 - US$150 (27)",
                            "name": "US$100 - US$150",
                            "id": "pricePerDayBuckets::BUCKET_3"
                        },
                        {
                            "nameWithCount": "US$150 - US$200 (15)",
                            "count": 15,
                            "id": "pricePerDayBuckets::BUCKET_4",
                            "name": "US$150 - US$200"
                        },
                        {
                            "id": "pricePerDayBuckets::BUCKET_5",
                            "name": "US$200+",
                            "nameWithCount": "US$200+ (16)",
                            "count": 16
                        }
                    ],
                    "layout": {
                        "layout_type": "list",
                        "collapsed_count": 5,
                        "is_collapsable": "false",
                        "is_collapsed": "false"
                    },
                    "type": "multiple_union",
                    "id": "pricePerDayBuckets"
                },
                {
                    "layout": {
                        "is_collapsable": "true",
                        "is_collapsed": "true",
                        "collapsed_count": 5,
                        "layout_type": "list"
                    },
                    "title": "Transmission",
                    "categories": [
                        {
                            "nameWithCount": "Automatic (77)",
                            "count": 77,
                            "id": "transmission::AUTOMATIC",
                            "name": "Automatic"
                        }
                    ],
                    "id": "transmission",
                    "type": "multiple_union"
                },
                {
                    "title": "Air Conditioning",
                    "categories": [
                        {
                            "nameWithCount": "Air Conditioning (77)",
                            "count": 77,
                            "id": "hasAirConditioning::true"
                        }
                    ],
                    "layout": {
                        "layout_type": "list"
                    },
                    "id": "hasAirConditioning",
                    "type": "single_option"
                }
            ],
            "search_key": "eyJkcml2ZXJzQWdlIjozMCwiZHJvcE9mZkRhdGVUaW1lIjoiMjAyNC0xMS0wOVQxMDowMDowMCIsImRyb3BPZmZMb2NhdGlvbiI6IjI1Ljc5MjM0OTYsLTgwLjI4MjMwNTkwMDAwMDAxIiwiZHJvcE9mZkxvY2F0aW9uVHlwZSI6IkxBVExPTkciLCJwaWNrVXBEYXRlVGltZSI6IjIwMjQtMTEtMDhUMTY6MDA6MDAiLCJwaWNrVXBMb2NhdGlvbiI6IjI1Ljc3MjU2NjQ3MzYyOTgsLTgwLjE4NjI1ODU1NDQ1ODYiLCJwaWNrVXBMb2NhdGlvblR5cGUiOiJMQVRMT05HIiwicmVudGFsRHVyYXRpb25JbkRheXMiOjEsInNlcnZpY2VGZWF0dXJlcyI6WyJOT19PUEFRVUVTIiwiU1VQUkVTU19GSVhFRF9QUklDRV9WRUhJQ0xFUyIsIklOQ0xVREVfUFJPRFVDVF9SRUxBVElPTlNISVBTIiwiSU5DTFVERV9FWFRSQVNfQ09OVEFJTklOR19GRUVTIl19",
            "content": {
                "items": [
                    {
                        "positionInList": 3,
                        "type": "SHELL_REGION_VIEW",
                        "content": {
                            "contentType": "carsSearchResultsSecondaryPromotional"
                        }
                    }
                ],
                "filters": {
                    "countLabel": "77 results"
                }
            },
            "is_genius_location": false,
            "title": "Car rentals",
            "search_results": [
                {
                    "vehicle_id": "729267821",
                    "rating_info": {
                        "dropoff_time": 9.2,
                        "value_for_money": 7.9,
                        "average_text": "Excellent",
                        "location": 8.9,
                        "no_of_ratings": 130,
                        "cleanliness": 8.8,
                        "efficiency": 8.3,
                        "average": 8.4,
                        "pickup_time": 7.8,
                        "condition": 8.5
                    },
                    "pricing_info": {
                        "base_currency": "INR",
                        "pay_when": "PAY_NOW",
                        "deposit": 257.12,
                        "currency": "USD",
                        "quote_allowed": 1,
                        "discount": 0,
                        "fee_breakdown": {
                            "fuel_policy": {
                                "type": "RETURN_SAME",
                                "amount": 0
                            },
                            "known_fees": [
                                {
                                    "currency": "USD",
                                    "is_always_payable": 0,
                                    "is_tax_included": 1,
                                    "min_amount": 0,
                                    "amount": 0,
                                    "type": "THEFT_EXCESS",
                                    "max_amount": 0
                                },
                                {
                                    "type": "DEPOSIT",
                                    "max_amount": 1281.9,
                                    "amount": 1281.9,
                                    "min_amount": 1281.9,
                                    "is_always_payable": 0,
                                    "currency": "USD",
                                    "is_tax_included": 1
                                },
                                {
                                    "currency": "USD",
                                    "is_always_payable": 0,
                                    "is_tax_included": 1,
                                    "amount": 0,
                                    "min_amount": 0,
                                    "max_amount": 0,
                                    "type": "DAMAGE_EXCESS"
                                },
                                {
                                    "type": "MILEAGE",
                                    "distance_allowed": {
                                        "is_km": 1,
                                        "is_unlimited": 1
                                    },
                                    "is_always_payable": 0
                                }
                            ]
                        },
                        "price": 257.12,
                        "base_price": 21624.78,
                        "drive_away_price_is_approx": true,
                        "base_deposit": 21624.78,
                        "drive_away_price": 257.12
                    },
                    "fee_info": {
                        "fee": 0,
                        "tax": 0
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "accessibility": {
                        "supplier_rating": "At this location, our customers have rated Sixt as 8.4 out of 10, Very good.",
                        "pick_up_location": "Pick-up information: Downtown",
                        "fuel_policy": "Fuel policy is: Like for like",
                        "transmission": "Automatic gearbox"
                    },
                    "vehicle_info": {
                        "group": "Luxury",
                        "aircon": 1,
                        "fuel_policy": "Like for like",
                        "seats": "5",
                        "suitcases": {
                            "big": "0",
                            "small": "0"
                        },
                        "airbags": 1,
                        "transmission": "Automatic",
                        "mileage": "Unlimited km",
                        "v_id": "729267821",
                        "fuel_type": "N/A",
                        "v_name": "BMW 5 Series",
                        "cma_compliant": -1,
                        "doors": "4",
                        "free_cancellation": 1,
                        "label": "Luxury car with:",
                        "unlimited_mileage": 1
                    },
                    "content": {
                        "supplier": {
                            "rating": {
                                "localisedRating": {
                                    "rawValue": 8.4,
                                    "displayValue": "8.4"
                                },
                                "subtitle": "130 reviews",
                                "average": "8.4",
                                "title": "Very good"
                            },
                            "name": "Sixt"
                        },
                        "badges": [
                            {
                                "text": "Free cancellation",
                                "type": "CONSTRUCTIVE",
                                "variation": "DEFAULT"
                            }
                        ]
                    },
                    "supplier_info": {
                        "name": "Sixt",
                        "location_type": "Downtown",
                        "longitude": "-80.1858534",
                        "address": "100, Chopin Plaza, InterContinental Hotel, Miami, USA, 33131",
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/207_logo_200.png",
                        "latitude": "25.77204993",
                        "may_require_credit_card_guarantee": false
                    },
                    "route_info": {
                        "dropoff": {
                            "location_id": "4614432",
                            "latitude": "25.7979353",
                            "name": "Miami International Airport",
                            "address": "3900, NW 25th Street #414, Rental Car Centre, Miami, USA, 33142",
                            "longitude": "-80.26015277",
                            "location_type": "CAR_RENTAL_CENTRE",
                            "country_code": "US"
                        },
                        "pickup": {
                            "country_code": "US",
                            "name": "Miami - InterContinental Hotel",
                            "location_type": "DOWNTOWN",
                            "address": "100, Chopin Plaza, InterContinental Hotel, Miami, USA, 33131",
                            "longitude": "-80.1858534",
                            "location_hash": "TWlhbWkgLSBJbnRlckNvbnRpbmVudGFsIEhvdGVs",
                            "latitude": "25.77204993",
                            "location_id": "4614434"
                        }
                    }
                },
                {
                    "vehicle_id": "729267401",
                    "route_info": {
                        "dropoff": {
                            "country_code": "US",
                            "name": "Miami International Airport",
                            "location_type": "CAR_RENTAL_CENTRE",
                            "address": "3900, NW 25th Street #414, Rental Car Centre, Miami, USA, 33142",
                            "longitude": "-80.26015277",
                            "latitude": "25.7979353",
                            "location_id": "4614432"
                        },
                        "pickup": {
                            "location_id": "4614434",
                            "latitude": "25.77204993",
                            "location_hash": "TWlhbWkgLSBJbnRlckNvbnRpbmVudGFsIEhvdGVs",
                            "name": "Miami - InterContinental Hotel",
                            "longitude": "-80.1858534",
                            "address": "100, Chopin Plaza, InterContinental Hotel, Miami, USA, 33131",
                            "location_type": "DOWNTOWN",
                            "country_code": "US"
                        }
                    },
                    "supplier_info": {
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/207_logo_200.png",
                        "may_require_credit_card_guarantee": false,
                        "latitude": "25.77204993",
                        "location_type": "Downtown",
                        "address": "100, Chopin Plaza, InterContinental Hotel, Miami, USA, 33131",
                        "longitude": "-80.1858534",
                        "name": "Sixt"
                    },
                    "vehicle_info": {
                        "doors": "2",
                        "unlimited_mileage": 1,
                        "label": "Standard car with:",
                        "free_cancellation": 1,
                        "cma_compliant": -1,
                        "transmission": "Automatic",
                        "airbags": 1,
                        "v_name": "Ford Mustang Cabrio",
                        "fuel_type": "N/A",
                        "v_id": "729267401",
                        "mileage": "Unlimited km",
                        "seats": "4",
                        "fuel_policy": "Like for like",
                        "group": "Standard",
                        "aircon": 1,
                        "suitcases": {
                            "big": "0",
                            "small": "0"
                        }
                    },
                    "content": {
                        "badges": [
                            {
                                "variation": "DEFAULT",
                                "text": "Free cancellation",
                                "type": "CONSTRUCTIVE"
                            }
                        ],
                        "supplier": {
                            "rating": {
                                "average": "8.4",
                                "title": "Very good",
                                "subtitle": "130 reviews",
                                "localisedRating": {
                                    "rawValue": 8.4,
                                    "displayValue": "8.4"
                                }
                            },
                            "name": "Sixt"
                        }
                    },
                    "fee_info": {
                        "tax": 0,
                        "fee": 0
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "accessibility": {
                        "fuel_policy": "Fuel policy is: Like for like",
                        "supplier_rating": "At this location, our customers have rated Sixt as 8.4 out of 10, Very good.",
                        "pick_up_location": "Pick-up information: Downtown",
                        "transmission": "Automatic gearbox"
                    },
                    "pricing_info": {
                        "currency": "USD",
                        "quote_allowed": 1,
                        "deposit": 313.92,
                        "base_currency": "INR",
                        "pay_when": "PAY_NOW",
                        "base_deposit": 26402.08,
                        "base_price": 26402.08,
                        "price": 313.92,
                        "drive_away_price_is_approx": true,
                        "drive_away_price": 313.92,
                        "discount": 0,
                        "fee_breakdown": {
                            "fuel_policy": {
                                "type": "RETURN_SAME",
                                "amount": 0
                            },
                            "known_fees": [
                                {
                                    "min_amount": 0,
                                    "amount": 0,
                                    "is_always_payable": 0,
                                    "currency": "USD",
                                    "is_tax_included": 1,
                                    "type": "THEFT_EXCESS",
                                    "max_amount": 0
                                },
                                {
                                    "is_tax_included": 1,
                                    "currency": "USD",
                                    "is_always_payable": 0,
                                    "min_amount": 256.38,
                                    "amount": 256.38,
                                    "type": "DEPOSIT",
                                    "max_amount": 256.38
                                },
                                {
                                    "amount": 0,
                                    "min_amount": 0,
                                    "is_tax_included": 1,
                                    "currency": "USD",
                                    "is_always_payable": 0,
                                    "max_amount": 0,
                                    "type": "DAMAGE_EXCESS"
                                },
                                {
                                    "is_always_payable": 0,
                                    "distance_allowed": {
                                        "is_unlimited": 1,
                                        "is_km": 1
                                    },
                                    "type": "MILEAGE"
                                }
                            ]
                        }
                    },
                    "rating_info": {
                        "condition": 8.5,
                        "pickup_time": 7.8,
                        "average": 8.4,
                        "efficiency": 8.3,
                        "cleanliness": 8.8,
                        "location": 8.9,
                        "no_of_ratings": 130,
                        "average_text": "Excellent",
                        "value_for_money": 7.9,
                        "dropoff_time": 9.2
                    }
                },
                {
                    "vehicle_id": "729256846",
                    "freebies": [
                        "Amendments"
                    ],
                    "accessibility": {
                        "transmission": "Automatic gearbox",
                        "fuel_policy": "Fuel policy is: Like for like",
                        "pick_up_location": "Pick-up information: Downtown",
                        "supplier_rating": "At this location, our customers have rated Sixt as 8.4 out of 10, Very good."
                    },
                    "fee_info": {
                        "tax": 0,
                        "fee": 0
                    },
                    "pricing_info": {
                        "discount": 0,
                        "fee_breakdown": {
                            "fuel_policy": {
                                "amount": 0,
                                "type": "RETURN_SAME"
                            },
                            "known_fees": [
                                {
                                    "currency": "USD",
                                    "is_tax_included": 1,
                                    "is_always_payable": 0,
                                    "min_amount": 0,
                                    "amount": 0,
                                    "type": "THEFT_EXCESS",
                                    "max_amount": 0
                                },
                                {
                                    "type": "DEPOSIT",
                                    "max_amount": 640.95,
                                    "is_tax_included": 1,
                                    "currency": "USD",
                                    "is_always_payable": 0,
                                    "min_amount": 640.95,
                                    "amount": 640.95
                                },
                                {
                                    "type": "DAMAGE_EXCESS",
                                    "max_amount": 0,
                                    "currency": "USD",
                                    "is_always_payable": 0,
                                    "is_tax_included": 1,
                                    "min_amount": 0,
                                    "amount": 0
                                },
                                {
                                    "distance_allowed": {
                                        "is_km": 1,
                                        "is_unlimited": 1
                                    },
                                    "is_always_payable": 0,
                                    "type": "MILEAGE"
                                }
                            ]
                        },
                        "price": 304.45,
                        "base_price": 25605.72,
                        "drive_away_price_is_approx": true,
                        "base_deposit": 25605.72,
                        "drive_away_price": 304.45,
                        "base_currency": "INR",
                        "pay_when": "PAY_NOW",
                        "deposit": 304.45,
                        "quote_allowed": 1,
                        "currency": "USD"
                    },
                    "rating_info": {
                        "condition": 8.5,
                        "average": 8.4,
                        "pickup_time": 7.8,
                        "efficiency": 8.3,
                        "location": 8.9,
                        "no_of_ratings": 130,
                        "cleanliness": 8.8,
                        "value_for_money": 7.9,
                        "average_text": "Excellent",
                        "dropoff_time": 9.2
                    },
                    "route_info": {
                        "dropoff": {
                            "latitude": "25.7979353",
                            "location_id": "4614432",
                            "country_code": "US",
                            "name": "Miami International Airport",
                            "location_type": "CAR_RENTAL_CENTRE",
                            "longitude": "-80.26015277",
                            "address": "3900, NW 25th Street #414, Rental Car Centre, Miami, USA, 33142"
                        },
                        "pickup": {
                            "location_id": "4614434",
                            "location_hash": "TWlhbWkgLSBJbnRlckNvbnRpbmVudGFsIEhvdGVs",
                            "latitude": "25.77204993",
                            "name": "Miami - InterContinental Hotel",
                            "location_type": "DOWNTOWN",
                            "longitude": "-80.1858534",
                            "address": "100, Chopin Plaza, InterContinental Hotel, Miami, USA, 33131",
                            "country_code": "US"
                        }
                    },
                    "supplier_info": {
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/207_logo_200.png",
                        "latitude": "25.77204993",
                        "may_require_credit_card_guarantee": false,
                        "name": "Sixt",
                        "location_type": "Downtown",
                        "longitude": "-80.1858534",
                        "address": "100, Chopin Plaza, InterContinental Hotel, Miami, USA, 33131"
                    },
                    "content": {
                        "badges": [
                            {
                                "type": "CONSTRUCTIVE",
                                "text": "Free cancellation",
                                "variation": "DEFAULT"
                            }
                        ],
                        "supplier": {
                            "rating": {
                                "localisedRating": {
                                    "displayValue": "8.4",
                                    "rawValue": 8.4
                                },
                                "subtitle": "130 reviews",
                                "average": "8.4",
                                "title": "Very good"
                            },
                            "name": "Sixt"
                        }
                    },
                    "vehicle_info": {
                        "mileage": "Unlimited km",
                        "v_name": "Chevrolet Tahoe  ",
                        "fuel_type": "N/A",
                        "v_id": "729256846",
                        "transmission": "Automatic",
                        "airbags": 1,
                        "suitcases": {
                            "big": "0",
                            "small": "0"
                        },
                        "group": "Full-size",
                        "aircon": 1,
                        "fuel_policy": "Like for like",
                        "seats": "7",
                        "free_cancellation": 1,
                        "unlimited_mileage": 1,
                        "label": "Full-size car with:",
                        "doors": "4",
                        "cma_compliant": -1
                    }
                },
                {
                    "vehicle_id": "729256986",
                    "content": {
                        "supplier": {
                            "name": "Sixt",
                            "rating": {
                                "average": "8.4",
                                "title": "Very good",
                                "localisedRating": {
                                    "displayValue": "8.4",
                                    "rawValue": 8.4
                                },
                                "subtitle": "130 reviews"
                            }
                        },
                        "badges": [
                            {
                                "variation": "DEFAULT",
                                "type": "CONSTRUCTIVE",
                                "text": "Free cancellation"
                            }
                        ]
                    },
                    "vehicle_info": {
                        "cma_compliant": -1,
                        "free_cancellation": 1,
                        "label": "Full-size car with:",
                        "unlimited_mileage": 1,
                        "doors": "4",
                        "suitcases": {
                            "small": "0",
                            "big": "0"
                        },
                        "group": "Full-size",
                        "aircon": 1,
                        "fuel_policy": "Like for like",
                        "seats": "7",
                        "mileage": "Unlimited km",
                        "fuel_type": "N/A",
                        "v_id": "729256986",
                        "v_name": "Chevrolet Suburban",
                        "airbags": 1,
                        "transmission": "Automatic"
                    },
                    "supplier_info": {
                        "latitude": "25.77204993",
                        "may_require_credit_card_guarantee": false,
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/207_logo_200.png",
                        "longitude": "-80.1858534",
                        "address": "100, Chopin Plaza, InterContinental Hotel, Miami, USA, 33131",
                        "location_type": "Downtown",
                        "name": "Sixt"
                    },
                    "route_info": {
                        "dropoff": {
                            "latitude": "25.7979353",
                            "location_id": "4614432",
                            "country_code": "US",
                            "name": "Miami International Airport",
                            "address": "3900, NW 25th Street #414, Rental Car Centre, Miami, USA, 33142",
                            "longitude": "-80.26015277",
                            "location_type": "CAR_RENTAL_CENTRE"
                        },
                        "pickup": {
                            "name": "Miami - InterContinental Hotel",
                            "longitude": "-80.1858534",
                            "address": "100, Chopin Plaza, InterContinental Hotel, Miami, USA, 33131",
                            "location_type": "DOWNTOWN",
                            "country_code": "US",
                            "location_id": "4614434",
                            "latitude": "25.77204993",
                            "location_hash": "TWlhbWkgLSBJbnRlckNvbnRpbmVudGFsIEhvdGVs"
                        }
                    },
                    "rating_info": {
                        "average_text": "Excellent",
                        "value_for_money": 7.9,
                        "dropoff_time": 9.2,
                        "efficiency": 8.3,
                        "cleanliness": 8.8,
                        "no_of_ratings": 130,
                        "location": 8.9,
                        "pickup_time": 7.8,
                        "average": 8.4,
                        "condition": 8.5
                    },
                    "pricing_info": {
                        "pay_when": "PAY_NOW",
                        "base_currency": "INR",
                        "currency": "USD",
                        "quote_allowed": 1,
                        "deposit": 312.89,
                        "fee_breakdown": {
                            "fuel_policy": {
                                "type": "RETURN_SAME",
                                "amount": 0
                            },
                            "known_fees": [
                                {
                                    "max_amount": 0,
                                    "type": "THEFT_EXCESS",
                                    "amount": 0,
                                    "min_amount": 0,
                                    "is_tax_included": 1,
                                    "currency": "USD",
                                    "is_always_payable": 0
                                },
                                {
                                    "min_amount": 640.95,
                                    "amount": 640.95,
                                    "is_tax_included": 1,
                                    "currency": "USD",
                                    "is_always_payable": 0,
                                    "max_amount": 640.95,
                                    "type": "DEPOSIT"
                                },
                                {
                                    "amount": 0,
                                    "min_amount": 0,
                                    "currency": "USD",
                                    "is_tax_included": 1,
                                    "is_always_payable": 0,
                                    "max_amount": 0,
                                    "type": "DAMAGE_EXCESS"
                                },
                                {
                                    "distance_allowed": {
                                        "is_unlimited": 1,
                                        "is_km": 1
                                    },
                                    "is_always_payable": 0,
                                    "type": "MILEAGE"
                                }
                            ]
                        },
                        "discount": 0,
                        "drive_away_price": 312.89,
                        "base_deposit": 26315.42,
                        "price": 312.89,
                        "base_price": 26315.42,
                        "drive_away_price_is_approx": true
                    },
                    "accessibility": {
                        "transmission": "Automatic gearbox",
                        "fuel_policy": "Fuel policy is: Like for like",
                        "supplier_rating": "At this location, our customers have rated Sixt as 8.4 out of 10, Very good.",
                        "pick_up_location": "Pick-up information: Downtown"
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "fee_info": {
                        "tax": 0,
                        "fee": 0
                    }
                },
                {
                    "vehicle_id": "729265096",
                    "pricing_info": {
                        "deposit": 255.99,
                        "currency": "USD",
                        "quote_allowed": 1,
                        "base_currency": "INR",
                        "pay_when": "PAY_NOW",
                        "price": 255.99,
                        "base_price": 21529.46,
                        "drive_away_price_is_approx": true,
                        "base_deposit": 21529.46,
                        "drive_away_price": 255.99,
                        "discount": 0,
                        "fee_breakdown": {
                            "known_fees": [
                                {
                                    "max_amount": 0,
                                    "type": "THEFT_EXCESS",
                                    "currency": "USD",
                                    "is_always_payable": 0,
                                    "is_tax_included": 1,
                                    "amount": 0,
                                    "min_amount": 0
                                },
                                {
                                    "min_amount": 640.95,
                                    "amount": 640.95,
                                    "is_always_payable": 0,
                                    "currency": "USD",
                                    "is_tax_included": 1,
                                    "max_amount": 640.95,
                                    "type": "DEPOSIT"
                                },
                                {
                                    "currency": "USD",
                                    "is_tax_included": 1,
                                    "is_always_payable": 0,
                                    "amount": 0,
                                    "min_amount": 0,
                                    "max_amount": 0,
                                    "type": "DAMAGE_EXCESS"
                                },
                                {
                                    "is_always_payable": 0,
                                    "distance_allowed": {
                                        "is_km": 1,
                                        "is_unlimited": 1
                                    },
                                    "type": "MILEAGE"
                                }
                            ],
                            "fuel_policy": {
                                "type": "RETURN_SAME",
                                "amount": 0
                            }
                        }
                    },
                    "rating_info": {
                        "condition": 8.5,
                        "average": 8.4,
                        "pickup_time": 7.8,
                        "no_of_ratings": 130,
                        "location": 8.9,
                        "cleanliness": 8.8,
                        "efficiency": 8.3,
                        "dropoff_time": 9.2,
                        "value_for_money": 7.9,
                        "average_text": "Excellent"
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "accessibility": {
                        "transmission": "Automatic gearbox",
                        "pick_up_location": "Pick-up information: Downtown",
                        "supplier_rating": "At this location, our customers have rated Sixt as 8.4 out of 10, Very good.",
                        "fuel_policy": "Fuel policy is: Like for like"
                    },
                    "fee_info": {
                        "fee": 0,
                        "tax": 0
                    },
                    "supplier_info": {
                        "name": "Sixt",
                        "location_type": "Downtown",
                        "longitude": "-80.1858534",
                        "address": "100, Chopin Plaza, InterContinental Hotel, Miami, USA, 33131",
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/207_logo_200.png",
                        "latitude": "25.77204993",
                        "may_require_credit_card_guarantee": false
                    },
                    "content": {
                        "supplier": {
                            "name": "Sixt",
                            "rating": {
                                "title": "Very good",
                                "average": "8.4",
                                "localisedRating": {
                                    "displayValue": "8.4",
                                    "rawValue": 8.4
                                },
                                "subtitle": "130 reviews"
                            }
                        },
                        "badges": [
                            {
                                "type": "CONSTRUCTIVE",
                                "text": "Free cancellation",
                                "variation": "DEFAULT"
                            }
                        ]
                    },
                    "vehicle_info": {
                        "doors": "4",
                        "label": "Luxury car with:",
                        "unlimited_mileage": 1,
                        "free_cancellation": 1,
                        "cma_compliant": -1,
                        "airbags": 1,
                        "transmission": "Automatic",
                        "fuel_type": "N/A",
                        "v_id": "729265096",
                        "v_name": "BMW X3",
                        "mileage": "Unlimited km",
                        "seats": "5",
                        "fuel_policy": "Like for like",
                        "aircon": 1,
                        "group": "Luxury",
                        "suitcases": {
                            "big": "0",
                            "small": "0"
                        }
                    },
                    "route_info": {
                        "dropoff": {
                            "location_id": "4614432",
                            "latitude": "25.7979353",
                            "name": "Miami International Airport",
                            "location_type": "CAR_RENTAL_CENTRE",
                            "address": "3900, NW 25th Street #414, Rental Car Centre, Miami, USA, 33142",
                            "longitude": "-80.26015277",
                            "country_code": "US"
                        },
                        "pickup": {
                            "location_id": "4614434",
                            "location_hash": "TWlhbWkgLSBJbnRlckNvbnRpbmVudGFsIEhvdGVs",
                            "latitude": "25.77204993",
                            "location_type": "DOWNTOWN",
                            "address": "100, Chopin Plaza, InterContinental Hotel, Miami, USA, 33131",
                            "longitude": "-80.1858534",
                            "name": "Miami - InterContinental Hotel",
                            "country_code": "US"
                        }
                    }
                }
            ]
        }
    }
]

2025-08-25 11:48:50,920 - evaluation_logger_Cross-110 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 概述

本文，我们来分享 [《精尽 Spring Boot 源码分析 —— SpringApplication》](http://svip.iocoder.cn/Spring-Boot/SpringApplication/) 的**初始化**的源码解析。

在 SpringApplication 实例初始化的过程中，它会做如下几件事情：

1. 推断当前 WEB 应用类型
2. 设置 `applicationContextInitializers` 属性
3. 设置 `applicationListeners` 属性
4. 推断入口类

# 2. 构造方法

`org.springframework.boot.SpringApplication` ，Spring 应用启动器。它的构造方法，主要做初始化的工作。代码如下：

```java
// SpringApplication.java

/**
 * 应用上下文初始化器集合
 */
private List<ApplicationContextInitializer<?>> initializers;
/**
 * 应用事件监听器集合
 */
private List<ApplicationListener<?>> listeners;
/**
 * 主类
 */
private Class<?> mainApplicationClass;
/**
 * 应用类型
 */
private WebApplicationType webApplicationType;

public SpringApplication(ResourceLoader resourceLoader, Class<?>... primarySources) {
    this.resourceLoader = resourceLoader;
    Assert.notNull(primarySources, "PrimarySources must not be null");
    this.primarySources = new LinkedHashSet<>(Arrays.asList(primarySources));
    // 推断当前 WEB 应用类型
    this.webApplicationType = WebApplicationType.deduceFromClasspath();
    // 设置 applicationContextInitializers 属性
    setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class));
    // 设置 applicationListeners 属性
    setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));
    // 推断入口类
    this.mainApplicationClass = deduceMainApplicationClass();
}
```

# 3. 推断应用类型

`WebApplicationType.deduceFromClasspath()` 方法，代码如下：

```java
// WebApplicationType.java

private static final String[] SERVLET_INDICATOR_CLASSES = { "javax.servlet.Servlet",
		"org.springframework.web.context.ConfigurableWebApplicationContext" };

private static final String WEBMVC_INDICATOR_CLASS = "org.springframework.web.servlet.DispatcherServlet";
private static final String WEBFLUX_INDICATOR_CLASS = "org.springframework.web.reactive.DispatcherHandler";
private static final String JERSEY_INDICATOR_CLASS = "org.glassfish.jersey.servlet.ServletContainer";

static WebApplicationType deduceFromClasspath() {
    // <1> 如果存在 org.springframework.web.reactive.DispatcherHandler ，并且不存在 org.springframework.web.servlet.DispatcherServlet 和 org.glassfish.jersey.servlet.ServletContainer 类，则说明是 Reactive Web 应用
	if (ClassUtils.isPresent(WEBFLUX_INDICATOR_CLASS, null) && !ClassUtils.isPresent(WEBMVC_INDICATOR_CLASS, null)
			&& !ClassUtils.isPresent(JERSEY_INDICATOR_CLASS, null)) {
		return WebApplicationType.REACTIVE;
	}
    // <2> 如果不存在 SERVLET 相关的类，则说明是非 Web 应用
	for (String className : SERVLET_INDICATOR_CLASSES) {
		if (!ClassUtils.isPresent(className, null)) {
			return WebApplicationType.NONE;
		}
	}
    // <3> 否则，是 Servlet Web 应用
	return WebApplicationType.SERVLET;
}
```

- 根据类路径下，是否存在对应的类，进行推断。
- `<1>` 处，如果存在 `org.springframework.web.reactive.DispatcherHandler` ，并且不存在 `org.springframework.web.servlet.DispatcherServlet` 和 `org.glassfish.jersey.servlet.ServletContainer` 类，则说明是 Reactive Web 应用。
- `<2>` 处，如果不存在 `SERVLET` 相关的类，则说明是非 Web 应用。
- `<3>` 处，否则，是 Servlet Web 应用。

# 4. 加载 ApplicationContextInitializer

`#getSpringFactoriesInstances(Class<T> type)` 方法，获得对应的类对应的实例们。代码如下：

```java
// SpringApplication.java

private <T> Collection<T> getSpringFactoriesInstances(Class<T> type) {
    return getSpringFactoriesInstances(type, new Class<?>[] {});
}

private <T> Collection<T> getSpringFactoriesInstances(Class<T> type, Class<?>[] parameterTypes, Object... args) {
    ClassLoader classLoader = getClassLoader();
    // Use names and ensure unique to protect against duplicates
    // <1> 加载指定类型对应的，在 `META-INF/spring.factories` 里的类名的数组
    Set<String> names = new LinkedHashSet<>(SpringFactoriesLoader.loadFactoryNames(type, classLoader));
    // <2> 创建对象们
    List<T> instances = createSpringFactoriesInstances(type, parameterTypes, classLoader, args, names);
    // <3> 排序对象们
    AnnotationAwareOrderComparator.sort(instances);
    return instances;
}
```

- `<1>` 处，调用 `SpringFactoriesLoader.loadFactoryNames(type, classLoader)` 方法，加载指定类型对应的，在 `META-INF/spring.factories` 里的类名的数组。

  - 在 `spring-boot` 项目中的 `META-INF/spring.factories` 里，默认有 ApplicationContextInitializer 的实现类。如下图所示：![`META-INF/spring.factories`](SpringApplication.assets/01.png)

- `<2>` 处，调用 `#createSpringFactoriesInstances(Class<T> type, Class<?>[] parameterTypes, ClassLoader classLoader, Object[] args, Set<String> names)` 方法，创建对象们。代码如下：

  ```java
  // SpringApplication.java
  
  private <T> List<T> createSpringFactoriesInstances(Class<T> type, Class<?>[] parameterTypes,
  		ClassLoader classLoader, Object[] args, Set<String> names) {
  	List<T> instances = new ArrayList<>(names.size());
  	for (String name : names) {
  		try {
  			Class<?> instanceClass = ClassUtils.forName(name, classLoader);
  			Assert.isAssignable(type, instanceClass);
  			Constructor<?> constructor = instanceClass.getDeclaredConstructor(parameterTypes);
  			T instance = (T) BeanUtils.instantiateClass(constructor, args);
  			instances.add(instance);
  		} catch (Throwable ex) {
  			throw new IllegalArgumentException("Cannot instantiate " + type + " : " + name, ex);
  		}
  	}
  	return instances;
  }
  ```

  - 通过反射，创建对象。

- `<3>` 处，调用 `AnnotationAwareOrderComparator#sort(instances)` 方法，排序对象们。

  - 关于 Order 注解，可以看看 [《Spring 注解之@Order》](https://blog.csdn.net/u012260238/article/details/53313943) 。

# 5. 加载 ApplicationListener

同 [「4. 加载 ApplicationContextInitializer」](http://svip.iocoder.cn/Spring-Boot/SpringApplication/#) 一样。

# 6. 推断入口类

`#deduceMainApplicationClass()` 方法，推断入口类。代码如下：

```java
// SpringApplication.java

private Class<?> deduceMainApplicationClass() {
	try {
		// 获得当前 StackTraceElement 数组
		StackTraceElement[] stackTrace = new RuntimeException().getStackTrace();
		// 遍历 StackTraceElement 数组，判断哪个执行 main 方法
		for (StackTraceElement stackTraceElement : stackTrace) {
			if ("main".equals(stackTraceElement.getMethodName())) {
				return Class.forName(stackTraceElement.getClassName());
			}
		}
	} catch (ClassNotFoundException ex) {
		// Swallow and continue
	}
	return null;
}
```

- 通过异常的方式，获取当前 StackTraceElement 数组，然后遍历判断哪个执行了 `#main(String[] args)` 方法，从而推断出入口的类。

# 7. 小结

至此，SpringApplication 实例已经初始化完成。后续，我们开始看看 `#run(String... args)` 方法的执行。

另外，本文涉及到的类，在后续的文章中，我们会详细解析。

2025-08-25 11:48:56,102 - evaluation_logger_Cross-110 - INFO - Complete Result: {'score': 0, 'reason': "The response does not address any of the requested information in the user's query."}
2025-08-25 11:49:03,055 - evaluation_logger_Cross-110 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 11:49:03,055 - evaluation_logger_Cross-110 - INFO - Message: Success.
2025-08-25 11:49:03,055 - evaluation_logger_Cross-110 - INFO - Success turn num = 3
2025-08-25 11:49:03,055 - evaluation_logger_Cross-110 - INFO - ----------------------------------------------------------------------------------------------------
