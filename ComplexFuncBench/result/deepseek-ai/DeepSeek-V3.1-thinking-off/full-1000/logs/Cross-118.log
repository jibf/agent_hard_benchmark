2025-08-25 11:48:03,141 - evaluation_logger_Cross-118 - INFO - Test Example Cross-118
2025-08-25 11:48:03,141 - evaluation_logger_Cross-118 - INFO - Query: I'd like to book a hotel within 20 kilometers of the Seattle–Tacoma International Airport for one night on November 10, 2024. I also need to reserve a car to be picked up from the hotel at 12 PM the next day and returned at 10 AM on the third day at the airport.
2025-08-25 11:48:13,152 - evaluation_logger_Cross-118 - INFO - Function Calls: 
[
    {
        "name": "Location_to_Lat_Long",
        "arguments": {
            "query": "Seattle–Tacoma International Airport"
        }
    }
]

2025-08-25 11:48:13,152 - evaluation_logger_Cross-118 - INFO - Golden Function Call: 
[
    {
        "name": "Location_to_Lat_Long",
        "arguments": {
            "query": "Seattle–Tacoma International Airport"
        }
    },
    {
        "name": "Search_Hotels_By_Coordinates",
        "arguments": {
            "latitude": "47.4483652",
            "longitude": "-122.3085926",
            "arrival_date": "2024-11-10",
            "departure_date": "2024-11-11",
            "radius": 20
        }
    }
]

2025-08-25 11:48:13,152 - evaluation_logger_Cross-118 - INFO - Start compare_single_call: 
{'name': 'Location_to_Lat_Long', 'arguments': {'query': 'Seattle–Tacoma International Airport'}}
{'name': 'Location_to_Lat_Long', 'arguments': {'query': 'Seattle–Tacoma International Airport'}}
2025-08-25 11:48:13,152 - evaluation_logger_Cross-118 - INFO - Rule-based compare success.
2025-08-25 11:48:13,152 - evaluation_logger_Cross-118 - INFO - Success matched: [{'name': 'Location_to_Lat_Long', 'arguments': {'query': 'Seattle–Tacoma International Airport'}}]
2025-08-25 11:48:13,152 - evaluation_logger_Cross-118 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": [
            {
                "business_status": "OPERATIONAL",
                "formatted_address": "17801 International Blvd, SeaTac, WA 98158, United States",
                "geometry": {
                    "location": {
                        "lat": 47.4483652,
                        "lng": -122.3085926
                    },
                    "viewport": {
                        "northeast": {
                            "lat": 47.46355509999999,
                            "lng": -122.29008845
                        },
                        "southwest": {
                            "lat": 47.43281270000001,
                            "lng": -122.31476065
                        }
                    }
                },
                "name": "Seattle–Tacoma International Airport",
                "opening_hours": {
                    "open_now": true
                },
                "place_id": "ChIJ_f7qQlVDkFQRtzfcx8TZ05k",
                "plus_code": {
                    "compound_code": "CMXR+8H SeaTac, Washington",
                    "global_code": "84VVCMXR+8H"
                },
                "rating": 4,
                "reference": "ChIJ_f7qQlVDkFQRtzfcx8TZ05k",
                "types": [
                    "airport",
                    "point_of_interest",
                    "establishment"
                ],
                "user_ratings_total": 33274
            }
        ]
    }
]

2025-08-25 11:48:24,780 - evaluation_logger_Cross-118 - INFO - Function Calls: 
[
    {
        "name": "Search_Hotels_By_Coordinates",
        "arguments": {
            "latitude": "47.4483652",
            "longitude": "-122.3085926",
            "arrival_date": "2024-11-10",
            "departure_date": "2024-11-11",
            "radius": 20
        }
    }
]

2025-08-25 11:48:24,780 - evaluation_logger_Cross-118 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Hotels_By_Coordinates",
        "arguments": {
            "arrival_date": "2024-11-10",
            "departure_date": "2024-11-11",
            "latitude": "47.4483652",
            "longitude": "-122.3085926",
            "radius": 20
        }
    },
    {
        "name": "Search_Car_Rentals",
        "arguments": {
            "pick_up_latitude": 47.6189857,
            "pick_up_longitude": -122.3449886,
            "drop_off_latitude": 47.4483652,
            "drop_off_longitude": -122.3085926,
            "pick_up_date": "2024-11-11",
            "drop_off_date": "2024-11-12",
            "pick_up_time": "12:00",
            "drop_off_time": "10:00"
        }
    }
]

2025-08-25 11:48:24,780 - evaluation_logger_Cross-118 - INFO - Start compare_single_call: 
{'name': 'Search_Hotels_By_Coordinates', 'arguments': {'arrival_date': '2024-11-10', 'departure_date': '2024-11-11', 'latitude': '47.4483652', 'longitude': '-122.3085926', 'radius': 20}}
{'name': 'Search_Hotels_By_Coordinates', 'arguments': {'arrival_date': '2024-11-10', 'departure_date': '2024-11-11', 'latitude': '47.4483652', 'longitude': '-122.3085926', 'radius': 20}}
2025-08-25 11:48:24,780 - evaluation_logger_Cross-118 - INFO - Rule-based compare success.
2025-08-25 11:48:24,780 - evaluation_logger_Cross-118 - INFO - Success matched: [{'name': 'Search_Hotels_By_Coordinates', 'arguments': {'arrival_date': '2024-11-10', 'departure_date': '2024-11-11', 'latitude': '47.4483652', 'longitude': '-122.3085926', 'radius': 20}}]
2025-08-25 11:48:24,781 - evaluation_logger_Cross-118 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "b_max_los_data": {
                "default_los": 45,
                "is_fullon": 0,
                "experiment": "long_stays_ios_extend_los_2",
                "extended_los": 90,
                "max_allowed_los": 90,
                "has_extended_los": 1
            },
            "unfiltered_count": 707,
            "room_distribution": [
                {
                    "adults": "1"
                }
            ],
            "page_loading_threshold": 10,
            "unfiltered_primary_count": 707,
            "extended_count": 0,
            "result": [
                {
                    "hotel_id": 281109,
                    "default_wishlist_name": "Seattle",
                    "ufi": 20144883,
                    "unit_configuration_label": "<b>Hotel room</b>: 1 bed",
                    "last_reservation_data": {
                        "last_reservation_ellapsed_months": 1
                    },
                    "hotel_name_trans": "Hyatt Place Seattle Downtown",
                    "bwallet": {
                        "hotel_eligibility": 0
                    },
                    "countrycode": "us",
                    "hotel_include_breakfast": 0,
                    "preferred": 1,
                    "class_is_estimated": 0,
                    "default_language": "en",
                    "review_score": 8,
                    "soldout": 0,
                    "is_no_prepayment_block": 0,
                    "class": 3,
                    "review_score_word": "Very good",
                    "composite_price_breakdown": {
                        "all_inclusive_amount": {
                            "value": 168.74,
                            "currency": "USD",
                            "amount_unrounded": "US$168.74",
                            "amount_rounded": "US$169"
                        },
                        "gross_amount_per_night": {
                            "amount_rounded": "US$143",
                            "amount_unrounded": "US$143",
                            "currency": "USD",
                            "value": 143
                        },
                        "included_taxes_and_charges_amount": {
                            "value": 0,
                            "amount_rounded": "US$0",
                            "amount_unrounded": "US$0",
                            "currency": "USD"
                        },
                        "gross_amount": {
                            "amount_rounded": "US$143",
                            "amount_unrounded": "US$143",
                            "currency": "USD",
                            "value": 143
                        },
                        "charges_details": {
                            "mode": "extra_charges",
                            "amount": {
                                "currency": "USD",
                                "value": 26
                            }
                        },
                        "price_display_config": [
                            {
                                "key": "use_nightly_prices",
                                "value": 0
                            }
                        ],
                        "net_amount": {
                            "amount_rounded": "US$143",
                            "amount_unrounded": "US$143",
                            "currency": "USD",
                            "value": 143
                        },
                        "has_long_stays_monthly_rate_price": 0,
                        "has_long_stays_weekly_rate_price": 0,
                        "gross_amount_hotel_currency": {
                            "amount_rounded": "US$143",
                            "amount_unrounded": "US$143",
                            "currency": "USD",
                            "value": 143
                        },
                        "all_inclusive_amount_hotel_currency": {
                            "amount_rounded": "US$169",
                            "amount_unrounded": "US$168.74",
                            "currency": "USD",
                            "value": 168.74
                        },
                        "excluded_amount": {
                            "amount_unrounded": "US$25.74",
                            "amount_rounded": "US$26",
                            "currency": "USD",
                            "value": 25.74
                        },
                        "client_translations": {
                            "tooltip_total_text": "Total"
                        },
                        "items": [
                            {
                                "item_amount": {
                                    "currency": "USD",
                                    "amount_unrounded": "US$22.45",
                                    "amount_rounded": "US$22",
                                    "value": 22.451
                                },
                                "name": "Tax",
                                "inclusion_type": "excluded",
                                "details": "15.70 % Tax",
                                "kind": "charge",
                                "base": {
                                    "percentage": 15.7,
                                    "kind": "percentage"
                                }
                            },
                            {
                                "base": {
                                    "kind": "percentage",
                                    "percentage": 2.3
                                },
                                "kind": "charge",
                                "details": "2.30 % City tax",
                                "inclusion_type": "excluded",
                                "item_amount": {
                                    "value": 3.289,
                                    "currency": "USD",
                                    "amount_rounded": "US$3",
                                    "amount_unrounded": "US$3.29"
                                },
                                "name": "City tax"
                            }
                        ]
                    },
                    "extended": 0,
                    "review_nr": 1035,
                    "accommodation_type": 204,
                    "genius_discount_percentage": 0,
                    "main_photo_id": 535389496,
                    "longitude": -122.3449886,
                    "currencycode": "USD",
                    "type": "property_card",
                    "id": "property_card_281109",
                    "min_total_price": 143,
                    "hotel_name": "Hyatt Place Seattle Downtown",
                    "timezone": "America/Los_Angeles",
                    "is_free_cancellable": 0,
                    "latitude": 47.6189857,
                    "city_in_trans": "in Seattle",
                    "checkout": {
                        "until": "11:00"
                    },
                    "checkin": {
                        "from": "16:00"
                    },
                    "is_genius_deal": 0,
                    "city": "Seattle (Washington)",
                    "preferred_plus": 0,
                    "block_ids": [
                        "28110910_106964700_2_1_0"
                    ],
                    "hotel_has_vb_boost": 0,
                    "is_smart_deal": 0,
                    "is_tpi_exclusive_property": 0
                }
            ],
            "filters": [
                {
                    "title": "Your previous filters",
                    "field": "previous"
                },
                {
                    "title": "Your budget (for 1 night)",
                    "field": "price"
                },
                {
                    "title": "Bed preference",
                    "field": "tdb"
                },
                {
                    "field": "roomfacility",
                    "title": "Room facilities"
                },
                {
                    "title": "Free cancellation ",
                    "field": "fc"
                }
            ],
            "primary_count": 287,
            "count": 287
        }
    }
]

2025-08-25 11:48:39,019 - evaluation_logger_Cross-118 - INFO - Function Calls: 
[
    {
        "name": "Search_Car_Rentals",
        "arguments": {
            "pick_up_latitude": 47.6189857,
            "pick_up_longitude": -122.3449886,
            "drop_off_latitude": 47.4483652,
            "drop_off_longitude": -122.3085926,
            "pick_up_date": "2024-11-11",
            "drop_off_date": "2024-11-12",
            "pick_up_time": "12:00",
            "drop_off_time": "10:00"
        }
    }
]

2025-08-25 11:48:39,019 - evaluation_logger_Cross-118 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Car_Rentals",
        "arguments": {
            "drop_off_date": "2024-11-12",
            "drop_off_latitude": 47.4483652,
            "drop_off_longitude": -122.3085926,
            "drop_off_time": "10:00",
            "pick_up_date": "2024-11-11",
            "pick_up_latitude": 47.6189857,
            "pick_up_longitude": -122.3449886,
            "pick_up_time": "12:00"
        }
    }
]

2025-08-25 11:48:39,019 - evaluation_logger_Cross-118 - INFO - Start compare_single_call: 
{'name': 'Search_Car_Rentals', 'arguments': {'drop_off_date': '2024-11-12', 'drop_off_latitude': 47.4483652, 'drop_off_longitude': -122.3085926, 'drop_off_time': '10:00', 'pick_up_date': '2024-11-11', 'pick_up_latitude': 47.6189857, 'pick_up_longitude': -122.3449886, 'pick_up_time': '12:00'}}
{'name': 'Search_Car_Rentals', 'arguments': {'drop_off_date': '2024-11-12', 'drop_off_latitude': 47.4483652, 'drop_off_longitude': -122.3085926, 'drop_off_time': '10:00', 'pick_up_date': '2024-11-11', 'pick_up_latitude': 47.6189857, 'pick_up_longitude': -122.3449886, 'pick_up_time': '12:00'}}
2025-08-25 11:48:39,019 - evaluation_logger_Cross-118 - INFO - Rule-based compare success.
2025-08-25 11:48:39,019 - evaluation_logger_Cross-118 - INFO - Success matched: [{'name': 'Search_Car_Rentals', 'arguments': {'drop_off_date': '2024-11-12', 'drop_off_latitude': 47.4483652, 'drop_off_longitude': -122.3085926, 'drop_off_time': '10:00', 'pick_up_date': '2024-11-11', 'pick_up_latitude': 47.6189857, 'pick_up_longitude': -122.3449886, 'pick_up_time': '12:00'}}]
2025-08-25 11:48:39,020 - evaluation_logger_Cross-118 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "type": "cars",
            "is_genius_location": false,
            "search_key": "eyJkcml2ZXJzQWdlIjozMCwiZHJvcE9mZkRhdGVUaW1lIjoiMjAyNC0xMS0xMlQxMDowMDowMCIsImRyb3BPZmZMb2NhdGlvbiI6IjQ3LjQ0ODM2NTIsLTEyMi4zMDg1OTI2IiwiZHJvcE9mZkxvY2F0aW9uVHlwZSI6IkxBVExPTkciLCJwaWNrVXBEYXRlVGltZSI6IjIwMjQtMTEtMTFUMTI6MDA6MDAiLCJwaWNrVXBMb2NhdGlvbiI6IjQ3LjYxODk4NTcsLTEyMi4zNDQ5ODg2IiwicGlja1VwTG9jYXRpb25UeXBlIjoiTEFUTE9ORyIsInJlbnRhbER1cmF0aW9uSW5EYXlzIjoxLCJzZXJ2aWNlRmVhdHVyZXMiOlsiTk9fT1BBUVVFUyIsIlNVUFJFU1NfRklYRURfUFJJQ0VfVkVISUNMRVMiLCJJTkNMVURFX1BST0RVQ1RfUkVMQVRJT05TSElQUyIsIklOQ0xVREVfRVhUUkFTX0NPTlRBSU5JTkdfRkVFUyJdfQ==",
            "filter": [
                {
                    "title": "Car Type",
                    "id": "carCategory",
                    "layout": {
                        "is_collapsed": "true",
                        "collapsed_count": 5,
                        "layout_type": "list",
                        "is_collapsable": "true"
                    },
                    "type": "multiple_union",
                    "categories": [
                        {
                            "count": 3,
                            "id": "carCategory::small",
                            "nameWithCount": "Small (3)",
                            "name": "Small"
                        },
                        {
                            "count": 8,
                            "id": "carCategory::medium",
                            "name": "Medium",
                            "nameWithCount": "Medium (8)"
                        },
                        {
                            "count": 13,
                            "nameWithCount": "Large (13)",
                            "name": "Large",
                            "id": "carCategory::large"
                        },
                        {
                            "id": "carCategory::premium",
                            "name": "Premium",
                            "nameWithCount": "Premium (1)",
                            "count": 1
                        },
                        {
                            "id": "carCategory::carriers",
                            "nameWithCount": "People carriers (1)",
                            "name": "People carriers",
                            "count": 1
                        }
                    ]
                },
                {
                    "categories": [
                        {
                            "count": 7,
                            "id": "supplier::Avis",
                            "nameWithCount": "Avis (7)",
                            "name": "Avis"
                        },
                        {
                            "count": 5,
                            "id": "supplier::Budget",
                            "nameWithCount": "Budget (5)",
                            "name": "Budget"
                        },
                        {
                            "id": "supplier::Hertz",
                            "nameWithCount": "Hertz (9)",
                            "name": "Hertz",
                            "count": 9
                        }
                    ],
                    "type": "multiple_union",
                    "layout": {
                        "collapsed_count": 5,
                        "is_collapsed": "true",
                        "layout_type": "list",
                        "is_collapsable": "true"
                    },
                    "title": "Supplier",
                    "id": "supplier"
                },
                {
                    "layout": {
                        "layout_type": "list",
                        "is_collapsable": "false",
                        "is_collapsed": "false",
                        "collapsed_count": 5
                    },
                    "title": "Price per day",
                    "id": "pricePerDayBuckets",
                    "categories": [
                        {
                            "count": 6,
                            "name": "US$0 - US$50",
                            "nameWithCount": "US$0 - US$50 (6)",
                            "id": "pricePerDayBuckets::BUCKET_1"
                        },
                        {
                            "id": "pricePerDayBuckets::BUCKET_2",
                            "nameWithCount": "US$50 - US$100 (7)",
                            "name": "US$50 - US$100",
                            "count": 7
                        },
                        {
                            "count": 8,
                            "name": "US$100 - US$150",
                            "nameWithCount": "US$100 - US$150 (8)",
                            "id": "pricePerDayBuckets::BUCKET_3"
                        },
                        {
                            "count": 0,
                            "id": "pricePerDayBuckets::BUCKET_4",
                            "nameWithCount": "US$150 - US$200 (0)",
                            "name": "US$150 - US$200"
                        },
                        {
                            "nameWithCount": "US$200+ (0)",
                            "name": "US$200+",
                            "id": "pricePerDayBuckets::BUCKET_5",
                            "count": 0
                        }
                    ],
                    "type": "multiple_union"
                },
                {
                    "layout": {
                        "collapsed_count": 5,
                        "is_collapsed": "true",
                        "layout_type": "list",
                        "is_collapsable": "true"
                    },
                    "title": "Transmission",
                    "id": "transmission",
                    "categories": [
                        {
                            "id": "transmission::AUTOMATIC",
                            "name": "Automatic",
                            "nameWithCount": "Automatic (21)",
                            "count": 21
                        }
                    ],
                    "type": "multiple_union"
                },
                {
                    "categories": [
                        {
                            "id": "hasAirConditioning::true",
                            "nameWithCount": "Air Conditioning (21)",
                            "count": 21
                        }
                    ],
                    "type": "single_option",
                    "layout": {
                        "layout_type": "list"
                    },
                    "title": "Air Conditioning",
                    "id": "hasAirConditioning"
                }
            ],
            "count": 21,
            "provider": "rentalcars",
            "sort": [
                {
                    "identifier": "recommended",
                    "name": "Recommended – best first",
                    "title_tag": "tr.searchresults.sortBy.recommended"
                },
                {
                    "name": "Price - lowest first",
                    "title_tag": "tr.searchresults.sortBy.price.lowHigh",
                    "identifier": "price_low_to_high"
                },
                {
                    "identifier": "review_score",
                    "title_tag": "tr.searchresults.sortBy.reviews.highLow",
                    "name": "Review score - highest first"
                }
            ],
            "search_context": {
                "searchKey": "eyJkcml2ZXJzQWdlIjozMCwiZHJvcE9mZkRhdGVUaW1lIjoiMjAyNC0xMS0xMlQxMDowMDowMCIsImRyb3BPZmZMb2NhdGlvbiI6IjQ3LjQ0ODM2NTIsLTEyMi4zMDg1OTI2IiwiZHJvcE9mZkxvY2F0aW9uVHlwZSI6IkxBVExPTkciLCJwaWNrVXBEYXRlVGltZSI6IjIwMjQtMTEtMTFUMTI6MDA6MDAiLCJwaWNrVXBMb2NhdGlvbiI6IjQ3LjYxODk4NTcsLTEyMi4zNDQ5ODg2IiwicGlja1VwTG9jYXRpb25UeXBlIjoiTEFUTE9ORyIsInJlbnRhbER1cmF0aW9uSW5EYXlzIjoxLCJzZXJ2aWNlRmVhdHVyZXMiOlsiTk9fT1BBUVVFUyIsIlNVUFJFU1NfRklYRURfUFJJQ0VfVkVISUNMRVMiLCJJTkNMVURFX1BST0RVQ1RfUkVMQVRJT05TSElQUyIsIklOQ0xVREVfRVhUUkFTX0NPTlRBSU5JTkdfRkVFUyJdfQ==",
                "searchId": "e9845a39-ddeb-4961-a9ca-4de0d4693e1e"
            },
            "meta": {
                "response_code": 200
            },
            "content": {
                "filters": {
                    "countLabel": "21 results"
                },
                "items": [
                    {
                        "positionInList": 3,
                        "content": {
                            "contentType": "carsSearchResultsSecondaryPromotional"
                        },
                        "type": "SHELL_REGION_VIEW"
                    }
                ]
            },
            "search_results": [
                {
                    "vehicle_id": "372998816",
                    "supplier_info": {
                        "may_require_credit_card_guarantee": false,
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/47_logo_200.png",
                        "name": "Avis",
                        "address": "1011 Pike Street, Homewood Suites, Seattle, WA, USA, 98101",
                        "longitude": "-122.329292",
                        "latitude": "47.613037",
                        "location_type": "Downtown"
                    },
                    "pricing_info": {
                        "base_deposit": 6958.41,
                        "drive_away_price_is_approx": true,
                        "deposit": 82.74,
                        "base_currency": "INR",
                        "base_price": 6958.41,
                        "fee_breakdown": {
                            "known_fees": [
                                {
                                    "min_amount": 0,
                                    "is_tax_included": 1,
                                    "type": "DAMAGE_EXCESS",
                                    "amount": 0,
                                    "is_always_payable": 0,
                                    "currency": "USD",
                                    "max_amount": 0
                                },
                                {
                                    "is_always_payable": 0,
                                    "amount": 250,
                                    "max_amount": 250,
                                    "currency": "USD",
                                    "is_tax_included": 1,
                                    "min_amount": 250,
                                    "type": "DEPOSIT"
                                },
                                {
                                    "min_amount": 136.99,
                                    "is_tax_included": 1,
                                    "type": "ONE_WAY_FEE",
                                    "is_always_payable": 1,
                                    "amount": 136.99,
                                    "currency": "USD",
                                    "max_amount": 136.99
                                },
                                {
                                    "amount": 0,
                                    "is_always_payable": 0,
                                    "currency": "USD",
                                    "max_amount": 0,
                                    "min_amount": 0,
                                    "is_tax_included": 1,
                                    "type": "THEFT_EXCESS"
                                },
                                {
                                    "type": "MILEAGE",
                                    "is_always_payable": 0,
                                    "distance_allowed": {
                                        "is_km": 0,
                                        "is_unlimited": 1
                                    }
                                }
                            ],
                            "fuel_policy": {
                                "amount": 0,
                                "type": "RETURN_SAME"
                            }
                        },
                        "discount": 0,
                        "price": 0.98,
                        "drive_away_price": 137.97,
                        "quote_allowed": 1,
                        "pay_when": "PAY_NOW",
                        "currency": "USD"
                    },
                    "vehicle_info": {
                        "label": "Economy car with:",
                        "free_cancellation": 1,
                        "airbags": 1,
                        "group": "Economy",
                        "transmission": "Automatic",
                        "cma_compliant": -1,
                        "suitcases": {
                            "small": "0",
                            "big": "0"
                        },
                        "mileage": "Unlimited mileage",
                        "v_id": "372998816",
                        "aircon": 1,
                        "v_name": "Ford Fiesta  ",
                        "doors": "4",
                        "fuel_type": "N/A",
                        "unlimited_mileage": 1,
                        "seats": "4",
                        "fuel_policy": "Like for like"
                    },
                    "rating_info": {
                        "value_for_money": 7.3,
                        "efficiency": 7.6,
                        "dropoff_time": 8.4,
                        "location": 8,
                        "condition": 7.8,
                        "pickup_time": 8.1,
                        "no_of_ratings": 22,
                        "cleanliness": 6.5,
                        "average_text": "Very good",
                        "average": 7.6
                    },
                    "content": {
                        "badges": [
                            {
                                "text": "Free cancellation",
                                "variation": "DEFAULT",
                                "type": "CONSTRUCTIVE"
                            }
                        ],
                        "supplier": {
                            "name": "Avis",
                            "rating": {
                                "title": "Good",
                                "subtitle": "22 reviews",
                                "localisedRating": {
                                    "displayValue": "7.6",
                                    "rawValue": 7.6
                                },
                                "average": "7.6"
                            }
                        }
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "route_info": {
                        "pickup": {
                            "location_id": "1707241",
                            "address": "1011 Pike Street, Homewood Suites, Seattle, WA, USA, 98101",
                            "location_hash": "U2VhdHRsZSAtIFBpa2UgU3RyZWV0",
                            "name": "Seattle - Pike Street",
                            "country_code": "US",
                            "latitude": "47.613037",
                            "location_type": "DOWNTOWN",
                            "longitude": "-122.329292"
                        },
                        "dropoff": {
                            "address": "Seattle Tacoma Intl Airport, 3150 South 160Th Street, Seattle (SEA), USA - Other, 98188",
                            "location_id": "4748816",
                            "name": "Seattle-Tacoma International Airport",
                            "country_code": "US",
                            "location_type": "CAR_RENTAL_CENTRE",
                            "latitude": "47.443763",
                            "longitude": "-122.302473"
                        }
                    },
                    "fee_info": {
                        "fee": 0,
                        "tax": 0
                    },
                    "accessibility": {
                        "fuel_policy": "Fuel policy is: Like for like",
                        "supplier_rating": "At this location, our customers have rated Avis as 7.6 out of 10, Good.",
                        "pick_up_location": "Pick-up information: Downtown",
                        "transmission": "Automatic gearbox"
                    }
                },
                {
                    "vehicle_id": "372998811",
                    "freebies": [
                        "Amendments"
                    ],
                    "accessibility": {
                        "fuel_policy": "Fuel policy is: Like for like",
                        "supplier_rating": "At this location, our customers have rated Avis as 7.6 out of 10, Good.",
                        "transmission": "Automatic gearbox",
                        "pick_up_location": "Pick-up information: Downtown"
                    },
                    "route_info": {
                        "dropoff": {
                            "location_type": "CAR_RENTAL_CENTRE",
                            "latitude": "47.443763",
                            "longitude": "-122.302473",
                            "country_code": "US",
                            "address": "Seattle Tacoma Intl Airport, 3150 South 160Th Street, Seattle (SEA), USA - Other, 98188",
                            "location_id": "4748816",
                            "name": "Seattle-Tacoma International Airport"
                        },
                        "pickup": {
                            "longitude": "-122.329292",
                            "location_type": "DOWNTOWN",
                            "latitude": "47.613037",
                            "name": "Seattle - Pike Street",
                            "location_hash": "U2VhdHRsZSAtIFBpa2UgU3RyZWV0",
                            "address": "1011 Pike Street, Homewood Suites, Seattle, WA, USA, 98101",
                            "location_id": "1707241",
                            "country_code": "US"
                        }
                    },
                    "fee_info": {
                        "tax": 0,
                        "fee": 0
                    },
                    "content": {
                        "badges": [
                            {
                                "type": "CONSTRUCTIVE",
                                "variation": "DEFAULT",
                                "text": "Free cancellation"
                            }
                        ],
                        "supplier": {
                            "name": "Avis",
                            "rating": {
                                "title": "Good",
                                "subtitle": "22 reviews",
                                "localisedRating": {
                                    "displayValue": "7.6",
                                    "rawValue": 7.6
                                },
                                "average": "7.6"
                            }
                        }
                    },
                    "rating_info": {
                        "value_for_money": 7.3,
                        "efficiency": 7.6,
                        "dropoff_time": 8.4,
                        "location": 8,
                        "condition": 7.8,
                        "pickup_time": 8.1,
                        "no_of_ratings": 22,
                        "cleanliness": 6.5,
                        "average_text": "Very good",
                        "average": 7.6
                    },
                    "pricing_info": {
                        "drive_away_price_is_approx": true,
                        "base_deposit": 7149.05,
                        "base_price": 7149.05,
                        "base_currency": "INR",
                        "deposit": 85,
                        "pay_when": "PAY_NOW",
                        "quote_allowed": 1,
                        "price": 1.01,
                        "drive_away_price": 1.01,
                        "discount": 0,
                        "fee_breakdown": {
                            "fuel_policy": {
                                "amount": 0,
                                "type": "RETURN_SAME"
                            },
                            "known_fees": [
                                {
                                    "type": "DAMAGE_EXCESS",
                                    "is_tax_included": 1,
                                    "min_amount": 0,
                                    "max_amount": 0,
                                    "currency": "USD",
                                    "is_always_payable": 0,
                                    "amount": 0
                                },
                                {
                                    "type": "DEPOSIT",
                                    "min_amount": 250,
                                    "is_tax_included": 1,
                                    "currency": "USD",
                                    "max_amount": 250,
                                    "is_always_payable": 0,
                                    "amount": 250
                                },
                                {
                                    "currency": "USD",
                                    "max_amount": 0,
                                    "amount": 0,
                                    "is_always_payable": 1,
                                    "type": "ONE_WAY_FEE",
                                    "min_amount": 0,
                                    "is_tax_included": 1
                                },
                                {
                                    "min_amount": 0,
                                    "is_tax_included": 1,
                                    "type": "THEFT_EXCESS",
                                    "amount": 0,
                                    "is_always_payable": 0,
                                    "currency": "USD",
                                    "max_amount": 0
                                },
                                {
                                    "type": "MILEAGE",
                                    "distance_allowed": {
                                        "is_km": 0,
                                        "is_unlimited": 1
                                    },
                                    "is_always_payable": 0
                                }
                            ]
                        },
                        "currency": "USD"
                    },
                    "vehicle_info": {
                        "airbags": 1,
                        "group": "Compact",
                        "label": "Compact car with:",
                        "free_cancellation": 1,
                        "cma_compliant": -1,
                        "transmission": "Automatic",
                        "suitcases": {
                            "big": "0",
                            "small": "0"
                        },
                        "mileage": "Unlimited mileage",
                        "doors": "4",
                        "fuel_type": "N/A",
                        "v_id": "372998811",
                        "aircon": 1,
                        "v_name": "Ford Focus  ",
                        "seats": "5",
                        "fuel_policy": "Like for like",
                        "unlimited_mileage": 1
                    },
                    "supplier_info": {
                        "location_type": "Downtown",
                        "latitude": "47.613037",
                        "longitude": "-122.329292",
                        "address": "1011 Pike Street, Homewood Suites, Seattle, WA, USA, 98101",
                        "name": "Avis",
                        "may_require_credit_card_guarantee": false,
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/47_logo_200.png"
                    }
                },
                {
                    "vehicle_id": "372998806",
                    "supplier_info": {
                        "latitude": "47.613037",
                        "location_type": "Downtown",
                        "longitude": "-122.329292",
                        "address": "1011 Pike Street, Homewood Suites, Seattle, WA, USA, 98101",
                        "may_require_credit_card_guarantee": false,
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/47_logo_200.png",
                        "name": "Avis"
                    },
                    "vehicle_info": {
                        "mileage": "Unlimited mileage",
                        "suitcases": {
                            "small": "0",
                            "big": "0"
                        },
                        "cma_compliant": -1,
                        "transmission": "Automatic",
                        "free_cancellation": 1,
                        "label": "Intermediate car with:",
                        "group": "Intermediate",
                        "airbags": 1,
                        "unlimited_mileage": 1,
                        "fuel_policy": "Like for like",
                        "seats": "5",
                        "v_name": "Chevrolet Cruze  ",
                        "aircon": 1,
                        "v_id": "372998806",
                        "fuel_type": "N/A",
                        "doors": "2/4"
                    },
                    "pricing_info": {
                        "deposit": 89.54,
                        "base_price": 7530.33,
                        "base_currency": "INR",
                        "drive_away_price_is_approx": true,
                        "base_deposit": 7530.33,
                        "currency": "USD",
                        "discount": 0,
                        "fee_breakdown": {
                            "fuel_policy": {
                                "amount": 0,
                                "type": "RETURN_SAME"
                            },
                            "known_fees": [
                                {
                                    "is_tax_included": 1,
                                    "min_amount": 0,
                                    "type": "DAMAGE_EXCESS",
                                    "is_always_payable": 0,
                                    "amount": 0,
                                    "max_amount": 0,
                                    "currency": "USD"
                                },
                                {
                                    "is_always_payable": 0,
                                    "amount": 250,
                                    "currency": "USD",
                                    "max_amount": 250,
                                    "min_amount": 250,
                                    "is_tax_included": 1,
                                    "type": "DEPOSIT"
                                },
                                {
                                    "min_amount": 0,
                                    "is_tax_included": 1,
                                    "type": "ONE_WAY_FEE",
                                    "is_always_payable": 1,
                                    "amount": 0,
                                    "currency": "USD",
                                    "max_amount": 0
                                },
                                {
                                    "amount": 0,
                                    "is_always_payable": 0,
                                    "currency": "USD",
                                    "max_amount": 0,
                                    "min_amount": 0,
                                    "is_tax_included": 1,
                                    "type": "THEFT_EXCESS"
                                },
                                {
                                    "type": "MILEAGE",
                                    "distance_allowed": {
                                        "is_km": 0,
                                        "is_unlimited": 1
                                    },
                                    "is_always_payable": 0
                                }
                            ]
                        },
                        "pay_when": "PAY_NOW",
                        "quote_allowed": 1,
                        "price": 1.06,
                        "drive_away_price": 1.06
                    },
                    "rating_info": {
                        "condition": 7.8,
                        "pickup_time": 8.1,
                        "cleanliness": 6.5,
                        "no_of_ratings": 22,
                        "average_text": "Very good",
                        "average": 7.6,
                        "value_for_money": 7.3,
                        "efficiency": 7.6,
                        "dropoff_time": 8.4,
                        "location": 8
                    },
                    "content": {
                        "badges": [
                            {
                                "type": "CONSTRUCTIVE",
                                "variation": "DEFAULT",
                                "text": "Free cancellation"
                            }
                        ],
                        "supplier": {
                            "name": "Avis",
                            "rating": {
                                "average": "7.6",
                                "localisedRating": {
                                    "rawValue": 7.6,
                                    "displayValue": "7.6"
                                },
                                "subtitle": "22 reviews",
                                "title": "Good"
                            }
                        }
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "route_info": {
                        "pickup": {
                            "country_code": "US",
                            "name": "Seattle - Pike Street",
                            "location_hash": "U2VhdHRsZSAtIFBpa2UgU3RyZWV0",
                            "address": "1011 Pike Street, Homewood Suites, Seattle, WA, USA, 98101",
                            "location_id": "1707241",
                            "longitude": "-122.329292",
                            "location_type": "DOWNTOWN",
                            "latitude": "47.613037"
                        },
                        "dropoff": {
                            "location_type": "CAR_RENTAL_CENTRE",
                            "latitude": "47.443763",
                            "longitude": "-122.302473",
                            "address": "Seattle Tacoma Intl Airport, 3150 South 160Th Street, Seattle (SEA), USA - Other, 98188",
                            "location_id": "4748816",
                            "name": "Seattle-Tacoma International Airport",
                            "country_code": "US"
                        }
                    },
                    "fee_info": {
                        "fee": 0,
                        "tax": 0
                    },
                    "accessibility": {
                        "transmission": "Automatic gearbox",
                        "pick_up_location": "Pick-up information: Downtown",
                        "supplier_rating": "At this location, our customers have rated Avis as 7.6 out of 10, Good.",
                        "fuel_policy": "Fuel policy is: Like for like"
                    }
                },
                {
                    "vehicle_id": "372998801",
                    "fee_info": {
                        "tax": 0,
                        "fee": 0
                    },
                    "route_info": {
                        "dropoff": {
                            "country_code": "US",
                            "address": "Seattle Tacoma Intl Airport, 3150 South 160Th Street, Seattle (SEA), USA - Other, 98188",
                            "location_id": "4748816",
                            "name": "Seattle-Tacoma International Airport",
                            "location_type": "CAR_RENTAL_CENTRE",
                            "latitude": "47.443763",
                            "longitude": "-122.302473"
                        },
                        "pickup": {
                            "longitude": "-122.329292",
                            "location_type": "DOWNTOWN",
                            "latitude": "47.613037",
                            "name": "Seattle - Pike Street",
                            "address": "1011 Pike Street, Homewood Suites, Seattle, WA, USA, 98101",
                            "location_hash": "U2VhdHRsZSAtIFBpa2UgU3RyZWV0",
                            "location_id": "1707241",
                            "country_code": "US"
                        }
                    },
                    "accessibility": {
                        "fuel_policy": "Fuel policy is: Like for like",
                        "supplier_rating": "At this location, our customers have rated Avis as 7.6 out of 10, Good.",
                        "pick_up_location": "Pick-up information: Downtown",
                        "transmission": "Automatic gearbox"
                    },
                    "freebies": [
                        "Amendments"
                    ],
                    "supplier_info": {
                        "name": "Avis",
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/47_logo_200.png",
                        "may_require_credit_card_guarantee": false,
                        "address": "1011 Pike Street, Homewood Suites, Seattle, WA, USA, 98101",
                        "longitude": "-122.329292",
                        "location_type": "Downtown",
                        "latitude": "47.613037"
                    },
                    "pricing_info": {
                        "currency": "USD",
                        "drive_away_price": 1.12,
                        "price": 1.12,
                        "pay_when": "PAY_NOW",
                        "quote_allowed": 1,
                        "fee_breakdown": {
                            "fuel_policy": {
                                "type": "RETURN_SAME",
                                "amount": 0
                            },
                            "known_fees": [
                                {
                                    "max_amount": 0,
                                    "currency": "USD",
                                    "is_always_payable": 0,
                                    "amount": 0,
                                    "type": "DAMAGE_EXCESS",
                                    "is_tax_included": 1,
                                    "min_amount": 0
                                },
                                {
                                    "currency": "USD",
                                    "max_amount": 250,
                                    "amount": 250,
                                    "is_always_payable": 0,
                                    "type": "DEPOSIT",
                                    "min_amount": 250,
                                    "is_tax_included": 1
                                },
                                {
                                    "min_amount": 0,
                                    "is_tax_included": 1,
                                    "type": "ONE_WAY_FEE",
                                    "amount": 0,
                                    "is_always_payable": 1,
                                    "currency": "USD",
                                    "max_amount": 0
                                },
                                {
                                    "max_amount": 0,
                                    "currency": "USD",
                                    "is_always_payable": 0,
                                    "amount": 0,
                                    "type": "THEFT_EXCESS",
                                    "is_tax_included": 1,
                                    "min_amount": 0
                                },
                                {
                                    "is_always_payable": 0,
                                    "distance_allowed": {
                                        "is_unlimited": 1,
                                        "is_km": 0
                                    },
                                    "type": "MILEAGE"
                                }
                            ]
                        },
                        "discount": 0,
                        "base_currency": "INR",
                        "base_price": 7911.61,
                        "deposit": 94.07,
                        "base_deposit": 7911.61,
                        "drive_away_price_is_approx": true
                    },
                    "vehicle_info": {
                        "mileage": "Unlimited mileage",
                        "cma_compliant": -1,
                        "transmission": "Automatic",
                        "suitcases": {
                            "big": "0",
                            "small": "0"
                        },
                        "label": "Standard car with:",
                        "free_cancellation": 1,
                        "group": "Standard",
                        "airbags": 1,
                        "unlimited_mileage": 1,
                        "fuel_policy": "Like for like",
                        "seats": "5",
                        "v_id": "372998801",
                        "v_name": "Buick Verano  ",
                        "aircon": 1,
                        "fuel_type": "N/A",
                        "doors": "4"
                    },
                    "rating_info": {
                        "pickup_time": 8.1,
                        "condition": 7.8,
                        "average": 7.6,
                        "average_text": "Very good",
                        "cleanliness": 6.5,
                        "no_of_ratings": 22,
                        "dropoff_time": 8.4,
                        "value_for_money": 7.3,
                        "efficiency": 7.6,
                        "location": 8
                    },
                    "content": {
                        "supplier": {
                            "rating": {
                                "subtitle": "22 reviews",
                                "title": "Good",
                                "average": "7.6",
                                "localisedRating": {
                                    "displayValue": "7.6",
                                    "rawValue": 7.6
                                }
                            },
                            "name": "Avis"
                        },
                        "badges": [
                            {
                                "text": "Free cancellation",
                                "type": "CONSTRUCTIVE",
                                "variation": "DEFAULT"
                            }
                        ]
                    }
                },
                {
                    "vehicle_id": "372998796",
                    "freebies": [
                        "Amendments"
                    ],
                    "accessibility": {
                        "transmission": "Automatic gearbox",
                        "pick_up_location": "Pick-up information: Downtown",
                        "fuel_policy": "Fuel policy is: Like for like",
                        "supplier_rating": "At this location, our customers have rated Avis as 7.6 out of 10, Good."
                    },
                    "route_info": {
                        "dropoff": {
                            "longitude": "-122.302473",
                            "latitude": "47.443763",
                            "location_type": "CAR_RENTAL_CENTRE",
                            "country_code": "US",
                            "name": "Seattle-Tacoma International Airport",
                            "location_id": "4748816",
                            "address": "Seattle Tacoma Intl Airport, 3150 South 160Th Street, Seattle (SEA), USA - Other, 98188"
                        },
                        "pickup": {
                            "longitude": "-122.329292",
                            "latitude": "47.613037",
                            "location_type": "DOWNTOWN",
                            "name": "Seattle - Pike Street",
                            "location_id": "1707241",
                            "address": "1011 Pike Street, Homewood Suites, Seattle, WA, USA, 98101",
                            "location_hash": "U2VhdHRsZSAtIFBpa2UgU3RyZWV0",
                            "country_code": "US"
                        }
                    },
                    "fee_info": {
                        "fee": 0,
                        "tax": 0
                    },
                    "content": {
                        "supplier": {
                            "name": "Avis",
                            "rating": {
                                "average": "7.6",
                                "localisedRating": {
                                    "displayValue": "7.6",
                                    "rawValue": 7.6
                                },
                                "subtitle": "22 reviews",
                                "title": "Good"
                            }
                        },
                        "badges": [
                            {
                                "text": "Free cancellation",
                                "type": "CONSTRUCTIVE",
                                "variation": "DEFAULT"
                            }
                        ]
                    },
                    "rating_info": {
                        "dropoff_time": 8.4,
                        "efficiency": 7.6,
                        "value_for_money": 7.3,
                        "location": 8,
                        "pickup_time": 8.1,
                        "condition": 7.8,
                        "average_text": "Very good",
                        "average": 7.6,
                        "no_of_ratings": 22,
                        "cleanliness": 6.5
                    },
                    "vehicle_info": {
                        "mileage": "Unlimited mileage",
                        "suitcases": {
                            "small": "0",
                            "big": "0"
                        },
                        "cma_compliant": -1,
                        "transmission": "Automatic",
                        "group": "Full-size",
                        "airbags": 1,
                        "free_cancellation": 1,
                        "label": "Full-size car with:",
                        "fuel_policy": "Like for like",
                        "seats": "5",
                        "unlimited_mileage": 1,
                        "fuel_type": "N/A",
                        "doors": "4",
                        "v_name": "Ford Fusion  ",
                        "aircon": 1,
                        "v_id": "372998796"
                    },
                    "pricing_info": {
                        "base_price": 8369.15,
                        "base_currency": "INR",
                        "deposit": 99.51,
                        "drive_away_price_is_approx": true,
                        "base_deposit": 8369.15,
                        "currency": "USD",
                        "quote_allowed": 1,
                        "pay_when": "PAY_NOW",
                        "drive_away_price": 1.18,
                        "price": 1.18,
                        "discount": 0,
                        "fee_breakdown": {
                            "fuel_policy": {
                                "type": "RETURN_SAME",
                                "amount": 0
                            },
                            "known_fees": [
                                {
                                    "is_always_payable": 0,
                                    "amount": 0,
                                    "max_amount": 0,
                                    "currency": "USD",
                                    "is_tax_included": 1,
                                    "min_amount": 0,
                                    "type": "DAMAGE_EXCESS"
                                },
                                {
                                    "is_tax_included": 1,
                                    "min_amount": 250,
                                    "type": "DEPOSIT",
                                    "amount": 250,
                                    "is_always_payable": 0,
                                    "max_amount": 250,
                                    "currency": "USD"
                                },
                                {
                                    "is_tax_included": 1,
                                    "min_amount": 0,
                                    "type": "ONE_WAY_FEE",
                                    "amount": 0,
                                    "is_always_payable": 1,
                                    "max_amount": 0,
                                    "currency": "USD"
                                },
                                {
                                    "type": "THEFT_EXCESS",
                                    "min_amount": 0,
                                    "is_tax_included": 1,
                                    "currency": "USD",
                                    "max_amount": 0,
                                    "is_always_payable": 0,
                                    "amount": 0
                                },
                                {
                                    "distance_allowed": {
                                        "is_km": 0,
                                        "is_unlimited": 1
                                    },
                                    "is_always_payable": 0,
                                    "type": "MILEAGE"
                                }
                            ]
                        }
                    },
                    "supplier_info": {
                        "address": "1011 Pike Street, Homewood Suites, Seattle, WA, USA, 98101",
                        "name": "Avis",
                        "logo_url": "https://cdn.rcstatic.com/sp/images/suppliers/47_logo_200.png",
                        "may_require_credit_card_guarantee": false,
                        "location_type": "Downtown",
                        "latitude": "47.613037",
                        "longitude": "-122.329292"
                    }
                }
            ],
            "title": "Car rentals"
        }
    }
]

2025-08-25 11:52:01,750 - evaluation_logger_Cross-118 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 概述

本文，我们来分享 [《精尽 Spring Boot 源码分析 —— 自动配置》](http://svip.iocoder.cn/Spring-Boot/AutoConfiguration/) 的**源码解析**。

在 Spring Boot 中，自动配置类是 `spring-boot-autoconfigure` 项目。在 `META-INF/spring.factories` 文件中，声明了有哪些自动配置类。如下图所示：

![`spring.factories`](第二章.assets/01.png)

# 2. 自动配置类

我们以 `org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration` 举例子，来看看一个典型的自动配置类，有哪些要素。代码如下：

```java
// RedisAutoConfiguration.java

@Configuration(proxyBeanMethods = false)
@ConditionalOnClass(RedisOperations.class)
@EnableConfigurationProperties(RedisProperties.class)
@Import({ LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class })
public class RedisAutoConfiguration {

	@Bean
	@ConditionalOnMissingBean(name = "redisTemplate")
	public RedisTemplate<Object, Object> redisTemplate(RedisConnectionFactory redisConnectionFactory) {
		RedisTemplate<Object, Object> template = new RedisTemplate<>();
		template.setConnectionFactory(redisConnectionFactory);
		return template;
	}

	@Bean
	@ConditionalOnMissingBean
	public StringRedisTemplate stringRedisTemplate(RedisConnectionFactory redisConnectionFactory) {
		StringRedisTemplate template = new StringRedisTemplate();
		template.setConnectionFactory(redisConnectionFactory);
		return template;
	}

}
```

- `@Configuration` 注解，声明这是一个 Spring 配置类。
- `@ConditionalOnClass` 注解，表示需要有 `RedisOperations.class` 类。也就是说，如果我们引入了 Redis 相关的依赖，才会有该配置类。
- `@EnableConfigurationProperties` 注解，让 `RedisProperties` 配置属性类生效。后续，`RedisTemplate` 会使用到 `RedisProperties` 的属性值。
- `@Import` 注解，导入另外两个配置类。
- 两个 `@Bean` 方法，创建 `redisTemplate` 和 `stringRedisTemplate` 两个 Bean 对象。并且，`@ConditionalOnMissingBean` 注解，表示如果当前已经有对应的 Bean 对象，则不会创建。

😈 是不是很简单。自动配置类，本质上就是一个 Spring 配置类，只是搭配了各种条件注解，用于在符合条件的情况下，创建相应的 Bean 们。

# 3. 条件注解

在 Spring Boot 中，提供了丰富的条件注解，用于在不同条件下，创建相应的 Bean 们。我们来逐个瞅一眼。

## 3.1 @Conditional

`@Conditional` 注解，是 Spring 4.0 提供的新特性，用于根据特定条件来控制 Bean 的创建行为。而在 Spring Boot 中，大量基于 `@Conditional` 注解，提供了各种条件注解。例如说：

- `@ConditionalOnClass`：当类存在情况下。
- `@ConditionalOnMissingClass`：当类不存在情况下。
- `@ConditionalOnBean`：当 Bean 存在情况下。
- `@ConditionalOnMissingBean`：当 Bean 不存在情况下。
- `@ConditionalOnProperty`：当配置属性满足情况下。
- … 等等等。

## 3.2 @ConditionalOnClass

`@ConditionalOnClass` 注解，当指定的**类**存在情况下，创建相应的 Bean 。代码如下：

```java
// ConditionalOnClass.java

@Target({ ElementType.TYPE, ElementType.METHOD })
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Conditional(OnClassCondition.class)
public @interface ConditionalOnClass {

	/**
	 * The classes that must be present. Since this annotation is parsed by loading class
	 * bytecode, it is safe to specify classes here that may ultimately not be on the
	 * classpath.
	 * @return the classes that must be present
	 */
	Class<?>[] value() default {};

	/**
	 * The classes names that must be present.
	 * @return the class names that must be present.
	 */
	String[] name() default {};

}
```

- 注意，`@Conditional(OnClassCondition.class)` 注解，表示使用 `OnClassCondition` 条件类。

## 3.3 @ConditionalOnMissingClass

`@ConditionalOnMissingClass` 注解，和 `@ConditionalOnClass` 注解**相反**，当指定的**类**不存在情况下，创建相应的 Bean 。代码如下：

```java
// ConditionalOnMissingClass.java

@Target({ ElementType.TYPE, ElementType.METHOD })
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Conditional(OnClassCondition.class)
public @interface ConditionalOnMissingClass {

	/**
	 * The classes names that must be present.
	 * @return the class names that must be present.
	 */
	String[] value() default {};

}
```

- 注意，`@Conditional(OnClassCondition.class)` 注解，表示使用 `OnClassCondition` 条件类。

## 3.4 @ConditionalOnBean

`@ConditionalOnBean` 注解，当指定的** Bean **存在情况下，创建相应的 Bean 。代码如下：

```java
// ConditionalOnBean.java

@Target({ ElementType.TYPE, ElementType.METHOD })
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Conditional(OnBeanCondition.class)
public @interface ConditionalOnBean {

	/**
	 * The class types of beans that should be checked. The condition matches when any of
	 * the classes specified is contained in the {@link ApplicationContext}.
	 * @return the class types of beans to check
	 */
	Class<?>[] value() default {};

	/**
	 * The class type names of beans that should be checked. The condition matches when any
	 * of the classes specified is contained in the {@link ApplicationContext}.
	 * @return the class type names of beans to check
	 */
	String[] type() default {};

	/**
	 * The annotation type decorating a bean that should be checked. The condition matches
	 * when any of the annotations specified is defined on a bean in the
	 * {@link ApplicationContext}.
	 * @return the annotation-type of beans to check
	 */
	Class<? extends Annotation>[] annotation() default {};

	/**
	 * The names of beans to check. The condition matches when any of the bean names
	 * specified is contained in the {@link ApplicationContext}.
	 * @return the names of beans to check
	 */
	String[] name() default {};

	/**
	 * Strategy to decide if the application context hierarchy (parent contexts) should be
	 * considered.
	 * @return the search strategy
	 */
	SearchStrategy search() default SearchStrategy.ALL;

	/**
	 * Additional classes that may contain the specified bean types within their generic
	 * parameters. For example, an annotation declaring {@code value=Name.class} and
	 * {@code parameterizedContainer=NameRegistration.class} would detect both
	 * {@code Name} and {@code NameRegistration<Name>}.
	 * @return the container types
	 * @since 2.1.0
	 */
	Class<?>[] parameterizedContainer() default {};

}
```

- 注意，`@Conditional(OnBeanCondition.class)` 注解，表示使用 `OnBeanCondition` 条件类。

## 3.5 @ConditionalOnMissingBean

`@ConditionalOnMissingBean` 注解，和 `@ConditionalOnBean` 注解**相反**，当指定的** Bean **不存在情况下，创建相应的 Bean 。代码如下：

```java
// ConditionalOnMissingBean.java

@Target({ ElementType.TYPE, ElementType.METHOD })
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Conditional(OnBeanCondition.class)
public @interface ConditionalOnMissingBean {

	/**
	 * The class types of beans that should be checked. The condition matches when all of
	 * the classes specified are not contained in the {@link ApplicationContext}.
	 * @return the class types of beans to check
	 */
	Class<?>[] value() default {};

	/**
	 * The class type names of beans that should be checked. The condition matches when all
	 * of the classes specified are not contained in the {@link ApplicationContext}.
	 * @return the class type names of beans to check
	 */
	String[] type() default {};

	/**
	 * The annotation type decorating a bean that should be checked. The condition matches
	 * when all of the annotations specified are not defined on a bean in the
	 * {@link ApplicationContext}.
	 * @return the annotation-type of beans to check
	 */
	Class<? extends Annotation>[] annotation() default {};

	/**
	 * The names of beans to check. The condition matches when all of the bean names
	 * specified are not contained in the {@link ApplicationContext}.
	 * @return the names of beans to check
	 */
	String[] name() default {};

	/**
	 * Strategy to decide if the application context hierarchy (parent contexts) should be
	 * considered.
	 * @return the search strategy
	 */
	SearchStrategy search() default SearchStrategy.ALL;

	/**
	 * Additional classes that may contain the specified bean types within their generic
	 * parameters. For example, an annotation declaring {@code value=Name.class} and
	 * {@code parameterizedContainer=NameRegistration.class} would detect both
	 * {@code Name} and {@code NameRegistration<Name>}.
	 * @return the container types
	 * @since 2.1.0
	 */
	Class<?>[] parameterizedContainer() default {};

}
```

- 注意，`@Conditional(OnBeanCondition.class)` 注解，表示使用 `OnBeanCondition` 条件类。

## 3.6 @ConditionalOnProperty

`@ConditionalOnProperty` 注解，当配置属性满足指定条件情况下，创建相应的 Bean 。代码如下：

```java
// ConditionalOnProperty.java

@Retention(RetentionPolicy.RUNTIME)
@Target({ ElementType.TYPE, ElementType.METHOD })
@Documented
@Conditional(OnPropertyCondition.class)
public @interface ConditionalOnProperty {

	/**
	 * Alias for {@link #name()}.
	 * @return the names
	 */
	String[] value() default {};

	/**
	 * A prefix that should be applied to each property. The prefix automatically ends
	 * with a dot if not specified. A valid prefix is defined by one or more words
	 * separated with dots.
	 * @return the prefix
	 */
	String prefix() default {};

	/**
	 * The name of the properties to test. If a prefix has been defined, it is applied to
	 * compute the full key of each property. For instance if the prefix is
	 * {@code app.config} and one value is {@code my-value}, the full key would be
	 * {@code app.config.my-value}
	 * <p>
	 * Use the dashed notation to specify each property, that is all lower case with a "-"
	 * to separate words (e.g. {@code my-long-property}).
	 * @return the names
	 */
	String[] name() default {};

	/**
	 * The string representation of the expected value for the properties. If not
	 * specified, the property must <strong>not</strong> be equal to {@code false}.
	 * @return the expected value
	 */
	String havingValue() default {};

	/**
	 * Specify if the condition should match if the property is not set. Defaults to
	 * {@code false}.
	 * @return if should match if the property is missing
	 */
	boolean matchIfMissing() default false;

}
```

- 注意，`@Conditional(OnPropertyCondition.class)` 注解，表示使用 `OnPropertyCondition` 条件类。

## 3.7 其它

其它还有 `@ConditionalOnWebApplication`、`@ConditionalOnNotWebApplication`、`@ConditionalOnExpression`、`@ConditionalOnJava`、`@ConditionalOnJndi`、`@ConditionalOnSingleCandidate`、`@ConditionalOnResource` 等等，胖友自己去瞅瞅。

# 4. 条件判断

在 Spring Boot 中，提供了 ConditionEvaluator 类，用于条件判断。具体的实现，是交给 `org.springframework.context.annotation.Condition` 接口的具体实现类。例如说，我们在[「3.2 @ConditionalOnClass」](http://svip.iocoder.cn/Spring-Boot/AutoConfiguration/#)提到的 `OnClassCondition` 类。

## 4.1 ConditionEvaluator

`org.springframework.context.annotation.ConditionEvaluator` 类，负责处理条件判断。代码如下：

```java
// ConditionEvaluator.java

class ConditionEvaluator {

	private final ConditionContextImpl context;

	public ConditionEvaluator(@Nullable BeanDefinitionRegistry registry,
			@Nullable Environment environment, @Nullable ResourceLoader resourceLoader) {
		this.context = new ConditionContextImpl(registry, environment, resourceLoader);
	}

	public boolean shouldSkip(AnnotatedTypeMetadata metadata) {
		return shouldSkip(metadata, null);
	}

	public boolean shouldSkip(@Nullable AnnotatedTypeMetadata metadata, @Nullable ConfigurationPhase phase) {
		// <1> 如果元数据为空，或者未被 @Conditional 注解，则不跳过
		if (metadata == null || !metadata.isAnnotated(Conditional.class.getName())) {
			return false;
		}
		// <2> 如果 phase 为空，则根据元数据解析
		if (phase == null) {
			if (metadata instanceof AnnotationMetadata &&
					ConfigurationClassUtils.isConfigurationCandidate((AnnotationMetadata) metadata)) {
				return shouldSkip(metadata, ConfigurationPhase.PARSE_CONFIGURATION);
			}
			return shouldSkip(metadata, ConfigurationPhase.REGISTER_BEAN);
		}
		// <3> 获得 Condition 数组
		List<Condition> conditions = new ArrayList<>();
		for (String[] conditionClasses : getConditionClasses(metadata)) {
			for (String conditionClass : conditionClasses) {
				Condition condition = getCondition(conditionClass, this.context.getClassLoader());
				conditions.add(condition);
			}
		}
		// <4> 排序
		AnnotationAwareOrderComparator.sort(conditions);
		// <5> 遍历 Condition 数组，逐个判断
		for (Condition condition : conditions) {
			ConfigurationPhase requiredPhase = null;
			if (condition instanceof ConfigurationCondition) {
				requiredPhase = ((ConfigurationCondition) condition).getConfigurationPhase();
			}
			// <5.1> 判断是否匹配
			if ((requiredPhase == null || requiredPhase == phase) && !condition.matches(this.context, metadata)) {
				return true;
			}
		}
		// <6> 不跳过
		return false;
	}

	private List<String[]> getConditionClasses(AnnotatedTypeMetadata metadata) {
		// ... 省略代码
	}

	private Condition getCondition(String conditionClassName, ClassLoader classloader) {
		// ... 省略代码
	}

}
```

- `<1>` 处，如果元数据为空，或者未被 `@Conditional` 注解，则不跳过。
- `<2>` 处，如果 `phase` 为空，则根据元数据解析。其中，`ConfigurationPhase` 枚举，有两个值：
  - `PARSE_CONFIGURATION`：配置类处理时。
  - `REGISTER_BEAN`：Bean 注册时。
- `<3>` 处，获得 `Condition` 数组。即，从 `@Conditional` 注解中，获得其配置的 Condition 实现类们。
- `<4>` 处，排序 Condition 数组。
- `<5>` 处，遍历 Condition 数组，逐个调用 `Condition#matches(...)` 方法，判断是否匹配。
  - `<5.1>` 处，如果匹配失败，则返回 `true` ，表示跳过。
- `<6>` 处，返回 `false` ，表示不跳过。

## 4.2 ConfigurationCondition

`org.springframework.context.annotation.ConfigurationCondition` 接口，继承 `Condition` 接口，增加获得配置阶段的方法。代码如下：

```java
// ConfigurationCondition.java

public interface ConfigurationCondition extends Condition {

	/**
	 * Return the {@link ConfigurationPhase} in which the condition should be evaluated.
	 */
	ConfigurationPhase getConfigurationPhase();

	/**
	 * The various configuration phases where the condition could be evaluated.
	 */
	enum ConfigurationPhase {

		/**
		 * The condition should be evaluated when the {@link Configuration} class is first
		 * being parsed.
		 * <p>If the condition does not match at this point, the {@code Configuration} class
		 * will not be added.
		 */
		PARSE_CONFIGURATION,

		/**
		 * The condition should be evaluated when adding a regular (non {@link Configuration})
		 * bean. The condition will not prevent the {@code Configuration} class from being
		 * added.
		 * <p>At the time that the condition is evaluated, all {@code Configuration} classes
		 * will have been parsed.
		 */
		REGISTER_BEAN
	}

}
```

- 有两个实现类：
  - `org.springframework.boot.autoconfigure.condition.SpringBootCondition`：Spring Boot Condition 的基类。
  - `org.springframework.boot.autoconfigure.condition.OnBeanCondition`：`@ConditionalOnBean` 和 `@ConditionalOnMissingBean` 的 Condition 实现类。
  - `org.springframework.boot.autoconfigure.condition.OnClassCondition`：`@ConditionalOnClass` 和 `@ConditionalOnMissingClass` 的 Condition 实现类。
  - `org.springframework.boot.autoconfigure.condition.OnWebApplicationCondition`：`@ConditionalOnWebApplication` 和 `@ConditionalOnNotWebApplication` 的 Condition 实现类。
  - `org.springframework.boot.autoconfigure.condition.OnPropertyCondition`：`@ConditionalOnProperty` 的 Condition 实现类。

## 4.3 SpringBootCondition

`org.springframework.boot.autoconfigure.condition.SpringBootCondition` 抽象类，实现 `ConfigurationCondition` 接口，是 Spring Boot Condition 的基类。代码如下：

```java
// SpringBootCondition.java

public abstract class SpringBootCondition implements ConfigurationCondition {

	@Override
	public ConfigurationPhase getConfigurationPhase() {
		return ConfigurationPhase.PARSE_CONFIGURATION;
	}

	@Override
	public final boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {
		// <1> 获得注解的是方法名还是类
		String classOrMethodName = getClassOrMethodName(metadata);
		try {
			// <2> 抽象方法，交给子类实现
			ConditionOutcome outcome = getMatchOutcome(context, metadata);
			// <3> 打印日志
			logOutcome(classOrMethodName, outcome);


2025-08-25 11:52:06,980 - evaluation_logger_Cross-118 - INFO - Complete Result: {'score': 0, 'reason': "The response does not address any of the requested information in the user's query."}
2025-08-25 11:52:13,707 - evaluation_logger_Cross-118 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 11:52:13,707 - evaluation_logger_Cross-118 - INFO - Message: Success.
2025-08-25 11:52:13,707 - evaluation_logger_Cross-118 - INFO - Success turn num = 3
2025-08-25 11:52:13,707 - evaluation_logger_Cross-118 - INFO - ----------------------------------------------------------------------------------------------------
