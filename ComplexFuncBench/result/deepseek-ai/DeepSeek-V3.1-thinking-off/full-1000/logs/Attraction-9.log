2025-08-25 12:53:26,493 - evaluation_logger_Attraction-9 - INFO - Test Example Attraction-9
2025-08-25 12:53:26,493 - evaluation_logger_Attraction-9 - INFO - Query: Check out the most trending tourist spots in Sydney for my family trip.
2025-08-25 12:53:33,589 - evaluation_logger_Attraction-9 - INFO - Function Calls: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Sydney"
        }
    }
]

2025-08-25 12:53:33,590 - evaluation_logger_Attraction-9 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "Sydney"
        }
    },
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0xNjAzMTM1fQ==",
            "sortBy": "trending"
        }
    }
]

2025-08-25 12:53:33,590 - evaluation_logger_Attraction-9 - INFO - Start compare_single_call: 
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Sydney'}}
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Sydney'}}
2025-08-25 12:53:33,590 - evaluation_logger_Attraction-9 - INFO - Rule-based compare success.
2025-08-25 12:53:33,590 - evaluation_logger_Attraction-9 - INFO - Success matched: [{'name': 'Search_Attraction_Location', 'arguments': {'query': 'Sydney'}}]
2025-08-25 12:53:33,590 - evaluation_logger_Attraction-9 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "products": [
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFIxSDIzY2lWMjRNIiwidWZpIjotMTYwMzEzNX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Sydney CBD to Sydney Airport",
                    "productId": "PR1H23ciV24M",
                    "productSlug": "pr1h23civ24m-sydney-cbd-to-sydney-airport",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -1603135,
                    "cityName": "Sydney",
                    "countryCode": "au"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFI2aEw5YUhrdmhoIiwidWZpIjotMTYwMzEzNX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Shared Sydney Airport Transfers for Sydney",
                    "productId": "PR6hL9aHkvhh",
                    "productSlug": "pr6hl9ahkvhh-shared-sydney-airport-transfers-for-sydney",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -1603135,
                    "cityName": "Sydney",
                    "countryCode": "au"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJsTGZwTWlodk1NIiwidWZpIjotMTYwMzEzNX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Private Sydney Airport-Sydney CBD, Sydney City, Cruise Terminal",
                    "productId": "PRlLfpMihvMM",
                    "productSlug": "prllfpmihvmm-sydney-airport-to-cbd-and-suburbs-and-blue-mountain-transfer",
                    "taxonomySlug": "transfers-services",
                    "cityUfi": -1603135,
                    "cityName": "Sydney",
                    "countryCode": "au"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJxRWljZE05akd4IiwidWZpIjotMTYwMzEzNX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Discover Sydney",
                    "productId": "PRqEicdM9jGx",
                    "productSlug": "prqeicdm9jgx-discover-sydney",
                    "taxonomySlug": "tours",
                    "cityUfi": -1603135,
                    "cityName": "Sydney",
                    "countryCode": "au"
                },
                {
                    "id": "eyJwaW5uZWRQcm9kdWN0IjoiUFJ5ODVrMW9ubXZtIiwidWZpIjotMTYwMzEzNX0=",
                    "__typename": "AttractionsSearchProductSuggestion",
                    "title": "Self-Guided Sydney Scavenger Hunt: Inside Sydney",
                    "productId": "PRy85k1onmvm",
                    "productSlug": "pry85k1onmvm-scavenger-hunt-inside-sydney",
                    "taxonomySlug": "tours",
                    "cityUfi": -1603135,
                    "cityName": "Sydney",
                    "countryCode": "au"
                }
            ],
            "destinations": [
                {
                    "id": "eyJ1ZmkiOi0xNjAzMTM1fQ==",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": -1603135,
                    "country": "Australia",
                    "cityName": "Sydney",
                    "productCount": 546,
                    "cc1": "au"
                }
            ]
        }
    }
]

2025-08-25 12:53:44,310 - evaluation_logger_Attraction-9 - INFO - Function Calls: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0xNjAzMTM1fQ==",
            "sortBy": "trending"
        }
    }
]

2025-08-25 12:53:44,310 - evaluation_logger_Attraction-9 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0xNjAzMTM1fQ==",
            "sortBy": "trending"
        }
    }
]

2025-08-25 12:53:44,310 - evaluation_logger_Attraction-9 - INFO - Start compare_single_call: 
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0xNjAzMTM1fQ==', 'sortBy': 'trending'}}
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0xNjAzMTM1fQ==', 'sortBy': 'trending'}}
2025-08-25 12:53:44,310 - evaluation_logger_Attraction-9 - INFO - Rule-based compare success.
2025-08-25 12:53:44,310 - evaluation_logger_Attraction-9 - INFO - Success matched: [{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0xNjAzMTM1fQ==', 'sortBy': 'trending'}}]
2025-08-25 12:53:44,311 - evaluation_logger_Attraction-9 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProductSearchResponse",
            "products": [
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRZp5qoBsedv",
                    "name": "Sydney Tower Eye Experience",
                    "slug": "przp5qobsedv-sydney-tower-eye-experience",
                    "shortDescription": "A tour to admire Sydney's attractions from a high point of view",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 17.74,
                        "currency": "USD",
                        "publicAmount": 17.74
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 66,
                        "percentage": "92%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.2,
                            "total": 239
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Sydney",
                        "ufi": -1603135
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIw6UTiF83XW"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI4f4X4NAJaH"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIA2MbewVAaE"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIIhYUdPUCBl"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OISh8ToJI3wj"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIUIwgRvH9Ni"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OICYvFRm4fmG"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIv6QWf1mcX0"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIecErJIfKbV"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OItfiasKBW6G"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIZt7IbS5MQG"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIPYZYHXVoMX"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIQ3HHhnz1Lw"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIf7WWqjfIEJ"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI9ycGtHKV7q"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI1cYTto9NeD"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIlFq9FXbeRA"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIU21rrzMwaj"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIiRikKhceUm"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI9YMQ7NKCTD"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIMu8Zl6QkNv"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerOnWeekends",
                            "value": true,
                            "rank": 3
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForLandmarks",
                            "value": true,
                            "rank": 1
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRwIFqZ0fA7c",
                    "name": "Sydney Opera House Official Guided Walking Tour",
                    "slug": "prwifqz0fa7c-sydney-opera-house-official-guided-walking-tour",
                    "shortDescription": "A one-hour tour to discover the iconic building",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 30.23,
                        "currency": "USD",
                        "publicAmount": 30.23
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 41,
                        "percentage": "88%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.7,
                            "total": 1215
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Sydney",
                        "ufi": -1603135
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIItAVA5DmbW"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIu7reP5vaH9"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIZFlA03QYTJ"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIvC54iTRqE5"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIbJLEwBIAYN"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIsY6oyfjNm5"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIOkcqCKvufT"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OITk6GTXm1dy"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIn4QA9CdW56"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI3B3wwNFGz3"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI0deBh9qlKU"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OItvcDprdaBk"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIr8hIEd3h4M"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIrsRhIaAc4K"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIjZnGNS9Ndt"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForLandmarks",
                            "value": true,
                            "rank": 3
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRCb09t3m9Mp",
                    "name": "SEA LIFE Admission",
                    "slug": "prcb09t3m9mp-sea-life-admission-with-combo-option",
                    "shortDescription": "A chance to visit the Sydney Aquarium",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 27.41,
                        "currency": "USD",
                        "publicAmount": 27.41
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 252,
                        "percentage": "92%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.4,
                            "total": 264
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Sydney",
                        "ufi": -1603135
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIGAt0whnyWd"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIqluMq51Bgp"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIz6Yj8IhESD"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI4LyV6i0UbJ"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIBHC3nYygfl"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIrI5S5xbJsi"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIPnCREImjX4"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OISAqJ2t98gk"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIE1CPkm0gpE"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIXFaQqYotey"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIKnpQwez4Mf"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIt5c5qG3mgB"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIPXkfKrGwiM"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIiheEx4y5oJ"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI1kIC9ggiJO"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIB6wSF9S0FA"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIJ45dMlntOL"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIp3cjUT6zCc"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 4
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInMonth",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInWeek",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerOnWeekends",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForAttractions",
                            "value": true,
                            "rank": 1
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRrnSsEJpfNb",
                    "name": "General Admission to Sydney Taronga Zoo",
                    "slug": "prrnssejpfnb-general-admission-to-sydney-taronga-zoo",
                    "shortDescription": "A visit to Australia's largest zoo to see and learn about its animals",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 35.61,
                        "currency": "USD",
                        "publicAmount": 35.61
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 43,
                        "percentage": "91%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.4,
                            "total": 202
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Sydney",
                        "ufi": -1603135
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIu1BoDhIC70"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIcC8UuPUCZo"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIuDhS5evIMg"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 7
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForAttractions",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "popularFor3Travelers",
                            "value": true,
                            "rank": 2
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PR60KFUjtYx8",
                    "name": "Sydney Whale Watching Adventure Cruise",
                    "slug": "pr60kfujtyx8-sydney-whale-watching-adventure-cruise",
                    "shortDescription": "This catamaran gets you to the open ocean in no time, ensuring customers get more whale watching ...",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 57.11,
                        "currency": "USD",
                        "publicAmount": 57.11
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 3.7,
                            "total": 39
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "Sydney",
                        "ufi": -1603135
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI6rtgEcwz65"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIYx1zZMO7NR"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI6mzoI4BzHS"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    }
                }
            ],
            "filterStats": {
                "__typename": "FilterStats",
                "unfilteredProductCount": 546,
                "filteredProductCount": 546
            },
            "sorters": [
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Our top picks",
                    "value": "trending"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Most popular",
                    "value": "attr_book_score"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Lowest price",
                    "value": "lowest_price"
                }
            ],
            "defaultSorter": {
                "__typename": "AttractionsSorterOption",
                "name": "Our top picks",
                "value": "trending"
            },
            "filterOptions": {
                "__typename": "FilterOptions",
                "typeFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Tours",
                        "tagname": "tours",
                        "productCount": 147
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Nature & outdoor",
                        "tagname": "nature-outdoor",
                        "productCount": 111
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Entertainment & tickets",
                        "tagname": "entertainment-tickets",
                        "productCount": 63
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Museums, arts & culture",
                        "tagname": "museums-arts-culture",
                        "productCount": 59
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Food & drinks",
                        "tagname": "food-drinks",
                        "productCount": 30
                    }
                ],
                "labelFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Free cancellation",
                        "tagname": "free_cancellation",
                        "productCount": 500
                    }
                ],
                "ufiFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Sydney",
                        "tagname": "-1603135",
                        "productCount": 546
                    }
                ],
                "priceFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "US$0 - US$22",
                        "tagname": "b0",
                        "productCount": 41
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$22 - US$44",
                        "tagname": "b1",
                        "productCount": 69
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$44 - US$83",
                        "tagname": "b2",
                        "productCount": 97
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$83 - US$138",
                        "tagname": "b3",
                        "productCount": 77
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$138+",
                        "tagname": "b4",
                        "productCount": 273
                    }
                ]
            }
        }
    }
]

2025-08-25 12:56:53,895 - evaluation_logger_Attraction-9 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 前言

在上一篇文章中，我们实现了`axios`的请求和响应配置化，即用户可以配置`config`对象中的`url`、`method`、`params`、`data`、`headers`、`timeout`、`responseType`等属性。其中，`headers`配置对象中的`Content-Type`属性是告诉服务器我们发送过去的数据是什么格式的，而`responseType`属性是告诉服务器我们期望返回的数据是什么格式的。另外，我们还实现了配置的默认值和配置合并策略。

但是，在之前的案例中，我们虽然可以配置`data`为任意类型，但是真正发送给服务器的数据是`JSON`字符串格式，这是因为我们之前在对`data`做处理的时候只是简单的调用了`JSON.stringify`进行序列化，并且默认请求头中的`Content-Type`是`application/json;charset=utf-8`，所以服务器收到请求后按照`JSON`字符串格式来解析的。

然而，在实际项目中，我们可能并不总是需要`JSON`字符串格式，有时候还需要表单字符串格式，即`key1=value1&key2=value2`这种格式，并且请求头中的`Content-Type`也要设置为`application/x-www-form-urlencoded`；有时候可能还需要表单格式，即`multipart/form-data`格式，并且请求头中的`Content-Type`也要设置为`multipart/form-data`。

那么，接下来，我们就来实现`axios`对多种数据格式的支持。

# 2. 需求分析

我们希望能够让用户配置`data`的格式，根据配置的格式，我们来自动设置请求头`Content-Type`，并且自动将`data`转换成对应格式。根据需求，我们希望能够支持三种数据格式：

- `application/json`：请求体中的数据会以`json`字符串的形式发送到后端
- `application/x-www-form-urlencoded`：请求体中的数据会以普通表单形式（键值对）发送到后端
- `multipart/form-data`：它会将请求体的数据处理为一条消息，以标签为单元，用分隔符分开。既可以上传键值对，也可以上传文件

# 3. 实现 application/x-www-form-urlencoded 格式

## 3.1 修改请求头 Content-Type

首先，我们需要修改请求头`Content-Type`，当用户配置`data`为普通对象的时候，并且没有设置`headers['Content-Type']`的时候，我们应该自动设置请求头`Content-Type`为：`application/x-www-form-urlencoded;charset=utf-8`。

我们在`src/core/xhr.ts`中的`processConfig`函数里添加对请求头的处理：

```typescript
// src/core/xhr.ts

import { isPlainObject } from "../helpers/util";

function processConfig(config: AxiosRequestConfig): void {
  config.url = transformUrl(config);
  config.headers = transformHeaders(config);
  config.data = transformRequestData(config);
}

function transformHeaders(config: AxiosRequestConfig): any {
  const { headers = {}, data } = config;
  if (isPlainObject(data)) {
    if (headers && !headers["Content-Type"]) {
      headers["Content-Type"] = "application/x-www-form-urlencoded;charset=utf-8";
    }
  }
  return headers;
}
```

我们通过`isPlainObject`工具函数判断`data`是不是普通对象，如果是的话，并且用户没有配置`headers['Content-Type']`，我们就自动设置请求头`Content-Type`为`application/x-www-form-urlencoded;charset=utf-8`。

## 3.2 转换请求数据 data

当请求头`Content-Type`为`application/x-www-form-urlencoded;charset=utf-8`的时候，我们需要将`data`转换为表单字符串，即`key1=value1&key2=value2`这种格式。

我们创建一个新的模块`src/helpers/data.ts`，并且在该模块中实现一个`transformRequestData`函数，用来转换请求数据。

```typescript
// src/helpers/data.ts

import { isPlainObject } from "./util";

export function transformRequestData(data: any): any {
  if (isPlainObject(data)) {
    return JSON.stringify(data);
  }
  return data;
}
```

目前，我们只对普通对象做了转换，并且还是转换成`JSON`字符串，这显然不是我们想要的，我们需要将其转换为表单字符串。所以，我们需要再写一个将普通对象转换为表单字符串的函数。

```typescript
// src/helpers/data.ts

import { isPlainObject } from "./util";

export function transformRequestData(data: any): any {
  if (isPlainObject(data)) {
    return JSON.stringify(data);
  }
  return data;
}

export function transformFormDataToUrlencoded(data: any): string {
  if (!isPlainObject(data)) {
    return data;
  }
  let str = "";
  for (const key in data) {
    if (data.hasOwnProperty(key)) {
      let value = data[key];
      if (typeof value !== "string") {
        value = JSON.stringify(value);
      }
      str += `&${key}=${encodeURIComponent(value)}`;
    }
  }
  return str.substring(1);
}
```

我们创建了一个`transformFormDataToUrlencoded`函数，该函数接收一个参数`data`，首先判断`data`是不是普通对象，如果不是，直接返回；如果是，则遍历该对象，将对象的键值对拼接成`key=value`的形式，并且用`&`连接起来，最后返回。注意：在拼接的时候，我们调用了`encodeURIComponent`对`value`进行编码，这是为了防止`value`中有特殊字符导致服务端解析错误。

另外，我们还需要修改`transformRequestData`函数，当`data`是普通对象的时候，我们将其转换为表单字符串。

```typescript
// src/helpers/data.ts

export function transformRequestData(data: any): any {
  if (isPlainObject(data)) {
    return transformFormDataToUrlencoded(data);
  }
  return data;
}
```

OK，请求数据转换函数写好了，接下来我们在`src/core/xhr.ts`中引入并使用。

```typescript
// src/core/xhr.ts

import { transformRequestData } from "../helpers/data";

function processConfig(config: AxiosRequestConfig): void {
  config.url = transformUrl(config);
  config.headers = transformHeaders(config);
  config.data = transformRequestData(config);
}
```

## 3.3 demo 编写

好了，实现之后，我们编写`demo`来测试下是否好用。

我们在`examples`目录下创建`moreParams`目录，并在该目录下创建`index.html`:

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>moreParams demo</title>
  </head>
  <body>
    <script src="/__build__/moreParams.js"></script>
  </body>
</html>
```

然后创建`app.ts`：

```typescript
import axios from "../../src/index";

axios({
  method: "post",
  url: "/api/moreParams/post",
  data: {
    a: 1,
    b: 2,
  },
});
```

接着在`server.js`中添加路由：

```javascript
// 添加更多参数测试接口
router.post("/api/moreParams/post", function(req, res) {
  res.json(req.body);
});
```

最后在根目录下的`index.html`中加上启动该`demo`的入口：

```html
<li><a href="examples/moreParams">moreParams</a></li>
```

OK,我们在命令行中执行：

```bash
# 同时开启客户端和服务端
npm run server | npm start
```

接着我们打开`chrome`浏览器，访问<http://localhost:8000/> 接着我们点击`moreParams`，通过`F12`的`network`部分我们可以看到请求已经正常发出，并且请求头中的`Content-Type`已经自动被设置为`application/x-www-form-urlencoded;charset=utf-8`，并且请求数据也被转换成了表单字符串`a=1&b=2`。

![](~@/axios/08/01.gif)

# 4. 实现 multipart/form-data 格式

虽然我们实现了`application/x-www-form-urlencoded`格式，但是这种格式有两个缺点：

- 无法传输文件
- 如果数据量很大，这种格式的数据会非常长，而且效率低下

所以，我们还需要实现`multipart/form-data`格式，这种格式既可以上传文件，也可以上传键值对，它采用了键值对的方式，所以可以上传多个文件。

## 4.1 修改请求头 Content-Type

首先，我们需要修改请求头`Content-Type`，当用户配置`data`为`FormData`类型的时候，我们应该自动设置请求头`Content-Type`为：`multipart/form-data`。

我们在`src/core/xhr.ts`中的`transformHeaders`函数里添加对`FormData`的判断：

```typescript
// src/core/xhr.ts

function transformHeaders(config: AxiosRequestConfig): any {
  const { headers = {}, data } = config;
  if (isPlainObject(data)) {
    if (headers && !headers["Content-Type"]) {
      headers["Content-Type"] = "application/x-www-form-urlencoded;charset=utf-8";
    }
  } else if (typeof FormData !== "undefined" && data instanceof FormData) {
    if (headers && !headers["Content-Type"]) {
      headers["Content-Type"] = "multipart/form-data";
    }
  }
  return headers;
}
```

我们通过`typeof FormData !== "undefined"`判断当前环境是否支持`FormData`，并且判断`data`是否是`FormData`的实例，如果是的话，并且用户没有配置`headers['Content-Type']`，我们就自动设置请求头`Content-Type`为`multipart/form-data`。

## 4.2 转换请求数据 data

当请求头`Content-Type`为`multipart/form-data`的时候，我们不需要对`data`做任何转换，因为`FormData`数据格式可以直接被`xhr.send`发送。

所以，我们只需要在`src/helpers/data.ts`中的`transformRequestData`函数里添加对`FormData`的判断即可。

```typescript
// src/helpers/data.ts

export function transformRequestData(data: any): any {
  if (isPlainObject(data)) {
    return transformFormDataToUrlencoded(data);
  } else if (typeof FormData !== "undefined" && data instanceof FormData) {
    return data;
  }
  return data;
}
```

## 4.3 demo 编写

好了，实现之后，我们编写`demo`来测试下是否好用。

我们在`examples/moreParams/app.ts`中添加`FormData`的测试代码：

```typescript
import axios from "../../src/index";

// 普通对象
axios({
  method: "post",
  url: "/api/moreParams/post",
  data: {
    a: 1,
    b: 2,
  },
});

// FormData
const formData = new FormData();
formData.append("a", "1");
formData.append("b", "2");
axios({
  method: "post",
  url: "/api/moreParams/post",
  data: formData,
});
```

接着在`server.js`中修改路由，使其能够处理`FormData`数据：

```javascript
// 添加更多参数测试接口
const multer = require("multer");
const upload = multer();
router.post("/api/moreParams/post", upload.none(), function(req, res) {
  console.log(req.body);
  res.json(req.body);
});
```

这里我们使用了`multer`中间件来处理`multipart/form-data`格式的数据，`upload.none()`表示不处理任何文件，只处理文本数据。

OK,我们在命令行中执行：

```bash
# 同时开启客户端和服务端
npm run server | npm start
```

接着我们打开`chrome`浏览器，访问<http://localhost:8000/> 接着我们点击`moreParams`，通过`F12`的`network`部分我们可以看到两个请求都已经正常发出，第一个请求的`Content-Type`为`application/x-www-form-urlencoded;charset=utf-8`，第二个请求的`Content-Type`为`multipart/form-data`，并且请求数据也是`FormData`格式。

![](~@/axios/08/02.gif)

# 5. 实现 application/json 格式

虽然我们之前已经实现了`application/json`格式，但是之前是写死的，现在我们需要根据用户的配置来决定是否使用`application/json`格式。

## 5.1 修改请求头 Content-Type

如果用户配置了`headers['Content-Type']`为`application/json`，那么我们就使用`application/json`格式。

我们在`src/core/xhr.ts`中的`transformHeaders`函数里添加对`application/json`的判断：

```typescript
// src/core/xhr.ts

function transformHeaders(config: AxiosRequestConfig): any {
  const { headers = {}, data } = config;
  if (isPlainObject(data)) {
    if (headers && !headers["Content-Type"]) {
      headers["Content-Type"] = "application/x-www-form-urlencoded;charset=utf-8";
    }
  } else if (typeof FormData !== "undefined" && data instanceof FormData) {
    if (headers && !headers["Content-Type"]) {
      headers["Content-Type"] = "multipart/form-data";
    }
  }
  // 如果用户配置了headers['Content-Type']，那么我们就使用用户配置的
  if (headers && headers["Content-Type"]) {
    if (headers["Content-Type"] === "application/json") {
      headers["Content-Type"] = "application/json;charset=utf-8";
    }
  }
  return headers;
}
```

如果用户配置了`headers['Content-Type']`，那么我们就使用用户配置的，并且如果用户配置的是`application/json`，我们就将其设置为`application/json;charset=utf-8`。

## 5.2 转换请求数据 data

当请求头`Content-Type`为`application/json;charset=utf-8`的时候，我们需要将`data`转换为`JSON`字符串。

所以，我们需要在`src/helpers/data.ts`中的`transformRequestData`函数里添加对`application/json`的判断。

```typescript
// src/helpers/data.ts

export function transformRequestData(data: any, headers: any): any {
  if (isPlainObject(data)) {
    if (headers && headers["Content-Type"] === "application/json;charset=utf-8") {
      return JSON.stringify(data);
    }
    return transformFormDataToUrlencoded(data);
  } else if (typeof FormData !== "undefined" && data instanceof FormData) {
    return data;
  }
  return data;
}
```

我们给`transformRequestData`函数增加了一个参数`headers`，用来判断请求头中的`Content-Type`。如果请求头中的`Content-Type`为`application/json;charset=utf-8`，那么我们就将`data`转换为`JSON`字符串；否则，我们就将`data`转换为表单字符串。

另外，我们还需要在`src/core/xhr.ts`中修改`transformRequestData`函数的调用，传入`headers`参数。

```typescript
// src/core/xhr.ts

function processConfig(config: AxiosRequestConfig): void {
  config.url = transformUrl(config);
  config.headers = transformHeaders(config);
  config.data = transformRequestData(config.data, config.headers);
}
```

## 5.3 demo 编写

好了，实现之后，我们编写`demo`来测试下是否好用。

我们在`examples/moreParams/app.ts`中添加`application/json`的测试代码：

```typescript
import axios from "../../src/index";

// 普通对象
axios({
  method: "post",
  url: "/api/moreParams/post",
  data: {
    a: 1,
    b: 2,
  },
});

// FormData
const formData = new FormData();
formData.append("a", "1");
formData.append("b", "2");
axios({
  method: "post",
  url: "/api/moreParams/post",
  data: formData,
});

// application/json
axios({
  method: "post",
  url: "/api/moreParams/post",
  headers: {
    "Content-Type": "application/json",
  },
  data: {
    a: 1,
    b: 2,
  },
});
```

OK,我们在命令行中执行：

```bash
# 同时开启客户端和服务端
npm run server | npm start
```

接着我们打开`chrome`浏览器，访问<http://localhost:8000/> 接着我们点击`moreParams`，通过`F12`的`network`部分我们可以看到三个请求都已经正常发出，第一个请求的`Content-Type`为`application/x-www-form-urlencoded;charset=utf-8`，第二个请求的`Content-Type`为`multipart/form-data`，第三个请求的`Content-Type`为`application/json;charset=utf-8`，并且请求数据也是`JSON`字符串格式。

![](~@/axios/08/03.gif)

# 6. 遗留问题

我们虽然实现了三种数据格式，但是还存在一些问题：

1. 如果用户配置了`headers['Content-Type']`为其他值，比如`text/plain`，那么我们就不会对`data`做任何转换，而是直接发送，这显然是不对的。
2. 如果用户配置了`headers['Content-Type']`为`application/json`，但是`data`不是普通对象，比如是`string`，那么我们就不会对`data`做任何转换，而是直接发送，这显然也是不对的。

这两个问题我们暂时先不处理，等到后面我们再来处理。

# 7. 总结

在本篇文章中，我们给`axios`实现了对多种数据格式的支持，包括`application/x-www-form-urlencoded`、`multipart/form-data`、`application/json`三种格式。并且我们通过`demo`测试了这三种格式的使用。

在下一篇文章中，我们将要实现`axios`的异常处理机制，使得axios在网络错误、超时、状态码错误等情况下能够抛出异常，并且能够让用户捕获到这些异常。


2025-08-25 12:56:58,447 - evaluation_logger_Attraction-9 - INFO - Complete Result: {'score': 0, 'reason': 'no requested information is addressed'}
2025-08-25 12:57:05,160 - evaluation_logger_Attraction-9 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 12:57:05,160 - evaluation_logger_Attraction-9 - INFO - Message: Success.
2025-08-25 12:57:05,160 - evaluation_logger_Attraction-9 - INFO - Success turn num = 2
2025-08-25 12:57:05,160 - evaluation_logger_Attraction-9 - INFO - ----------------------------------------------------------------------------------------------------
