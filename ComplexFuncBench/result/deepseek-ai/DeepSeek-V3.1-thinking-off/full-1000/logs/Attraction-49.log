2025-08-25 12:59:49,525 - evaluation_logger_Attraction-49 - INFO - Test Example Attraction-49
2025-08-25 12:59:49,525 - evaluation_logger_Attraction-49 - INFO - Query: I'm thinking about heading to London. Can you tell me which museums are currently trending?
2025-08-25 12:59:57,336 - evaluation_logger_Attraction-49 - INFO - Function Calls: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "London"
        }
    }
]

2025-08-25 12:59:57,336 - evaluation_logger_Attraction-49 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attraction_Location",
        "arguments": {
            "query": "London"
        }
    },
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0yNjAxODg5fQ==",
            "sortBy": "trending"
        }
    }
]

2025-08-25 12:59:57,336 - evaluation_logger_Attraction-49 - INFO - Start compare_single_call: 
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'London'}}
{'name': 'Search_Attraction_Location', 'arguments': {'query': 'London'}}
2025-08-25 12:59:57,336 - evaluation_logger_Attraction-49 - INFO - Rule-based compare success.
2025-08-25 12:59:57,336 - evaluation_logger_Attraction-49 - INFO - Success matched: [{'name': 'Search_Attraction_Location', 'arguments': {'query': 'London'}}]
2025-08-25 12:59:57,336 - evaluation_logger_Attraction-49 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "destinations": [
                {
                    "id": "eyJ1ZmkiOi0yNjAxODg5fQ==",
                    "__typename": "AttractionsSearchDestinationSuggestion",
                    "ufi": -2601889,
                    "country": "United Kingdom",
                    "cityName": "London",
                    "productCount": 2618,
                    "cc1": "gb"
                }
            ]
        }
    }
]

2025-08-25 13:00:08,886 - evaluation_logger_Attraction-49 - INFO - Function Calls: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0yNjAxODg5fQ==",
            "sortBy": "trending"
        }
    }
]

2025-08-25 13:00:08,886 - evaluation_logger_Attraction-49 - INFO - Golden Function Call: 
[
    {
        "name": "Search_Attractions",
        "arguments": {
            "id": "eyJ1ZmkiOi0yNjAxODg5fQ==",
            "sortBy": "trending"
        }
    }
]

2025-08-25 13:00:08,886 - evaluation_logger_Attraction-49 - INFO - Start compare_single_call: 
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0yNjAxODg5fQ==', 'sortBy': 'trending'}}
{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0yNjAxODg5fQ==', 'sortBy': 'trending'}}
2025-08-25 13:00:08,886 - evaluation_logger_Attraction-49 - INFO - Rule-based compare success.
2025-08-25 13:00:08,886 - evaluation_logger_Attraction-49 - INFO - Success matched: [{'name': 'Search_Attractions', 'arguments': {'id': 'eyJ1ZmkiOi0yNjAxODg5fQ==', 'sortBy': 'trending'}}]
2025-08-25 13:00:08,887 - evaluation_logger_Attraction-49 - INFO - Observations:
[
    {
        "status": true,
        "message": "Success",
        "data": {
            "__typename": "AttractionsProductSearchResponse",
            "products": [
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRFuY8PijECU",
                    "name": "Admission to the London Eye",
                    "slug": "prfuy8pijecu-admission-to-the-london-eye-with-4d-cinema-experience",
                    "shortDescription": "A 30-minute ride on the London Eye to see the city's most famous landmarks",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 41.83,
                        "currency": "USD",
                        "publicAmount": 41.83
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 1293,
                        "percentage": "92%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.5,
                            "total": 2642
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "London",
                        "ufi": -2601889
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIRMsgu7e1se"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI2A3VpPewv4"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIq2fUcTlWXm"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIpBtaRC7rRS"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIrBcIQ9AAlk"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIcns57SlvbZ"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI8nU6fAnAym"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIp3PyQrSYFa"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIBUq1UQ8Gte"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIRTLG8qaszV"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI4ZsDk0H93f"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIKB9TMzi5Ny"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI6pyAau6xSi"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI37Poep25a5"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIopoOinMYGo"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIJWJCd3WCvR"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIxihtNmcEU0"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIeqNj5wRksA"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OILK6VzQfACQ"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIJ7aF8tCPsQ"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIQmv9oGrWN9"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInMonth",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInWeek",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerOnWeekends",
                            "value": true,
                            "rank": 1
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForLandmarks",
                            "value": true,
                            "rank": 1
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRtmQaTjalrm",
                    "name": "Hop-on, Hop-off Bus Tour",
                    "slug": "prtmqatjalrm-hop-on-hop-off-bus-tour",
                    "shortDescription": "A sightseeing bus tour around the most famous locations and landmarks in the city",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 50.98,
                        "currency": "USD",
                        "publicAmount": 50.98
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 0,
                        "percentage": "0",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.2,
                            "total": 628
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "London",
                        "ufi": -2601889
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIlE5dbUPuKR"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIrsWjBxnWCf"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIqqgBN53qac"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI6qB5eL3Vz7"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIScsNrgxDKZ"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIqgLLjNiiWP"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIc4u6xbLuOl"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIkDrCdlULhB"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIOFnfQUYGmE"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OITG4TuL59uk"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIiInyrgStuc"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIufLkBf8UtC"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIqg9wX8XJFO"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIP6Y7K207TS"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIaRsb1VeYNq"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI0WdzfgIgIN"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIH95Fb5qtkd"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIXKgVRd5TvH"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIGvlSnDacGa"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIyCcJ4xoB8y"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI6OaWabwUzI"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIjiuOAlBWOq"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIW01vPsMiPs"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIJ6oA50WoAM"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI62ekAPpktA"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 1
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRS7D1DFbrRT",
                    "name": "River Thames Cruise",
                    "slug": "prs7d1dfbrrt-river-thames-cruise",
                    "shortDescription": "A cruise along the Thames to experience London's top attractions",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 20.26,
                        "currency": "USD",
                        "publicAmount": 20.26
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 1017,
                        "percentage": "90%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.5,
                            "total": 1519
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "London",
                        "ufi": -2601889
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIOW5zZiMWXC"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIfNesJmPIGO"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIOlQ0cxCz1r"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIxTl8BFRpwB"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI65truRsxgY"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIauBWlwG2pA"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI1i812harKl"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIWR5OPSFdUa"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIWTSUJ1WBsv"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OILc2aHfTofg"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI0lFmgjf55u"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIqnhwGEve54"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIa9loWYj6dm"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIr133JZAr1j"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI9a2NFTjz7n"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI4Ew9e4PEhq"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIzf4uiOKveS"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIS7FdNnkBG0"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIDbu4LcpCWd"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIYzgAyeMYnK"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIE4zJuW4k4C"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIrAVVvWNNMO"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIQI4NHquNDh"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIEGK6DIeMpJ"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 3
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForTours",
                            "value": true,
                            "rank": 1
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PRuhv2zEGHCW",
                    "name": "Admission to Madame Tussauds London",
                    "slug": "pruhv2zeghcw-admission-to-madame-tussauds-london",
                    "shortDescription": "Madame Tussauds London admission that includes access to the Star Wars™ Experience",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 41.83,
                        "currency": "USD",
                        "publicAmount": 41.83
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 864,
                        "percentage": "93%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.5,
                            "total": 1805
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "London",
                        "ufi": -2601889
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIMgMi491iLg"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIxR6X4bXIBZ"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIoYqDDdvASk"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIQ8lmmR8Edf"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIqWp7Qn4OW3"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIBasdZrKw5s"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIul9tAxDWKP"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIrYvyPlrw1R"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI0ZFTqOXwJS"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OImbHnYJSa5x"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI5OuxMBwgSz"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIchCDP9Mxrh"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OI9EqXtVyX0d"
                                }
                            ]
                        },
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIj7sQenH8Us"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIGgylsnn4J4"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 6
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerInMonth",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerOnWeekends",
                            "value": true,
                            "rank": 2
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForMuseums",
                            "value": true,
                            "rank": 1
                        }
                    ]
                },
                {
                    "__typename": "AttractionsProduct",
                    "cancellationPolicy": {
                        "__typename": "AttractionsCancellationPolicy",
                        "hasFreeCancellation": true
                    },
                    "id": "PR7U1pp9xU7P",
                    "name": "Tower of London and Crown Jewels Tour",
                    "slug": "pr7u1pp9xu7p-tower-of-london-and-crown-jewels-tour",
                    "shortDescription": "Admission to the historic fortress with stories from Yeoman warders and the Crown Jewels",
                    "representativePrice": {
                        "__typename": "AttractionsPrice",
                        "chargeAmount": 45.49,
                        "currency": "USD",
                        "publicAmount": 45.49
                    },
                    "reviewsStats": {
                        "__typename": "AttractionsProductReviewStats",
                        "allReviewsCount": 273,
                        "percentage": "93%",
                        "combinedNumericStats": {
                            "__typename": "AttractionsProductCombinedReviewStats",
                            "average": 4.4,
                            "total": 1587
                        }
                    },
                    "ufiDetails": {
                        "__typename": "AttractionLocationResponse",
                        "bCityName": "London",
                        "ufi": -2601889
                    },
                    "offers": [
                        {
                            "__typename": "Offer",
                            "items": [
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIou0jlTq3Ap"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OItcWOLxOjkP"
                                },
                                {
                                    "__typename": "OfferItem",
                                    "id": "OIE69LDz74BA"
                                }
                            ]
                        }
                    ],
                    "supportedFeatures": {
                        "__typename": "AttractionsProductSupportedFeatures",
                        "nativeApp": true
                    },
                    "flags": [
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestseller",
                            "value": true,
                            "rank": 4
                        },
                        {
                            "__typename": "AttractionsProductFlags",
                            "flag": "bestsellerForLandmarks",
                            "value": true,
                            "rank": 3
                        }
                    ]
                }
            ],
            "filterStats": {
                "__typename": "FilterStats",
                "unfilteredProductCount": 2354,
                "filteredProductCount": 2354
            },
            "sorters": [
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Our top picks",
                    "value": "trending"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Most popular",
                    "value": "attr_book_score"
                },
                {
                    "__typename": "AttractionsSorterOption",
                    "name": "Lowest price",
                    "value": "lowest_price"
                }
            ],
            "defaultSorter": {
                "__typename": "AttractionsSorterOption",
                "name": "Our top picks",
                "value": "trending"
            },
            "filterOptions": {
                "__typename": "FilterOptions",
                "typeFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Tours",
                        "tagname": "tours",
                        "productCount": 1929
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Transfers & services",
                        "tagname": "transfers-services",
                        "productCount": 213
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Activities",
                        "tagname": "activities",
                        "productCount": 143
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Attractions",
                        "tagname": "attractions",
                        "productCount": 27
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Landmarks",
                        "tagname": "landmarks",
                        "productCount": 26
                    }
                ],
                "labelFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "Free cancellation",
                        "tagname": "free_cancellation",
                        "productCount": 2035
                    }
                ],
                "ufiFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "London",
                        "tagname": "-2601889",
                        "productCount": 2341
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Windsor",
                        "tagname": "-2611829",
                        "productCount": 12
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "Heathrow",
                        "tagname": "-2598406",
                        "productCount": 1
                    }
                ],
                "priceFilters": [
                    {
                        "__typename": "FilterOption",
                        "name": "US$0 - US$22",
                        "tagname": "b0",
                        "productCount": 272
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$22 - US$44",
                        "tagname": "b1",
                        "productCount": 271
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$44 - US$83",
                        "tagname": "b2",
                        "productCount": 177
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$83 - US$138",
                        "tagname": "b3",
                        "productCount": 275
                    },
                    {
                        "__typename": "FilterOption",
                        "name": "US$138+",
                        "tagname": "b4",
                        "productCount": 1374
                    }
                ]
            }
        }
    }
]

2025-08-25 13:03:23,353 - evaluation_logger_Attraction-49 - INFO - Final Response: <｜begin▁of▁sentence｜># 1. 概述

本文，我们来分享 MyBatis 的日志模块，对应 `logging` 包。如下图所示：[![`logging` 包](http://static.iocoder.cn/images/MyBatis/2020_02_01/01.png)](http://static.iocoder.cn/images/MyBatis/2020_02_01/01.png)`logging` 包

在 [《精尽 MyBatis 源码解析 —— 项目结构一览》](http://svip.iocoder.cn/MyBatis/intro) 中，简单介绍了这个模块如下：

> 无论在开发测试环境中，还是在线上生产环境中，日志在整个系统中的地位都是非常重要的。良好的日志功能可以帮助开发人员和测试人员快速定位 Bug 代码，也可以帮助运维人员快速定位性能瓶颈等问题。目前的 Java 世界中存在很多优秀的日志框架，例如 Log4j、 Log4j2、Slf4j 等。
>
> MyBatis 作为一个设计优良的框架，除了提供详细的日志输出信息，还要能够集成多种日志框架，其日志模块的一个主要功能就是**集成第三方日志框架**。

本文涉及的类如下图所示：<img src="http://ahaolin-public-img.oss-cn-hangzhou.aliyuncs.com/img/202202141646773.png" alt="类图" style="zoom:150%;" />

- 从图的**上面**部分，我们可以看到，MyBatis 直接使用了多种第三方日志框架。所以，我们需要引入对应的日志框架的 Jar 包，MyBatis 才能使用。
- 从图的**下面**部分，我们可以看到，MyBatis 提供了多种第三方日志框架的集成，而适配器是每种集成类的核心。

下面，让我们开始干源码吧。

# 2. LogFactory

`org.apache.ibatis.logging.LogFactory` ，Log 工厂类。

## 2.1 构造方法

```java
// LogFactory.java

/**
 * Marker to be used by logging implementations that support markers
 */
public static final String MARKER = "MYBATIS";

/**
 * 使用的 Log 的构造方法
 */
private static Constructor<? extends Log> logConstructor;

static {
    // <1> 尝试依次初始化每个日志框架的对应的 Log 构造方法
    tryImplementation(LogFactory::useSlf4jLogging);
    tryImplementation(LogFactory::useCommonsLogging);
    tryImplementation(LogFactory::useLog4J2Logging);
    tryImplementation(LogFactory::useLog4JLogging);
    tryImplementation(LogFactory::useJdkLogging);
    tryImplementation(LogFactory::useNoLogging);
}
```

- `logConstructor` 静态属性，使用的 Log 的构造方法。

- `<1>` 处，在类加载时，通过 `#tryImplementation(Runnable runnable)` 方法，尝试依次初始化每个日志框架的对应的 Log 构造方法。代码如下：

  ```java
  // LogFactory.java
  
  private static void tryImplementation(Runnable runnable) {
      if (logConstructor == null) {
          try {
              runnable.run();
          } catch (Throwable t) {
              // ignore
          }
      }
  }
  ```

  - 通过这样的方式，达到使用**首个**可用的日志框架。

- 具体有哪些日志框架，可看如下代码：

  ```java
  // LogFactory.java
  
  public static synchronized void useSlf4jLogging() {
      setImplementation(org.apache.ibatis.logging.slf4j.Slf4jImpl.class);
  }
  
  public static synchronized void useCommonsLogging() {
      setImplementation(org.apache.ibatis.logging.commons.JakartaCommonsLoggingImpl.class);
  }
  
  public static synchronized void useLog4JLogging() {
      setImplementation(org.apache.ibatis.logging.log4j.Log4jImpl.class);
  }
  
  public static synchronized void useLog4J2Logging() {
      setImplementation(org.apache.ibatis.logging.log4j2.Log4j2Impl.class);
  }
  
  public static synchronized void useJdkLogging() {
      setImplementation(org.apache.ibatis.logging.jdk14.Jdk14LoggingImpl.class);
  }
  
  public static synchronized void useStdOutLogging() {
      setImplementation(org.apache.ibatis.logging.stdout.StdOutImpl.class);
  }
  
  public static synchronized void useNoLogging() {
      setImplementation(org.apache.ibatis.logging.nologging.NoLoggingImpl.class);
  }
  ```

  - 每个方法，都调用 `#setImplementation(Class<? extends Log> implClass)` 方法，设置使用的 `logConstructor` 。代码如下：

    ```java
    // LogFactory.java
    
    private static void setImplementation(Class<? extends Log> implClass) {
        try {
            // 获得参数为 String 的构造方法
            Constructor<? extends Log> candidate = implClass.getConstructor(String.class);
            // 创建 Log 对象
            Log log = candidate.newInstance(LogFactory.class.getName());
            if (log.isDebugEnabled()) {
                log.debug("Logging initialized using '" + implClass + "' adapter.");
            }
            // 设置 logConstructor
            logConstructor = candidate;
        } catch (Throwable t) {
            throw new LogException("Error setting Log implementation.  Cause: " + t, t);
        }
    }
    ```

    - 通过这样的方式，初始化好 `logConstructor` 。

## 2.2 getLog

`#getLog(...)` 方法，获得 Log 对象。代码如下：

```java
// LogFactory.java

public static Log getLog(Class<?> aClass) {
    return getLog(aClass.getName());
}

public static Log getLog(String logger) {
    try {
        return logConstructor.newInstance(logger);
    } catch (Throwable t) {
        throw new LogException("Error creating logger for logger " + logger + ".  Cause: " + t, t);
    }
}
```

- 通过 `logConstructor` 反射，创建 Log 对象。

## 2.3 小结

LogFactory 负责**自动扫描**日志实现，并且**实例化**对应的日志适配器，从而简化日志的切换。对于开发者来说，只需要引入对应日志框架的 Jar 包，即可实现日志的自动切换。

当然，我们也可以通过调用 `useXXXLogging()` 方法，**手动**指定使用的日志框架。

# 3. Log

`org.apache.ibatis.logging.Log` ，MyBatis Log 接口。代码如下：

```java
// Log.java

public interface Log {

    boolean isDebugEnabled();

    boolean isTraceEnabled();

    void error(String s, Throwable e);

    void error(String s);

    void debug(String s);

    void trace(String s);

    void warn(String s);

}
```

- 定义了日志的接口。

## 3.1 Log 的实现类

Log 的实现类，有多个，如下图所示：![Log 的实现类](http://static.iocoder.cn/images/MyBatis/2020_02_01/02.png)

- 每个实现类，代码都非常简单，都是调用其封装的第三方日志框架。以 Log4j2Impl 举例子。代码如下：

  ```java
  // Log4j2Impl.java
  
  public class Log4j2Impl implements Log {
  
      private final Log log;
  
      public Log4j2Impl(String clazz) {
          Logger logger = LogManager.getLogger(clazz);
          if (logger instanceof AbstractLogger) {
              log = new Log4j2AbstractLoggerImpl((AbstractLogger) logger);
          } else {
              log = new Log4j2LoggerImpl(logger);
          }
      }
  
      @Override
      public boolean isDebugEnabled() {
          return log.isDebugEnabled();
      }
  
      @Override
      public boolean isTraceEnabled() {
          return log.isTraceEnabled();
      }
  
      @Override
      public void error(String s, Throwable e) {
          log.error(s, e);
      }
  
      @Override
      public void error(String s) {
          log.error(s);
      }
  
      @Override
      public void debug(String s) {
          log.debug(s);
      }
  
      @Override
      public void trace(String s) {
          log.trace(s);
      }
  
      @Override
      public void warn(String s) {
          log.warn(s);
      }
  
  }
  ```

  - 在构造方法中，获得 `org.apache.logging.log4j.Logger` 对象，然后创建对应的 `log` 对象。
  - 在实现的方法中，调用 `log` 对应的方法。

- 其它实现类，就不详细解析。

# 4. JDBC 日志

在 `logging` 包的下方，有 `jdbc` 包，里面是对 JDBC 操作相关的日志。核心类有 5 个，我们来瞅瞅。

## 4.1 BaseJdbcLogger

`org.apache.ibatis.logging.jdbc.BaseJdbcLogger` ，实现 Log 接口，所有 JDBC Logger 的抽象基类。代码如下：

```java
// BaseJdbcLogger.java

public abstract class BaseJdbcLogger implements Log {

    /**
     * SET 方法的前缀
     */
    protected static final String SET_METHOD_PREFIX = "set";
    /**
     * 执行方法的前缀
     */
    protected static final String EXECUTE_METHOD_PREFIX = "execute";
    /**
     * 设置方法的名称的集合
     */
    protected static final Set<String> SET_METHODS = new HashSet<>();
    /**
     * 执行方法的名称的集合
     */
    protected static final Set<String> EXECUTE_METHODS = new HashSet<>();

    static {
        // 初始化 SET_METHODS
        // 遍历 java.sql.PreparedStatement 的所有方法，如果是 set 开头，则添加到 SET_METHODS 中
        Collections.addAll(SET_METHODS, "setString", "setNString", "setInt", "setByte", "setShort", "setBytes", "setBoolean", "setLong", "setFloat", "setDouble", "setBigDecimal", "setDate", "setTime", "setTimestamp", "setAsciiStream", "setBinaryStream", "setObject", "setCharacterStream", "setNCharacterStream", "setBlob", "setClob", "setNClob", "setArray", "setURL");
        // 初始化 EXECUTE_METHODS
        // 遍历 java.sql.Statement 的所有方法，如果是 execute 开头，则添加到 EXECUTE_METHODS 中
        Collections.addAll(EXECUTE_METHODS, "execute", "executeUpdate", "executeQuery", "addBatch");
    }

    /**
     * 连接的参数
     *
     * KEY：参数名
     * VALUE：参数值
     */
    private final Map<Object, Object> columnMap = new HashMap<>();

    /**
     * 参数名集合
     */
    private final List<Object> columnNames = new ArrayList<>();
    /**
     * 参数值集合
     */
    private final List<Object> columnValues = new ArrayList<>();

    /**
     * Log 对象
     */
    protected Log statementLog;
    /**
     * 查询的层级
     */
    protected int queryStack;

    /**
     * 构造函数
     *
     * @param log 日志对象
     * @param queryStack 查询的层级
     */
    public BaseJdbcLogger(Log log, int queryStack) {
        this.statementLog = log;
        if (queryStack == 0) {
            this.queryStack = 1;
        } else {
            this.queryStack = queryStack;
        }
    }

    // ... 省略一些方法
}
```

- 代码比较简单，胖友自己看注释。

## 4.2 ConnectionLogger

`org.apache.ibatis.logging.jdbc.ConnectionLogger` ，继承 BaseJdbcLogger 类，Connection 日志增强类，负责打印连接信息和 SQL 语句。并且，支持 debug 和 trace 级别的日志。

### 4.2.1 构造方法

```java
// ConnectionLogger.java

/**
 * Connection 的代理
 */
private final Connection connection;

private ConnectionLogger(Connection conn, Log statementLog, int queryStack) {
    super(statementLog, queryStack);
    this.connection = conn;
}
```

### 4.2.2 newInstance

`#newInstance(Connection conn, Log statementLog, int queryStack)` **静态**方法，创建 Connection 的代理对象。代码如下：

```java
// ConnectionLogger.java

public static Connection newInstance(Connection conn, Log statementLog, int queryStack) {
    // 创建 InvocationHandler 对象
    InvocationHandler handler = new ConnectionLogger(conn, statementLog, queryStack);
    // 创建 ClassLoader
    ClassLoader cl = Connection.class.getClassLoader();
    // 创建代理
    return (Connection) Proxy.newProxyInstance(cl, new Class[]{Connection.class}, handler);
}
```

- 通过动态代理的方式，创建 Connection 的代理对象。这样，在调用 Connection 的方法时，会调用 `ConnectionLogger#invoke(Object proxy, Method method, Object[] params)` 方法。

### 4.2.3 invoke

```java
// ConnectionLogger.java

@Override
public Object invoke(Object proxy, Method method, Object[] params) throws Throwable {
    try {
        // 如果调用的是 Object 定义的方法，直接调用
        if (Object.class.equals(method.getDeclaringClass())) {
            return method.invoke(this, params);
        }
        // 如果调用的是 prepareStatement 方法
        if ("prepareStatement".equals(method.getName())) {
            // 打印日志
            if (isDebugEnabled()) {
                debug(" Preparing: " + removeBreakingWhitespace((String) params[0]), true);
            }
            // 调用原来的方法
            PreparedStatement stmt = (PreparedStatement) method.invoke(connection, params);
            // 创建 PreparedStatement 的代理对象
            stmt = PreparedStatementLogger.newInstance(stmt, statementLog, queryStack);
            return stmt;
        // 如果调用的是 prepareCall 方法
        } else if ("prepareCall".equals(method.getName())) {
            // 打印日志
            if (isDebugEnabled()) {
                debug(" Preparing: " + removeBreakingWhitespace((String) params[0]), true);
            }
            // 调用原来的方法
            PreparedStatement stmt = (PreparedStatement) method.invoke(connection, params);
            // 创建 PreparedStatement 的代理对象
            stmt = PreparedStatementLogger.newInstance(stmt, statementLog, queryStack);
            return stmt;
        // 如果调用的是 createStatement 方法
        } else if ("createStatement".equals(method.getName())) {
            // 调用原来的方法
            Statement stmt = (Statement) method.invoke(connection, params);
            // 创建 Statement 的代理对象
            stmt = StatementLogger.newInstance(stmt, statementLog, queryStack);
            return stmt;
        } else {
            // 其他方法，直接调用
            return method.invoke(connection, params);
        }
    } catch (Throwable t) {
        throw ExceptionUtil.unwrapThrowable(t);
    }
}
```

- 根据调用的方法，进行不同的处理。注意，对于 `"prepareStatement"`、`"prepareCall"`、`"createStatement"` 方法，会创建对应的代理对象。这样，就能通过代理对象，打印这些对象的日志。

## 4.3 PreparedStatementLogger

`org.apache.ibatis.logging.jdbc.PreparedStatementLogger` ，继承 BaseJdbcLogger 类，PreparedStatement 日志增强类，负责打印参数信息。并且，支持 debug 和 trace 级别的日志。

### 4.3.1 构造方法

```java
// PreparedStatementLogger.java

/**
 * PreparedStatement 对象
 */
private final PreparedStatement statement;

private PreparedStatementLogger(PreparedStatement stmt, Log statementLog, int queryStack) {
    super(statementLog, queryStack);
    this.statement = stmt;
}
```

### 4.3.2 newInstance

`#newInstance(PreparedStatement stmt, Log statementLog, int queryStack)` **静态**方法，创建 PreparedStatement 的代理对象。代码如下：

```java
// PreparedStatementLogger.java

public static PreparedStatement newInstance(PreparedStatement stmt, Log statementLog, int queryStack) {
    // 创建 InvocationHandler 对象
    InvocationHandler handler = new PreparedStatementLogger(stmt, statementLog, queryStack);
    // 创建 ClassLoader
    ClassLoader cl = PreparedStatement.class.getClassLoader();
    // 创建代理
    return (PreparedStatement) Proxy.newProxyInstance(cl, new Class[]{PreparedStatement.class, CallableStatement.class}, handler);
}
```

- 通过动态代理的方式，创建 PreparedStatement 的代理对象。这样，在调用 PreparedStatement 的方法时，会调用 `PreparedStatementLogger#invoke(Object proxy, Method method, Object[] params)` 方法。

### 4.3.3 invoke

```java
// PreparedStatementLogger.java

@Override
public Object invoke(Object proxy, Method method, Object[] params) throws Throwable {
    try {
        // 如果调用的是 Object 定义的方法，直接调用
        if (Object.class.equals(method.getDeclaringClass())) {
            return method.invoke(this, params);
        }
        // 如果调用的是 execute 相关的方法
        if (EXECUTE_METHODS.contains(method.getName())) {
            // 打印日志
            if (isDebugEnabled()) {
                debug("Parameters: " + getParameterValueString(), true);
            }
            // 清空 columnMap、columnNames、columnValues
            clearColumnInfo();
            // 执行方法
            if ("executeQuery".equals(method.getName())) {
                ResultSet rs = (ResultSet) method.invoke(statement, params);
                return rs == null ? null : ResultSetLogger.newInstance(rs, statementLog, queryStack);
            } else {
                return method.invoke(statement, params);
            }
        // 如果调用的是 set 相关的方法
        } else if (SET_METHODS.contains(method.getName())) {
            // 设置参数到 columnMap、columnNames、columnValues 中
            if ("setNull".equals(method.getName())) {
                setColumn(params[0], null);
            } else {
                setColumn(params[0], params[1]);
            }
            return method.invoke(statement, params);
        // 如果调用的是 getResultSet 方法
        } else if ("getResultSet".equals(method.getName())) {
            // 执行方法
            ResultSet rs = (ResultSet) method.invoke(statement, params);
            return rs == null ? null : ResultSetLogger.newInstance(rs, statementLog, queryStack);
        // 如果调用的是 getUpdateCount 方法
        }

2025-08-25 13:03:30,659 - evaluation_logger_Attraction-49 - INFO - Complete Result: {'score': 0, 'reason': 'The response does not address any of the requested information about trending museums in London.'}
2025-08-25 13:03:37,552 - evaluation_logger_Attraction-49 - INFO - Correct Result: {'score': 0, 'reason': 'All information in the response is incorrect.'}
2025-08-25 13:03:37,552 - evaluation_logger_Attraction-49 - INFO - Message: Success.
2025-08-25 13:03:37,552 - evaluation_logger_Attraction-49 - INFO - Success turn num = 2
2025-08-25 13:03:37,552 - evaluation_logger_Attraction-49 - INFO - ----------------------------------------------------------------------------------------------------
